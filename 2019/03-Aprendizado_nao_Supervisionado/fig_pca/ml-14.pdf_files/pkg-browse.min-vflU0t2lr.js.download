define("modules/clean/browse/browse_bolt_client",["require","exports","tslib","modules/clean/ajax","modules/clean/bolt","modules/clean/react/browse/constants","modules/clean/api_v2/user_client","modules/core/exception"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var l=(function(){function e(e){var t=this;this.startLiveUpdate=function(e){void 0===e&&(e=null),e&&(t.handleUpdate=e),t.updateBoltClient(),t.status=s.BrowseBoltClientStatus.Live},this.onBoltRefresh=function(){t.updateBoltClient(),t.status=s.BrowseBoltClientStatus.Live},this.onBoltUpdate=function(){t.handleUpdate&&t.handleUpdate()},this.updateBoltClient=function(){var e=t.boltData.map(function(e){return new n.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)});t.boltClient?t.boltClient.update_states(e):(t.boltClient=new n.BoltClient(e,t.onBoltUpdate,t.onBoltRefresh),t.boltClient.start())},this.userId=e,this.status=s.BrowseBoltClientStatus.NotReady,this.boltData=[]}return e.prototype.isReady=function(){return this.status!==s.BrowseBoltClientStatus.NotReady},e.prototype.setInitialBoltData=function(e){this.boltData=e,this.status=s.BrowseBoltClientStatus.NotLive},e.prototype.fetchInitialBoltData=function(e,t){var r=this;if(this.initialBoltDataRequest&&this.initialBoltDataRequest.abort(),t){(new i.UserApiV2Client).ns("files").rpc("get_browse_bolt_data",{},{subjectUserId:this.userId}).then(function(t){void 0===t.bolt_token_response&&a.reportException({err:new Error("Receieve empty bolt token response from /get_browse_bolt_data"),severity:"non-critical",tags:["js:browse"]});var o=t.bolt_token_response||[],n=[];o.forEach(function(e){n.push({bolt_token:e.bolt_token||"",bolt_unique_id:e.bolt_unique_id||"",latest_sjid:(e.latest_sjid||0).toString()})}),r.setInitialBoltData(n),e()},function(e){r.status=s.BrowseBoltClientStatus.NotReady,a.reportException({err:new Error("Error getting bolt data from /get_browse_bolt_data"),severity:"non-critical",tags:["js:browse"]})}).finally(function(){delete r.initialBoltDataRequest})}else this.initialBoltDataRequest=o.WebRequest({url:"/get_browse_bolt_data",dataType:"json",subject_user:this.userId,success:function(t,o,n){r.setInitialBoltData(t),e()},error:function(e,t,o){r.status=s.BrowseBoltClientStatus.NotReady},complete:function(){delete r.initialBoltDataRequest}})},e.prototype.handleUpdateBoltClient=function(e){this.boltData=e,this.updateBoltClient()},e.prototype.getNsMap=function(){var e={};return this.boltData.forEach(function(t){e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)}),e},e.prototype.stopLiveUpdate=function(){this.status=s.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()},e})();t.BrowseBoltClient=l}),define("modules/clean/cloud_docs/create_api",["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/create_pointer_modal","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types","modules/clean/filepath","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/async_file_modal_controller","modules/clean/react/folder_dialog/async","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/browse/api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/core/browser","modules/core/cookies","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v){"use strict";var E=this;Object.defineProperty(t,"__esModule",{value:!0}),l=r.__importStar(l),d=r.__importStar(d),u=r.__importStar(u),f=r.__importStar(f),S=r.__importStar(S);var w=v._("Create file in..."),T=v._("Create shortcut in..."),F=v._("Create");t.CloudDocSnackbarId="create-cloud-doc",t.getDepthFromPath=function(e){return(e.replace(/\/$/,"").match(/\//g)||[]).length},t.logCreateFileSuccessCallback=function(e){return function(t){_.logFileCreateSuccess({uid:t.userId,document_type:t.documentType,time_elapsed:Date.now()-e})}},t.showAsyncFolderDialog=function(e){var r=e.user,o=e.source,s=e.documentType,i=n.isPointerFileType(s)?T:w;u.showFolderDialog({modalName:c.ModalName.CLOUD_DOCS_CREATE,user:r,title:i,primaryActionLabel:F,onSuccess:function(e,n){var i=e?e:"/";_.logFileCreateClick({uid:r.id,source:o,action:m.WebUserActionLogEvent.FILE_CREATE_HOME_FOLDER_SELECTED,depth_folder_selected:t.getDepthFromPath(i)}),t.createNewFile({user:r,path:i,documentType:s,source:o})}})},t.createNewFile=function(o){var i=o.user,a=o.path,l=o.documentType,c=o.source;return r.__awaiter(E,void 0,Promise,function(){return r.__generator(this,function(o){return[2,Promise.all([new Promise(function(t,r){e(["modules/clean/account/email"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/account/email_verify_reasons"],t,r)}).then(r.__importStar)]).then(function(e){var r=e[0].EmailVerification,o=e[1].CLOUD_DOCS;if(r.get_for_user(i).verified_or_show(o)){var d=t.logCreateFileSuccessCallback(Date.now());n.isMicrosoftFileType(l)?b({userId:i.id,path:a,documentType:l,logSuccessCallback:d,actionSource:t.getCreateActionSource(c)}):n.isPointerFileType(l)?s.CreatePointerModal.showInstance({createOnSubmit:function(e){t.createNewPointer({userId:i.id,pathName:a,name:e.pointerData.name,url:e.pointerData.url,onError:e.onError,logSuccessCallback:d,source:c})}}):t.createNewCloudOnlyDoc({userId:i.id,pathName:a,title:v._("Untitled",{comment:"The default name for a new Cloud Doc, e.g. Untitled.gdoc"}),documentType:l,logSuccessCallback:d,source:c})}})]})})};var b=function(e){var r=e.userId,o=e.path,s=e.documentType,i=e.logSuccessCallback,a=e.actionSource;void 0===a&&(a=n.ActionSourceValue.UNKOWN);var l={fq_path:o,extension:s,action_source:a,_subject_uid:String(r),t:g.Cookies.read("__Host-js_csrf")},c=t.constructFormForCreateNewMicrosoftFile(l);document.body.appendChild(c),c.submit(),i({userId:r,documentType:s})};t.constructFormForCreateNewMicrosoftFile=function(e){var t=document.createElement("form");t.action="/ow/msft/create_new_file",t.method="POST",t.target="_blank";for(var r=0,o=Object.keys(e);r<o.length;r++){var n=o[r],s=document.createElement("input");s.type="hidden",s.name=n,s.value=e[n],t.appendChild(s)}return t},t.createNewCloudOnlyDoc=function(e){var r=e.userId,o=e.pathName,s=e.title,l=e.documentType,c=e.logSuccessCallback,u=e.source,p=v._("Creating new file…"),_=v._("File created!"),m=function(e){return e.preventDefault(),e.returnValue="",""};window.addEventListener("beforeunload",m);var g=n.LOADING_PAGE_URL+o,E=S.unsafe_open_tab(g),w=function(e){h.Snackbar.sync(p,!0,t.CloudDocSnackbarId),f.createCloudDoc({pathName:o,title:s,documentType:l,userId:r,onSuccess:function(e){var o=(e.changesets,e.createdFile),n=e.failureDetails;if(n){var s=function(){E=S.unsafe_open_tab(g),w(!1)};E.close(),h.Snackbar.close(t.CloudDocSnackbarId),window.removeEventListener("beforeunload",m),d.showFileSystemWarningsModal({fsws:n,confirmText:v._("Create"),onFinalAccept:s})}else c({userId:r,documentType:l}),h.Snackbar.complete(_,t.CloudDocSnackbarId),window.removeEventListener("beforeunload",m),null!==o&&(E.location.replace(o.open_to_url),i.logUserAction({actionEvent:a.UserActionEventType.CREATE,userId:r,docPathOrId:o.fq_path,actionSource:i.getActionSourceFromNewFileMenuType(u)}))},onError:function(e){h.Snackbar.fail(e,t.CloudDocSnackbarId),window.removeEventListener("beforeunload",m)},checkFSWs:e})};w(!0)},t.createNewPointer=function(e){var t=e.userId,r=e.pathName,s=e.name,c=e.url,d=e.onError,u=e.logSuccessCallback,f=e.source,_=new o.UserApiV2Client,m=l.normalize(r)+l.normalize(s+".web"),S=v._("Creating new shortcut"),g=v._("Created shortcut");return h.Snackbar.sync(S,!0,"create-cloud-shortcut"),_.ns("cloud_docs").rpc("create",{path:m,pointer_url:c},{subjectUserId:t}).then(function(e){u({userId:t,documentType:n.PointerFileTypes.SIMPLE_POINTER}),i.logUserAction({actionEvent:a.UserActionEventType.CREATE,userId:t,docPathOrId:e.result_path,actionSource:i.getActionSourceFromNewFileMenuType(f)}),p.Modal.close(),h.Snackbar.complete(g+' "'+l.filename(e.result_path)+'"',"create-cloud-shortcut")}).catch(function(e){d(),h.Snackbar.fail(v._("Invalid title. Please try again."),"create-cloud-shortcut")})},t.getCreateActionSource=function(e){switch(e){case n.NewFileMenuFromType.BROWSE:return n.ActionSourceValue.WEB_BROWSE;case n.NewFileMenuFromType.HOME:return n.ActionSourceValue.WEB_HOME;default:return n.ActionSourceValue.WEB}}}),define("modules/clean/cloud_docs/create_pointer_modal",["require","exports","tslib","react","modules/clean/cloud_docs/pointers_common","modules/clean/react/css","modules/clean/react/modal","modules/core/i18n","spectrum/button","spectrum/modal"],function(e,t,r,o,n,s,i,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var d=a._("Create a new shortcut"),u=a._("Create"),p=a._("Creating..."),h=a._("Cancel"),f=a._("Name"),_=a._("URL"),m=a._("Invalid URL"),S=(function(e){function t(t){var r=e.call(this,t)||this;return r.onChange=function(e){r.setState({pointerData:e})},r.handleCreateOnClick=function(){r.setState({creationInProgress:!0}),r.props.createOnSubmit({pointerData:{name:r.state.pointerData.name.trim(),url:r.state.pointerData.url.trim()},onError:r.handleSubmitError})},r.handleSubmitError=function(){r.setState({creationInProgress:!1})},r.renderCreateButton=function(){var e=n.CreatePointerFields.canSubmit(r.state.pointerData)&&!r.state.creationInProgress;return o.default.createElement(l.Button,{variant:"primary",disabled:!e,onClick:r.handleCreateOnClick},r.state.creationInProgress?p:u)},r.renderCancelButton=function(){return o.default.createElement(l.Button,{variant:"secondary",onClick:i.Modal.close},h)},r.state={pointerData:{name:"",url:""},creationInProgress:!1},r}return r.__extends(t,e),t.prototype.render=function(){return o.default.createElement(c.UtilityModal,{title:d,ariaLabel:"Shortcut Creation Modal",primaryAction:this.renderCreateButton,secondaryAction:this.renderCancelButton,open:!0,shouldRequestCloseOnActions:!1,overlayClickClose:!0,variant:"regular"},o.default.createElement(n.CreatePointerFields,{name:this.state.pointerData.name,url:this.state.pointerData.url,onChange:this.onChange,onSubmit:this.handleCreateOnClick,nameLabel:f,urlLabel:_,urlValidationMessage:m}))},t.showInstance=function(e){return i.Modal.showInstance(o.default.createElement(g,r.__assign({},e)))},t})(o.default.Component);t.CreatePointerModal=S;var g=s.requireCssWithComponent(S,["/static/css/spectrum/index.web-vflXs49Xf.css","/static/css/cloud_docs/create_pointer_modal-vflATc8Dt.css"])}),define("modules/clean/cloud_docs/event_logging",["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/cloud_docs/types","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/clean/logging/hive/schemas/web-user-action","modules/clean/logging/telemetry","modules/constants/python","modules/clean/cloud_docs/constants"],function(e,t,r,o,n,s,i,a,l,c,d){"use strict";function u(e,t,r){var n={".tag":r},s={shared_link_details:{url:t}},i={file_info:s,platform_type:n},a={file_views:[i]};(new o.UserApiV2Client).ns("seen_state").rpc("log_file_view",a,{subjectUserId:e})}function p(e,t,r,i,a,l){(new o.UserApiV2Client).ns("cloud_docs").rpc("log_client_event",{client:n.docTypeToClient[r],cloud_doc_id:t,event_name:i,auth_token:a,time_on_page:s.time_since_start(),extras:l?[{key:"time_now",value:Date.now().toString()}].concat(l):null},{subjectUserId:e})}function h(e){var t=(new o.UserApiV2Client).ns("cloud_docs"),r={".tag":"path_or_id",path_or_id:e.docPathOrId},n=e.data&&e.data.webOpenId;t.rpc("log_user_action",{action:e.actionEvent,doc_id:r,source:e.actionSource,open_id:n},{subjectUserId:e.userId})}function f(e,t,r,o,n){(new l.HiveLogger).log(new a.WebUserActionRow({user_id:e,event_name:i.WebUserActionLogEvent.FILE_OPEN_PROMPT_ACTION,extra:{file_type:t,integration_name:r,prompt_action:o,ask_again:n}}))}Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),l=r.__importStar(l),t.logViewEvent=u,t.logClientEvent=p,t.logUserAction=h,t.getActionSourceFromSurface=function(e){return"search"===e?n.UserActionSourceType.WEB_SEARCH:"previews"===e?n.UserActionSourceType.WEB_PREVIEW:"home_recent"===e||"home_starred"===e?n.UserActionSourceType.WEB_HOME:"browse"===e||"sidebar"===e?n.UserActionSourceType.WEB_BROWSE:n.UserActionSourceType.WEB},t.getActionSourceFromSourceArgs=function(e){return e.fileViewAction===c.FileViewActionType.SEARCH||e.fileViewOrigin===c.FileViewOriginType.SEARCH?n.UserActionSourceType.WEB_SEARCH:e.fileViewOrigin===c.FileViewOriginType.BROWSE?n.UserActionSourceType.WEB_BROWSE:e.fileViewOrigin===c.FileViewOriginType.HOME?n.UserActionSourceType.WEB_HOME:n.UserActionSourceType.WEB},t.getActionSourceFromNewFileMenuType=function(e){switch(e){case d.NewFileMenuFromType.BROWSE:return n.UserActionSourceType.WEB_BROWSE;case d.NewFileMenuFromType.HOME:return n.UserActionSourceType.WEB_HOME;default:return n.UserActionSourceType.WEB}},t.logFileOpenPromptAction=f}),define("modules/clean/cloud_docs/new_file_menu",["require","exports","tslib","external/classnames","react","spectrum/icon_partners","spectrum/popover","spectrum/button","spectrum/tertiary_link","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/create_api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/clean/react/css","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importDefault(n),t.NewFileCreateLabel=f._("Create new file");var _=f._("Google Docs"),m=f._("Google Sheets"),S=f._("Google Slides"),g=f._("Microsoft Excel"),v=f._("Microsoft PowerPoint"),E=f._("Microsoft Word"),w=f._("Dropbox Paper"),T=f._("Shortcut");t.handleNewFileSelection=function(e){e.handleClick()};var F=function(e){switch(e){case c.MicrosoftFileTypes.WORD:return p.WebUserActionLogEvent.FILE_CREATE_WORD;case c.MicrosoftFileTypes.EXCEL:return p.WebUserActionLogEvent.FILE_CREATE_EXCEL;case c.MicrosoftFileTypes.POWERPOINT:return p.WebUserActionLogEvent.FILE_CREATE_POWERPOINT;case c.GoogleFileTypes.GOOGLE_DSS_DOC:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_DOC;case c.GoogleFileTypes.GOOGLE_DSS_SHEET:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SHEET;case c.GoogleFileTypes.GOOGLE_DSS_SLIDES:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SLIDES;case c.PaperNewFileTypes.PAPER:return p.WebUserActionLogEvent.FILE_CREATE_PAPER;case c.PointerFileTypes.SIMPLE_POINTER:return p.WebUserActionLogEvent.FILE_CREATE_SIMPLE_POINTER}},b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.renderIcon=function(){return n.default.createElement(s.IconPartners,{name:this.props.item.iconName,width:"24px",height:"24px"})},t.prototype.render=function(){return n.default.createElement(i.PopoverContentItem,{key:this.props.item.displayName,value:this.props.item,className:this.props.item.className},n.default.createElement("div",{className:"newfile-popover--item"},this.renderIcon(),n.default.createElement("div",{className:"newfile-popover--item-text"},this.props.item.displayName)))},t})(n.default.Component);t.NewFileTypeRow=b;var y=(function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCreateNewFile=function(e){return function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:F(e),depth_folder_selected:t.props.path?d.getDepthFromPath(t.props.path):void 0}),t.props.path?d.createNewFile({user:t.props.user,path:t.props.path,documentType:e,source:t.props.source}):d.showAsyncFolderDialog({user:t.props.user,source:t.props.source,documentType:e})}},t.logTriggerClick=function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:p.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU,depth_folder_selected:t.props.path?d.getDepthFromPath(t.props.path):void 0})},t}return r.__extends(s,e),s.prototype.getNewFileTypeSections=function(){var e=[],t=[];this.props.showPaper&&t.push({displayName:w,iconName:"dropbox_paper",className:"action-create-file-paper-doc",handleClick:this.handleCreateNewFile(c.PaperNewFileTypes.PAPER)}),this.props.showSimplePointer&&t.push({displayName:T,iconName:"shortcut",className:"action-create-simple-pointer",handleClick:this.handleCreateNewFile(c.PointerFileTypes.SIMPLE_POINTER)}),t.length>0&&e.push(t);var r=[];if(r.push({displayName:E,iconName:"microsoft_docx",className:"action-create-file-word",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.WORD)}),r.push({displayName:g,iconName:"microsoft_xlsx",className:"action-create-file-excel",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.EXCEL)}),r.push({displayName:v,iconName:"microsoft_pptx",className:"action-create-file-powerpoint",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.POWERPOINT)}),e.push(r),this.props.showGdd){var o=[];o.push({displayName:_,iconName:"google_gdoc",className:"action-create-file-google-doc",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_DOC)}),o.push({displayName:m,iconName:"google_gsheet",className:"action-create-file-google-sheet",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SHEET)}),o.push({displayName:S,iconName:"google_gslides",className:"action-create-file-google-slides",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SLIDES)}),e.push(o)}return e},s.prototype.renderTrigger=function(){return this.props.primaryButton?n.default.createElement(a.Button,{key:t.NewFileCreateLabel,onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("primary-action-menu__button","action-create-file"),tagName:"span"},t.NewFileCreateLabel):n.default.createElement(l.TertiaryLink,{key:t.NewFileCreateLabel,icon:"create",onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("secondary-action-menu__button","action-create-file"),tagName:"span"},t.NewFileCreateLabel)},s.prototype.renderSection=function(e,t){return n.default.createElement("div",{className:"newfile-popover--section",key:t},e.map(function(e){return n.default.createElement(b,{item:e,key:e.displayName})}))},s.prototype.render=function(){return n.default.createElement(i.Popover,{onSelection:t.handleNewFileSelection},n.default.createElement(i.PopoverTrigger,{disabled:this.props.disabled,className:"newfile-popover--trigger"},this.renderTrigger()),n.default.createElement(i.PopoverContent,{attachment:"right",isRevealed:!this.props.disabled&&void 0},n.default.createElement("div",{className:"newfile-popover"},this.getNewFileTypeSections().map(this.renderSection))))},s})(n.default.Component),C=h.requireCssWithComponent(y,["/static/css/spectrum/index.web-vflXs49Xf.css","/static/css/cloud_docs/new_file_menu-vfl9wMRGq.css","/static/css/cloud_docs/create_pointer_modal-vflATc8Dt.css"]);t.NewFileMenu=C}),define("modules/clean/cloud_docs/open_with_utils",["require","exports","tslib","modules/clean/filepath","modules/core/browser","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types","modules/clean/referrer_cleansing_redirect","modules/clean/cloud_docs/constants","modules/constants/cloud_docs","modules/core/uri","modules/clean/cloud_docs/utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button/types","modules/clean/open_with","spectrum/util/uuid_generator"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m){"use strict";function S(){return r.__awaiter(this,void 0,Promise,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/api_v2/user_client"],t,r)}).then(r.__importStar)];case 1:return t=o.sent().UserApiV2Client,[2,(new t).ns("cloud_docs")]}})})}function g(e){if(void 0!==e&&void 0!==e.error&&void 0!==e.error[".tag"])return e.error[".tag"]}function v(e){switch(g(e)){case"invalid_file_id":case"permission_denied":case"other":return;default:return}}function E(e){return[".gdoc",".gsheet",".gslides"].indexOf(p.getFileExt(e))>=0}function w(e){return".web"===p.getFileExt(e)}function T(e){return!!E(e)||!!w(e)}function F(e,r){var o=p.getFileExt(e);if(t.isOpenWithGddEnabled(r.id))for(var n=0,s=Object.keys(c.DSS_TYPE_TO_SUPPORTED_EXTS);n<s.length;n++){var i=s[n],a=i;if(c.DSS_TYPE_TO_SUPPORTED_EXTS[a].indexOf(o)>=0)return a}switch(o){case".gdoc":return c.GoogleFileTypes.GOOGLE_DSS_DOC;case".gsheet":return c.GoogleFileTypes.GOOGLE_DSS_SHEET;case".gslides":return c.GoogleFileTypes.GOOGLE_DSS_SLIDES}return null}function b(e,r){if(!t.isSingleFileEditingForWopiEnabled(r.id))return null;var o=p.getFileExt(e);return[".odt",".docm",".docx"].indexOf(o)!==-1?c.MicrosoftEditors.WORD:[".ods",".xlsb",".xlsm",".xlsx"].indexOf(o)!==-1?c.MicrosoftEditors.EXCEL:[".odp",".ppsx",".pptx"].indexOf(o)!==-1?c.MicrosoftEditors.POWERPOINT:null}var y=this;Object.defineProperty(t,"__esModule",{value:!0}),l=r.__importStar(l),_=r.__importDefault(_),t.getCloudEditorUrl=function(e,t){return r.__awaiter(y,void 0,Promise,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,S()];case 1:return o=r.sent(),[2,o.rpc("get_cloud_editor_url",{file_id:t},{subjectUserId:e})]}})})},t.decodeAPIError=g,t.handleError=v,t.openWithCloudEditor=function(e,r,o,s){var l=c.LOADING_PAGE_URL,d=n.open_tab(l,!0);t.getCloudEditorUrl(r.id,e.file_id).then(function(t){var l=m.generateUUID("web_open_id"),c=u.URI.parse(t.cloud_editor_url).updateQuery({cloud_editor:o,web_open_id:l}).toString();c&&null!==d&&(void 0===s&&(s=a.UserActionSourceType.WEB),i.logUserAction({actionEvent:a.UserActionEventType.PRE_OPEN,userId:r.id,docPathOrId:e.file_id,actionSource:s,data:{webOpenId:l}}),n.redirect(c,d))}).catch(function(e){v(e)})},t.openCloudDoc=function(t,d,p){if(p||(p=a.UserActionSourceType.WEB),t.href)if(s.isPointerByExtension(t.ns_path))l.safe_open_tab_and_redirect(t.href),i.logUserAction({actionEvent:a.UserActionEventType.PRE_OPEN,userId:d.id,docPathOrId:t.file_id,actionSource:p});else{var h=m.generateUUID("web_open_id"),f=u.URI.parse(t.href).updateQuery("web_open_id",h).toString();n.open_tab(f),i.logUserAction({actionEvent:a.UserActionEventType.PRE_OPEN,userId:d.id,docPathOrId:t.file_id,actionSource:p,data:{webOpenId:h}})}else{var _=c.LOADING_PAGE_URL+o.parent_dir(t.fq_path),S=n.unsafe_open_tab(_);new Promise(function(t,r){e(["modules/clean/previews/data/actions"],t,r)}).then(r.__importStar).then(function(e){return e.fetchPreviewUrl(t,d)}).then(function(e){e&&null!==S&&l.redirect(e,S,!0)})}},t.getOpenWithCloudEditorInfo=function(e,r,o,n){var s=[],i=t.getOpenWithGoogleEditorInfo(e,r,n);i&&o.gdd&&s.push(i);var a=t.getOpenWithWopiEditorInfo(e,r,n);return a&&o.wopi&&s.push(a),s},t.getOpenWithGoogleEditorInfo=function(e,r,o){var n=F(e,r);return n?{text:c.DSS_TYPE_TO_TEXT[n],iconUrl:c.DSS_TYPE_TO_OPEN_WITH_ICONS[n],handler:function(){return t.openWithCloudEditor(e,r,n,o)},type:f.OpenButtonAction.OPEN_WITH_CLOUD_DOC,userAction:h.UserAction.OpenWithCloudDocEditor}:null},t.getOpenWithWopiEditorInfo=function(e,r,o){var n=_.default.get_open_handler_for(e,r),s=b(e,r),i=t.isSingleFileEditingForWopiEnabled(r.id);return n&&i&&s?{text:n.name,spriteName:n.icon,handler:function(){return t.openWithCloudEditor(e,r,s,o)},type:f.OpenButtonAction.OPEN_WITH,userAction:h.UserAction.OpenInOfficeOnline}:null},t.isGoogleDoc=E,t.isCloudBasedDoc=T,t.isOpenWithGddEnabled=function(e){return d.CLOUD_DOCS_OPEN_WITH_GDD[e]===!0},t.getGoogleEditorType=F,t.isSingleFileEditingForWopiEnabled=function(e){return d.CLOUD_DOCS_WOPI_SINGLE_FILE_EDIT[e]===!0},t.getWopiEditorType=b}),define("modules/clean/cloud_docs/pointers_common",["require","exports","tslib","modules/clean/keycode","react","spectrum/input"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var i=(function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.handleKeyPress=function(e){e.charCode===o.KeyCode.ENTER&&t.canSubmit({name:r.props.name,url:r.props.url})&&r.props.onSubmit()},r.handleNameChange=function(e){var t=e.target.value;r.props.onChange({name:t,url:r.props.url})},r.handleUrlChange=function(e){var t=e.target.value;r.props.onChange({name:r.props.name,url:t})},r.setNameFieldRef=function(e){r.nameRef=e},r}return r.__extends(t,e),t.prototype.render=function(){var e=""===this.props.url||t.isUrlValid(this.props.url),r=e?"default":"invalid",o="";return e||(o=this.props.urlValidationMessage),n.createElement("div",{className:"create-pointer--fields"},n.createElement("div",{className:"create-pointer--fieldset"},n.createElement("label",{htmlFor:"create-pointer--link_input"},this.props.urlLabel),n.createElement("div",{className:"create-pointer--fieldset-with-icon"},this.props.urlIcon,n.createElement(s.Input,{id:"create-pointer--link_input",className:"create-pointer--link_input",variant:r,onChange:this.handleUrlChange,onKeyPress:this.handleKeyPress,value:this.props.url,autoFocus:!0}))),n.createElement("div",{className:"create-pointer--url-validation-warning"},o),n.createElement("div",{className:"create-pointer--fieldset"},n.createElement("label",{htmlFor:"create-pointer--name_input"},this.props.nameLabel),n.createElement(s.Input,{id:"create-pointer--name_input",className:"create-pointer--name_input",onChange:this.handleNameChange,onKeyPress:this.handleKeyPress,forwardedRef:this.setNameFieldRef})))},t.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){var e;return r.__generator(this,function(t){switch(t.label){case 0:return this.props.urlPrepopulateFunction?[4,this.props.urlPrepopulateFunction()]:[3,2];case 1:e=t.sent(),e&&(this.props.onChange({name:this.props.name,url:e}),this.nameRef.focus()),t.label=2;case 2:return[2]}})})},t.isUrlValid=function(e){return/^((http|https):\/\/)?([^.:\/\\?#@!]+?\.)+[^.:\/\\?#@!]+/i.test(e.trim())},t.canSubmit=function(e){return""!==e.name&&""!==e.url&&t.isUrlValid(e.url)},t})(n.Component);t.CreatePointerFields=i}),define("modules/clean/cloud_docs/preferred_editor_utils",["require","exports","tslib","modules/core/i18n","modules/core/browser","modules/core/exception","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/utils","modules/clean/cloud_docs/types","modules/clean/react_format","react","modules/clean/filepath","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/open_with_utils","modules/core/uri","modules/clean/cloud_docs/cloud_doc_api_client","spectrum/util/uuid_generator"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m){"use strict";function S(e){var t=a.getFileExt(e);return O.indexOf(t)>=0}function g(e,r,o,c,d,u){var p=a.getFileExt(r),S=o[e.id];if(!S)return void c();try{var g=S[t.EXTENSION_TO_DOC_TYPE[p]],v=g===b.GoogleDSS||g===b.OfficeOnline,E=m.generateUUID("web_open_id");if(v)if(u){var w=f.URI.parse(u).updateQuery("web_open_id",E).toString();n.open_tab(w),i.logUserAction({actionEvent:l.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:r.file_id,actionSource:i.getActionSourceFromSourceArgs(d),data:{webOpenId:E}})}else h.getCloudEditorUrl(e.id,r.file_id).then(function(t){u=f.URI.parse(t.cloud_editor_url).updateQuery("web_open_id",E).toString(),n.open_tab(u),i.logUserAction({actionEvent:l.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:r.file_id,actionSource:i.getActionSourceFromSourceArgs(d),data:{webOpenId:E}})}).catch(function(e){s.reportStack("Error getting cloud editor url from preferred editor open.",{severity:s.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:u,file_ext:p,preferred_editor_configs:S,error:e.message}}),c()});else _.getPreferredUrl(e.id,r.file_id,p).then(function(t){if(t.preferred_editor_url){var o=f.URI.parse(t.preferred_editor_url).updateQuery("web_open_id",E).toString();i.logUserAction({actionEvent:l.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:r.file_id,actionSource:i.getActionSourceFromSourceArgs(d),data:{webOpenId:E}}),n.redirect(o)}}).catch(function(e){s.reportStack("Error getting preferred editor url from preferred editor open.",{severity:s.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:u,file_ext:p,preferred_editor_configs:S,error:e.message}})}),c()}catch(e){s.reportStack("Error opening docs in preferred editor.",{severity:s.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:u,file_ext:p,preferred_editor_configs:S,error:e.message}}),c()}}function v(e,t){var r="."+u.file_extension(e),n=P[t][r],s="<b>"+r+"</b>";return n?{title:c.reactFormat(o._("Would you like to open %(file_extension)s files with %(web_editor_name)s by default?").format({file_extension:s,web_editor_name:n}),{b:d.default.createElement("b",null)}),body:c.reactFormat(o._("%(web_editor_name)s will automatically be used to open your %(file_extension)s files in Dropbox. You can always update this later in your Dropbox settings.").format({file_extension:s,web_editor_name:n}),{b:d.default.createElement("b",null)})}:null}Object.defineProperty(t,"__esModule",{value:!0}),d=r.__importDefault(d);var E,w,T,F,b;(function(e){e[e.Unknown=0]="Unknown",e[e.FileViewer=1]="FileViewer",e[e.OfficeOnline=2]="OfficeOnline",e[e.GoogleDSS=3]="GoogleDSS"})(b=t.PreferredEditorTypes||(t.PreferredEditorTypes={})),t.IntegrationNameToPreferredEditorEnums=(E={},E[l.IntegrationName.GOOGLE_DSS]=b.GoogleDSS,E[l.IntegrationName.OFFICE_ONLINE]=b.OfficeOnline,E[l.IntegrationName.PAPER_INTEGRATION]=b.Unknown,E);var y;(function(e){e.WORD="ms_word",e.EXCEL="ms_excel",e.POWERPOINT="ms_powerpoint"})(y=t.PreferredEditorDocTypes||(t.PreferredEditorDocTypes={})),t.PreferredEditorOptionsMap=(w={},w[y.WORD]={1:o._("View in dropbox.com"),2:o._("Microsoft Word Online"),3:o._("Google Docs")},w[y.EXCEL]={1:o._("View in dropbox.com"),2:o._("Microsoft Excel Online"),3:o._("Google Sheets")},w[y.POWERPOINT]={1:o._("View in dropbox.com"),2:o._("Microsoft PowerPoint Online"),3:o._("Google Slides")},w),t.DssEditorTypeToPreferredEditorDocType=(T={},T[p.GoogleFileTypes.GOOGLE_DSS_DOC]=y.WORD,T[p.GoogleFileTypes.GOOGLE_DSS_SHEET]=y.EXCEL,T[p.GoogleFileTypes.GOOGLE_DSS_SLIDES]=y.POWERPOINT,T);var C=[".docx"],I=[".xlsx"],R=[".pptx"],O=C.concat(I,R);t.EXTENSION_TO_DOC_TYPE={".docx":y.WORD,".xlsx":y.EXCEL,".pptx":y.POWERPOINT},t.hasPreferredEditorSupport=S,t.openInPreferredEditor=g;var P=(F={},F[l.IntegrationName.GOOGLE_DSS]={".docx":o._("Google Docs"),".xlsx":o._("Google Sheets"),".pptx":o._("Google Slides")},F[l.IntegrationName.OFFICE_ONLINE]={".docx":o._("Microsoft Word Online"),".xlsx":o._("Microsoft Excel Online"),".pptx":o._("Microsoft PowerPoint Online")},F[l.IntegrationName.PAPER_INTEGRATION]={},F);t.getPreferredEditorPrompt=v}),define("modules/clean/cloud_docs/utils",["require","exports","modules/clean/filepath","modules/clean/sharing/constants","modules/clean/cloud_docs/types"],function(e,t,r,o,n){"use strict";function s(e){var t="";return e.hasOwnProperty("ext")?t=e.ext:e.hasOwnProperty("filename")?(t=r.file_extension(e.filename),t&&(t="."+t)):(t=r.file_extension(e),t&&(t="."+t)),t}function i(e){switch(e){case n.IntegrationName.GOOGLE_DSS:return o.SHARE_ACTION_ORIGIN_TYPE.GOOGLE_DSS;case n.IntegrationName.PAPER_INTEGRATION:return o.SHARE_ACTION_ORIGIN_TYPE.PAPER_INTEGRATION;case n.IntegrationName.OFFICE_ONLINE:return o.SHARE_ACTION_ORIGIN_TYPE.OFFICE_INTEGRATION;default:throw"No mapping for integration to share action origin: "+e}}function a(e){return e.replace(/[\/?<>:*\\]/g,"�")}Object.defineProperty(t,"__esModule",{value:!0}),t.getFileExt=s,t.integrationNameToShareActionOrigin=i,t.replaceInvalidFilenameChars=a}),define("modules/clean/file_operations/notifications",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,r,o,n,s,i,a,l,c,d,u){"use strict";function p(e,t,r,o){var n=function(){return a.rollbackChangeSets({changesets:r,userId:t.id,progressText:d._("Undoing…"),onSuccess:function(){
u.Notify.success(d._("Undo complete.")),o&&o()}})};l.notifyWithUndo(e,r,n)}function h(e,t){var r=n.browse_uri_for_fq_path(t,e),a=s.Emstring.em_snippet(i.filename(e),40);return{href:r,text:o.escape(a)}}function f(e,t,r,o,n){var s;if(o){var i=h(o,t);s=d.ungettext('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:i.href,dest_name:i.text}),s=new c.HTML(s)}else s=d.ungettext("Copied %(num_items)d item.","Copied %(num_items)d items.",e).format({num_items:e});p(s,t,r,n)}function _(e,t,r,o,n){var s;if(o){var i=h(o,t);s=d.ungettext('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:i.href,dest_name:i.text}),s=new c.HTML(s)}else s=d.ungettext("Moved %(num_items)d item.","Moved %(num_items)d items.",e).format({num_items:e});p(s,t,r,n)}function m(e,t,r,o){p(d.ungettext("Deleted %(num_items)d item.","Deleted %(num_items)d items.",e).format({num_items:e}),t,r,o)}function S(e,t,r){p(d._("Rename complete."),e,t,r)}function g(e,t,r){p(d._("Created folder %(folder_name)s.").format({folder_name:e}),t,r)}function v(e){var t=d.ungettext("Permanently deleted %(num)s item.","Permanently deleted %(num)s items.",e).format({num:e});u.Notify.success(t)}function E(e){var t,r=e.length;if(1===r){var n=o.escape(i.filename(e[0].fq_path));t=d._("Restored <strong>%(filename)s</strong>.").format({filename:n}),t=new c.HTML(t)}else t=d.ungettext("Restored %(num)s file.","Restored %(num)s files.",r).format({num:r});u.Notify.success(t)}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),i=r.__importStar(i),a=r.__importStar(a),l=r.__importStar(l),t.notifyCopySuccess=f,t.notifyMoveSuccess=_,t.notifyDeleteSuccess=m,t.notifyRenameSuccess=S,t.notifyFolderCreationSuccess=g,t.notifyPurgeSuccess=v,t.notifyRestoreSuccess=E}),define("modules/clean/growth/api",["require","exports","tslib","external/lodash","modules/clean/api_v2/user_client"],function(e,t,r,o,n){"use strict";function s(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,(new n.UserApiV2Client).ns("onboarding_tracker").rpc("get_modules_statuses_for_tracker",{tracker:"post_setup_edu"},{subjectUserId:e.id}).then(function(e){return o.mapValues(o.keyBy(e.modules,"name"),"completed")})]})})}function i(e,t){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(r){return[2,(new n.UserApiV2Client).ns("onboarding_tracker").rpc("mark_modules_complete_for_tracker",{tracker:"post_setup_edu",modules:[e]},{subjectUserId:t.id}).then(function(e){return e.errors})]})})}function a(e,t){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){return[2,(new n.UserApiV2Client).ns("files").rpc("get_metadata",{path:e},{subjectUserId:t.id})]})})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.fetchRichSnackbarSeenState=s,t.markRichSnackbarAsSeen=i,t.fetchMetadataForPath=a}),define("modules/clean/logging/hive/schemas/web-modal-activity",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.MOVE="move",e.COPY="copy",e.NEW_FOLDER="new_folder",e.UPLOAD="upload",e.SEARCH_FILTER="search_filter",e.KEYBOARD_SHORTCUTS="keyboard_shortcuts",e.EXPORT_LEGAL_HOLD="export_legal_hold",e.FOLDER_OVERVIEW_PIN_TO="folder_overview_pin_to",e.CLOUD_DOCS_CREATE="cloud_docs_create"})(t.ModalName||(t.ModalName={}));(function(e){e.SHOW="show",e.ERROR="error",e.SUCCESS="success",e.DATA_LOADED="data-loaded",e.BREADCRUMB_CLICKED="breadcrumb-clicked",e.ROW_CLICKED="row-clicked",e.READY="ready",e.CLOSE="close",e.PRIMARY_CLICK="primary-click",e.SECONDARY_CLICK="secondary-click",e.CHANGE_FOLDER_AUDIENCE="change-folder-audience",e.FOLDER_SUGGESTION_API_RESPONSE="folder-suggestion-api-response",e.FOLDER_SUGGESTION_CLICKED="folder-suggestion-clicked",e.FOLDER_SUGGESTION_LOCATION_CLICKED="folder-suggestion-location-clicked"})(t.ModalEventName||(t.ModalEventName={}));(function(e){e.CONFIDENTIAL="confidential",e.NON_CONFIDENTIAL="non-confidential"})(t.FolderType||(t.FolderType={}));var r=(function(){function e(e){this.category="web-modal-activity",this.user_id=null,this.team_id=null,this.modal_name=e.modal_name,this.modal_session_id=e.modal_session_id,this.event_name=e.event_name.toString(),e.hasOwnProperty("timestamp")&&void 0!==e.timestamp?this.timestamp=e.timestamp:this.timestamp=Date.now(),e.hasOwnProperty("user_id")&&void 0!==e.user_id&&(this.user_id=e.user_id),e.hasOwnProperty("team_id")&&void 0!==e.team_id&&(this.team_id=e.team_id),e.hasOwnProperty("session_id")&&void 0!==e.session_id&&(this.session_id=e.session_id),e.hasOwnProperty("path")&&void 0!==e.path&&(this.path=e.path),e.hasOwnProperty("index")&&void 0!==e.index&&(this.index=e.index),e.hasOwnProperty("is_keyboard")&&void 0!==e.is_keyboard&&(this.is_keyboard=e.is_keyboard),e.hasOwnProperty("error")&&void 0!==e.error&&(this.error=e.error),e.hasOwnProperty("folder_type")&&void 0!==e.folder_type&&(this.folder_type=e.folder_type),e.hasOwnProperty("folder_suggestion_path")&&void 0!==e.folder_suggestion_path&&(this.folder_suggestion_path=e.folder_suggestion_path),Object.seal(this)}return e})();t.WebModalActivityRow=r}),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/ajax","modules/core/i18n","modules/core/notify"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var i=(function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){this.hasMoreItems=!0},e.prototype.addDataToAjax=function(e){},e})(),a=(function(){function e(e){this.ajaxURL=e.ajaxURL,this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items)}return e.prototype.areAllItemsReady=function(){return this.mode.areAllItemsReady()},e.prototype.addPage=function(e){for(var t=[],r=[],o=0,i=e;o<i.length;o++){var a=i[o],l=a[this.keyName];if(null==l)return void s.Notify.warning(n._("Invalid server response"));null==this.items[l]&&(this.items[l]=a,r.push(a),t.push(l))}this.pages.push(t),this.newDataCallback(this,r)},e.prototype.startAutoFetching=function(){this.autoFetching=!0,this.fetchNext()},e.prototype.stopAutoFetching=function(){this.autoFetching=!1},e.prototype.reSync=function(e){void 0===e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);var t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()},e.prototype.fetchNext=function(){var e=this;if(!this.mode.areAllItemsReady()){var t={};this.nextRequestVoucher&&(t.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(t),o.WebRequest({url:this.ajaxURL,data:t,subject_user:this.userID,success:function(t){var r=JSON.parse(t);e.nextRequestVoucher=r.next_request_voucher,e.mode.hasMoreItems=r.has_more_items,e.autoFetching&&e.fetchNext();for(var o=0,n=r.items;o<n.length;o++){var s=n[o];s.fq_path=e.fqPathPrefix+s.fq_path}e.addPage(r.items)},error:function(){s.Notify.error(n._("There was a problem completing this request."))}})}},e.prototype.loadedPageCount=function(){return this.pages.length},e.prototype.getLoadedPage=function(e){var t=this,r=this.pages[e];return null==r?null:r.map(function(e){return t.items[e]})},e.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},e})();t.BasePaginationManager=a;var l=(function(e){function t(t){return e.call(this,r.__assign({},t,{mode:new i(t.firstPage.has_more_items)}))||this}return r.__extends(t,e),t.create=function(e){return new t(e)},t})(a);t.PaginationManager=l}),define("modules/clean/react/app_actions/education/async_extensions_edu_modal",["require","exports","tslib","react","modules/clean/react/modal"],function(e,t,r,o,n){"use strict";function s(t,s){var i=this;return new Promise(function(t){return r.__awaiter(i,void 0,void 0,function(){var i;return r.__generator(this,function(a){switch(a.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/react/app_actions/education/edu_modal_component"],t,r)}).then(r.__importStar)];case 1:return i=a.sent().AppActionsEduModal,t(n.Modal.showInstance(o.default.createElement(i,{appName:s}))),[2]}})})})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),t.asyncShowExtensionsEduModal=s});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_fileops_modals",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/fileops_modals"],t,r)}).then(__importStar).then(t)}function o(e){r(function(t){return(0,t.showCopy)(e)})}function n(e){r(function(t){return(0,t.showMove)(e)})}function s(e){r(function(t){return(0,t.showUpload)(e)})}function i(e){r(function(t){return(0,t.showAdminUpload)(e)})}function a(t){new Promise(function(t,r){e(["modules/clean/react/folder_dialog/move_dialog_modal"],t,r)}).then(__importStar).then(function(e){return e.MoveDialogModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showCopy=o,t.showMove=n,t.showUpload=s,t.showAdminUpload=i,t.showMoveDialog=a});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_onboarding_move_modal",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/onboarding_folder_dialog/onboarding_move_dialog"],t,r)}).then(__importStar).then(function(e){return(0,e.showMove)(t)})}function o(t){new Promise(function(t,r){e(["modules/clean/react/onboarding_folder_dialog/onboarding_move_dialog_v2"],t,r)}).then(__importStar).then(function(e){return(0,e.showMoveDialog)(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showOnboardingMoveDialog=r,t.showOnboardingMoveDialogV2=o}),define("modules/clean/react/browse/actions",["require","exports","tslib","external/immutable","modules/clean/cloud_docs/open_with_utils","modules/clean/cloud_docs/preferred_editor_utils","modules/clean/cloud_docs/types","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/helpers","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_viewer/async_controller","modules/clean/react/fileops_actions","modules/clean/react/files_view/types","modules/clean/search/constants","modules/clean/search/search_results/dispatcher","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/user_education/user_education_client","modules/constants/python","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C,I,R,O,P,D,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),a=r.__importStar(a),l=r.__importStar(l),c=r.__importStar(c),u=r.__importDefault(u),p=r.__importStar(p),f=r.__importStar(f),m=r.__importStar(m),g=r.__importStar(g),b=r.__importStar(b),C=r.__importStar(C);var N=(function(){function N(){var n=this;this.initializeEverything=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles,i=e.context,a=e.mountPoints,l=e.fqPathsToSelect,c=e.loadingState,u=e.teamFolders;n.reduxStore.dispatch(m.setPath({path:t})),n.reduxStore.dispatch(m.appendFiles({path:t,files:r.concat(u).map(function(e){return e instanceof E.File?e:E.File.fromServerObject(e)})})),n.reduxStore.dispatch(m.setPaginatedTotalNumFiles({paginatedTotalNumFiles:s})),n.reduxStore.dispatch(m.setMountPoints({mountPoints:a})),n.reduxStore.dispatch(m.setLoadingState({loadingState:c,path:t})),c===y.LoadingState.LOADED?n.reduxStore.dispatch(m.selectFilesByFqPath({fqPathsToSelect:l})):n.reduxStore.dispatch(m.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set(l)})),n.reduxStore.dispatch(m.setContext({context:i})),d.Dispatcher.dispatch({type:T.UploaderActionType.SET_PATH,data:{path:t,hasPermissionToUploadToFolder:i.isCurrentPathWriteable()}}),d.Dispatcher.dispatch({type:_.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:t,files:r}})},this.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files,s=e.paginatedTotalNumFiles;n.reduxStore.dispatch(m.appendFiles({path:t,files:o})),n.reduxStore.dispatch(m.setPaginatedTotalNumFiles({paginatedTotalNumFiles:s})),n.reduxStore.dispatch(m.setLoadingState({loadingState:r,path:t})),d.Dispatcher.dispatch({type:_.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:t,files:o}})},this.nameNewFolder=function(){n.reduxStore.dispatch(m.setNewFolderCreationState({newFolderCreationState:y.NewFolderCreationState.PENDING_INPUT}))},this.createFolderPending=function(){h.logCreateFolderPending(),n.reduxStore.dispatch(m.setNewFolderCreationState({newFolderCreationState:y.NewFolderCreationState.SAVING_INPUT}))},this.cancelCreateFolder=function(){h.logCreateFolderCancel(),n.reduxStore.dispatch(m.setNewFolderCreationState({newFolderCreationState:y.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),window.setTimeout(function(){P.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolderComplete=function(e){var t=e.folderName,r=e.user,o=e.changesets;h.logCreateFolderSuccess(),n.reduxStore.dispatch(m.setNewFolderCreationState({newFolderCreationState:y.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),l.notifyFolderCreationSuccess(t,r,o),window.setTimeout(function(){P.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolder=function(e){var t=e.folderName,o=e.pathName,s=e.nsId,i=void 0===s?null:s,a=e.checkFSWs,l=e.showShareModalOnSuccess,d=e.redirectOnSuccess,u=e.redirectOnCancel,_=e.selectCreatedFolder,m=void 0===_||_,S=g.user(n.reduxStore.getState());n.createFolderPending(),f.createNewFolder({pathName:o,folderName:t,nsId:i,checkFSWs:a,userId:S.id,onSuccess:function(o){var s=o.changesets,i=o.createdFolder,a=o.failureDetails;if(a){var u=function(){n.createFolder(r.__assign({},e,{checkFSWs:!1}))};p.showFileSystemWarningsModal({fsws:a,onFinalAccept:u,confirmText:A._("Create folder"),onAbortAction:n.cancelCreateFolder})}else{var h=i?c.filename(i.fq_path):t;n.createFolderComplete({user:S,folderName:h,changesets:s}),i&&(m&&n.selectRowsFromBoltClient([i]),d&&d(i.fq_path),l&&n.handleShowShareModal(i,O.SHARE_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL))}},onError:function(){h.logCreateFolderError(),n.cancelCreateFolder(),u&&u()}})},this.createFolderInNewFolderModal=function(e){var r=e.folderName,o=e.isConfidential,n=e.user,s=e.context,i=e.redirectOnSuccess,a=e.redirectOnCancel,l=e.fqPath,c=e.selectCreatedFolder,d=s?s.currentFQPath:l,u=s?s.rootNSID:n.root_ns_id;o&&s&&!s.isInsideTeamFolderTree?R.asyncShowNewFolderShareModal(n,null,d,r,!1,!1,null,w.browseNavActions.setPath,w.browseNavActions.setUrl):t.browseActions.createFolder({pathName:d,folderName:r,nsId:u,checkFSWs:!1,showShareModalOnSuccess:(n.is_cdm_member||o)&&!!s&&s.isInsideTeamFolderTree,redirectOnSuccess:i,redirectOnCancel:a,selectCreatedFolder:c})},this.handleNewFolderRedirectOnSuccess=function(e){w.browseNavActions.setUrl({path:e})},this.doDeleteFilesWithModal=function(e){var t=e.files,r=g.user(n.reduxStore.getState()),o=g.context(n.reduxStore.getState());p.showDelete(r,t,o,c.filename(o.currentFQPath),function(){f.deleteFiles({files:t,userId:r.id,onSuccess:function(e){var o=e.changesets,s=e.fileDeltas;I.SearchResultsDispatcher.dispatch({type:C.CHANGE_FILES_ACTION,data:{fileDeltas:s.filter(function(e){return!!e.before}).map(function(e){return{before:e.before.fq_path,after:null}})}}),l.notifyDeleteSuccess(t.length,r,o,function(){n.selectRowsFromBoltClient(t),I.SearchResultsDispatcher.dispatch({type:C.CHANGE_FILES_ACTION,data:{fileDeltas:s.filter(function(e){return!!e.before}).map(function(e){return{before:null,after:e.before}})}})})}})})},this.purgeSuccessCallback=function(e){t.browseActions.reloadCurrentPath(),I.SearchResultsDispatcher.dispatch({type:C.CHANGE_FILES_ACTION,data:{fileDeltas:e.map(function(e){return{before:e.fq_path,after:null}})}})},this.onPurgeBatch=function(t,o){new Promise(function(t,r){e(["modules/clean/react/trash/actions"],t,r)}).then(r.__importStar).then(function(e){(0,e.purgeByPathBatch)(t,o,n.purgeSuccessCallback)})},this.doPermanentDeleteWithModal=function(e){var t=g.user(n.reduxStore.getState()),r=g.context(n.reduxStore.getState());p.showPurgeModal({userId:t.id,context:r,files:e,onPurge:n.onPurgeBatch})},this.onRestore=function(e,t,r){f.restoreFiles({files:t,userId:e,onSuccess:function(){l.notifyRestoreSuccess(t)},isSearchMode:r})},this.doRestoreFilesWithUnifiedTrashModal=function(e){var t=e.files,r=g.user(n.reduxStore.getState()),o=g.context(n.reduxStore.getState());p.showUnifiedTrashModal({userId:r.id,context:o,files:t,onRestore:function(e,t){n.onRestore(e,t,!1)}})},this.handleShowRewindPanel=function(){u.default.update_query_param(_.BrowseQueryArg.rewind,"true"),n.reduxStore.dispatch(m.showTimeline())},this.fetchFolderSizes=function(e){var t=e.file;return r.__awaiter(n,void 0,Promise,function(){var e,o,n,s,i,a,l,c,d;return r.__generator(this,function(r){switch(r.label){case 0:e=g.user(this.reduxStore.getState()),o=_.MAX_FOLDER_SIZE_ITERATIONS,r.label=1;case 1:return r.trys.push([1,7,,8]),this.reduxStore.dispatch(m.requestFolderSizes({fqPath:t.fq_path})),[4,f.fetchSharedFolderSizes(e.id,{fq_path:t.fq_path})];case 2:return n=r.sent(),this.reduxStore.dispatch(m.setFolderSizesPending({fetchFolderSizesResp:n})),s=[],[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:_.MAX_FOLDERS_PER_CALL})];case 3:i=r.sent(),i.queue&&(s=s.concat(i.queue)),r.label=4;case 4:return s.length>0&&o>0?(o--,a=Math.min(_.MAX_FOLDER_SIZE_QUEUE_SIZE,s.length),l=s.splice(0,a),[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:_.MAX_FOLDERS_PER_CALL,queue:l})]):[3,6];case 5:return i=r.sent(),i.queue&&s&&(s=s.concat(i.queue)),[3,4];case 6:return c=0!==o&&i.queue&&0===i.queue.length?y.FetchFolderSizeState.COMPLETE:y.FetchFolderSizeState.ERROR,this.reduxStore.dispatch(m.completeFolderSizes({fetchFolderSizeState:c})),[3,8];case 7:return d=r.sent(),this.reduxStore.dispatch(m.setFolderSizesPending({fetchFolderSizesResp:{sizes_dict:[{fq_path:t.fq_path,size:0}],queue:[]}})),this.reduxStore.dispatch(m.completeFolderSizes({fetchFolderSizeState:y.FetchFolderSizeState.ERROR})),[3,8];case 8:return[2]}})})},this.fetchMultipleFolderSizes=function(e){var t=e.files;return r.__awaiter(n,void 0,Promise,function(){var e,o,n;return r.__generator(this,function(r){switch(r.label){case 0:e=0,o=t.toArray(),r.label=1;case 1:return e<o.length?(n=o[e],[4,this.fetchFolderSizes({file:n})]):[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},this.reduxStore=v.getStoreForBrowse()}return N.prototype.reloadCurrentPath=function(){g.isSearchMode(this.reduxStore.getState())||this.setUrl({path:g.path(this.reduxStore.getState()),qargs:{reload:"1"}})},N.prototype.setUrl=function(e){var t=e.path,r=e.qargs;w.browseNavActions.setUrl({path:t,qargs:r})},N.prototype.selectRowsFromBoltClient=function(e){void 0===e&&(e=[]),this.reduxStore.dispatch(m.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set(e.map(function(e){return e.fq_path}))}))},N.prototype.copyFiles=function(e){b.copyFiles(e)},N.prototype.moveFiles=function(e){b.moveFiles(e)},N.prototype.selectFilesAfterUpload=function(e){var t=e.fqPathsToSelect,r=g.unsortedFilesWithFolderSizes(this.reduxStore.getState());t.every(function(e){return r.has(e)})?this.reduxStore.dispatch(m.selectFilesByFqPath({fqPathsToSelect:t})):this.reduxStore.dispatch(m.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set(t)}))},N.prototype.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;this.reduxStore.dispatch(m.selectFilesByFqPath({fqPathsToSelect:t}))},N.prototype.navigateToFileOrFolder=function(e){var t=this,r=e.file,o=e.shouldFocusComment,n=void 0!==o&&o,i=e.shouldPrepareForSignature,a=void 0!==i&&i,l=e.onFileViewerUnmount,c=e.fileViewAction,d=void 0===c?D.FileViewActionType.CLICK:c,u=e.fileViewOrigin,h=void 0===u?D.FileViewOriginType.BROWSE:u,f=e.preferredEditors,_=g.user(this.reduxStore.getState()),m=g.context(this.reduxStore.getState());if(r.isDeleted)this.doRestoreFilesWithUnifiedTrashModal({files:[r]});else if(r.is_dir)E.File.isNoAccessSharedFolder(r)?p.showNoAccess(_,r,m):this.setUrl({path:r.fq_path});else{var S=function(){t.openPreviewForBrowseFile(r,n,a,_,d,h,l)};!n&&f&&s.hasPreferredEditorSupport(r)?s.openInPreferredEditor(_,r,f,S,{fileViewAction:d,fileViewOrigin:h},r.open_to_url):S()}},N.prototype.openPreviewForBrowseFile=function(e,t,r,o,s,a,l){var c=S.getIndexOfFile(e,this.reduxStore.getState()),d=c<0?[e]:g.sortedFilesWithFolderSizes(this.reduxStore.getState()).toArray();if(c<0?c=0:d[c]=e,e.is_cloud_doc)n.openCloudDoc(e,o,s===D.FileViewActionType.SEARCH?i.WebSearchSource:i.WebBrowseSource);else{var u=function(){F.showElementsBehindFileViewer(),l&&l()};F.asyncOpenPreview({containerId:_.BROWSE_FILE_VIEWER_ELEMENT_ID,files:d,indexOfPreviewFile:c,shouldFocusComment:t,user:o,onFileViewerDidMount:F.hideElementsBehindFileViewer,onFileViewerUnmount:u,fileViewAction:s,fileViewOrigin:a,fileViewTarget:D.FileViewTargetType.PRIVATE})}},N.prototype.navigateToResultObjectParentFolder=function(e){var t=e.file,r=e.fileViewAction;void 0===r&&D.FileViewActionType.CLICK;if(E.File.isNoAccessSharedFolder(t))p.showNoAccess(g.user(this.reduxStore.getState()),t,g.context(this.reduxStore.getState()));else{var o=c.parent_dir(t.fq_path);this.setUrl({path:o})}},N.prototype.navigateToParentFolder=function(){var e=c.parent_dir(g.path(this.reduxStore.getState()));this.setUrl({path:e})},N.prototype.setShouldShowDeletedFiles=function(e){e.shouldShowDeletedFiles?u.default.update_query_param(_.BrowseQueryArg.d,"1"):u.default.remove_query_param(_.BrowseQueryArg.d)},N.prototype.downloadFiles=function(e){var t=e.files,r=e.context,o=e.user;if(1===t.count()&&!t.first().is_dir)return void a.get({url:t.first().href});if(r.blockHash){var n=r.currentFQPath,s=t.toArray().map(function(e){return e.fq_path}),i=!!g.postTTIExperiments(this.reduxStore.getState()).browseExpUseZipToken;a.get_zip({fq_paths:s,subject_uid:o.id,block_hash:r.blockHash,parent_path:n,browseExpUseZipToken:i})}},N.prototype.fetchAndSetSameNamespaceFolderSize=function(e,t){return r.__awaiter(this,void 0,Promise,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,f.fetchSameNamespaceFolderSizes(e,t)];case 1:return o=r.sent(),this.reduxStore.dispatch(m.setFolderSizesPending({fetchFolderSizesResp:o})),[2,o]}})})},N.prototype.handleShowShareModal=function(e,t){var r=g.user(this.reduxStore.getState()),o=g.context(this.reduxStore.getState());R.asyncShowShareModal(r,e,{browseContext:o,origin:t},w.browseNavActions.setPath,w.browseNavActions.setUrl)},N.prototype.handleShowShareInterstitialModal=function(e,t,r,o,n){var s=g.user(this.reduxStore.getState()),i=g.context(this.reduxStore.getState());R.expAsyncShowShareInterstitialModal(s,e,r,o,n,{browseContext:i,origin:t},w.browseNavActions.setPath,w.browseNavActions.setUrl)},N})();t.browseActions=new N}),define("modules/clean/react/browse/api",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/api_v2/user_client","modules/clean/filepath","modules/clean/react/browse/models","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,o,n,s,i,a,l,c,d,u){"use strict";function p(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function h(e){var t=e.sortLabel,r=e.sortIsAscending,o=e.path,s=e.userId,i=e.onSuccess,a=e.includeDeletedFiles,l=void 0!==a&&a,c=e.sortFoldersFirst,d=void 0===c||c,u=e.onError;return n.WebRequest({data:{sort_label:t,sort_is_ascending:r.toString(),show_deleted:l||"",sort_folders_first:d,include_file_info:"True",path2:o},url:"/browse",subject_user:s,success:function(e,t,r){var n=p(e);n&&i({path:o,data:n,xhr:r})},error:function(e,t,r){u&&u(e,t,r)}})}function f(e){var t=e.files,r=e.newPath,s=e.userId,i=e.onSuccess,l=e.checkFSWs,u=t.map(function(e){return e.fq_path});return u.includes(r)?(d.Notify.error(c._("You can’t copy a folder into itself.")),null):n.WebProgressRequest({url:"/cmd/copy",data:{files:u,to_path:r,fsw_request:l?"check":void 0},subject_user:s,progress_text:c._("Copying files..."),success:function(e){try{var t=o.isString(e)?JSON.parse(e):e;i({newFiles:t.new_browse_files?t.new_browse_files.map(a.File.fromServerObject):[],destinationPath:r,changesets:t.changesets,failureDetails:t.failure_details})}catch(e){}}})}function _(e){var t=e.files,r=e.userId,s=e.onSuccess,i=t.map(function(e){return e.fq_path});return n.WebProgressRequest({url:"/cmd/delete",data:{files:i},subject_user:r,progress_text:c._("Deleting files..."),success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;s({fileDeltas:t.map(function(e){return{before:e,after:null}}),changesets:r.changesets})}catch(e){}}})}function m(e){var t=e.path,r=e.files,s=e.newPath,u=e.userId,p=e.onSuccess,h=e.allowOwnershipTransfer,f=e.checkFSWs;if(void 0!==t&&i.paths_are_equal(t,s))return d.Notify.error(c._("Those files already exist in that folder.")),null;var _=r.map(function(e){return e.fq_path});return _.includes(s)?(d.Notify.error(c._("You can’t move a folder into itself.")),null):n.WebProgressRequest({url:"/cmd/move",data:{files:_,to_path:s,allow_ownership_transfer:h,fsw_request:f?"check":void 0},subject_user:u,progress_text:c._("Moving files..."),skipNotifyError:!h,success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;p({path:t,destinationPath:s,newFiles:r.new_browse_files?r.new_browse_files.map(a.File.fromServerObject):[],changesets:r.changesets,failureDetails:r.failure_details})}catch(e){}},error:function(t,r,o){d.Notify.error(new l.HTML(o)),e.onError&&e.onError(o)}})}function S(e){var t=e.files,r=e.userId,o=e.onSuccess,s=e.isSearchMode;return n.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(function(e){return e.fq_path}),source:s?"search":"browse"},subject_user:r,dataType:"text",progress_text:c._("Restoring…"),success:function(){o()}})}function g(e){var t=e.userId,r=e.changesets,o=void 0===r?null:r,s=e.progressText,i=e.onSuccess;return n.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(o)},subject_user:t,progress_text:s,success:function(){i()}})}function v(e){var t=e.pathName,r=e.folderName,o=e.userId,s=e.onSuccess,i=e.onError,l=e.checkFSWs;return n.WebProgressRequest({url:new u.URI({path:"/cmd/new"+t}).toString(),data:{to_path:r,folder:"yes",fsw_request:l?"check":void 0},subject_user:o,success:function(e){var t=p(e);if(t){var r=t.new_browse_files?a.File.fromServerObject(t.new_browse_files[0]):null;s({changesets:t.changesets,createdFolder:r,failureDetails:t.failure_details})}},error:function(){i()}})}function E(e){var t=e.pathName,r=e.title,o=e.documentType,s=e.userId,i=e.onSuccess,l=e.onError,c=e.checkFSWs,d=e.actionSource,h=(t+"/"+r+"."+o).replace("//","/");return n.WebRequest({url:new u.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:s,data:{to_path:h,title:r,fsw_request:c?"check":void 0,action_source:d},success:function(e){var t=p(e);if(t){i({changesets:null,createdFile:t.new_browse_files?a.File.fromServerObject(t.new_browse_files[0]):null,failureDetails:t.failure_details})}},error:function(e,t,r){l(r)},skipNotifyError:!0})}function w(e){var t=e.path,r=e.userId,s=e.namespaceToJournalIdMap,i=e.onSuccess,a=e.includeDeletedFiles,l="/"===t?"":t,c={fq_dir:l,ns_map:o.map(s,function(e,t){return t+"_"+e}).join(","),show_deleted:!!a};return n.WebRequest({url:"/update/list_dir",subject_user:r,data:c,dataType:"text",success:function(e){var t=p(e);t&&i(t)}})}function T(e,t){return(new s.UserApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})}function F(e,t){return(new s.UserApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),i=r.__importStar(i),t.loadPath=h,t.copyFiles=f,t.deleteFiles=_,t.moveFiles=m,t.renameFile=function(e){var t=e.file,r=e.name,o=e.user,s=e.checkFSWs;return new Promise(function(e,i){n.WebRequest({url:new u.URI({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:o.id,data:{to_path:r,fsw_request:s?"check":void 0},success:function(r){var o=p(r);if(o){var n=o.new_browse_files?t.merge(o.new_browse_files[0]):"";e({changesets:o.changesets,renamedFile:n,failureDetails:o.failure_details})}else i(r)},error:i})})},t.restoreFiles=S,t.rollbackChangeSets=g,t.createNewFolder=v,t.createCloudDoc=E,t.getChangesForDirectory=w,t.fetchSharedFolderSizes=T,t.fetchSameNamespaceFolderSizes=F}),define("modules/clean/react/browse/browse",["require","exports","tslib","react","external/react-redux","modules/clean/react/browse/controller","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors","modules/clean/react/extensions/data/selectors","modules/clean/react/files_view/data/store","modules/clean/react/folder_overview/data/selectors","modules/clean/react/retrieval_success_banner/data/store","modules/clean/react/retrieval_success_banner/data/selectors","modules/clean/search/search_bar/data/action_creators","modules/clean/search/search_bar/data/selectors","modules/clean/viewer","modules/clean/web_timing_logger","modules/clean/react/browse/data/selectors"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),i=r.__importStar(i),a=r.__importStar(a),c=r.__importStar(c),d=r.__importStar(d),u=r.__importStar(u),h=r.__importStar(h),m=r.__importStar(m),S=r.__importStar(S),v=r.__importStar(v);var w=function(e){var t=a.context,r=a.sortedFilesWithFoldersSizesWithoutTeamFolders,o=a.sortedFilesWithFolderSizes,n=a.teamFolders,s=a.paginatedTotalNumFiles,i=a.loadingState,l=a.path,c=a.selection,p=a.selectedFiles,f=a.shouldShowDeletedFiles,m=a.shouldShowPinnedTeamFolders,g=a.shouldShowSharedFolderInvites,v=a.newFolderCreationState,w=a.isTimelineVisible,T=a.optedInToRewind,F=a.sortOrder,b=a.urlPrefix,y=a.canDisplayFolderSizes,C=a.isQueryingFolderSizes,I=a.user,R=a.viewer,O=a.browsePostTTIExperiments,P=a.mountPoints,D=a.isFileJumping,A=a.isSearchMode,N=a.shouldShowFolderOverview,L=d.viewType,x=d.viewTypeColumns,M=u.fileExtensionsConfigs,k=S.searchSessionId,U=S.isSearchBarFocused,V=h.pinnedItems;return{files:o(e),filesWithoutTeamFolders:r(e),teamFolders:n(e),paginatedTotalNumFiles:s(e),loadingState:i(e),path:l(e),fileRename:d.fileRename(e),shouldShowDeletedFiles:f(e),shouldShowPinnedTeamFolders:m(e),shouldShowSharedFolderInvites:g(e),isTextSelectable:!!d.fileRename(e),createNewFolderState:v(e),isTimelineVisible:w(e),clickTimelineTimestamp:E.clickTimelineTimestamp(e),
optedInToRewind:T(e),currentSort:F(e),urlPrefix:b(e),canDisplayFolderSizes:y(e),viewTypeColumns:x(e),isQueryingFolderSizes:C(e),user:I(e),viewer:R(e),browsePostTTIExperiments:O(e),brsContext:t(e),brsSelection:c(e),brsSelectedFiles:p(e),mountPoints:P(e),isFileJumping:D(e),searchSessionId:k(e),isSearchBarFocused:U(e),isSearchMode:A(e),viewType:L(e),fileExtensionsConfigs:M(e),shouldShowRetrievalSuccessBanner:_.isRetrievalSuccessBannerVisible(e),pinnedItems:V(e),shouldShowFolderOverview:N(e)}},T={addFileJumpKeyCode:i.addFileJumpKeyCode,appendFiles:i.appendFiles,applyBoltUpdates:i.applyBoltUpdates,blurSearchBar:m.blurSearchBar,clearFiles:i.clearFiles,clearSearchBar:m.clearSearchBar,copyFilesToClipboard:i.copyFilesToClipboard,optInToRewind:i.optInToRewind,hideTimeline:i.hideTimeline,pasteFilesFromClipboard:i.pasteFilesFromClipboard,renameFile:i.renameFile,resetFileJumpFilter:i.resetFileJumpFilter,setAndStoreSortOrder:i.setAndStoreSortOrder,setBrowsePostTTIExperiments:i.setBrowsePostTTIExperiments,setBrowseScope:m.setBrowseScope,setCanDisplayFolderSizes:i.setCanDisplayFolderSizes,setFileCategories:m.setFileCategories,setFileRename:c.setFileRename,setIsSearchMode:i.setIsSearchMode,setLoadingState:i.setLoadingState,setMountPoints:i.setMountPoints,setPath:i.setPath,setPathData:i.setPathData,setSearchBarExperiments:m.setExperiments,setSearchQuery:m.setSearchQuery,setSelection:i.setSelection,setShouldShowDeletedFiles:i.setShouldShowDeletedFiles,setUrl:i.setUrl,setViewType:c.setViewType,setViewTypeColumns:c.setViewTypeColumns,setViewTypeScope:c.setViewTypeScope,showTimeline:i.showTimeline},F=n.connect(w,T)(s.BrowseController),b=(function(e){function t(t){var r=e.call(this,t)||this;v.log_js_modules_application_code_start(),p.getStoreForFilesView(),f.getStoreForSuccessBanner(),r.reduxStore=l.getStoreForBrowse();var o=g.Viewer.get_viewer(),n=o.get_user_by_id(t["user-id"]);return r.reduxStore.dispatch(c.loadViewTypes({user:n})),r.reduxStore.dispatch(c.loadViewTypeColumns({user:n})),r.reduxStore.dispatch(i.setPath({path:t["init-fq-path"]||"/"})),r.reduxStore.dispatch(i.appInit({experiments:t["exp-browse-experiments"]||{},shouldShowDeletedFiles:!!t["should-show-deleted-files"],user:n,viewer:o})),r}return r.__extends(t,e),t.prototype.render=function(){return o.default.createElement(n.Provider,{store:this.reduxStore},o.default.createElement(F,r.__assign({},this.props)))},t})(o.default.PureComponent);t.BrowseApp=b}),define("modules/clean/react/browse/browse_prefetch_loader",["require","exports","tslib","modules/core/exception","modules/clean/react/files_view/types","modules/clean/react/browse/models","modules/clean/pagination_manager","modules/core/notify","modules/clean/web_timing_logger"],function(e,t,r,o,n,s,i,a,l){"use strict";function c(e){if(0===e.indexOf("err:")){var t=e.substr("err:".length);a.Notify.error(t)}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),l=r.__importStar(l);var d=(function(){function e(e,t,r,a){var d=e.user,u=e.path,p=e.fqPathsToSelect,h=t.onPrefetchComplete,f=t.onPrefetchError,_=t.onLoadComplete,m=t.onPostTTIPrefetchComplete,S=t.onPostTTIPrefetchError,g=r.onInitializeEverything,v=r.onLoad,E=r.onAddFilesAndSetLoadingState;void 0===a&&(a=window);var w=this;this.isPrefetching=function(){return!!w.browsePreloadHandler&&!!w.firstPagePreloadHandler},this.handlePrefetch=function(){o.assert(w.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),w.browsePreloadHandler(w.handlePrefetchDataSuccess,w.onPrefetchError),l.waitForTTI().then(function(){w.postTTIPreloadHandler(w.handlePostTTIDataSuccess,w.onPostTTIPrefetchError)})},this.handlePostTTIDataSuccess=function(e){var t=void 0;try{t=JSON.parse(e)}catch(e){return void w.onPostTTIPrefetchError(e)}if(!t)return void w.onPostTTIPrefetchError();w.onPostTTIPrefetchComplete(t)},this.handlePrefetchDataSuccess=function(e){var t=w.extractAjaxInitData(e);if(!t)return void w.onPrefetchError();var r,o,i=[],a=0,l=n.LoadingState.LOADING_FIRST_PAGE,c=w.firstPagePreloadHandler.getDataIfAvailable();if(c){if(!c.payload||c.error)return void w.onPrefetchError();var d=w.extractAjaxFileInfo(c.payload);if(!d)return void w.onPrefetchError();r=d.file_info,o=d.first_page,o?(i=[],a=o.total_num_items,l=n.LoadingState.LOADING_REMAINING_PAGES):r&&(i=r,a=i.length,l=n.LoadingState.LOADED)}var u=s.BrowseContext.fromServerObject(t);w.onInitializeEverything({path:w.path,files:i.map(s.File.fromServerObject),paginatedTotalNumFiles:a,context:u,mountPoints:t.ns_id_to_mount_point,fqPathsToSelect:w.fqPathsToSelect,loadingState:l,teamFolders:t.team_folders_js_info&&t.team_folders_js_info.map(s.File.fromServerObject)}),r||o?(o?w.initializePaginationManager(o):w.onLoadComplete(),w.onPrefetchComplete(t)):w.firstPagePreloadHandler(function(e){w.handleFirstPagePrefetchDataSuccess(e,t,u)},w.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=function(e,t,r){var o=w.extractAjaxFileInfo(e);if(!o)return void w.onPrefetchError();o.paginated?w.initializePaginationManager(o.first_page):(w.onLoad({path:w.path,files:o.file_info.map(s.File.fromServerObject),paginatedTotalNumFiles:o.file_info.length,context:r}),w.onLoadComplete()),w.onPrefetchComplete(t)},this.extractAjaxInitData=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.extractAjaxFileInfo=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.initializePaginationManager=function(e){var t=e.total_num_items,r=i.PaginationManager.create({firstPage:e,keyName:"sjid",ajaxURL:"/browse_get_next",userID:w.user.id,newDataAvailableCallback:function(e,r){var o=e.areAllItemsReady(),i=o?n.LoadingState.LOADED:n.LoadingState.LOADING_REMAINING_PAGES;w.onAddFilesAndSetLoadingState({path:w.path,files:r.map(s.File.fromServerObject),paginatedTotalNumFiles:t,loadingState:i}),o&&(e.stopAutoFetching(),w.onLoadComplete())}});l.waitForTTI().then(function(){return r.startAutoFetching()})},this.user=d,this.path=u,this.fqPathsToSelect=p,this.onPrefetchComplete=h,this.onPrefetchError=f,this.onLoadComplete=_,this.onPostTTIPrefetchComplete=m,this.onPostTTIPrefetchError=S,this.onInitializeEverything=g,this.onLoad=v,this.onAddFilesAndSetLoadingState=E,this.browsePreloadHandler=a.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=a.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER,this.postTTIPreloadHandler=a.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER}return e})();t.BrowsePrefetchLoader=d;var u=(function(){function e(e,t){var r=e.onPostTTIPrefetchComplete,o=e.onPostTTIPrefetchError;void 0===t&&(t=window),this.postTTIPreloadHandler=t.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER,this.onPostTTIPrefetchComplete=r,this.onPostTTIPrefetchError=o}return e.prototype.handlePrefetch=function(){var e=this;this.postTTIPreloadHandler&&l.waitForTTI().then(function(){e.postTTIPreloadHandler(function(t){var r=void 0;try{r=JSON.parse(t)}catch(t){return void e.onPostTTIPrefetchError(t)}if(!r)return void e.onPostTTIPrefetchError();e.onPostTTIPrefetchComplete(r)},e.onPostTTIPrefetchError)})},e})();t.SearchPrefetchLoader=u}),define("modules/clean/react/browse/browse_view",["require","exports","tslib","external/immutable","react","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/browse/constants","modules/clean/react/folder_overview/connected","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/browse/sidebar","modules/clean/react/browse/title","modules/clean/react/browse/web_team_sharing_experiment","modules/clean/react/file_uploader/file_uploader","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/types","modules/clean/react/maestro/search","modules/clean/react/retrieval_success_banner/constants","modules/clean/react/retrieval_success_banner/retrieval_success_browseview_banner","modules/clean/react/retrieval_success_banner/util","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/log_helper","modules/clean/search/search_results/controller","modules/clean/search/search_results/log_helper","modules/clean/search/types","modules/clean/sharing/access_level","modules/clean/sharing/shared_folder_invite/shared_folder_invite_async","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/core/browser","modules/clean/react/async/loadable","modules/clean/web_user_action_events","modules/clean/react/browse/uri_helper","modules/clean/react/growth/connected_checklist_banner","modules/clean/react/growth/education_module_experiment","modules/clean/analytics","modules/clean/react/snackbar","modules/clean/react/snackbar_manager","modules/clean/react/delorean/data/types"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C,I,R,O,P,D,A,N,L,x,M,k,U,V,B,q,H){"use strict";var W=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),i=r.__importStar(i),l=r.__importStar(l),u=r.__importStar(u),N=r.__importStar(N);var G=[O.NameSpaceAccess.ACCESS_NO_ACCESS,O.NameSpaceAccess.ACCESS_READER,O.NameSpaceAccess.ACCESS_READER_NO_COMMENT],z=(function(O){function L(e){var t=O.call(this,e)||this;return t.handleGetOverflowMenuActions=function(e,r,n){var s=t.handleGetFileActionsForSetOfFiles(o.Set([e]),r,n,!1,!1,t.props.browsePostTTIExperiments.expRewindUpsell),i=new Array;return s.forEach(function(e){"function"!=typeof e&&i.push(e)}),[i]},t.handleGetFileActionsForSetOfFiles=function(e,r,o,n,s,i){var a=t.props,l=a.context,c=a.user,d=a.actionHandlers,u=a.isSearchMode,p=a.isOverFreeQuota,h=a.hasExcludedNsIds,f=a.isQueryingFolderSizes,_=a.browsePostTTIExperiments,m=a.viewType,S=a.fileExtensionsConfigs,g=a.searchBarExperiments,v=a.pinnedItems,E=t.state.fileActionsModule;if(!E)return[];var w=_.expShowAddToShowcase,T=_.expShowAddFolderToShowcase,F=_.expShowAddToTransfer,b=_.expHasCreatedShowcase,y=_.expHasShowcaseFreemium,C=_.expShowShowcaseInterstitial,I=_.expFolderCalcSize,R=t.props.browseExperiments.expFolderHistoryRollbacks,O="CTX"===I,P=g.expSearchSuccessBanner,D=g.expBrowseSuccessBanner;return E.getActionsForFileCollection({files:e,context:l,user:c,viewType:m,fileExtensionsConfigs:S,canDisplayFolderSizes:r,actionHandlers:d,skipSharing:!1,isSearchMode:u,isOverFreeQuota:p,hasExcludedNsIds:h,isQueryingFolderSizes:f,canShowUJPopup:n,showAddToShowcase:!!w,showAddFolderToShowcase:!!T,hasCreatedShowcase:!!b,hasShowcaseFreemium:!!y,isSidebar:s,showShowcaseInterstitialExp:!!C,responsive:o,showFolderCalcSize:O,useSearchSuccessBanner:!!P,expBrowseSuccessBanner:D,pinnedItems:v,expFolderHistoryRollbacks:R,expRewindUpsell:i,showAddToTransfer:!!F})},t.handleLocationLinkClick=function(e,r){if(!r){var o=i.parent_dir(e.fq_path);t.props.onNavigateToPath(o)}},t.handleOpenPaper=function(e){var r=t.props,o=r.user,n=r.isSearchMode,s=r.viewType;n&&I.recordSearchResultsAction({result:e,user:o,action_type:x.WebUserActionLogEvent.PAPER_OPEN,view_type:s}),N.redirect(e.url)},t.handleUploadButtonClick=function(e){m.FileUploaderController.setPath(t.props.path),m.FileUploaderController.handleUploadButtonClick(e)},t.handleShowFileUploader=function(){m.FileUploaderController.setPath(t.props.path),m.FileUploaderController.showModal()},t.handleSelectionChange=function(e){var r=t.props.getFileByFullPath(e.selected.first());if(r){var o=r.ns_id,n=r.sjid,s=r.file_id,a=r.fq_path,c=r.bytes,d=r.ext,u=r.request_id;l.logSelectRow({uid:t.props.user.id,entity_type:r.is_dir?"folder":"file",view_type:t.props.viewType,file_nsid:o,file_sjid:n,file_id:s,file_name:i.filename(r.fq_path),file_path:a,file_size:c,file_extension:d,request_id:u})}t.props.onSelectionChange({selection:e})},t.handleFileListSortChange=function(e,r){l.logSortRecords({uid:t.props.user.id,sort_by:e,sort_direction:r,view_type:t.props.viewType}),t.props.onSortFiles({sortField:e,sortDirection:r})},t.handleStarClick=function(e,r){var o=r?x.WebUserActionLogEvent.STAR:x.WebUserActionLogEvent.REMOVE_STAR,n=t.props,s=n.user,i=n.isSearchMode,a=n.viewType,c=n.selectedFiles,d=n.searchBarExperiments,p=u.countFilesAndFolders(c),h=p.num_files_selected,f=p.num_folders_selected;i?I.recordSearchResultsAction({result:e,user:s,action_type:o,view_type:a}):l.logBrowseAction({uid:s.id,source:"BROWSE",action:o,num_files_selected:h,num_folders_selected:f,view_type:a,result:e});var _=d.expSearchSuccessBanner,m=d.expBrowseSuccessBanner;t.showRetrievalSuccessBanner(!!_,i,m,x.WebUserActionLogEvent.STAR)},t.handleSearchFromSearchBar=function(e){var r=e.query,o=e.searchPath,n=e.qargs;r?t.props.onSearch(r,o,!0,n):t.props.onSetUrl({path:o})},t.handleSearchResultOpen=function(e){e instanceof p.File?(y.logDropdownSearchAction({result:e,user:t.props.user,action_type:e.is_dir?x.WebUserActionLogEvent.FOLDER_OPEN:x.WebUserActionLogEvent.FILE_VIEW,viewport:"dropdown-view"}),t.props.onSearchBarResultOpen(e)):(e instanceof p.Paper||e instanceof p.PaperFolder)&&(y.logDropdownSearchAction({result:e,user:t.props.user,action_type:x.WebUserActionLogEvent.PAPER_OPEN,viewport:"dropdown-view"}),N.open_tab(e.url))},t.handleResultObjectPathClick=function(e){t.props.searchBarExperiments.expSearchSuccessBanner&&(F.setSearchSuccessBannerVisible(),F.setClickablePathData(i.parent_dir(e.fq_path))),y.logDropdownSearchAction({result:e,user:t.props.user,action_type:x.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"}),t.props.onSearchBarPathClicked(e)},t.setFilesViewControllerRef=function(e){t.filesViewControllerRef=e},t.handleSearchFromSearchResults=function(e,r,o){t.props.onSearch(e,r,!1,o)},t.handleFocusSearchBar=function(){t.props.browseExperiments.expUniversalSinglePageSearch?document.getElementsByClassName("search__input")[0].focus():document.getElementsByClassName("search-bar__text-input")[0].focus()},t.renderSharedWithController=function(e){var r=t.props,o=r.context,s=r.user,i=t.state.sharedWithModule;if(!i)return null;if(e.type===a.FileTypes.TEAM_SHARED_FOLDER&&("archived"===e.team_folder_status||"archive_in_progress"===e.team_folder_status))return null;var l=t.props.selectedFiles,c=!!l.size,d=i.SharedWithController;return n.default.createElement("div",{className:"brws-vertically-center brws-shared-with-wrapper"},n.default.createElement(d,{file:e,browseContext:o,inSelectMode:c,user:s}))},t.renderAppContent=function(e){return t.props.isSearchMode?t.renderSearchResults(e):t.renderFilesViewController(e)},t.getPageHeaderHeight=function(e){return e.isMatchedLarge||e.isMatchedMedium?c.DEFAULT_PAGE_HEADER_HEIGHT:c.COMPACT_PAGE_HEADER_HEIGHT},t.handleFixedHeaderHeightChange=function(e){t.setState({fixedHeaderHeight:e})},t.isRootFileView=function(){return!t.props.isSearchMode&&i.paths_are_equal(t.props.context.currentFQPath,"/")},t.isExpGrowthTcBizChecklistUiRevampEnabled=function(){return!!t.props.browseExperiments.expGrowthTcBizChecklistUiRevamp&&t.isRootFileView()},t.showRetrievalSuccessBanner=function(e,t,r,o){e&&t?F.doSearchResultActionClickBroadcast(!0):r!==R.BrowseSuccessBannerVariants.V2||t||F.setBrowseSuccessBannerVisible(o)},t.renderFixedHeader=function(){return t.props.shouldShowFolderOverview?n.default.createElement(d.FolderOverview,{expFolderOverview:t.props.browseExperiments.expFolderOverview||"OFF",expFolderOverviewGeminiRollout:t.props.browseExperiments.expFolderOverviewGeminiRollout||"OFF",onNavigateToFileOrFolder:t.props.onNavigateToFileOrFolder,isReadOnly:!t.props.context.isCurrentPathWriteable(),browseLoadingState:t.props.loadingState,onChangeHeight:t.handleFixedHeaderHeightChange}):t.props.shouldShowSharedFolderInvites?n.default.createElement(P.AsyncSharedFolderInvite,{user:t.props.user,onChangeHeight:t.handleFixedHeaderHeightChange}):t.isExpGrowthTcBizChecklistUiRevampEnabled()?n.default.createElement(k.OnboardingChecklistBanner,{user:t.props.user,isUserEduEnabled:!!t.props.browseExperiments.currentChecklistModuleName}):null},t.renderSidebar=function(e){var o=t.props,s=o.fileCategories,i=o.fileExtensionsConfigs,a=o.isNautilusEnabled,l=o.isPaperEnabled,c=o.pinnedItems,d=o.searchType;return n.default.createElement(h.BrowseSidebar,r.__assign({},t.props,{onSearch:t.handleSearchFromSearchResults,onUploadButtonClick:t.handleUploadButtonClick,onGetFileActionsForFiles:t.handleGetFileActionsForSetOfFiles,responsive:e,fileCategories:s,isNautilusEnabled:a,isPaperEnabled:l,fileExtensionsConfigs:i,pinnedItems:c,searchType:d,renderFilters:!0}))},t.close=function(){t.props.onCloseTimeline()},t.onTimelineOptIn=function(){t.props.onOptInToRewind()},t.state={searchBarProps:t.getCurrentSearchBarProps(t.props)},t}return r.__extends(L,O),L.prototype.componentWillReceiveProps=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){return e.isSearchMode===this.props.isSearchMode&&e.path===this.props.path||this.setState({searchBarProps:this.getCurrentSearchBarProps(e)}),[2]})})},L.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){var t,o,n,i,a,c,d,u=this;return r.__generator(this,function(p){switch(p.label){case 0:return t=this.props.searchBarExperiments.expBrowseSuccessBanner,t===R.BrowseSuccessBannerVariants.V1||t===R.BrowseSuccessBannerVariants.V3?F.startBrowseSuccessBannerCounter(t):t===R.BrowseSuccessBannerVariants.V2&&F.setBrowseSuccessBannerTimer(),this.props.browseExperiments.expSnackbarManager&&(B.Snackbar.manager=this.refs.snackbarManager),[4,A.waitForTTI()];case 1:return p.sent(),Promise.all([new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/shared_with"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar)]).then(function(e){var t=e[0],r=e[1],o=e[2].OverquotaHelper;u.setState({fileActionsModule:t,sharedWithModule:r}),o.maybeShowSubgrowthProOQRecurringModal("wb_oq_ups_recur_fb")}),m.FileUploaderController.loadCoreComponent(),this.props.shouldOpenUploadModal&&this.handleShowFileUploader(),D.UEClient.sendEvent("BrowseView","componentDidMount",this.props.context.toJSON()),o=this.props,n=o.isSearchMode,i=o.context,a=o.user,c=o.viewType,n||(d=i.currentFQPath.split("/").filter(function(e){return!!e}).length,0===d?l.logPageView({uid:a.id,view_type:c,url:s.get_browse_root(a)}):l.logPageView({uid:a.id,view_type:c,url:s.get_browse_root(a)+"/*",navigation_depth:d})),this.props.browseExperiments.expGrowthTcBizEducationModuleVariant&&"OFF"!==this.props.browseExperiments.expGrowthTcBizEducationModuleVariant&&V.TeamsWebActionsLogger.log("edu_module_browser_dim",{width:window.innerWidth,height:window.innerHeight,variant:this.props.browseExperiments.expGrowthTcBizEducationModuleVariant}),[2]}})})},L.prototype.componentDidUpdate=function(){this.props.loadingState===v.LoadingState.LOADED&&D.UEClient.sendEvent("BrowseView","componentDidUpdate",this.props.context.toJSON())},L.prototype.getCurrentDropTargetHighlightMode=function(){var e=this.props,t=e.selectedFiles,r=e.context;return r.isInsideSharedFolder&&G.includes(r.currentSharedFolderPermissionRole)?v.DropTargetHighlightMode.NONE:this.props.isDraggingInternalFiles?t.some(function(e){return e.isDeleted||e.type===a.FileTypes.TEAM_SHARED_FOLDER})?v.DropTargetHighlightMode.NONE:t.some(function(e){return e.type===a.FileTypes.SHARED_FOLDER})?r.currentNSAllowsNesting?v.DropTargetHighlightMode.NONSELECTED_FOLDERS:v.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:v.DropTargetHighlightMode.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?v.DropTargetHighlightMode.ALL_FOLDERS:v.DropTargetHighlightMode.NONE},L.prototype.getCurrentSearchBarProps=function(e){return{showSearchBar:!0,currentPath:e.path,onSearch:this.handleSearchFromSearchBar,onSearchResultOpen:this.handleSearchResultOpen,onResultObjectPathClick:this.handleResultObjectPathClick,isSearchBarExpanded:e.isSearchMode,searchBarExperiments:e.searchBarExperiments,onSearchFiltersChanged:e.onSearchFiltersChanged,searchFrom:e.searchFrom,expUniversalSinglePageSearch:e.browseExperiments.expUniversalSinglePageSearch}},L.prototype.getFilesViewControllerRef=function(){return this.filesViewControllerRef},L.prototype.renderSearchResults=function(e){var t=this.props,r=t.actionHandlers,o=t.filesViewActionHandlers,i=t.fileRename,a=t.path,l=t.user,c=t.handleComponentTTI,d=t.isFileViewerShown,u=t.arePostTTIModulesLoaded,p=t.getIsFileJumping,h=t.ensureFileViewerClosedIfNotPreviewing,f=t.browseExperiments,_=t.searchResultsExperiments,S=t.searchBarExperiments,g=t.onNavigateToParentFolder,v=t.onNavigateToPath,E=t.onOpenFileSharedWithMe,y=t.shouldShowDeletedFiles,I=t.onNavigateToFileOrFolder,R=t.onSearchFiltersChanged,O=t.starredState,P=t.fileCategories,D=t.isPaperEnabled,A=t.viewType,N=t.searchSortOrder,L=t.onSearchSortChange,x=t.shouldShowRetrievalSuccessBanner,M=t.isSearchMode,k=this.getPageHeaderHeight(e)+(x?w.SEARCH_SUCCESSS_BANNER_HEIGHT_IN_SEARCH_RESULTS:0);return n.default.createElement("div",null,n.default.createElement(T.RetrievalSuccessBrowseviewBanner,{user:l,displayContext:w.SearchSuccessDisplayContext.SEARCH_RESULTS,expSearchSuccessBanner:!!S.expSearchSuccessBanner,isFilePreview:F.isFilePreview(),isSearchMode:M}),n.default.createElement(C.SearchResultsController,{actionHandlers:r,filesViewActionHandlers:o,path:a,user:l,searchResultsExperiments:_,searchBarExperiments:S,browseExperiments:f,onSearch:this.handleSearchFromSearchResults,setFileUploaderPath:m.FileUploaderController.setPathAndPermissions,maestroSearchBarProps:this.state.searchBarProps,handleComponentTTI:c,ensureFileViewerClosedIfNotPreviewing:h,getIsFileJumping:p,renderSharedWithController:this.renderSharedWithController,hrefForFile:s.href_for_file,isFileViewerShown:d,fileRename:i,arePostTTIModulesLoaded:u,getOverflowMenuActions:this.handleGetOverflowMenuActions,onFocusSearchBar:this.handleFocusSearchBar,onNavigateToFileOrFolder:I,onNavigateToParentFolder:g,onNavigateToPath:v,onOpenFileSharedWithMe:E,onOpenPaper:this.handleOpenPaper,shouldShowDeletedFiles:b.isInDeletedFilterRightRailExperiment(S)?y:void 0,responsive:e,onSearchFiltersChanged:R,starredState:O,viewType:A,fileCategories:P,isPaperEnabled:D,pageHeaderHeight:k,onStarClick:this.handleStarClick,currentSort:N,onSortChange:L}))},L.prototype.renderFilesViewController=function(e){var t=this.props.shouldShowPinnedTeamFolders,o=t?this.props.filesWithoutTeamFolders:this.props.files;return n.default.createElement("div",{className:"maestro-browse-app-content"},n.default.createElement(T.RetrievalSuccessBrowseviewBanner,{user:this.props.user,displayContext:w.SearchSuccessDisplayContext.IN_EMBEDDED_APP,expSearchSuccessBanner:!!this.props.searchBarExperiments.expSearchSuccessBanner,isFilePreview:F.isFilePreview(),isSearchMode:this.props.isSearchMode}),n.default.createElement(_.WebTeamSharingModalExperiment,{context:this.props.context,user:this.props.user,path:this.props.path,selectedFiles:this.props.selectedFiles,browsePostTTIExperiments:this.props.browsePostTTIExperiments}),this.renderFixedHeader(),this.props.browseExperiments.expGrowthTcBizEducationModule&&n.default.createElement(U.EducationModuleExperiment,{user:this.props.user,initialState:this.props.browseExperiments.expGrowthTcBizEducationModule,isCurrentlyInOnboarding:!!this.props.browseExperiments.currentChecklistModuleName}),n.default.createElement(g.FilesViewController,r.__assign({},this.props.filesViewActionHandlers,{disabledMultiselect:this.props.isTimelineVisible,getOverflowMenuActions:this.handleGetOverflowMenuActions,renderSharedWithController:this.renderSharedWithController,hrefForFile:s.href_for_file,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onNavigateToParentFolder:this.props.onNavigateToParentFolder,onOpenFileSharedWithMe:this.props.onOpenFileSharedWithMe,onOpenPaper:this.handleOpenPaper,onFocusSearchBar:this.handleFocusSearchBar,context:this.props.context,createNewFolderState:this.props.createNewFolderState,currentSort:this.props.currentSort,dropTargetHighlightMode:this.getCurrentDropTargetHighlightMode(),fileRename:this.props.fileRename,items:o,responsive:e,getIsFileJumping:this.props.getIsFileJumping,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isFileViewerShown:this.props.isFileViewerShown,isOverFreeQuota:this.props.isOverFreeQuota,shouldShowPinnedTeamFolders:t,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,fileExtensionsConfigs:this.props.fileExtensionsConfigs,isTextSelectable:this.props.isTextSelectable,loadingState:this.props.loadingState,onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.handleSelectionChange,onSortChange:this.handleFileListSortChange,onStarClick:this.handleStarClick,path:this.props.path,ref:this.setFilesViewControllerRef,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:m.FileUploaderController.setPathAndPermissions,showFileUploaderModal:this.handleShowFileUploader,teamFolders:this.props.teamFolders,totalNumFiles:this.props.totalNumItems,user:this.props.user,viewType:this.props.viewType,isQueryingFolderSizes:this.props.isQueryingFolderSizes,columns:this.props.columns,viewTypeColumns:this.props.viewTypeColumns,viewTypes:S.AllViewTypes,viewTypeLabels:S.ViewTypeLabels,starredState:this.props.starredState,pageHeaderHeight:this.getPageHeaderHeight(e),isStickyColumnHeader:this.props.shouldShowSharedFolderInvites||this.props.shouldShowPinnedTeamFolders||this.props.shouldShowFolderOverview||this.isExpGrowthTcBizChecklistUiRevampEnabled(),scrollPositionOffset:this.state.fixedHeaderHeight||0,hasResponsiveOverflowMenu:!!this.props.browsePostTTIExperiments.expResponsiveFilesOverflowMenu})))},L.prototype.render=function(){var e=this.props,r=e.user,o=e.path,s=e.clickTimelineTimestamp,i=e.isDraggingExternalFiles,a=e.isDraggingInternalFiles,l=e.isUploadModalOpen,c=e.isSearchMode,d=e.context,u=e.isTimelineVisible,p=e.onSetUrl,h=e.optedInToRewind,_=e.browsePostTTIExperiments,m=_.expTimeline,S=_.expRewindUpsell,g=e.browseExperiments.expSnackbarManager,v=e.montanaModalProps,w=this.props.browseExperiments.expFolderHistoryRollbacks,T=M.getQueryArgs().rewind_optin,F=w||h||m||T||S!==H.UpsellVariant.OFF&&S!==H.UpsellVariant.CONTROL;return n.default.createElement("div",null,F&&n.default.createElement(t.AsyncDelorean,{clickBrowseButtonTimestampMs:s,user:r,fromDesktopClient:"true"===M.getQueryArgs().from_desktop_client,showRewindTab:"true"===M.getQueryArgs().rewind,browseContext:d,close:this.close,isVisible:u,expFolderHistoryRollbacks:w||h||!1,expTimeline:m||!1,rewindOptin:T,userVersionHistoryLength:this.props.userVersionHistoryLength,onOptIn:this.onTimelineOptIn,expRewindUpsell:S}),v&&n.default.createElement(t.AsyncMontanaModal,{montanaModalProps:v,user:r}),n.default.createElement(E.SearchChrome,{user:r,titleRegion:n.default.createElement(f.BrowseTitle,{path:o,user:r,isDraggingExternalFiles:i,isDraggingInternalFiles:a,isUploadModalOpen:l,isSearchMode:c,onSetUrl:p}),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderAppContent,actionSidebarRegion:this.renderSidebar,searchBarProps:this.state.searchBarProps,key:String(this.props.optedInToRewind)}),g?n.default.createElement(q.SnackbarManager,{ref:"snackbarManager"}):null)},L.defaultProps={selectedFiles:o.OrderedMap(),viewType:v.ViewType.List},L})(n.default.PureComponent);t.BrowseView=z,t.AsyncDelorean=L.Loadable({loader:function(){return r.__awaiter(W,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,A.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/delorean/delorean"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().Delorean,[2,t]}})})}}),t.AsyncMontanaModal=L.Loadable({loader:function(){return r.__awaiter(W,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,A.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/montana/in_product_modal/in_product_modal_post_tti_renderer"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().PostTTIMontanaIPAModalRenderer,[2,t]}})})}})}),define("modules/clean/react/browse/controller",["require","exports","tslib","external/lodash","external/react-dom","react","modules/clean/analytics","modules/clean/browse/browse_bolt_client","modules/clean/em_string","modules/clean/filepath","modules/clean/filetypes","modules/clean/history","modules/clean/pagelet_logger","modules/clean/pagination_manager","modules/clean/react/app_actions/education/async_extensions_edu_modal","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/browse_prefetch_loader","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/professional_collection_actions","modules/clean/react/browse/uri_helper","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/react/file_viewer/async_controller","modules/clean/react/fileops_actions","modules/clean/react/files_view/constants","modules/clean/react/files_view/types","modules/clean/react/retrieval_success_banner/util","modules/clean/react/snackbar","modules/clean/search/constants","modules/clean/search/logger","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/clean/storage","modules/clean/upsell/prompt_event_emitter","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/browser_detection","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C,I,R,O,P,D,A,N,L,x,M,k,U,V,B,q,H,W,G,z,j,Q,Y,K,J,X,Z,$,ee,te,re,oe,ne){"use strict";function se(e){oe.Notify.success(re._("%(file_name)s added to your Dropbox.").format({file_name:c.filename(e)}))}function ie(e){var t=re._('Added “%(folder_name)s” <a href="%(href)s">Learn More</a>').format({folder_name:l.Emstring.em_snippet(c.filename(e),G.SNIPPET_SIZES.FILENAME),href:"/help/business/team-space-overview#acceptfolder"});oe.Notify.success(new te.HTML(t))}function ae(e){var t=c.parent_dir(e);"/"!==t&&oe.Notify.success(re._("Folder is in %(path)s").format({path:l.Emstring.em_snippet(t,22)}))}function le(e){return!!e&&e.isShown()}function ce(e){var t=b.getQueryArgs();u.default.replace_state(e,o.pick.apply(o,[t,E.BrowseQueryArg.d,E.BrowseQueryArg.select,E.BrowseQueryArg.preview,E.BrowseQueryArg.activity,E.BrowseQueryArg.rewind,E.BrowseQueryArg.from_desktop_client,E.BrowseQueryArg.rewind_optin,E.BrowseQueryArg.preselected_for_showcase,E.BrowseQueryArg.folder_overview,E.BrowseQueryArg.rewind_tip].concat(E.FRAMEWORK_ARGS)))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),s=r.__importDefault(s),c=r.__importStar(c),u=r.__importDefault(u),_=r.__importStar(_),S=r.__importStar(S),R=r.__importStar(R),P=r.__importStar(P),M=r.__importStar(M),V=r.__importStar(V),K=r.__importStar(K),Z=r.__importStar(Z),$=r.__importStar($);var de;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SEARCH=1]="SEARCH"})(de||(de={}));var ue=(function(t){function l(s){
var a=t.call(this,s)||this;a.deferredCheckForMissingStarredData=o.noop,a.searchHistoryTime=0,a.previousHistoryCallbackMode=de.BROWSE,a.debouncedRunSearch=o.debounce(function(e){B.searchResultsActions.runSearch(e)},200),a.handlePostTTIPrefetchComplete=function(t){return r.__awaiter(a,void 0,void 0,function(){var o,n,s,i,a,l,c,d,u,p;return r.__generator(this,function(h){switch(h.label){case 0:return o=t["exp-browse-post-tti-experiments"],n=t["exp-uploader-post-tti-experiments"],s=!!t["is-over-free-quota"],i=!!t["maybe-render-team-admin-modals"],a=!!t["has-excluded-ns-ids"],l=t["montana-modal-props"],c=t["preferred-editors"],o.expShouldShowNcctPaywall&&Z.redirect("/ncct-trial-end"),[4,new Promise(function(t,r){e(["modules/core/browser_detection"],t,r)}).then(r.__importStar)];case 1:return d=h.sent().is_supported_mobile_browser,u=!d()&&l,this.setState({uploaderPostTTIExperiments:n,isOverFreeQuota:s,hasExcludedNsIds:a,montanaModalProps:u?l:null,preferredEditors:c}),this.props.setBrowsePostTTIExperiments({browsePostTTIExperiments:o}),!i||u?[3,3]:[4,new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar)];case 2:p=h.sent().postTTINCCTReminderModal,p(),h.label=3;case 3:return[2]}})})},a.handlePostTTIPrefetchError=function(e){ee.reportException({err:e||new Error("failed to load post TTI experiments")})},a.handlePreviewAndShareModalsOnLoad=function(t){var o=a.getPathFromProps(),n=a.props.user,s=!!a.props["open-preview"],i=!!a.props["show-share-modal"],l=a.props["share-prefill-email"];if(s&&!t){oe.Notify.error(re._("The file doesn’t exist"));var c=a.props.urlPrefix,d=a.getUrlForFQPath(c,o),p=b.getQueryArgs();delete p.preview,u.default.replace_state(d,p)}if(t){var h=w.File.fromServerObject(t);O.asyncOpenPreview({containerId:E.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[h],fileViewAction:X.FileViewActionType.CLICK,fileViewOrigin:X.FileViewOriginType.BROWSE,fileViewTarget:X.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:n,updateBrowserLocation:!1,onFileViewerDidMount:O.hideElementsBehindFileViewer,onFileViewerUnmount:function(){O.showElementsBehindFileViewer();var e=a.browseViewRef;(e=e.getFilesViewControllerRef())&&(e=e.getFilesViewTileGridRef())&&(e=e.getTileGridRef())&&e.getAndUpdateTileLayout(),a.restoreUrlAfterFileViewClose()}}),i&&K.waitForTTI().then(function(){a.mounted&&W.asyncShowPrefilledShareModal({user:n,sharePrefillEmail:l,content:h,setPath:T.browseNavActions.setPath,setUrl:a.props.setUrl})})}else i&&a.showShareModalForCurrentPath(l);i||a.props["showing-mobile-billing-modal"]||a.props["showing-client-modal"]||K.waitForTTI().then(function(){Q.promptBufferedEventEmitter.on(Q.Events.ON_PROMPT_INITIALIZED,function(t){return r.__awaiter(a,void 0,void 0,function(){var o,n,s,i,a,l;return r.__generator(this,function(c){switch(c.label){case 0:return t&&(t.didMainCampaignLoad()||t.didCampaignForUserEducationLoad())?[2]:[4,new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar)];case 1:return o=c.sent().postTTINCCTReminderModal,[4,o()];case 2:return(n=c.sent())?[2]:(s="V1"===this.props.browsePostTTIExperiments.expEngageDesktopWebOnly,i="V1"===this.props.browsePostTTIExperiments.expEngageDesktopWebFirst,s&&this.props.user.is_team?[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/install_client_modal"],t,r)}).then(r.__importStar)]:[3,4]);case 3:return a=c.sent().installClientModalExperiment,a(),[3,6];case 4:return i?[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/non_unity_web_first_modal"],t,r)}).then(r.__importStar)]:[3,6];case 5:l=c.sent().nonUnityWebFirstModal,l(),c.label=6;case 6:return[2]}})})})})},a.receiveStateFromStores=function(){a.setState(a.getStateFromStores())},a.handleComponentTTI=function(e){a.browseLogger&&(!a.browseLogger.ttiLogged||"FilesViewController"!==e&&"SearchResultsTitle"!==e?a.browseLogger.componentReady(e):a.ajaxRequestWebTimer&&(a.ajaxRequestWebTimer.markTimeToInteractive(),delete a.ajaxRequestWebTimer))},a.onAllUploadsComplete=function(e){var t=e.detail.files,r=t.map(function(e){return c.normalize(e.path)+c.normalize(e.name)});m.browseActions.selectFilesAfterUpload({fqPathsToSelect:r})},a.getIsFileJumping=function(){return a.props.isFileJumping},a.getFileByFullPath=function(e){return a.props.files.find(function(t){return t.fq_path===e})||null},a.getFileByFilename=function(e){return a.props.files.find(function(t){return c.filename(t.fq_path)===e})||null},a.setBrowseViewRef=function(e){a.browseViewRef=e},a.startBoltLiveUpdate=function(){a.browseBoltClient.startLiveUpdate(function(){a.getChangesRequest&&a.getChangesRequest.abort();var e=a.props,t=e.user,r=e.path,o=e.shouldShowDeletedFiles;a.getChangesRequest=S.getChangesForDirectory({path:r,userId:t.id,namespaceToJournalIdMap:a.browseBoltClient.getNsMap(),includeDeletedFiles:o,onSuccess:function(e){delete a.getChangesRequest,r===a.props.path&&(a.props.applyBoltUpdates({updates:e,setPath:T.browseNavActions.setPath}),a.browseBoltClient.handleUpdateBoltClient(e.bolt_data))}})})},a.toggleTimelineIfNecessary=function(){var e=b.getQueryArgs().activity||b.getQueryArgs().rewind;e&&!a.props.isTimelineVisible&&a.props.showTimeline(),!e&&a.props.isTimelineVisible&&a.props.hideTimeline()},a.showShareModalForCurrentPath=function(e){var t=a.props.user,r=a.getPathFromProps();K.waitForTTI().then(function(){if(a.mounted){var o=a.props["ns-id"],n=a.props["ns-path"];W.asyncShowPrefilledShareModal({user:t,sharePrefillEmail:e,content:{fqPath:r,isFolder:!0,nsId:o&&n?o:null,targetNsId:o&&!n?o:null},setPath:T.browseNavActions.setPath,setUrl:a.props.setUrl})}})},a.handleFileLocationChange=function(e,t){if(e="/"+ne.URI.decode(e),a.ensureFileViewerIsOpenedOrClosedIfNeeded(t),a.toggleTimelineIfNecessary(),t.share&&!a.props["show-share-modal"]&&a.showShareModalForCurrentPath(),a.previousHistoryCallbackMode!==de.BROWSE||!c.paths_are_equal(a.props.path,e)||"1"===t.d!==a.props.shouldShowDeletedFiles||t.reload){t.reload&&(delete t.reload,a.props.setUrl({path:a.props.path,qargs:t}));var r=function(){return D.SortIsFilename.includes(a.props.currentSort.sortField)?A.SortLabel.FILENAME:a.props.currentSort.sortField===A.SortField.MODIFIED?A.SortLabel.MODIFIED:A.SortLabel.SIZE};a.previousHistoryCallbackMode=de.BROWSE,a.props.setPath({path:e}),a.props.setLoadingState({loadingState:A.LoadingState.LOADING_FIRST_PAGE,path:e}),a.props.setShouldShowDeletedFiles({shouldShowDeletedFiles:"1"===t.d}),a.browseLogger&&a.browseLogger.ttiLogged&&a.ensureTimer("browse_ajax","browse_ajax_nav"),S.loadPath({sortLabel:r(),sortIsAscending:a.props.currentSort.sortDirection===A.SortDirection.ASCENDING,path:e,userId:a.props.user.id,sortFoldersFirst:!$.mac,includeDeletedFiles:"1"===t.d,onSuccess:function(t){var r=t.path,o=t.data,n=t.xhr;if(a.ajaxRequestWebTimer){var s=n.getResponseHeader("x-dropbox-request-id");a.ajaxRequestWebTimer.end(s?s:void 0)}if(c.paths_are_equal(e,r)&&!b.getQueryArgs().query){a.props.setPath({path:e}),a.props.setMountPoints({mountPoints:o.ns_id_to_mount_point});var i=w.BrowseContext.fromServerObject(o);if(o.paginated){var l=o.first_page.total_num_items;a.props.setPathData({path:e,files:[],context:i,paginatedTotalNumFiles:l});h.PaginationManager.create({firstPage:o.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:a.props.user.id,newDataAvailableCallback:function(t,r){var o=t.areAllItemsReady()?A.LoadingState.LOADED:A.LoadingState.LOADING_REMAINING_PAGES;a.props.appendFiles({path:e,files:r.map(w.File.fromServerObject)}),a.props.setLoadingState({path:e,loadingState:o}),t.areAllItemsReady()&&t.stopAutoFetching()}}).startAutoFetching()}else a.props.setPathData({path:e,files:o.file_info.map(w.File.fromServerObject),paginatedTotalNumFiles:o.file_info.length,context:i}),a.props.setLoadingState({loadingState:A.LoadingState.LOADED,path:e})}},onError:function(){c.paths_are_equal(e,"/")||a.props.setUrl({path:"/"})}})}},a.getPathFromProps=function(){return a.props["init-fq-path"]||"/"},a._handleSearchLocationChange=function(e,t){if(t){a.props.isSearchMode||a.props.setIsSearchMode({isSearchMode:!0});var r=a.searchBarExperiments,o=t.query||t.query_unnormalized||"";e=t.path||t.last_fq_path||"/";var n=t.search_session_id||"",s=t.file_categories||"",i=t[E.BrowseQueryArg.search_type]||x.SearchType.ALL,l=void 0,d=void 0,u=V.orderByToSortField(t.search_order_by),p=V.reverseOrderToSortDirection(t.search_reverse_order),h={sortField:u,sortDirection:p},f=!V.areSortOrdersEqual(h,a.state.searchSortOrder);f&&q.recordSearchResultsSortOrderChange({user:a.props.user,sort_order:h,view_type:a.props.viewType}),a.props.setViewTypeScope({viewTypeScope:i===x.SearchType.IMAGE?D.VIEW_TYPE_SCOPE_IMAGE_SEARCH:D.VIEW_TYPE_GLOBAL_SCOPE}),i!==a.state.searchType&&i===x.SearchType.IMAGE&&a.props.viewType!==A.ViewType.LargeGrid&&a.props.setViewType({user:a.props.user,viewType:A.ViewType.LargeGrid}),U.isInDeletedFilterRightRailExperiment(r)&&(l="1"===t.d,a.props.setShouldShowDeletedFiles({shouldShowDeletedFiles:l}),l&&(_.logSwitchViewType({uid:a.props.user.id,isSearchMode:!0,viewType:A.ViewType.List}),a.props.setViewType({user:a.props.user,viewType:A.ViewType.List})));var m=!(c.paths_are_equal(e,a.props.path)&&(!U.isInDeletedFilterRightRailExperiment(r)||l===a.props.shouldShowDeletedFiles)&&(!V.isInFileTypeFilterExperiment(r)||s===V.fileCategoriesToString(a.state.latestFileCategories))&&i===a.state.searchType);if(o&&(o!==a.state.latestQuery||m||f)){if(o===a.state.latestQuery&&!m&&f&&a.state.hasCachedFullSearchResults&&(a.state.cachedFullSearchResultsSortField===A.SortField.RELEVANCE||u!==A.SortField.RELEVANCE))return void B.searchResultsActions.sortSearchResults(h);var S=a.props.user;setTimeout(function(){a.props.clearFiles({path:e,context:a.props.brsContext})}),a.previousHistoryCallbackMode=de.SEARCH,c.paths_are_equal(a.props.path,e)||a.props.setPath({path:e}),V.isInFileTypeFilterExperiment(r)&&(d=V.fileCategoriesFromString(s),s!==V.fileCategoriesToString(a.state.latestFileCategories)&&a.props.setFileCategories({fileCategories:d})),i!==a.state.searchType&&a.setState({searchType:i}),a.props.setSearchQuery({query:o,searchSessionId:n,searchPath:e}),a.ensureTimer("search_results","search_results_ajax");var g={user:S,path:e,query:o,searchSessionId:n,webTimer:a.ajaxRequestWebTimer||K.get_timer("search_results"),deletedFiles:l,expSinglePageSearch:a.isInSinglePageSearchExperiment,fileCategories:d,isPaperEnabled:!!a.props["paper-enabled-for-user"],sortOrder:h,searchResultsExperiments:a.searchResultsExperiments,searchType:i};a.isInSinglePageSearchExperiment?m||f?(B.searchResultsActions.clearSearch(),B.searchResultsActions.runSearch(g)):a.debouncedRunSearch(g):B.searchResultsActions.runSearch(g)}}},a.handleSearchExit=function(){a.props.setIsSearchMode({isSearchMode:!1}),a.props.setViewTypeScope({viewTypeScope:D.VIEW_TYPE_GLOBAL_SCOPE}),B.searchResultsActions.clearSearch(),a.searchBarExperiments.expSearchSuccessBanner&&!N.getClickedOnSearchResultsPageItem()&&N.setSearchSuccessBannerVisible(),a.isInSinglePageSearchExperiment&&!a.props.isSearchBarFocused&&a.props.blurSearchBar()},a.markTTVIfNeeded=function(){if(!a.hasTTVBeenLogged&&a.mounted&&(a.prefetchComplete||a.props["search-query"])){var e=window.ensemble;e&&e.markPageletRenderedByDOMNode(n.findDOMNode(a)),K.mark_time_to_view(),a.hasTTVBeenLogged=!0}},a.handleFileListUpdated=function(){le(a.state.fileViewerController)?a.props.files.isEmpty()?a.state.fileViewerController.close():a.state.fileViewerController.updateFiles(a.props.files.toJS()):a.ensureFileViewerIsOpenedOrClosedIfNeeded(b.getQueryArgs()),a.prefetchPreviewData(a.props.files.toArray(),a.props.user)},a.handleOnNavigateToPath=function(e){a.searchBarExperiments.expSearchSuccessBanner&&(N.setSearchSuccessBannerVisible(),N.setClickablePathData(e)),a.blurSearchBarIfInSinglePageSearch(),m.browseActions.setUrl({path:e})},a.handleOnNavigateToParentFolder=function(){a.blurSearchBarIfInSinglePageSearch(),m.browseActions.navigateToParentFolder()},a.handleDelete=function(e){var t=e.some(w.File.isTeamSharedFolder),r=e.some(function(e){return e.read_only}),o=e.every(function(e){return e.isDeleted});!a.browseContext.isCurrentPathWriteable()||t||r?t?oe.Notify.error(re._("Team folders can’t be deleted.")):oe.Notify.warning(re._("You don’t have permission to delete files in this folder.")):o?m.browseActions.doPermanentDeleteWithModal(e):m.browseActions.doDeleteFilesWithModal({files:e})},a.handleSearchBarResultOpen=function(e){m.browseActions.navigateToFileOrFolder({file:e,fileViewAction:X.FileViewActionType.SEARCH,preferredEditors:a.state.preferredEditors})},a.handleSearchBarPathClicked=function(e){m.browseActions.navigateToResultObjectParentFolder({file:e,fileViewAction:X.FileViewActionType.SEARCH})},a.handleOnNavigateToFileOrFolder=function(e,t){if(a.blurSearchBarIfInSinglePageSearch(),a.searchBarExperiments.expSearchSuccessBanner&&!N.userIsOptedOutOfRetrievalSuccessBanner()){N.resetSearchResultClickKey();var r=e.is_dir;if(a.props.isSearchMode)N.setClickedOnSearchResultsPageItem(),N.setSearchSuccessBannerVisible(),r&&N.setFolderSearchResultData(e.fq_path);else{N.doSearchBarInteractionBroadcast(!1),N.doSearchResultActionClickBroadcast(!1);var o=e.fq_path,n=N.getClickablePath(),s=N.getSearchResultPath(),i=N.getSearchResultClickTimestamp(),l=N.getClickableFilePathClickTimestamp(),c=Date.now();i&&c-i<=3e4&&N.parentPathOfFileEqualsSearchResultPath(o,s,r)||l&&c-l<=3e4&&N.parentPathOfFileEqualsSearchResultPath(o,n,r)?N.setSearchSuccessBannerVisible():N.resetSearchSuccessBannerSettings()}}a.props.hideTimeline();var d=window.pageYOffset;a.ensureFullFileObjectPopulated(e,a.completeNavigateToFileOrFolder,function(){window.scrollTo({top:d})})},a.ensureFullFileObjectPopulated=function(e,t,r){a.props.isSearchMode?B.searchResultsActions.fetchCompleteSearchResultSRP({searchResult:e,user:a.props.user,onSuccess:t}):t(e,r)},a.completeNavigateToFileOrFolder=function(e,t){var r=a.props,o=r.isSearchMode,n=r.user,s=r.viewer,l=r.viewType,u=e.ns_id,p=e.sjid,h=e.file_id,f=e.fq_path,S=e.bytes,g=e.ext,v=e.request_id;if(_.logOpenRow({uid:n.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:l,file_nsid:u,file_sjid:p,file_id:h,file_name:c.filename(e.fq_path),file_path:f,file_size:S,file_extension:g,request_id:v}),e.type===d.FileTypes.TEAM_SHARED_FOLDER&&(Y.UEClient.sendEvent("FileItemRow","TeamFolderClicked"),i.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:s.team_id})),o){var E=J.WebUserActionLogEvent.FILE_VIEW;e.is_unmounted?E=J.WebUserActionLogEvent.UNMOUNTED_VIEW:e.is_dir&&(E=J.WebUserActionLogEvent.FOLDER_OPEN),q.recordSearchResultsAction({result:e,user:n,action_type:E,view_type:l,search_type:a.state.searchType})}m.browseActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:t,fileViewAction:o?X.FileViewActionType.SEARCH:X.FileViewActionType.CLICK,preferredEditors:a.state.preferredEditors})},a.handleOnOpenFileSharedWithMe=function(e){var t=a.props,r=t.isSearchMode,o=t.user,n=t.viewType;r&&q.recordSearchResultsAction({result:e,action_type:J.WebUserActionLogEvent.FILE_VIEW,user:o,view_type:n,search_type:a.state.searchType}),Z.redirect(e.href)},a.actionHandlers={onDelete:a.handleDelete,onShowRename:function(e){return a.props.setFileRename({file:e,renameState:A.RenameState.PENDING_INPUT})},onRestore:function(e){m.browseActions.doRestoreFilesWithUnifiedTrashModal({files:e})},onPermanentDelete:function(e){m.browseActions.doPermanentDeleteWithModal(e)},onShowComment:function(e){return a.onShowComment(e)},onPrepareForSignature:function(e){return a.onPrepareForSignature(e)}},a.handlePresentInZoom=function(e){O.asyncOpenPreview({containerId:E.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[e],indexOfPreviewFile:0,shouldFocusComment:!1,user:a.props.user,onFileViewerDidMount:O.hideElementsBehindFileViewer,onFileViewerUnmount:O.showElementsBehindFileViewer,fileViewAction:X.FileViewActionType.CLICK,fileViewOrigin:X.FileViewOriginType.BROWSE,fileViewTarget:X.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})},a.getOnShowShareHandler=function(e,t){var r=a.props.browsePostTTIExperiments,o=r.expShowShowcaseInterstitial,n=r.expHasCreatedShowcase,s=r.expHasShowcaseFreemium;o?m.browseActions.handleShowShareInterstitialModal(e,t,!!n,!!s,a.props.viewType):m.browseActions.handleShowShareModal(e,t)},a.filesViewActionHandlers={onDelete:a.handleDelete,onShowRename:function(e){return a.props.setFileRename({file:e,renameState:A.RenameState.PENDING_INPUT})},onCopyToClipboard:function(e){return a.props.copyFilesToClipboard({files:e})},onPasteFromClipboard:function(){return a.props.pasteFilesFromClipboard({copyFiles:P.copyFiles})},onNewFolderSubmit:function(e){return m.browseActions.createFolder({pathName:a.browseContext.currentFQPath,folderName:e,nsId:a.browseContext.rootNSID,checkFSWs:!0})},onNewFolderCancel:function(){return m.browseActions.cancelCreateFolder()},onRenameSubmit:function(e,t){return a.props.renameFile({file:e,name:t,isSearchMode:a.props.isSearchMode,checkFSWs:!0})},onRenameCancel:function(e){return a.props.setFileRename({file:e,renameState:null})},onSwitchViewType:function(e){_.logSwitchViewType({uid:a.props.user.id,isSearchMode:a.props.isSearchMode,viewType:e}),a.props.setViewType({user:a.props.user,viewType:e})},onColumnsChanged:function(e,t,r){a.props.setViewTypeColumns({columns:e,viewType:t,user:a.props.user}),a.props.setCanDisplayFolderSizes({canDisplayFolderSizes:r})},onCanDisplayFolderSizesChanged:function(e){return a.props.setCanDisplayFolderSizes({canDisplayFolderSizes:e})},onAddFileJumpKeyCode:function(e){return a.props.addFileJumpKeyCode({keyChar:e})},onResetFileJump:function(){return a.props.resetFileJumpFilter()},onShowShare:a.getOnShowShareHandler,onPresentInZoom:a.handlePresentInZoom},a.uploadAjaxInterceptor={interceptUploadPrecheck:function(e){return e},interceptUpload:function(e,t){var o=t.ns_id_for_routing;if(!o){var n=a.props.mountPoints,s=a.props.brsContext.rootNSID;ee.assert(null!=n,"mountPoints is null"),ee.assert(null!=s,"rootNSID is null"),o=R.getNsId(n,s,e.dest)}return r.__assign({},t,{ns_id_for_routing:o,ns_id:o})}},a.shouldPushNewHistory=function(){if(!a.isInSinglePageSearchExperiment)return!0;var e=(new Date).getTime(),t=e-a.searchHistoryTime;return a.searchHistoryTime=e,t>1e3},a.handleSearch=function(e,t,r,o){o&&void 0===o[E.BrowseQueryArg.search_type]&&(o[E.BrowseQueryArg.search_type]=a.state.searchType);var n=V.buildSearchURL({user:a.props.user,searchPath:t,normalizedQuery:e,searchSessionId:r?a.props.searchSessionId:H.getSearchResultsStore().searchSessionId(),searchToken:V.getSearchCsrfToken(),qargs:o});a.shouldPushNewHistory()?u.default.push_state(n.getPath(),n.getQuery()):u.default.replace_state(n.getPath(),n.getQuery())},a.handleSearchFiltersChanged=function(e){var t=e.path,r=void 0===t?a.props.path:t,o=e.deletedFiles,n=e.fileCategories,s=void 0===n?a.state.latestFileCategories:n,i=e.searchType,l=a.state,c=l.searchSessionId,d=l.latestQuery,u=a.props.user;void 0===i&&(i=a.state.searchType),r&&r!==a.props.path&&M.logScopeChipChanged({searchSessionId:c,user:u,chipAdded:!k.isScopeChipRoot(r),filePath:r,viewport:"right-rail",searchType:"full_page"}),void 0!==o&&o!==a.props.shouldShowDeletedFiles&&M.logDeletedFilterChanged({searchSessionId:c,user:u,deletedFiles:o,viewport:"right-rail",searchType:"full_page"});var p={};void 0!==o&&(p.d=o?"1":"0"),p[E.BrowseQueryArg.search_type]=i,a.addFileCategoryToQueryArgs(p,s),a.addSearchSortOrderToQueryArgs(p),a.handleSearch(d,r,!1,p)},a.handleSearchSortChanged=function(e,t){var r={sortField:e,sortDirection:t},o=a.props.path,n=a.state.latestQuery,s={};a.addFileCategoryToQueryArgs(s),a.addSearchSortOrderToQueryArgs(s,r),a.handleSearch(n,o,!1,s)},a.fileViewerIsShown=function(){return le(a.state.fileViewerController)},a.ensureFileViewerClosedIfNotPreviewing=function(e){!e.preview&&le(a.state.fileViewerController)&&a.state.fileViewerController.close()},a.prefetchPreviewData=function(e,t){a.state.fileViewerController&&a.state.fileViewerController.prewarmPreviewData(e,t)},a.ensureFileViewerIsOpenedOrClosedIfNeeded=function(e){if(e.preview&&!le(a.state.fileViewerController)){var t=a.getFileByFilename(e.preview);t&&m.browseActions.navigateToFileOrFolder({file:t,preferredEditors:a.state.preferredEditors})}else!e.preview&&le(a.state.fileViewerController)&&a.state.fileViewerController.close()},a.getLearnMoreLinkHandler=function(){window.open("/help/business/unsynced-team-folder","_blank")};var l=H.getSearchResultsStore();return a.props.setSearchBarExperiments({experiments:a.searchBarExperiments}),l.add_change_listener(a.receiveStateFromStores),I.uploaderStore.add_change_listener(a.receiveStateFromStores),window.addEventListener(y.ALL_UPLOADS_COMPLETE_EVENT,a.onAllUploadsComplete),a.state=r.__assign({},a.getStateFromStores(),{montanaModalProps:null,arePostTTIModulesLoaded:!1,searchFrom:b.getQueryArgs().search_from,preferredEditors:{}}),a.props.setIsSearchMode({isSearchMode:!!a.state.latestQuery}),a}return r.__extends(l,t),Object.defineProperty(l.prototype,"uploaderExperiments",{get:function(){return this.props["exp-uploader-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"uploaderPostTTIExperiments",{get:function(){return this.state.uploaderPostTTIExperiments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"searchBarExperiments",{get:function(){return this.props["exp-search-bar-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"searchResultsExperiments",{get:function(){return this.props["exp-search-results-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"browseExperiments",{get:function(){return this.props["exp-browse-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isInSinglePageSearchExperiment",{get:function(){return U.isInSinglePageSearchExperiment(this.searchBarExperiments)},enumerable:!0,configurable:!0}),l.prototype.componentWillMount=function(){var e=this,t=this.props,r=t.urlPrefix,o=t.user,n=t.viewer,s=this.props["search-query"],i=this.props["share-link"],l=!!this.props["open-preview"],c=this.getPathFromProps(),d=s?["FilesViewController"]:["FilesViewController","AppActionsView"];this.browseLogger=new p.PageletLogger(s?"search_results":"browse",d,!0,{view_type:this.props.viewType.toLowerCase()}),s||i||l||ce(this.getUrlForFQPath(r,c));var h=n.get_users().map(function(e){return e.id});if(j.UserLocalStorage.clearOtherUsers(h),this.browseBoltClient=new a.BrowseBoltClient(o.id),s){new g.SearchPrefetchLoader({onPostTTIPrefetchComplete:this.handlePostTTIPrefetchComplete,onPostTTIPrefetchError:this.handlePostTTIPrefetchError}).handlePrefetch()}else{var f=new g.BrowsePrefetchLoader({user:o,path:c,fqPathsToSelect:this.props["select-fq-paths"]},{onPrefetchComplete:function(t){e.prefetchComplete=!0,e.handlePreviewAndShareModalsOnLoad(t.preview_file_info),K.log_js_modules_fetched_data_required_for_tti(),e.markTTVIfNeeded()},onPrefetchError:function(){e.prefetchComplete=!0,e.props.setUrl({path:""}),e.handleFileLocationChange("",{})},onLoadComplete:function(){e.maybeShowPrepopulatedAddToCollectionModal(e.props.files)},onPostTTIPrefetchComplete:this.handlePostTTIPrefetchComplete,onPostTTIPrefetchError:this.handlePostTTIPrefetchError},{onInitializeEverything:m.browseActions.initializeEverything,onLoad:T.browseNavActions.loadPath,onAddFilesAndSetLoadingState:m.browseActions.addFilesAndSetLoadingState});f.isPrefetching()&&f.handlePrefetch()}this.searchBarExperiments.expSearchSuccessBanner&&(window.addEventListener("popstate",function(){N.resetSearchSuccessBannerSettings(),N.doSearchBarInteractionBroadcast(!1),N.doSearchResultActionClickBroadcast(!1)}),u.default.deconstruct_url(document.referrer).qargs.search_session_id&&!N.getClickedOnSearchResultsPageItem()?N.setSearchSuccessBannerVisible():N.getSearchSuccessBannerVisibleFromHome()?(N.setSearchSuccessBannerVisible(),N.resetSearchSuccessBannerVisibleFromHome()):N.resetSearchSuccessBannerSettings());u.default.add_callback(r,this.handleFileLocationChange,!0),this.browseExperiments.expUniversalSinglePageSearch||(u.default.add_callback("/search",this._handleSearchLocationChange,!s),u.default.add_exit_callback("/search",this.handleSearchExit))},l.prototype.componentDidMount=function(){var t=this;this.mounted=!0;var n=this.getPathFromProps(),s=this.props.user,i=this.props["search-query"],a=this.props["share-link"],d=!!this.props["open-preview"];if(this.props["from-scl-sync-modal"]&&(s.is_cdm_member?ie(n):se(n)),this.props["show-share-success-snackbar"]){var u=c.filename(n);z.showInBandShareSuccessSnackbar(u)}this.shouldShowUnsyncNotification()&&this.showUnsyncNotification(),!i&&a&&!d&&s.is_cdm_member&&ae(n),this.toggleTimelineIfNecessary(),this.markTTVIfNeeded(),l.mountFileViewerTarget(),K.waitForTTI().then(function(){t.props["search-query"]||t.fetchAndStartBoltUpdates();var n=function(e){var r=e[0],n=r[0],s=(r[1],r[2].SharedWithStore),i=(r[3],r[4]),a=i.checkForMissingStarredData,l=i.StarredStore,c=(r[5],r[6],e[1]),d=(c[0],c[1],c[2].BloodhoundContactsV2),u=c[3].EmailVerification;c[4],c[5],c[6];if(t.mounted){var p=t.props,h=p.user,_=p.path,m=p.files,S=m.toArray();s.initializeWith({path:_,files:S}),a({items:S,user:h});var g=l.addListener(function(){t.setState({starredState:l.getLoadingStates()})});t.deferredCheckForMissingStarredData=function(){return o.defer(function(){a({items:t.props.files.toArray(),user:h})})},t.removeStarredStoreListener=function(){g()},d.getOrCreateForUser(h),t.setState({arePostTTIModulesLoaded:!0,fileViewerController:n}),t.props["email-just-verified"]?u.getForRole(h.role).show_verified_modal():t.props["email-just-verified-and-changed"]?u.getForRole(h.role).show_verified_and_changed_modal():t.props["send-verification-email"]&&u.getForRole(h.role).show_sent_modal(),t.prefetchPreviewData(m.toArray(),h);var v=t.props["should-open-extensions-edu-modal"];v&&f.asyncShowExtensionsEduModal(h.id,v)}};n.perfName="browse_post_tti",Promise.all([Promise.all([new Promise(function(t,r){e(["modules/clean/react/file_viewer/controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/shared_with"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/files_view/overflow_menu"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/file_modal_controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/share_modal_util"],t,r)}).then(r.__importStar)]),Promise.all([new Promise(function(t,r){e(["modules/clean/sharing/ui_util"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/wizard/wizard_modals"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/contacts/bloodhound_contacts_v2"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/account/email"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity_browse_interface"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/features"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/check_file_cache"],t,r)}).then(r.__importStar)])]).then(n)})},l.prototype.componentWillUpdate=function(e,t){e.isSearchMode&&!this.props.isSearchMode?this.browseBoltClient.stopLiveUpdate():!e.isSearchMode&&this.props.isSearchMode&&this.fetchAndStartBoltUpdates(),e.files.equals(this.props.files)||o.defer(this.handleFileListUpdated)},l.prototype.componentDidUpdate=function(e){e.loadingState===A.LoadingState.LOADING_FIRST_PAGE&&this.props.loadingState!==e.loadingState&&this.markTTVIfNeeded(),e.files!==this.props.files&&this.deferredCheckForMissingStarredData()},l.prototype.componentWillUnmount=function(){this.removeStarredStoreListener&&this.removeStarredStoreListener(),window.removeEventListener("popstate",function(){N.resetSearchSuccessBannerSettings()}),l.unmountFileViewerTarget(),H.getSearchResultsStore().remove_change_listener(this.receiveStateFromStores),I.uploaderStore.remove_change_listener(this.receiveStateFromStores),window.removeEventListener(y.ALL_UPLOADS_COMPLETE_EVENT,this.onAllUploadsComplete),this.mounted=!1},Object.defineProperty(l.prototype,"browseContext",{get:function(){return this.props.isSearchMode?this.state.srpContext:this.props.brsContext},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"selection",{get:function(){return this.props.isSearchMode?this.state.srpSelection:this.props.brsSelection},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"selectedFiles",{get:function(){return this.props.isSearchMode?this.state.srpSelectedFiles:this.props.brsSelectedFiles},enumerable:!0,configurable:!0}),l.prototype.getStateFromStores=function(){var e=H.getSearchResultsStore(),t=e.latestQuery();return{isDraggingInternalFiles:C.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:C.FileUploaderController.isDraggingExternalFiles(),isUploadModalOpen:C.FileUploaderController.isUploadModalOpen(),latestFileCategories:e.latestFileCategories(),srpContext:e.browseContext(),srpSelection:e.selection(),srpSelectedFiles:e.selectedFiles(),searchSessionId:e.searchSessionId(),latestQuery:t,searchSortOrder:e.sortOrder(),hasCachedFullSearchResults:e.hasCachedFullSearchResults(),cachedFullSearchResultsSortField:e.cachedFullSearchResultsSortField(),searchType:e.searchType()}},l.prototype.restoreUrlAfterFileViewClose=function(){var e,t=this.props.urlPrefix,r=this.getUrlForFQPath(t,this.props.path);e=this.props["open-preview"]?o.omit(b.getQueryArgs(),E.BrowseQueryArg.preview,E.BrowseQueryArg.select):{},u.default.replace_state(r,e)},l.prototype.getUrlForFQPath=function(e,t){return e+("/"===t?"":ne.URI.encode_parts(t))},l.prototype.fetchAndStartBoltUpdates=function(){this.browseBoltClient.isReady()?this.startBoltLiveUpdate():this.browseBoltClient.fetchInitialBoltData(this.startBoltLiveUpdate,!!this.browseExperiments.expGetBoltWithOdyssey)},l.prototype.ensureTimer=function(e,t){if(this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&(this.ajaxRequestWebTimer.abort(),K.delete_timer(this.ajaxRequestWebTimer.getContextName()),this.ajaxRequestWebTimer=void 0),this.ajaxRequestWebTimer)this.ajaxRequestWebTimer.restart();else{K.delete_timer(e),this.ajaxRequestWebTimer=K.get_timer(e);var r={requireTTI:!0,requireTTV:!1};t&&(r.url=t),this.ajaxRequestWebTimer.initialize(r)}},l.prototype.blurSearchBarIfInSinglePageSearch=function(){this.isInSinglePageSearchExperiment&&this.props.blurSearchBar()},l.prototype.onShowComment=function(e){var t=this;this.ensureFullFileObjectPopulated(e,function(e){m.browseActions.navigateToFileOrFolder({file:e,shouldFocusComment:!0,preferredEditors:t.state.preferredEditors})})},l.prototype.onPrepareForSignature=function(e){var t=this;this.ensureFullFileObjectPopulated(e,function(e){m.browseActions.navigateToFileOrFolder({file:e,shouldPrepareForSignature:!0,preferredEditors:t.state.preferredEditors})})},l.prototype.maybeShowPrepopulatedAddToCollectionModal=function(e){var t=b.getQueryArgs();if(t.preselected_for_showcase){var r=t.preselected_for_showcase.split(".").map(function(e){return"id:"+e});F.showPrepopulatedAddToCollectionModal(r,this.props.user,e.toJS());var o=this.getPathFromProps(),n=this.getUrlForFQPath(this.props.urlPrefix,o);delete t[E.BrowseQueryArg.preselected_for_showcase],u.default.replace_state(n,t)}},l.prototype.addFileCategoryToQueryArgs=function(e,t){if(void 0===t&&(t=this.state.latestFileCategories),void 0!==t&&!V.allCategoriesUnchecked(t)){var r=V.fileCategoriesToString(t);e.file_categories=r}},l.prototype.addSearchSortOrderToQueryArgs=function(e,t){void 0===t&&(t=this.state.searchSortOrder),t&&(e.search_order_by=V.sortFieldToOrderBy(t.sortField),
e.search_reverse_order=V.sortDirectionToReverseOrder(t.sortDirection))},l.prototype.shouldShowUnsyncNotification=function(){return this.props["should-show-unsync-notification"]},l.prototype.showUnsyncNotification=function(){L.Snackbar.show(s.default.createElement(L.Snackbar,{variant:"generic",title:re._("Do you also need this on your computer?",{comment:'\'"this" refers to the folder that the user is currently browsing. (limited space, please keep the phase short)'}),timeoutDelayMs:1e5,actionButtonText:re._("Learn more"),closeButtonText:re._("Close"),onActionClick:this.getLearnMoreLinkHandler,id:"browse-unsync"}))},l.prototype.render=function(){var e=this.state,t=e.isUploadModalOpen,r=e.starredState,o=e.arePostTTIModulesLoaded,n=e.isDraggingExternalFiles,i=e.isDraggingInternalFiles,a=e.isOverFreeQuota,l=e.hasExcludedNsIds,c=e.searchSessionId,d=e.latestQuery,u=e.latestFileCategories,p=e.montanaModalProps,h=e.searchFrom,f=e.searchSortOrder,_=e.searchType,m=this.props,S=m.browsePostTTIExperiments,g=m.canDisplayFolderSizes,E=m.clickTimelineTimestamp,w=m.createNewFolderState,T=m.currentSort,F=m.fileRename,b=m.files,y=m.filesWithoutTeamFolders,C=m.hideTimeline,I=m.isQueryingFolderSizes,R=m.isSearchMode,O=m.isTextSelectable,P=m.optedInToRewind,D=m.isTimelineVisible,A=m.loadingState,N=m.paginatedTotalNumFiles,L=m.path,x=m.setAndStoreSortOrder,M=m.setSelection,k=m.setUrl,U=m.shouldShowDeletedFiles,V=m.shouldShowPinnedTeamFolders,B=m.shouldShowSharedFolderInvites,q=m.showTimeline,H=m.optInToRewind,W=m.teamFolders,G=m.user,z=m.viewType,j=m.viewTypeColumns,Q=m.fileExtensionsConfigs,Y=m.shouldShowRetrievalSuccessBanner,K=m.pinnedItems,J=m.shouldShowFolderOverview,X=this,Z=X.browseContext,$=X.selection,ee=X.selectedFiles;return s.default.createElement(v.BrowseView,{autoTeamGroupId:this.props["auto-team-group-id"],userVersionHistoryLength:this.props["user-version-history-length"],ref:this.setBrowseViewRef,actionHandlers:this.actionHandlers,filesViewActionHandlers:this.filesViewActionHandlers,onNavigateToParentFolder:this.handleOnNavigateToParentFolder,onNavigateToPath:this.handleOnNavigateToPath,onNavigateToFileOrFolder:this.handleOnNavigateToFileOrFolder,onOpenFileSharedWithMe:this.handleOnOpenFileSharedWithMe,onSearchBarResultOpen:this.handleSearchBarResultOpen,clickTimelineTimestamp:E,context:Z,onSearchBarPathClicked:this.handleSearchBarPathClicked,createNewFolderState:w,currentSort:T,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,fileRename:F,files:b,filesWithoutTeamFolders:y,getIsFileJumping:this.getIsFileJumping,getFileByFullPath:this.getFileByFullPath,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:n,isDraggingInternalFiles:i,isFileViewerShown:this.fileViewerIsShown,isSearchMode:R,isTextSelectable:O,isTimelineVisible:D,optedInToRewind:P,isUploadModalOpen:t,loadingState:A,onSearch:this.handleSearch,path:L,selectedFiles:ee,selection:$,shouldOpenUploadModal:this.props["should-open-upload-modal"],shouldShowDeletedFiles:U,shouldShowPinnedTeamFolders:V,shouldShowSharedFolderInvites:B,starredState:r,teamFolders:W,totalNumItems:N,uploadAjaxInterceptor:this.uploadAjaxInterceptor,user:G,viewType:z,canDisplayFolderSizes:g,columns:j[z],viewTypeColumns:j,arePostTTIModulesLoaded:o,isNoComment:this.props["is-no-comment"],isOverFreeQuota:a,hasExcludedNsIds:l,isQueryingFolderSizes:I,nsId:this.props["ns-id"],uploaderExperiments:this.uploaderExperiments,uploaderPostTTIExperiments:this.uploaderPostTTIExperiments,searchBarExperiments:this.searchBarExperiments,searchResultsExperiments:this.searchResultsExperiments,browseExperiments:this.browseExperiments,browsePostTTIExperiments:S,searchSessionId:c,latestQuery:d,onSearchFiltersChanged:this.handleSearchFiltersChanged,fileCategories:u,isNautilusEnabled:!!this.props["nautilus-enabled-for-user"],isPaperEnabled:!!this.props["paper-enabled-for-user"],searchFrom:h,onShowTimeline:q,onCloseTimeline:C,onOptInToRewind:H,onSelectionChange:M,fileExtensionsConfigs:Q,onSortFiles:x,onSetUrl:k,pinnedItems:K,shouldShowFolderOverview:J,searchSortOrder:f,shouldShowRetrievalSuccessBanner:Y,onSearchSortChange:this.handleSearchSortChanged,montanaModalProps:p,searchType:_})},l.mountFileViewerTarget=function(){var e=document.getElementById(E.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=E.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},l.unmountFileViewerTarget=function(){var e=document.getElementById(E.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},l})(s.default.Component);t.BrowseController=ue}),define("modules/clean/react/browse/data/action_creators",["require","exports","tslib","external/immutable","external/lodash","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/data/helpers","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/types","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/browse/uri_helper","modules/clean/react/extensions/data/store","modules/clean/react/file_uploader/constants","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors","modules/clean/react/files_view/file_actions/api_v2","modules/clean/react/files_view/file_actions/file_from_metadata","modules/clean/react/files_view/file_actions/snackbars","modules/clean/react/files_view/types","modules/clean/react/folder_overview/data/action_creators","modules/clean/react/folder_overview/data/selectors","modules/clean/react/selection","modules/clean/react/snackbar","modules/clean/redux/tests/store","modules/clean/search/constants","modules/clean/search/search_results/dispatcher","modules/clean/undo","modules/clean/web_user_action_events","modules/core/cookies","modules/core/exception","modules/core/i18n","modules/core/uri"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C,I,R,O,P,D,A,N,L,x,M,k,U,V){"use strict";function B(e,r,o,n){var s=o.mount_points,i=f.path(r()),a=h.getMountPointUpdateForCurrentPath(s,i,f.mountPoints(r())),l=a[0],c=a[1];l&&!c&&P.Snackbar.complete(U._("The folder was unshared."),"browse-unshare");var d=h.getPathForNewMountPoint(l,c,i);if(d)return void n({path:d});e(t.setMountPoints({mountPoints:s}))}function q(e,r,o){var n=o.added,s=o.moved,l=o.removed,c=f.path(r()),d=f.unsortedFiles(r()),u=f.folderSizes(r()),h=d.size;if(f.postTTIExperiments(r()).expRenameUseApiV2){var _=f.boltIgnore(r()),m=_.added,g=_.moved,v=_.removed,E={added:new Set([]),moved:new Set([]),removed:new Set([])};n=n.filter(function(e){return!m.has(e.fq_path)||(E.added.add(e.fq_path),!1)}),s=s.filter(function(e){var t=e[0];return!g.has(t)||(E.moved.add(t),!1)}),l=l.filter(function(e){return!v.has(e)||(E.removed.add(e),!1)}),e(t.popBoltIgnore(E))}d=d.withMutations(function(e){u=u.withMutations(function(t){for(var r=function(e){return i.paths_are_equal(i.parent_dir(e.fq_path),c)},o=function(t){r(t)&&(e.set(t.fq_path,S.File.fromServerObject(t)),h+=1)},a=function(r,n){var s=e.get(r);if(!(s&&s.sjid>=n.sjid&&r===n.fq_path)){e.remove(r),h-=1,o(n);var i=t.get(r);i&&(t.remove(r),t.set(n.fq_path,i))}},d=function(r){e.remove(r),t.remove(r),h-=1},u=0,p=n;u<p.length;u++){var f=p[u];e.has(f.fq_path)?a(f.fq_path,f):o(f)}for(var _=0,m=s;_<m.length;_++){var g=m[_],v=g[0],f=g[1];e.has(v)?a(v,f):o(f)}for(var E=0,w=l;E<w.length;E++){var v=w[E];e.has(v)&&d(v)}})}),d.size!==h&&k.reportException({err:new Error("applyBoltUpdates ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:k.SEVERITY.CRITICAL,exc_extra:{expected_unsorted_files_size:h,actual_unsorted_files_size:d.size,is_deleted_files_on:f.shouldShowDeletedFiles(r()),filesAdded:n,filesRemoved:l,filesMove:s}}),d!==f.unsortedFiles(r())&&(t.setUnsortedFiles({unsortedFiles:d})(e,r,D.mockExtraArguments),a.Dispatcher.dispatch({type:p.SharedWithActionType.BROWSE_FILES_UPDATED,data:{parentPath:c,files:d.toArray()}})),u!==f.folderSizes(r())&&e(t.setFolderSizes({folderSizes:u})),j({unsortedFiles:d})(e,r,D.mockExtraArguments)}var H=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),s=r.__importStar(s),i=r.__importStar(i),l=r.__importDefault(l),c=r.__importStar(c),u=r.__importStar(u),f=r.__importStar(f),m=r.__importStar(m),w=r.__importStar(w),F=r.__importStar(F),y=r.__importStar(y),R=r.__importStar(R),A=r.__importStar(A);t.appInit=function(e){var t=e.experiments,r=e.shouldShowDeletedFiles,o=e.user,n=e.viewer;return function(e,s){e({type:_.ActionTypes.APP_INIT,payload:{experiments:t,shouldShowDeletedFiles:r,user:o,viewer:n}});var i=M.Cookies.read(p.BROWSE_SORT_COOKIE_NAME);if(i&&i.indexOf("|")>-1){var l=i.split("|",2),c={sortField:l[0],sortDirection:l[1]},d=f.sortOrder(s());c.sortDirection===d.sortDirection&&c.sortField===d.sortField||e(z({sortOrder:c}))}a.Dispatcher.dispatch({type:E.UploaderActionType.SET_USER,data:{user:o}})}},t.pushBoltIgnore=function(e){return{type:_.ActionTypes.PUSH_BOLT_IGNORE,payload:e}},t.popBoltIgnore=function(e){return{type:_.ActionTypes.POP_BOLT_IGNORE,payload:e}},t.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;return{type:_.ActionTypes.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:t}}},t.setCanDisplayFolderSizes=function(e){var t=e.canDisplayFolderSizes;return{type:_.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:t}}},t.setClipboardFiles=function(e){var t=e.clipboardFiles;return{type:_.ActionTypes.SET_CLIPBOARD_FILES,payload:{clipboardFiles:t}}},t.copyFilesToClipboard=function(e){var r=e.files;return function(e,o){if(r.length){if(r.some(function(e){return e.isDeleted}))return void P.Snackbar.fail(U._("Deleted files cannot be added to the clipboard"),"browse-clipboard-copy");if(r.some(S.File.isTeamSharedFolder))return void P.Snackbar.fail(U._("Team Folders can’t be copied."),"browse-clipboard-copy");var n=U.ungettext("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",r.length).format({num_items:r.length});P.Snackbar.complete(n,"browse-clipboard-copy"),e(t.setClipboardFiles({clipboardFiles:r}))}}},t.pasteFilesFromClipboard=function(e){var t=e.copyFiles;return function(e,r){t({user:f.user(r()),files:f.clipboardFiles(r()),newPath:f.path(r()),checkFSWs:!0,dataApi:u,onSuccess:function(e){var t=U.ungettext("Pasted %(num_items)s item from clipboard","Pasted %(num_items)s items from clipboard",e.length).format({num_items:e.length});P.Snackbar.complete(t,"browse-clipboard-paste")}})}},t.setContext=function(e){var t=e.context;return{type:_.ActionTypes.SET_CONTEXT,payload:{context:t}}},t.setBrowsePostTTIExperiments=function(e){var t=e.browsePostTTIExperiments;return{type:_.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:t}}};var W=function(e){var t=e.fileJumpFilter;return{type:_.ActionTypes.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:t}}};t.addFileJumpKeyCode=function(e){var r=e.keyChar;return function(e,o){var n=f.fileJumpFilter(o())+r.toLowerCase();e(W({fileJumpFilter:n}));for(var s=null,i=f.fileJumpIndex(o()),a=0,l=i;a<l.length;a++){var c=l[a],d=c.fqPath;if(c.filename>=n){s=d;break}}null!=s&&e(t.selectFilesByFqPath({fqPathsToSelect:[s]}))}},t.resetFileJumpFilter=function(){return function(e,t){d.logKeyboardShortcutUsage({user_id:f.user(t()).id,keyboard_shortcut_type:"jump",view_type:T.viewType(t())}),e(W({fileJumpFilter:""}))}},t.setFilePathsToSelectOnNextUpdate=function(e){var t=e.filePathsToSelectOnNextUpdate;return{type:_.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:t}}},t.optInToRewind=function(){return{type:_.ActionTypes.OPT_IN_TO_REWIND,payload:{}}},t.showTimeline=function(){return{type:_.ActionTypes.SHOW_TIMELINE,payload:{timestamp:(new Date).getTime()}}},t.hideTimeline=function(){return{type:_.ActionTypes.HIDE_TIMELINE,payload:{}}};var G=function(e,t){N.SearchResultsDispatcher.dispatch({type:A.CHANGE_FILES_ACTION,data:{fileDeltas:[{before:e.fq_path,after:e.is_dir?t.set("icon",e.icon):t}]}})};t.renameFile=function(e){var n=e.file,a=e.name,l=e.isSearchMode,p=e.checkFSWs;return function(e,h){return r.__awaiter(H,void 0,void 0,function(){var _,S,g,v,E,O,D,A,N,M,k,V,B,q=this;return r.__generator(this,function(H){switch(H.label){case 0:return a.indexOf("/")!==-1?(P.Snackbar.fail(U._("Name was invalid."),"browse-rename"),e(w.setFileRename({file:n,renameState:null})),[2]):(_=f.user(h()),S=function(e,t,r){var o=f.selectedFiles(h()),n=m.countFilesAndFolders(o),s=n.num_files_selected,i=n.num_folders_selected;d.logBrowseAction({uid:_.id,action:e,num_files_selected:s,num_folders_selected:i,view_type:T.viewType(h()),result:t,error_summary:r})},g=function(){if("V2"===f.experiments(h()).expFolderOverview){var t=R.folderFileId(h());e(I.reloadContentReferences({folderFileId:t}))}},a.indexOf("/")!==-1?(P.Snackbar.fail(U._("Name was invalid."),"browse-rename"),e(w.setFileRename({file:n,renameState:null})),S(x.WebUserActionLogEvent.RENAME_REQUEST_FAIL,n,'Name contained "/"'),[2]):(e(w.setFileRename({file:n,renameState:C.RenameState.SAVING_INPUT})),f.postTTIExperiments(h()).expRenameUseApiV2?(v=f.path(h()),P.Snackbar.sync(U._("Renaming"),!1,"browse-rename"),l||e(t.pushBoltIgnore({moved:new Set([n.fq_path])})),[4,F.renameFile(n,a,_,p)]):[3,2]));case 1:return E=H.sent(),E.isError?(l||e(t.popBoltIgnore({moved:new Set([n.fq_path])})),"to"===E.error[".tag"]&&"file_system_warnings"===E.error.to[".tag"]?(P.Snackbar.close("browse-rename"),c.showFileSystemWarningsModal({fsws:E.error.to.details,onFinalAccept:function(){e(t.renameFile({file:n,name:a,isSearchMode:l,checkFSWs:!1}))},onAbortAction:function(){e(w.setFileRename({file:n,renameState:null}))},confirmText:U._("Rename")})):(e(w.setFileRename({file:n,renameState:null})),y.renameError(E.error,n.fq_path)),S(x.WebUserActionLogEvent.RENAME_REQUEST_FAIL,n,E.error_summary)):(O=b.fileFromMetadata(n,E.result.metadata),l?G(n,O):i.paths_are_equal(f.path(h()),v)&&(e(t.setUnsortedFiles({unsortedFiles:f.unsortedFiles(h()).remove(n.fq_path).set(O.fq_path,O)})),g()),e(t.selectFilesByFqPath({fqPathsToSelect:[O.fq_path]})),e(w.setFileRename({file:n,renameState:null})),D=function(){return r.__awaiter(q,void 0,void 0,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return P.Snackbar.sync(U._("Undoing"),!1,"browse-rename"),l||e(t.pushBoltIgnore({added:new Set([n.fq_path]),removed:new Set([O.fq_path])})),S(x.WebUserActionLogEvent.RENAME_UNDO,n),[4,F.undo(E.result.changeset_data,_)];case 1:return o=r.sent(),o.isError?(P.Snackbar.fail(U._("Undo failed."),"browse-rename"),l||e(t.popBoltIgnore({added:new Set([n.fq_path]),removed:new Set([O.fq_path])})),S(x.WebUserActionLogEvent.RENAME_UNDO_REQUEST_FAIL,n,o.error_summary)):(P.Snackbar.complete(U._("Undo complete."),"browse-rename"),l?G(O,n):i.paths_are_equal(f.path(h()),v)&&(e(t.setUnsortedFiles({unsortedFiles:f.unsortedFiles(h()).remove(O.fq_path).set(n.fq_path,n)})),g()),e(t.selectFilesByFqPath({fqPathsToSelect:[n.fq_path]})),S(x.WebUserActionLogEvent.RENAME_UNDO_REQUEST_SUCCESS,n)),[2]}})})},L.setHandleUndo(D),P.Snackbar.completeWithUndo(U._("Rename complete."),D,"browse-rename"),S(x.WebUserActionLogEvent.RENAME_REQUEST_SUCCESS,O)),[3,5];case 2:return H.trys.push([2,4,,5]),[4,u.renameFile({file:n,name:a,user:_,checkFSWs:p})];case 3:return A=H.sent(),N=A.renamedFile,M=A.changesets,k=A.failureDetails,V=function(){l&&G(N,n),e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set([n.fq_path])})),g()},k?c.showFileSystemWarningsModal({fsws:k,onFinalAccept:function(){e(t.renameFile({file:n,name:a,isSearchMode:l,checkFSWs:!1}))},onAbortAction:function(){e(w.setFileRename({file:n,renameState:null}))},confirmText:U._("Rename")}):(s.notifyRenameSuccess(_,M,V),e(w.setFileRename({file:n,renameState:null})),l&&G(n,N),g(),e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set([N.fq_path])}))),[3,5];case 4:return B=H.sent(),e(w.setFileRename({file:n,renameState:null})),[3,5];case 5:return[2]}})})}},t.setFolderSizes=function(e){var t=e.folderSizes;return{type:_.ActionTypes.SET_FOLDER_SIZES,payload:{folderSizes:t}}},t.setLoadingState=function(e){var t=e.loadingState,r=e.path;return{type:_.ActionTypes.SET_LOADING_STATE,payload:{loadingState:t,path:r}}},t.setMountPoints=function(e){var t=e.mountPoints;return{type:_.ActionTypes.SET_MOUNT_POINTS,payload:{mountPoints:t}}},t.setNewFolderCreationState=function(e){var t=e.newFolderCreationState;return{type:_.ActionTypes.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:t}}},t.setPaginatedTotalNumFiles=function(e){var t=e.paginatedTotalNumFiles;return{type:_.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:t}}},t.setUrl=function(e){var o=e.path,s=void 0===o?"":o,i=e.qargs;return function(e,o){l.default.push_state(f.urlPrefix(o())+V.URI.encode_parts(s),n.omitBy(r.__assign({},n.pick(g.getQueryArgs(),["d"]),i),n.isUndefined)),e(t.setSelection({selection:O.createSelection()}))}},t.setPath=function(e){var t=e.path;return{type:_.ActionTypes.SET_PATH,payload:{path:t}}},t.setPathData=function(e){var r=e.path,n=e.files,s=e.paginatedTotalNumFiles,l=e.context;return function(e,c){if(i.paths_are_equal(r,f.path(c()))){var d=o.Map(n.map(function(e){return[e.fq_path,e]}));e(t.setContext({context:l})),t.setUnsortedFiles({unsortedFiles:d})(e,c,D.mockExtraArguments),e(t.setPaginatedTotalNumFiles({paginatedTotalNumFiles:s})),e(t.clearSelection()),j({unsortedFiles:d})(e,c,D.mockExtraArguments),setTimeout(function(){a.Dispatcher.dispatch({type:p.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:r,files:n}}),a.Dispatcher.dispatch({type:E.UploaderActionType.SET_PATH,data:{path:r,hasPermissionToUploadToFolder:l.isCurrentPathWriteable()}})},1)}}},t.setSelection=function(e){var t=e.selection;return{type:_.ActionTypes.SET_SELECTION,payload:{selection:t}}},t.clearSelection=function(){return t.setSelection({selection:O.createSelection()})},t.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles;return{type:_.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:t}}};var z=function(e){var t=e.sortOrder;return{type:_.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:t}}};t.setAndStoreSortOrder=function(e){return function(t,r){M.Cookies.delete(p.BROWSE_SORT_COOKIE_NAME);var o=e.sortField+"|"+e.sortDirection;M.Cookies.create(p.BROWSE_SORT_COOKIE_NAME,o,1095),t(z({sortOrder:e}))}},t.setUnsortedFiles=function(e){var t=e.unsortedFiles;return function(e,o){return r.__awaiter(H,void 0,void 0,function(){var n;return r.__generator(this,function(r){switch(r.label){case 0:return n=f.user(o()),e({type:_.ActionTypes.SET_UNSORTED_FILES,payload:{unsortedFiles:t}}),[4,v.initializeStore(n,t.toArray())];case 1:return r.sent(),[2]}})})}},t.requestFolderSizes=function(e){var t=e.fqPath;return{type:_.ActionTypes.REQUEST_FOLDER_SIZES,payload:{fqPath:t}}},t.setFolderSizesPending=function(e){var t=e.fetchFolderSizesResp;return{type:_.ActionTypes.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:t}}},t.completeFolderSizes=function(e){var t=e.fetchFolderSizeState;return{type:_.ActionTypes.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:t}}},t.setFetchFolderSizeState=function(e){var r=e.files,o=e.state;return function(e,n){var s=f.browsePostTTIExperiments(n());if(s&&s.expFolderCalcSize&&"AUTO"===s.expFolderCalcSize){for(var i={sizes_dict:[],queue:[]},a=0,l=r;a<l.length;a++){var c=l[a];c.is_dir&&c.bytes>=0&&!S.File.isNoAccessSharedFolder(c)&&(i.sizes_dict.push({fq_path:c.fq_path,size:c.bytes}),e(t.requestFolderSizes({fqPath:c.fq_path})))}e(t.setFolderSizesPending({fetchFolderSizesResp:i})),e(t.completeFolderSizes({fetchFolderSizeState:o}))}}},t.applyBoltUpdates=function(e){var r=e.updates,o=e.setPath;return function(e,n){var s=r.parent_changes,i=f.user(n());if(s&&s.change_to_fq_path)return h.showUserNotificationForPathChange(i,s),void t.setUrl({path:s.change_to_fq_path})(e,n,D.mockExtraArguments);B(e,n,r,o),q(e,n,r)}};var j=function(e){var r=e.unsortedFiles;return function(e,n){var s=f.filePathsToSelectOnNextUpdate(n()).filter(function(e){return r.has(e)}).toArray();0!==s.length&&(e(t.selectFilesByFqPath({fqPathsToSelect:s})),s.length===f.filePathsToSelectOnNextUpdate(n()).size&&e(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:o.Set()})))}};t.setIsSearchMode=function(e){var t=e.isSearchMode;return{type:_.ActionTypes.SET_IS_SEARCH_MODE,payload:{isSearchMode:t}}},t.appendFiles=function(e){var r=e.path,n=e.files;return function(e,s){if(i.paths_are_equal(r,f.path(s()))){var l=f.unsortedFiles(s()).size,c=f.unsortedFiles(s()).merge(o.Map(n.map(function(e){return[e.fq_path,e]})));t.setUnsortedFiles({unsortedFiles:c})(e,s,D.mockExtraArguments),j({unsortedFiles:c})(e,s,D.mockExtraArguments),setTimeout(function(){a.Dispatcher.dispatch({type:p.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:r,files:n}})},1),c.size!==l+n.length&&k.reportException({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:k.SEVERITY.CRITICAL,exc_extra:{previous_unsorted_files_size:l,incoming_files_size:n.length,updated_unsorted_files_size:c.size,is_deleted_files_on:f.shouldShowDeletedFiles(s())}})}}},t.clearFiles=function(e){var r=e.path,n=e.context;return function(e,s){i.paths_are_equal(r,f.path(s()))&&(t.setUnsortedFiles({unsortedFiles:o.Map()})(e,s,D.mockExtraArguments),e(t.setSelection({selection:O.createSelection()})),e(t.setPaginatedTotalNumFiles({paginatedTotalNumFiles:0})),e(t.setContext({context:n})))}}}),define("modules/clean/react/browse/data/helpers",["require","exports","tslib","external/lodash","modules/clean/filepath","modules/clean/react/browse/data/selectors","modules/clean/react/snackbar","modules/core/i18n"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),s=r.__importStar(s),t.showUserNotificationForPathChange=function(e,t){function r(e){return o.escape(n.filename(e))}switch(null!=t.change_type?t.change_type.toLowerCase():null){case"moved":i.Snackbar.complete(a._("This folder has been moved"),"browse-notification");break;case"renamed":i.Snackbar.complete(a._("This folder has been renamed to “%(folder_name)s”").format({folder_name:r(t.change_to_fq_path)}),"browse-notification");break;case"deleted":i.Snackbar.fail(a._("The folder “%(folder_name)s” has been deleted").format({folder_name:r(t.old_fq_path)}),"browse-notification")}},t.getMountPointUpdateForCurrentPath=function(e,t,r){var n,s,i=function(e){return t===e};return r&&r.find(i)?(s=r.find(i)||null,n=e[r.findKey(i)]||null):(s=null,n=o.find(e,i)||null),[s,n]},t.getPathForNewMountPoint=function(e,t,r){return e&&!t?r:e&&t?n.paths_are_equal(e,t)?null:t:!e&&t?r:null},t.getIndexOfFile=function(e,t){return s.sortedFiles(t).findIndex(function(t){return t.sjid===e.sjid&&t.ns_id===e.ns_id})}}),define("modules/clean/react/browse/data/reducer",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/react/browse/data/types","modules/clean/react/browse/models","modules/clean/react/files_view/types","modules/clean/react/selection","modules/core/exception"],function(e,t,r,o,n,s,i,a,l,c){"use strict";function d(e,t){var o=t.payload,n=o.experiments,s=o.shouldShowDeletedFiles,i=o.user,a=o.viewer;return c.assert(null===e.user,"Cannot reinitialize Browse store; changing invariants such as `user` is untested"),r.__assign({},e,{experiments:n,shouldShowDeletedFiles:s,user:i,viewer:a})}function u(e,t){var o=e.boltIgnore,n=o.added,s=o.moved,i=o.removed;return t.payload.added&&(n=new Set(n),t.payload.added.forEach(function(e){return n.add(e)})),t.payload.moved&&(s=new Set(s),t.payload.moved.forEach(function(e){return s.add(e)})),t.payload.removed&&(i=new Set(i),t.payload.removed.forEach(function(e){return i.add(e)})),r.__assign({},e,{boltIgnore:{added:n,moved:s,removed:i}})}function p(e,t){var o=e.boltIgnore,n=o.added,s=o.moved,i=o.removed;return t.payload.added&&(n=new Set(n),t.payload.added.forEach(function(e){return n.delete(e)})),t.payload.moved&&(s=new Set(s),t.payload.moved.forEach(function(e){return s.delete(e)})),t.payload.removed&&(i=new Set(i),t.payload.removed.forEach(function(e){return i.delete(e)})),r.__assign({},e,{boltIgnore:{added:n,moved:s,removed:i}})}function h(e,t){var n=t.payload.fqPathsToSelect,s=n.map(function(e){return e.toLowerCase()}),i=e.unsortedFiles.toList().filter(function(e){return s.includes(e.fq_path.toLowerCase())}),a=i.map(function(e){return e.fq_path}),l=o.OrderedSet(a),c=a.size?a.get(0):null;return r.__assign({},e,{selection:e.selection.set("selected",l).set("anchor",c)})}function f(e,t){var o=t.payload.canDisplayFolderSizes;return r.__assign({},e,{canDisplayFolderSizes:o})}function _(e,t){var o=t.payload.clipboardFiles;return r.__assign({},e,{clipboardFiles:o})}function m(e,t){var o=t.payload.context;return r.__assign({},e,{context:o})}function S(e,t){var o=t.payload.fileJumpFilter;return r.__assign({},e,{fileJumpFilter:o})}function g(e,t){var o=t.payload.filePathsToSelectOnNextUpdate;return r.__assign({},e,{filePathsToSelectOnNextUpdate:o})}function v(e,t){var o=t.payload.folderSizes;return r.__assign({},e,{folderSizes:o})}function E(e,t){var s=t.payload,i=s.loadingState,l=s.path;return n.paths_are_equal(l,e.path)?i===a.LoadingState.LOADED?r.__assign({},e,{loadingState:i,filePathsToSelectOnNextUpdate:o.Set()}):r.__assign({},e,{loadingState:i}):e}function w(e,t){var n=t.payload.mountPoints;return r.__assign({},e,{mountPoints:o.Map(n)})}function T(e,t){var o=t.payload.newFolderCreationState;return r.__assign({},e,{newFolderCreationState:o})}function F(e,t){var o=t.payload.paginatedTotalNumFiles;return r.__assign({},e,{paginatedTotalNumFiles:o})}function b(e,t){var o=t.payload.path;return r.__assign({},e,{path:o})}function y(e,t){var o=t.payload.selection;return r.__assign({},e,{selection:o})}function C(e,t){var o=t.payload.shouldShowDeletedFiles;return r.__assign({},e,{shouldShowDeletedFiles:o})}function I(e,t){var o=t.payload.sortOrder;return r.__assign({},e,{sortOrder:o})}function R(e,t){var o=t.payload.unsortedFiles;return r.__assign({},e,{unsortedFiles:o})}function O(e,t){var o=t.payload.browsePostTTIExperiments;return r.__assign({},e,{browsePostTTIExperiments:o})}function P(e,t){var o=t.payload.fqPath;if(e.isQueryingFolderSizes)return e;var n=e.folderSizes.withMutations(function(e){e.set(o,{size:0,state:a.FetchFolderSizeState.LOADING})});return r.__assign({},e,{folderSizes:n,isQueryingFolderSizes:!0})}function D(e,t){var o=t.payload.fetchFolderSizesResp,n=e.currentFolderSizesQuery,s=e.folderSizes.withMutations(function(t){for(var r=function(r){t.update(r.fq_path,{size:0,state:a.FetchFolderSizeState.LOADING},function(t){return{size:!e.browsePostTTIExperiments||"CTX"!==e.browsePostTTIExperiments.expFolderCalcSize&&"AUTO"!==e.browsePostTTIExperiments.expFolderCalcSize?t.size+r.size:r.size,state:a.FetchFolderSizeState.LOADING}}),n=n.withMutations(function(e){return e.add(r.fq_path)})},s=0,i=o.sizes_dict;s<i.length;s++){r(i[s])}});return r.__assign({},e,{currentFolderSizesQuery:n,folderSizes:s})}function A(e,t){var n=t.payload.fetchFolderSizeState,s=e.folderSizes.withMutations(function(t){e.currentFolderSizesQuery.forEach(function(r){var o=e.folderSizes.get(r);o&&t.update(r,function(){return{size:o.size,state:n}})})});return r.__assign({},e,{currentFolderSizesQuery:o.Set(),folderSizes:s,isQueryingFolderSizes:!1})}function N(e,t){return r.__assign({},e,{isTimelineVisible:!0,clickTimelineTimestamp:t.payload.timestamp})}function L(e,t){return r.__assign({},e,{isTimelineVisible:!1})}function x(e,t){return r.__assign({},e,{optedInToRewind:!0})}function M(e,t){var o=t.payload.isSearchMode;return r.__assign({},e,{isSearchMode:o})}function k(e,r){switch(void 0===e&&(e=t.defaultBrowseState),r.type){case s.ActionTypes.APP_INIT:return d(e,r);case s.ActionTypes.PUSH_BOLT_IGNORE:return u(e,r);case s.ActionTypes.POP_BOLT_IGNORE:return p(e,r);case s.ActionTypes.SELECT_FILES_BY_FQ_PATH:return h(e,r);case s.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES:return f(e,r);case s.ActionTypes.SET_CLIPBOARD_FILES:return _(e,r);case s.ActionTypes.SET_CONTEXT:return m(e,r);case s.ActionTypes.SET_FILE_JUMP_FILTER:return S(e,r);case s.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return g(e,r);case s.ActionTypes.SET_FOLDER_SIZES:return v(e,r);case s.ActionTypes.SET_LOADING_STATE:return E(e,r);case s.ActionTypes.SET_MOUNT_POINTS:return w(e,r);case s.ActionTypes.SET_NEW_FOLDER_CREATION_STATE:return T(e,r);case s.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES:return F(e,r);case s.ActionTypes.SET_PATH:return b(e,r);case s.ActionTypes.SET_SELECTION:return y(e,r);case s.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES:return C(e,r);case s.ActionTypes.SET_SORT_ORDER:return I(e,r);case s.ActionTypes.SET_UNSORTED_FILES:return R(e,r);case s.ActionTypes.SHOW_TIMELINE:return N(e,r);case s.ActionTypes.HIDE_TIMELINE:return L(e,r);case s.ActionTypes.OPT_IN_TO_REWIND:return x(e,r);case s.ActionTypes.REQUEST_FOLDER_SIZES:return P(e,r);case s.ActionTypes.SET_FOLDER_SIZES_PENDING:return D(e,r);case s.ActionTypes.COMPLETE_FOLDER_SIZES:return A(e,r);case s.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS:return O(e,r);case s.ActionTypes.SET_IS_SEARCH_MODE:return M(e,r)}return e}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),t.defaultBrowseState={boltIgnore:{added:new Set,moved:new Set,removed:new Set},canDisplayFolderSizes:!1,clipboardFiles:[],context:new i.BrowseContext,experiments:{},browsePostTTIExperiments:{},fileJumpFilter:"",filePathsToSelectOnNextUpdate:o.Set(),folderSizes:o.Map(),isTimelineVisible:!1,optedInToRewind:!1,clickTimelineTimestamp:void 0,loadingState:a.LoadingState.LOADING_FIRST_PAGE,mountPoints:null,newFolderCreationState:a.NewFolderCreationState.CREATE_FOLDER_INACTIVE,paginatedTotalNumFiles:0,path:"",selection:l.createSelection(),shouldShowDeletedFiles:!1,sortOrder:{sortField:a.SortField.FILENAME,sortDirection:a.SortDirection.ASCENDING},user:null,unsortedFiles:o.Map(),viewer:null,currentFolderSizesQuery:o.Set(),isQueryingFolderSizes:!1,isSearchMode:!1},t.browseReducer=k}),define("modules/clean/react/browse/data/selectors",["require","exports","tslib","external/immutable","external/reselect","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/data/reducer","modules/clean/react/browse/uri_helper","modules/clean/react/browse/util","modules/clean/react/files_view/types","modules/clean/redux/selectors","modules/clean/redux/namespaces","modules/core/browser_detection","modules/core/exception","modules/clean/react/files_view/data/selectors","modules/clean/react/folder_overview/data/selectors"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),h=r.__importStar(h),m=r.__importStar(m);var S=function(e){return u.getStateAtNamespace(e,p.BROWSE_NAMESPACE_KEY)||a.defaultBrowseState};t.canDisplayFolderSizes=function(e){return S(e).canDisplayFolderSizes},t.clipboardFiles=function(e){return S(e).clipboardFiles},t.context=function(e){return S(e).context},t.experiments=function(e){return S(e).experiments},t.postTTIExperiments=function(e){return S(e).browsePostTTIExperiments},t.fileJumpFilter=function(e){return S(e).fileJumpFilter},t.filePathsToSelectOnNextUpdate=function(e){return S(e).filePathsToSelectOnNextUpdate},t.folderSizes=function(e){return S(e).folderSizes},t.isFileJumping=function(e){return S(e).fileJumpFilter.length>0},t.isQueryingFolderSizes=function(e){return S(e).isQueryingFolderSizes};var g=function(e){return S(e).loadingState};t.mountPoints=function(e){return S(e).mountPoints},
t.newFolderCreationState=function(e){return S(e).newFolderCreationState},t.paginatedTotalNumFiles=function(e){return t.loadingState(e)===d.LoadingState.LOADED?t.sortedFiles(e).count():S(e).paginatedTotalNumFiles},t.path=function(e){return S(e).path},t.selection=function(e){return S(e).selection},t.shouldShowDeletedFiles=function(e){return S(e).shouldShowDeletedFiles},t.sortOrder=function(e){return S(e).sortOrder},t.unsortedFiles=function(e){return S(e).unsortedFiles},t.boltIgnore=function(e){return S(e).boltIgnore},t.user=function(e){var t=S(e).user;return f.assert(null!=t,"Browse store `user` accessed before APP_INIT action"),t},t.viewer=function(e){var t=S(e).viewer;return f.assert(null!=t,"Browse store `viewer` accessed before APP_INIT action"),t},t.isTimelineVisible=function(e){return S(e).isTimelineVisible},t.clickTimelineTimestamp=function(e){return S(e).clickTimelineTimestamp},t.optedInToRewind=function(e){return S(e).optedInToRewind},t.browsePostTTIExperiments=function(e){return S(e).browsePostTTIExperiments||{}},t.fileJumpIndex=n.createSelector(t.unsortedFiles,function(e){return e.keySeq().toArray().map(function(e){return{filename:s.filename(e).toLowerCase(),fqPath:e}}).sort(function(e,t){return e.filename<t.filename?-1:e.filename>t.filename?1:0})}),t.sortedFiles=n.createSelector(t.unsortedFiles,t.sortOrder,t.folderSizes,function(e,t,r){return c.sortFiles(e.toList(),t,r,h.mac)}),t.selectedFiles=n.createSelector(t.unsortedFiles,t.selection,function(e,t){return t.selected.isEmpty()||e.isEmpty()?o.OrderedMap():o.OrderedMap(t.selected.map(function(t){var r=e.find(function(e){return e.fq_path===t});return r?[r.fq_path,r]:void 0}))}),t.urlPrefix=n.createSelector(t.user,t.viewer,function(e,t){return l.browse_root(t,e)}),t.teamFolders=n.createSelector(t.unsortedFiles,t.folderSizes,function(e,t){var r={sortField:d.SortField.FILENAME,sortDirection:d.SortDirection.ASCENDING};return c.sortFiles(e.toList().filter(function(e){return e.type===i.FileTypes.TEAM_SHARED_FOLDER}),r,t,h.mac)}),t.sortedFilesWithFolderSizes=n.createSelector(t.sortedFiles,t.folderSizes,function(e,t){return e.map(function(e){var r=t.get(e.fq_path);return r?e.updateSize(r.size,r.state):e})}),t.unsortedFilesWithFolderSizes=n.createSelector(t.unsortedFiles,t.folderSizes,function(e,t){return e.withMutations(function(r){t.forEach(function(t,o){var n=e.get(o);if(n&&t){var s=n.updateSize(t.size,t.state);r.set(o,s)}})})}),t.sortedFilesWithFoldersSizesWithoutTeamFolders=n.createSelector(t.sortedFilesWithFolderSizes,function(e){return e.filter(function(e){return e.type!==i.FileTypes.TEAM_SHARED_FOLDER})}),t.shouldShowFolderOverview=n.createSelector(t.experiments,function(e){return"V1"===e.expFolderOverview||"V2"===e.expFolderOverview||"V2"===e.expFolderOverviewGeminiRollout}),t.loadingState=n.createSelector(g,t.shouldShowFolderOverview,m.haveAllComponentsLoaded,m.hasFailedToLoad,t.experiments,function(e,t,r,o,n){return!t||o?e:r||"V1"!==n.expFolderOverview&&"V2"!==n.expFolderOverview?e:d.LoadingState.LOADING_FIRST_PAGE}),t.shouldShowPinnedTeamFolders=n.createSelector(t.context,t.loadingState,t.path,t.teamFolders,_.viewType,function(e,t,r,o,n){return e.showPinnedTeamFolder&&!o.isEmpty()&&s.paths_are_equal(r,"/")&&n===d.ViewType.List&&(t===d.LoadingState.LOADED||t===d.LoadingState.LOADING_REMAINING_PAGES)}),t.isSearchMode=function(e){return S(e).isSearchMode},t.shouldShowSharedFolderInvites=n.createSelector(t.browsePostTTIExperiments,t.path,function(e,t){return!!e.expShowSharedFolderInvites&&s.paths_are_equal(t,"/")})}),define("modules/clean/react/browse/data/store",["require","exports","modules/clean/redux/namespaces","modules/clean/react/browse/data/reducer","modules/clean/redux/store"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s;t.getStoreForBrowse=function(){var e;return s||(s=n.getStoreAndRegisterReducers((e={},e[r.BROWSE_NAMESPACE_KEY]=o.browseReducer,e))),s}}),define("modules/clean/react/browse/global_actions",["require","exports","tslib","external/lodash","react","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/new_file_menu","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/async_onboarding_move_modal","modules/clean/react/browse/actions","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/browse/nav_actions","modules/clean/react/modal","modules/clean/sharing/access_level","modules/clean/sharing/browse_exports","modules/clean/react/growth/async_joiner_personal_account_modal","modules/clean/sharing/constants","modules/clean/viewer","modules/core/browser_detection","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/user_education/user_education_client","modules/clean/history","modules/clean/react/browse/constants","modules/clean/react/delorean/data/types","modules/clean/react/browse/uri_helper"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C,I,R,O){"use strict";function P(e){var t=e.context,r=e.user,l=e.viewType,c=e.showDeletedFiles,u=e.onUpload,p=void 0===u?o.noop:u,h=e.isNoComment,f=void 0!==h&&h,m=e.autoTeamGroupId,v=e.browsePostTTIExperiments,T=e.optedInToRewind,b=e.expFolderHistoryRollbacks,C=t.isCurrentlyInRoot,I=!t.canViewContainingNSMembers,P=t.isCurrentPathWriteable(),A=w.is_input_webkitdirectory_supported(),N={action:{className:"action-upload",label:L(D.UploadFiles),popoverLabel:L(D.Files),iconName:A?"upload-file":"upload",performAction:function(){return p(!1)},disabled:!P},isPrimary:!1},H=A?{action:{className:"action-upload",label:L(D.UploadFolder),popoverLabel:L(D.Folder),iconName:"upload-folder",performAction:function(){return p(!0)},disabled:!P},isPrimary:!1}:void 0,W=!t.isInsideSandboxFolder,G=v.expTimeline,z=v.expRewindUpsell,j=v.expEnableCloudDocsPaperCreate,Q=v.expEnableCloudDocsGddCreate,Y=v.expEnableCloudDocsSimplePointerCreate,K={action:function(){return n.default.createElement(a.NewFileMenu,{key:"new-file-menu",user:r,source:i.NewFileMenuFromType.BROWSE,path:t.currentFQPath,disabled:!P,showGdd:!!Q,showPaper:!!j,showSimplePointer:!!Y,primaryButton:!0})},isPrimary:!0},J=[];if(t.isInsideTeamFolderTree||!t.isInsideDeletedSharedFolder&&!t.isInsideDeletedNestedSharedFolder)if(t.isInsideDeletedFolder)J.push({action:{label:L(D.RestoreFolder),iconName:"restore",className:"action-restore",performAction:V(r,l,t),disabled:!P},isPrimary:!0});else{var X={label:L(D.NewFolder),iconName:"new-folder",performAction:x(r,l,t,m,v.expNewFolderModal),disabled:!P,className:"action-new-folder"},Z={action:X,isPrimary:!1},$={label:L(C?D.NewSharedFolder:D.ShareFolder),iconName:"new-shared-folder",performAction:k(r,t),disabled:I,className:"action-share-folder"},ee={action:$,isPrimary:!0},te={action:$,isPrimary:!1},re={action:{label:L(D.NewTeamFolder),iconName:"new-team-folder",performAction:q(r,t),disabled:!1,className:"action-team-folder"},isPrimary:!1};if(r.is_cdm_member&&"/"===t.currentFQPath){y.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_setup_team_space",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_free_order",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_free_order_v2",stepName:"team_folder_modal"}],X.performAction);var oe=function(e){s.TeamsWebActionsLogger.log(e),window.setTimeout(function(){y.UEClient.sendEvent("SetStructureModal","Close")},2500),_.Modal.close()},ne=function(){return{user:r,teamName:E.Viewer.get_viewer().team_name,onSuccess:function(){return oe("uj_ss_modal_success")},onError:function(){return oe("uj_ss_modal_error")},onCancel:function(){return oe("uj_ss_modal_cancel")}}};y.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_shared_workspace",stepName:"set_structure_modal"},{moduleName:"trial_admin_shared_workspace_v2",stepName:"set_structure_modal"},{moduleName:"trial_admin_shared_workspace_free_order",stepName:"set_structure_modal"},{moduleName:"trial_admin_shared_workspace_free_order_v2",stepName:"set_structure_modal"}],function(){d.showOnboardingMoveDialog(ne())}),y.UEClient.registerCallbackForEducationStep("joiner_checklist_shared_workspace_files_decision","set_structure_modal",function(){d.showOnboardingMoveDialogV2(ne())}),y.UEClient.registerCallbackForEducationStep("joiner_checklist_inform_personal_account","team_space_tooltip",function(){g.asyncWarmJoinerModalProps(r)}),y.UEClient.registerCallbackForEducationStep("joiner_checklist_inform_personal_account","joiner_personal_account_success_modal",function(){g.asyncShowJoinerPersonalAccountModal(r)}),J.push(K),J.push(N),A&&J.push(H),J.push(Z)}else C?(J.push(K),J.push(N),A&&J.push(H),!r.is_cdm_member&&S.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&J.push(re),J.push(te,Z)):(J.push(K),W&&J.push(ee),J.push(N),A&&J.push(H),J.push(Z));if(f||J.push({action:{label:L(c?D.HideDeletedFiles:D.ShowDeletedFiles),iconName:c?"hide":"show-deleted-files",performAction:U(r,l,c),disabled:I,className:"action-deleted-files",key:"toggle-deleted",ariaLabel:L(D.ShowDeletedFiles),ariaPressed:c},isPrimary:!1}),!E.Viewer.get_viewer().is_assume_user_session&&(S.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&S.GoldenGate.hasNewOwnershipModel(r.id)&&t.isInsideTeamFolderTree||!r.is_cdm_member&&S.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&t.isCurrentlyInRoot)&&J.push({action:{label:L(D.ManageAsAdmin),iconName:"settings-gear",performAction:q(r,t)},isPrimary:!1}),b||T||z!==R.UpsellVariant.OFF&&z!==R.UpsellVariant.CONTROL&&void 0!==z){var se=void 0,ie=T||"true"===O.getQueryArgs().rewind_tip;ie&&(se={title:F._("Get your files back",{project:"folder-history"}),content:F._("Return everything in this folder to an earlier time",{project:"folder-history"})}),J.push({action:{label:L(t.isCurrentlyInRoot?D.RewindDropbox:D.RewindFolder),iconName:"revert-folder",performAction:M(r,t),tip:se},isPrimary:!1})}else G&&J.push({action:{label:L(D.FolderHistory),iconName:"view-folder-history",performAction:M(r,t)},isPrimary:!1})}else J.push({action:{label:L(D.ReAddSharedFolder),iconName:"restore",performAction:B(r,t),disabled:!P},isPrimary:!0});return J}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),l=r.__importStar(l),p=r.__importStar(p),w=r.__importStar(w),C=r.__importDefault(C);var D;(function(e){e[e.UploadFiles=1]="UploadFiles",e[e.UploadFolder=2]="UploadFolder",e[e.Upload=3]="Upload",e[e.Files=4]="Files",e[e.Folder=5]="Folder",e[e.NewPaperDoc=6]="NewPaperDoc",e[e.NewFolder=7]="NewFolder",e[e.RestoreFolder=8]="RestoreFolder",e[e.ReAddSharedFolder=9]="ReAddSharedFolder",e[e.ShowDeletedFiles=10]="ShowDeletedFiles",e[e.HideDeletedFiles=11]="HideDeletedFiles",e[e.NewSharedFolder=12]="NewSharedFolder",e[e.ShareFolder=13]="ShareFolder",e[e.ManageAsAdmin=14]="ManageAsAdmin",e[e.NewTeamFolder=15]="NewTeamFolder",e[e.FolderHistory=16]="FolderHistory",e[e.RewindFolder=17]="RewindFolder",e[e.RewindDropbox=18]="RewindDropbox"})(D||(D={}));var A={},N=function(e){switch(e){case D.UploadFiles:return F._("Upload files");case D.UploadFolder:return F._("Upload folder");case D.Upload:return F._("Upload");case D.FolderHistory:return F._("Folder history");case D.RewindFolder:return F._("Rewind this folder",{project:"folder-history"});case D.RewindDropbox:return F._("Rewind Dropbox",{project:"folder-history"});case D.Files:return F._("Files");case D.Folder:return F._("Folder");case D.NewPaperDoc:return F._("New Paper Document");case D.NewFolder:return F._("New folder");case D.RestoreFolder:return F._("Restore folder");case D.ReAddSharedFolder:return F._("Re-add shared folder");case D.ShowDeletedFiles:return F._("Show deleted files");case D.HideDeletedFiles:return F._("Hide deleted files");case D.NewSharedFolder:return F._("New shared folder");case D.ShareFolder:return F._("Share folder");case D.ManageAsAdmin:return F._("View in admin console");case D.NewTeamFolder:return F._("New team folder")}},L=function(e){return e in A||(A[e]=N(e)),A[e]},x=function(e,t,r,o,n){return function(){var s=r.currentNSID,i=r.currentFQPath;if(c.logCreateFolder({uid:e.id,view_type:t,file_nsid:s,file_path:i,file_name:l.filename(i)}),e.is_cdm_member&&"/"===i){T.assert(!!o,"All CDM Users should have an auto team group in their team");var a=function(e){b.Notify.error(e?e:F._("There was a problem completing this request.")),u.browseActions.cancelCreateFolder()},d=function(e){var t=e.user,r=e.folderName,o=e.fqPath;u.browseActions.createFolderComplete({user:t,folderName:r,changesets:null}),u.browseActions.selectFilesByFqPath({fqPathsToSelect:[o]}),n&&u.browseActions.handleNewFolderRedirectOnSuccess(o)};S.asyncShowAppropriateNewFolderModalForCdmUser({user:e,context:r,autoTeamGroupId:o,showFileSystemWarningsModal:void 0,onPending:u.browseActions.createFolderPending,onComplete:d,onCancel:a,autoTeamGroupDefaultAccessLevel:m.ACCESS_LEVEL.WRITER,setPath:f.browseNavActions.setPath,setUrl:f.browseNavActions.setUrl})}else if(n){var p=function(t){var o=t.folderName,n=t.isConfidential;u.browseActions.createFolderInNewFolderModal({folderName:o,isConfidential:n,user:e,context:r,redirectOnSuccess:u.browseActions.handleNewFolderRedirectOnSuccess})};S.asyncShowCdmNewFolderModal(p,e,r,!1,!1,!0)}else u.browseActions.nameNewFolder()}},M=function(e,t){return function(){C.default.update_query_param(I.BrowseQueryArg.rewind,"true"),h.getStoreForBrowse().dispatch(p.showTimeline())}},k=function(e,t){return function(){t.isCurrentlyInRoot?S.asyncShowShareAFolderWizardModal(e):S.asyncShowShareModal(e,t,{origin:v.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS},f.browseNavActions.setPath,f.browseNavActions.setUrl)}},U=function(e,t,r){return function(){c.logToggleDeletedFiles({uid:e.id,show_deleted_files:!r,view_type:t}),u.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!r})}},V=function(e,t,r){return function(){var o=r.currentNSID,n=r.currentFQPath;c.logRestore({uid:e.id,view_type:t,file_nsid:o,file_path:n,file_name:l.filename(n),num_files_selected:0,num_folders_selected:1}),u.browseActions.doRestoreFilesWithUnifiedTrashModal({})}},B=function(e,t){return function(){var r=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[r],n=t.isInsideDeletedNestedSharedFolder;o&&S.asyncMountSharedFolder(o,e.role,v.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,!1,null,n)}},q=function(e,t){return function(){S.asyncGoToContentManagerForPath({isLimitedTeam:E.Viewer.get_viewer().team_is_limited,containingFolder:t.currentFQPath,isCDM:e.is_cdm_member})}};t.getGlobalActions=P}),define("modules/clean/react/browse/nav_actions",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/file_uploader/constants","modules/clean/react/files_view/types"],function(e,t,r,o,n,s,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s);var c=(function(){function e(){this.setPath=function(e){var t=e.path;i.getStoreForBrowse().dispatch(s.setUrl({path:t}))}}return e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;i.getStoreForBrowse().dispatch(s.setUrl({path:t,qargs:r}))},e.prototype.loadPath=function(e){var t=e.path,r=e.files,c=e.paginatedTotalNumFiles,d=e.context;i.getStoreForBrowse().dispatch(s.setPathData({path:t,files:r,paginatedTotalNumFiles:c,context:d})),i.getStoreForBrowse().dispatch(s.setFetchFolderSizeState({files:r,state:l.FetchFolderSizeState.COMPLETE})),i.getStoreForBrowse().dispatch(s.setLoadingState({loadingState:l.LoadingState.LOADED,path:t})),o.Dispatcher.dispatch({type:a.UploaderActionType.SET_PATH,data:{path:t,hasPermissionToUploadToFolder:d.isCurrentPathWriteable()}}),o.Dispatcher.dispatch({type:n.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:t,files:r}})},e})();t.BrowseNavActions=c,t.browseNavActions=new c}),define("modules/clean/react/browse/professional_collection_actions",["require","exports","tslib","external/lodash","modules/core/exception"],function(e,t,r,o,n){"use strict";function s(t,s,i){var a=o.keyBy(i,"file_id");if(!o.every(t,function(e){return!!a[e]}))return void n.reportException({err:new Error("Could not find specified files to add to Showcase")});var l=t.map(function(e){var t=a[e];return{ns_id:t.ns_id,ns_path:t.ns_path,fq_path:t.fq_path}});new Promise(function(t,r){e(["modules/clean/react/professional_collection/add_to_collection_modal_controller"],t,r)}).then(r.__importStar).then(function(e){(0,e.showAddToCollectionModal)(l,s)})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.showPrepopulatedAddToCollectionModal=s});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/browse/selection_preview_pane",["require","exports","modules/clean/react/async/loadable"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionPreviewPane=r.Loadable({loader:function(){return new Promise(function(t,r){e(["modules/clean/react/browse/selection_preview_component"],t,r)}).then(__importStar).then(function(e){return e.MemoizedSelectionPreviewComponent})}})}),define("modules/clean/react/browse/sidebar",["require","exports","tslib","react","modules/clean/search/search_results/sidebar_view","modules/clean/react/browse/sidebar_view"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),t.BrowseSidebar=function(e){var t=e.autoTeamGroupId,i=e.arePostTTIModulesLoaded,a=e.canDisplayFolderSizes,l=e.context,c=e.handleComponentTTI,d=e.isNoComment,u=e.isSearchMode,p=e.isTimelineVisible,h=e.optedInToRewind,f=e.selectedFiles,_=e.shouldShowDeletedFiles,m=e.starredState,S=e.user,g=e.viewType,v=e.uploaderExperiments,E=e.uploaderPostTTIExperiments,w=e.browseExperiments,T=e.browsePostTTIExperiments,F=e.uploadAjaxInterceptor,b=e.searchBarExperiments,y=e.actionHandlers,C=e.path,I=e.onSearch,R=e.onUploadButtonClick,O=e.onGetFileActionsForFiles,P=e.responsive,D=e.onSearchFiltersChanged,A=e.fileCategories,N=e.isNautilusEnabled,L=e.isPaperEnabled,x=e.fileExtensionsConfigs,M=e.pinnedItems,k=e.searchType,U={user:S,selectedFiles:f,arePostTTIModulesLoaded:i,context:l,viewType:g,shouldShowDeletedFiles:_,responsive:P};return u?o.default.createElement(n.SearchResultsSidebarView,r.__assign({},U,{path:C,actionHandlers:y,searchBarExperiments:b,onSearch:I,onSearchFiltersChanged:D,fileCategories:A,isNautilusEnabled:N,isPaperEnabled:L,fileExtensionsConfigs:x,searchType:k,renderFilters:!0})):o.default.createElement(s.BrowseSidebarView,r.__assign({},U,{autoTeamGroupId:t,browseExperiments:w,browsePostTTIExperiments:T,canDisplayFolderSizes:a,handleComponentTTI:c,isNoComment:d,optedInToRewind:h,isTimelineVisible:p,onGetFileActionsForFiles:O,onUploadButtonClick:R,pinnedItems:M,starredState:m,uploadAjaxInterceptor:F,uploaderExperiments:v,uploaderPostTTIExperiments:E}))}}),define("modules/clean/react/browse/sidebar_view",["require","exports","tslib","react","modules/clean/react/app_actions_view","modules/clean/react/browse/global_actions","modules/clean/react/browse/selection_preview_pane","modules/clean/react/browse/util","modules/clean/react/file_uploader/file_uploader","modules/clean/search/types","modules/clean/web_timing_logger","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var p=(function(t){function p(e){var r=t.call(this,e)||this;return r.renderSingleSelectionAudienceBox=function(e){var t=e.selectedFiles,n=e.context,s=e.user,i=r.state&&r.state.sharedWithModule;if(!i)return null;var a=t.first(),l=i.SharedWithController;return o.default.createElement(l,{file:a,browseContext:n,user:s,isInAudienceBox:!0})},r.state={appActionsProps:r.getCurrentAppActionsProps(r.props)},r}return r.__extends(p,t),p.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,d.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/browse/shared_with"],t,r)}).then(r.__importStar)];case 2:return t=o.sent(),this.setState({sharedWithModule:t,appActionsProps:this.getCurrentAppActionsProps(this.props)}),[2]}})})},p.prototype.componentWillReceiveProps=function(e){e.selectedFiles===this.props.selectedFiles&&e.context===this.props.context&&e.user===this.props.user&&e.shouldShowDeletedFiles===this.props.shouldShowDeletedFiles&&e.isNoComment===this.props.isNoComment&&e.arePostTTIModulesLoaded===this.props.arePostTTIModulesLoaded&&e.viewType===this.props.viewType&&e.starredState===this.props.starredState&&e.canDisplayFolderSizes===this.props.canDisplayFolderSizes&&e.uploadAjaxInterceptor===this.props.uploadAjaxInterceptor&&e.responsive.isMatchedMedium===this.props.responsive.isMatchedMedium&&e.responsive.isMatchedLarge===this.props.responsive.isMatchedLarge&&e.uploaderExperiments===this.props.uploaderExperiments&&e.uploaderPostTTIExperiments===this.props.uploaderPostTTIExperiments&&e.browseExperiments===this.props.browseExperiments&&e.browsePostTTIExperiments===this.props.browsePostTTIExperiments&&e.optedInToRewind===this.props.optedInToRewind&&e.pinnedItems===this.props.pinnedItems||this.setState({appActionsProps:this.getCurrentAppActionsProps(e)})},p.prototype.getCurrentAppActionsProps=function(e){function t(e){return"function"==typeof e?e:{displayName:e.label,popoverMenuName:e.popoverLabel,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className,badge:e.badge,displayTip:e.tip,ariaLabel:e.ariaLabel,ariaPressed:e.ariaPressed,key:e.key}}function r(e){if("function"==typeof e)return e;var r=void 0;return e.subItems&&(r=e.subItems.map(t)),{displayName:e.label,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className,subItems:r,ariaLabel:e.ariaLabel,ariaPressed:e.ariaPressed,key:e.key}}var n,i=e.selectedFiles,l=e.autoTeamGroupId,c=e.context,d=e.canDisplayFolderSizes,p=e.onGetFileActionsForFiles,h=e.user,f=e.viewType,_=e.shouldShowDeletedFiles,m=e.onUploadButtonClick,S=e.isNoComment,g=e.browsePostTTIExperiments,v=e.handleComponentTTI,E=e.responsive,w=a.getSelectedFilesText(i,c),T=i.count(),F=o.default.createElement("div",null);if(T>0){n=p(i,d,E,!0,!0,g.expRewindUpsell).map(function(e,t){return{action:e,isPrimary:0===t}}),1===T&&(F=this.renderSingleSelectionAudienceBox(e))}else{n=s.getGlobalActions({context:c,user:h,viewType:f,showDeletedFiles:_,onUpload:m,isNoComment:S,autoTeamGroupId:l,browsePostTTIExperiments:g,optedInToRewind:this.props.optedInToRewind,expFolderHistoryRollbacks:this.props.browseExperiments.expFolderHistoryRollbacks||!1});var b=this.state&&this.state.sharedWithModule;if(b){var y=b.SharedWithController;F=o.default.createElement(y,{browseContext:c,user:h,isInAudienceBox:!0})}}for(var C=[],I=[],R=0,O=n;R<O.length;R++){var P=O[R];P.isPrimary?C.push(r(P.action)):I.push(t(P.action))}return e.isNoComment&&(F=o.default.createElement("div",null)),{headerText:w,popoverTriggerLabel:u._("Actions"),primaryMenuItems:C,primarySubnode:F,secondaryMenuItems:I,handleComponentTTI:v}},p.prototype.maybeRenderBrowseFileUploader=function(){var e=this.props,t=e.context,r=e.viewType,n=e.uploadAjaxInterceptor,s=e.uploaderExperiments,i=e.uploaderPostTTIExperiments;return null!=t.currentFQPath?o.default.createElement(l.FileUploaderController,{key:"file-uploader-controller",ref:"fileUploader",loadOnRender:this.props.arePostTTIModulesLoaded,needToSetStoreValues:!1,ajaxInterceptor:n,uploaderExperiments:s,uploaderPostTTIExperiments:i,browseViewType:r}):null},p.prototype.render=function(){var e=this.props.browsePostTTIExperiments.expBrowseDetailsPaneVariants,t=e===c.DetailsPaneVariants.PREVIEW_ONLY,s=t?o.default.createElement(i.SelectionPreviewPane,{selectedFiles:this.props.selectedFiles,responsive:this.props.responsive}):null;return o.default.createElement(o.default.Fragment,null,this.maybeRenderBrowseFileUploader(),s,o.default.createElement(n.AppActionsView,r.__assign({user:this.props.user},this.state.appActionsProps,{responsive:this.props.responsive,hideHeaderText:!!t})))},p})(o.default.PureComponent);t.BrowseSidebarView=p}),define("modules/clean/react/browse/title",["require","exports","tslib","react","modules/core/i18n","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/react/file_uploader/file_uploader","modules/clean/viewer","modules/clean/react/maestro/header","modules/clean/react/path_breadcrumbs"],function(e,t,r,o,n,s,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),i=r.__importStar(i);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleGetUrlForPath=function(e){return s.browse_uri_for_fq_path(t.props.user,e).toString()},t}return r.__extends(t,e),t.setPageTitle=function(e,t){e&&(document.title=t?n._("Search results - Dropbox"):n._("%(folder_name)s - Dropbox").format({folder_name:i.filename(e,n._("Files"))}))},t.prototype.componentDidMount=function(){t.setPageTitle(this.props.path,this.props.isSearchMode)},t.prototype.componentWillReceiveProps=function(e){e.path===this.props.path&&e.isSearchMode===this.props.isSearchMode||t.setPageTitle(e.path,e.isSearchMode)},t.prototype.render=function(){var e=this.props,t=e.path,r=e.user,s=e.isDraggingInternalFiles,u=e.isDraggingExternalFiles,p=e.isUploadModalOpen,h=e.isSearchMode,f=e.onSetUrl;if(h)return o.default.createElement(c.MaestroHeaderTitle,null,n._("Search results"));var _=i.filename("",l.Viewer.get_root_name(r)),m="work"===r.role?n._("Work"):n._("Personal");return o.default.createElement(d.PathBreadcrumbs,{path:t,isDraggingInternalFiles:s,setFileUploaderPath:a.FileUploaderController.setPathAndPermissions,getUrlForPath:this.handleGetUrlForPath,firstBreadcrumbName:_,firstBreadcrumbAlt:m,shouldHighlightDropTargets:s||u&&!p,disableDragging:u,setUrl:f})},t})(o.default.PureComponent);t.BrowseTitle=u}),define("modules/clean/react/browse/web_team_sharing_experiment",["require","exports","tslib","react","modules/clean/react/file_uploader/constants","modules/clean/react/async_fileops_modals","modules/clean/analytics","external/immutable","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,r,o,n,s,i,a,l,c){"use strict";var d=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),s=r.__importStar(s),a=r.__importStar(a);var u=l.Loadable({loader:function(){return r.__awaiter(d,void 0,Promise,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,c.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/web_team_sharing_modal"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().WebTeamSharingModal,[2,t]}})})}}),p=(function(t){function l(e){var r=t.call(this,e)||this;return r.removeUploadListener=function(){window.removeEventListener(n.ALL_UPLOADS_COMPLETE_EVENT,r.handleUploadsComplete)},r.closeTeamSharingModal=function(){return r.setState({isWebTeamSharingModalOpen:!1})},r.openFileMoveDialog=function(){r.closeTeamSharingModal(),i.TeamsWebActionsLogger.log("post_m1_sharing_modal_clicked"),s.showMove({files:r.props.selectedFiles.toArray(),path:r.props.context.currentFQPath,user:r.props.user})},r.state={isWebTeamSharingModalOpen:!1,uploadedFiles:[],expWebSharingActive:!1},r}return r.__extends(l,t),l.prototype.componentWillReceiveProps=function(t){return r.__awaiter(this,void 0,void 0,function(){var o,s,i,a=this;return r.__generator(this,function(l){switch(l.label){case 0:return!t.browsePostTTIExperiments.expBizAddFilesTeamFolderRwls||this.handleUploadsComplete?[3,2]:[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/web_sharing_helper"],t,r)}).then(r.__importStar)];case 1:o=l.sent(),s=o.logExposure,i=o.shouldShowModal,this.handleUploadsComplete=function(e){if(i(a.props.user,a.props.path)){s();var t=e.detail.files;a.setState({isWebTeamSharingModalOpen:!0,uploadedFiles:t,expWebSharingActive:!0})}},window.addEventListener(n.ALL_UPLOADS_COMPLETE_EVENT,this.handleUploadsComplete),l.label=2;case 2:return[2]}})})},l.prototype.componentWillUnmount=function(){this.handleUploadsComplete&&this.removeUploadListener()},l.prototype.render=function(){return this.state.expWebSharingActive?o.default.createElement(u,{context:this.props.context,files:this.state.uploadedFiles,handleModalClose:this.closeTeamSharingModal,handleAction:this.openFileMoveDialog,open:this.state.isWebTeamSharingModalOpen,user:this.props.user}):null},l.defaultProps={selectedFiles:a.OrderedMap()},l})(o.default.PureComponent);t.WebTeamSharingModalExperiment=p}),define("modules/clean/react/comments2/components/comments_translations",["require","exports","modules/core/i18n","modules/clean/datetime"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commentsMasterLocalization={searchingMsg:r._("Searching contacts…"),noUsersFoundMsg:r._("No Users Found"),inviteMsg:function(e){return r._("Invite %(user_name)s?").format({user_name:e})},mentionMsg:r._("@mention someone to share this file",{comment:'\n    This is a prompt indicating to users that if they type the @ character,\n    this will bring up a UI allowing them to select from their contacts or\n    type an email address. That\'s what the "@" sign in front of the word "mention" means.\n    Translate this as best you can\n  '}),mentionButtonLabel:r._("@mention someone",{comment:'\n    This is a label on a button that will insert an @ symbol into a comment,\n    this will bring up a UI allowing them to select from their contacts or\n    type an email address. That\'s what the "@" sign in front of the word "mention" means.\n    Translate this as best you can\n  '}),editPostLabel:r._("Save"),editCancelLabel:r._("Cancel"),commentDeletedMsg:r._("This comment was deleted."),commentEditLabel:r._("Edit"),commentDeleteLabel:r._("Delete"),leaveACommentLabel:r._("Leave a comment"),markAsReadLabel:r._("Mark as read"),markAsUnreadLabel:r._("Mark as unread"),markedAsResolvedLabel:r._("Marked as resolved"),markedAsResolvedByUserLabel:function(e){return r._("Marked as resolved by %(name)s").format({name:e})},olderVersionLabel:r._("On older version"),threadRestoreLabel:r._("Restore"),threadResolveLabel:r._("Resolve"),threadPostLabel:r._("Post"),threadCancelLabel:r._("Cancel"),threadEditorPlaceholder:r._("Reply"),threadCollapsedCommentsText:function(e){return r.ungettext("1 comment","%(count)d comments",e).format({count:e})},stickerAltText:function(e){return r._("Sticker: %(sticker_name)s",{comment:'Sticker in a comment. Example: "Sticker: Wizard jumping with joy"'}).format({sticker_name:e})},streamEditorPlaceholder:r._("Write a comment"),streamPostLabel:r._("Post"),streamCancelLabel:r._("Cancel"),replyHintLabel:r._("Reply…"),viewHistoryLabel:r._("View version history"),pageLabel:function(e){return r._("Page %(page)d").format({page:e})},unreadComments:function(e){return r._("%(count)s unread").format({count:e})},ago:function(e){return o.ago(e,!0,!0)},getActingTime:function(e){return o.getActingTime(e.getTime(),!1,!1,30,!1,!0,!0)},niceDateWithMonthName:function(e,t){return o.nice_date_with_month_name(e,t,!1)},clickAndDragToComment:r._("Select an area to comment on"),a11yCommentThreadLabel:r._("Comment thread"),a11yUnreadCommentThreadLabel:r._("Unread comment thread")}}),
define("modules/clean/react/file_uploader/action_logger",["require","exports","tslib","modules/clean/filepath","modules/clean/react/file_uploader/constants","modules/clean/web_upload_action_logger","modules/clean/web_user_action_logger","modules/clean/web_upload_action_events","modules/clean/web_user_action_events","modules/core/browser"],function(e,t,r,o,n,s,i,a,l,c){"use strict";function d(e){return e&&!!e.uploadId}function u(e){return e&&!!e.batchId}function p(e){return e===l.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===l.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===l.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===l.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===l.WebUserActionLogEvent.DISMISS_INLINE_STATUS||e===l.WebUserActionLogEvent.UPLOAD_CLICK||e===l.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===l.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===l.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK}function h(e,t,l,h,f,_,m,S){var g={num_files:_,num_dirs:m,chooser_type:h,upload_method:f};if(d(l)){var v=l,E=t===a.WebUploadActionEvent.UPLOAD_FAILURE&&v.errorType===n.UploadErrorType.GENERIC&&S?S:v.errorType;g=r.__assign({},g,{upload_id:v.uploadId,file_size:v.size,file_extension:o.file_extension(v.name),failure_reason:E,batch_id:v.batchId,upload_destination:v.dest,current_path:c.get_pathname(),file_name:v.name})}else if(u(l)){var v=l;g=r.__assign({},g,{file_size:v.size,file_extension:o.file_extension(v.name),batch_id:v.batchId})}p(t)?i.WebUserActionLog.log(e,t,g):(t=t,g.client_timestamp=Math.round(Date.now()/1e3),s.WebUploadActionLog.log(e,t,g))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),c=r.__importStar(c),t.logUploadAction=h}),define("modules/clean/react/file_uploader/constants",["require","exports","tslib","external/immutable"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);(function(e){e.ALL_UPLOADS_COMPLETE="ALL_UPLOADS_COMPLETE",e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES",e.SET_HAS_OVERQUOTA_ERROR="SET_HAS_OVERQUOTA_ERROR"})(t.UploaderActionType||(t.UploaderActionType={}));var n;(function(e){e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(n=t.FileStatusType||(t.FileStatusType={}));var s;(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.INVALID_EXTENSION="INVALID_EXTENSION",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_RESPONSE_ERROR="SERVER_RESPONSE_ERROR",e.SERVER_TOKEN_EMPTY_ERROR="SERVER_TOKEN_EMPTY_ERROR",e.SERVER_TOKENS_MISSING_ERROR="SERVER_TOKENS_MISSING_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.BLOB_MISSING_ERROR="BLOB_MISSING_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR",e.UPLOAD_PRECHECK_ERROR="UPLOAD_PRECHECK_ERROR",e.UPLOAD_PRECHECK_INVALID_CHAR_ERROR="UPLOAD_PRECHECK_INVALID_CHAR_ERROR"})(s=t.UploadErrorType||(t.UploadErrorType={}));(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(o.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:n.PENDING,errorType:s.GENERIC,errorMessage:"",batchId:void 0},"FileUpload"));t.FileUpload=i,t.UPLOAD_BEGIN_EVENT="dbxUploadBegin",t.UPLOAD_CANCEL_EVENT="dbxUploadCancel",t.UPLOAD_COMPLETE_EVENT="dbxUploadComplete",t.ALL_UPLOADS_COMPLETE_EVENT="dbxAllUploadsComplete",t.UPLOAD_ERROR_EVENT="dbxUploadError";(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={})),t.INVALID_EXTENSIONS=["gdoc","gsheet","gslides","paper"]}),define("modules/clean/react/file_uploader/store",["require","exports","tslib","external/immutable","modules/clean/flux/base_store","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/utils","modules/core/exception"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._folderNsId=null,this._user=null,this._fileList=o.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._inlineStatusShouldBeDismissed=!1,this._numSecondsLeft=0,this._confirmedFSWs=[],this._confirmedFSWBatchIds=[],this._hasOverquotaError=!1,this._allUploadsComplete=!1},t.prototype.fileList=function(){return this._fileList},t.prototype.currentUpload=function(){var e=this._currentUploadId;if(!e)return null;var t=this._fileList.get(e);return t?t:null},t.prototype.uploadById=function(e){var t;return e&&(t=this._fileList.get(e)),t||void 0},t.prototype.numSecondsLeft=function(){return this._numSecondsLeft},t.prototype.isUploadCancelled=function(e){var t=this._fileList.get(e);return!!t&&t.status===s.FileStatusType.CANCELLED},t.prototype.inlineStatusShouldBeDismissed=function(){return this._inlineStatusShouldBeDismissed},t.prototype.path=function(){return this._path},t.prototype.folderNsId=function(){return this._folderNsId},t.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},t.prototype.user=function(){return this._user},t.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===s.FileStatusType.PENDING})},t.prototype.numDraggingFiles=function(){return this._numDraggingFiles},t.prototype.isInternalTransfer=function(){return this._isInternalTransfer},t.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},t.prototype.confirmedFSWs=function(){return this._confirmedFSWs},t.prototype.confirmedFSWBatchIds=function(){return this._confirmedFSWBatchIds},t.prototype.hasOverquotaError=function(){return this._hasOverquotaError},t.prototype.allUploadsComplete=function(){return this._allUploadsComplete},t.prototype.setUser=function(e){var t=e.user;this._user=t,this.emit_change()},t.prototype.setPath=function(e){var t=e.path,r=e.hasPermissionToUploadToFolder,o=void 0===r||r;this._path=t,this._hasPermissionToUploadToFolder=o,this._confirmedFSWs=[],this.emit_change()},t.prototype.setFolderNsId=function(e){var t=e.folderNsId;this._folderNsId=t},t.prototype.setHasOverquotaError=function(e){var t=e.hasOverquotaError;this._hasOverquotaError=t,this.emit_change()},t.prototype.queueUploads=function(e){for(var t=e.files,r={},o=0,n=t;o<n.length;o++){var s=n[o];r[s.uploadId]=s}this._fileList=this._fileList.merge(r),this.emit_change()},t.prototype.handleAllUploadsComplete=function(){this._allUploadsComplete=!0,this.emit_change()},t.prototype.startUpload=function(e){var t=e.file;a.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),a.assert(null!=t,"missing file to upload"),a.assert(this._fileList.get(t.uploadId)===t,"failed to find file in file list"),this._fileList.get(t.uploadId)&&(this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",s.FileStatusType.UPLOADING)}),this._currentUploadId=t.uploadId,this._allUploadsComplete=!1),this.emit_change()},t.prototype.completeUpload=function(e){var t=e.uploadId,r=this._fileList.get(t);r&&(t===this._currentUploadId&&r.status===s.FileStatusType.UPLOADING||a.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:r.toString(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(t,function(e){return e.set("status",s.FileStatusType.COMPLETE)})),this._currentUploadId=null,this.emit_change()},t.prototype.cancelUploads=function(e){for(var t=e.files,r=0,o=t;r<o.length;r++){var n=o[r];this._fileList=this._fileList.update(n.uploadId,function(e){return e.status===s.FileStatusType.PENDING||e.status===s.FileStatusType.UPLOADING?e.set("status",s.FileStatusType.CANCELLED):e}),n.uploadId===this._currentUploadId&&(this._currentUploadId=null)}this.emit_change()},t.prototype.setCurrentUploadProgress=function(e){var t=e.percentComplete,r=e.numSecondsLeft,o=this._currentUploadId;o&&(this._fileList=this._fileList.update(o,function(e){return e.set("percentUploaded",t)}),void 0!==r&&(this._numSecondsLeft=r)),this.emit_change()},t.prototype.handleUploadError=function(e){var t=e.uploadId,r=e.errorType,o=e.errorMessage,n=this._fileList.get(t);n&&(n.uploadId!==this._currentUploadId&&a.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:n.toString(),fileListLength:this._fileList.count(),errorType:r,errorMessage:o}}),this._fileList=this._fileList.update(n.uploadId,function(e){return e.set("status",s.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o)})),this._currentUploadId=null,this.emit_change()},t.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,r=e.isInternalTransfer,o=void 0!==r&&r;this._numDraggingFiles=t,this._isInternalTransfer=o,this.emit_change()},t.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;this._isUploadModalOpen=t,this.emit_change()},t.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;this._inlineStatusShouldBeDismissed=t,this.emit_change()},t.prototype.addNewFailedFile=function(e){var t=e.file,r=e.errorType,o=e.errorMessage;null==t.uploadId&&(t=t.set("uploadId",i.generateUploadId())),t=t.set("status",s.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o),this._fileList=this._fileList.set(t.uploadId,t),this.emit_change()},t.prototype.confirmFSW=function(e){var t=this,r=e.fswIds,o=e.batchId;r.forEach(function(e){t._confirmedFSWs.includes(e)||t._confirmedFSWs.push(e)}),this._confirmedFSWBatchIds.includes(o)||this._confirmedFSWBatchIds.push(o)},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case s.UploaderActionType.SET_USER:this.setUser(t.data);break;case s.UploaderActionType.SET_PATH:this.setPath(t.data);break;case s.UploaderActionType.SET_FOLDER_NS_ID:this.setFolderNsId(t.data);break;case s.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case s.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case s.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case s.UploaderActionType.ALL_UPLOADS_COMPLETE:this.handleAllUploadsComplete();break;case s.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case s.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case s.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case s.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case s.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case s.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED:this.setInlineStatusShouldBeDismissed(t.data);break;case s.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case s.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data);break;case s.UploaderActionType.SET_HAS_OVERQUOTA_ERROR:this.setHasOverquotaError(t.data)}},t})(n.Store);t.UploaderStoreClass=l,t.uploaderStore=new l}),define("modules/clean/react/file_uploader/utils",["require","exports","tslib","react","modules/clean/react_format","modules/clean/base64","modules/core/browser","modules/clean/analytics","modules/core/i18n","modules/clean/growth/types","modules/clean/growth/api","modules/clean/react/growth/education_module_event_bridge","modules/clean/react/snackbar"],function(e,t,r,o,n,s,i,a,l,c,d,u,p){"use strict";function h(){return _()}function f(){return"batch-"+_()}function _(){for(var e="",t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));var r=s.encode(e);return r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r=r.replace(/\=*$/,"")}function m(e,t){var r=0;return e.forEach(function(e){t.indexOf(e.status)!==-1&&(r+=e.size)}),r}function S(e,t,r){var o=t,n=0;return e.forEach(function(e,t){for(var s=0,i=e.split("/"),a=r.split("/");s<i.length&&s<a.length&&i[s]===a[s];)s++;s===i.length&&s>1&&s>n&&(n=s,o=Number(t))}),o}function g(e){var t;switch(e){case c.FolderType.Private:t=l._("<b>Only you can view and edit these files</b>. If you want to share, you can send anyone a read-only copy of your work.");break;case c.FolderType.Shared:t=l._("<b>Anyone in this folder can view this file. Only people with edit access can make changes.</b> You can edit user permissions at any time.");break;case c.FolderType.Team:t=l._("<b>Anyone on your team can access these files.</b> You can also create a folder to share files with specific team members.");break;default:throw c.enforceExhaustive(e),new Error("unknown folderType: "+e)}return{calloutTitle:o.createElement("span",null,n.reactFormat(t,{b:o.createElement("b",null)})),calloutButtonText:l._("Learn More")}}function v(e){switch(e){case c.FolderType.Private:return"private";case c.FolderType.Shared:return"specific";case c.FolderType.Team:return"everyone";default:throw c.enforceExhaustive(e),new Error("unknown folderType: "+e)}}function E(e){switch(e){case c.FolderType.Shared:return{sectionIdx:1,itemIdx:0};case c.FolderType.Team:return{sectionIdx:0,itemIdx:1};case c.FolderType.Private:return{sectionIdx:1,itemIdx:2};default:throw c.enforceExhaustive(e),new Error("unknown folderType: "+e)}}function w(e){return function(){p.Snackbar.close(),u.educationEventBridge.requestSection(e)}}function T(e,t,o){if(t){var n=g(e),s=E(e),i=w(s);return r.__assign({},n,{onCalloutButtonClick:i,viewContext:c.calculateViewContext(),logEvent:a.TeamsWebActionsLogger.log,extraLogInfo:{access_type:v(e),target_module_section_index:"string"!=typeof s&&s.sectionIdx,target_module_item_index:"string"!=typeof s&&s.itemIdx},onSnackbarSeen:function(){return d.markRichSnackbarAsSeen(e,t)},onSnackbarFinished:function(){return o(e)}})}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),i=r.__importStar(i),t.generateUploadId=h,t.generateBatchId=f,t.calculateSizeOfUploads=m,t.getNsId=S,t.getOQmodalOQALocationCode=function(e){return"/h"===(e||i.get_uri().path)?"ho":"fb"},t.folderTypeToSnackbarCopy=g,t.computeRichSnackbarProps=T}),define("modules/clean/react/fileops_actions",["require","exports","tslib","react","modules/core/notify","modules/core/i18n","modules/clean/em_string","modules/clean/filepath","modules/clean/react/async_file_modal_controller","modules/clean/file_operations/notifications","modules/clean/react/browse/api","modules/clean/react/browse/nav_actions","modules/clean/react_format","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/react/browse/models","modules/clean/viewer"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m){"use strict";function S(e,t,r,o){var i=m.Viewer.get_viewer().team_name,c=!1;"is_cdm_member"in e&&e.is_cdm_member&&a.inSubDirectory(e.cdm_tmf_path,o)&&(c=!0);var d=v(e,t,i,r,c);if(null!=d){n.Notify.clear();var p=t===E.TEAM_SPACE_OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR||t===E.TEAM_SPACE_ONLY_ON_TEAM_SHARING_ERROR||t===E.NS_HAVE_MOUNTED_CHILDREN_NS_ERROR,S=g(e,p,i,r.length,c),w="";w=p?"/help/business/team-space-overview#out":"/help/business/team-space-overview#move";var T=1===r.length,F=r[0]instanceof _.File&&T&&!p?s._("See owner"):void 0,b=function(){r[0]instanceof _.File&&h.asyncShowShareModal(e.id,r[0],{origin:f.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},u.browseNavActions.setPath,u.browseNavActions.setUrl)};l.showMoveErrorModal({title:S,content:d,learnMoreLink:w,buttonString:F,onClick:b})}}function g(e,t,r,o,n){return t?1===o?s._("Can’t move out of the team space"):s._("Can’t move %(num_of_files)s items").format({num_of_files:o}):"is_cdm_member"in e&&e.is_cdm_member&&!n?s.ungettext("Can’t move shared folder to the %(team_name)s team space","Can’t move shared folders to the %(team_name)s team space",o).format({team_name:i.Emstring.em_snippet(r,f.SNIPPET_SIZES.DISPLAY_NAME)}):s.ungettext("Can’t move shared folder to a team folder","Can’t move shared folders to a team folder",o)}function v(e,t,r,n,l){var c=s._("You don’t have permission to move some of these items. Try moving items individually."),d=null;return t===E.OFF_TEAM_OWNER_ERROR?d=1===n.length?null==r?p.reactFormat(s._("The owner of <strong>%(file_name)s</strong> is a member of another team.").format({file_name:i.Emstring.em_snippet(a.filename(n[0].fq_path),f.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):p.reactFormat(s._("The owner of <strong>%(file_name)s</strong> isn’t a member of %(team_name)s.").format({team_name:r,file_name:i.Emstring.em_snippet(a.filename(n[0].fq_path),f.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):null==r?s._("The owner of some of these shared folders is a member of another team."):s._("The owner of some of these shared folders isn’t a member of %(team_name)s.").format({team_name:r}):t===E.OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR?d=1===n.length?"is_cdm_member"in e&&e.is_cdm_member&&!l?p.reactFormat(s._("Only the owner of <strong>%(file_name)s</strong> can move it to the %(team_name)s team space.").format({team_name:r,file_name:i.Emstring.em_snippet(a.filename(n[0].fq_path),f.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):p.reactFormat(s._("Only the owner of <strong>%(file_name)s</strong> can move it to a team folder.").format({file_name:i.Emstring.em_snippet(a.filename(n[0].fq_path),f.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):"is_cdm_member"in e&&e.is_cdm_member&&!l?s._("Only the owner can move some of these folders to the %(team_name)s team space.").format({team_name:r}):s._("Only the owner can move some of these folders to a team folder."):t===E.VIEW_ONLY_ACCESS_ERROR?d=1===n.length?p.reactFormat(s._("You can only view <strong>%(file_name)s</strong>. Ask an owner or editor of the folder for access to edit it.").format({file_name:i.Emstring.em_snippet(a.filename(n[0].fq_path),f.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):s._("You can’t edit some of these folders. Ask an owner or editor of the folders for access to edit them."):t===E.TEAM_SPACE_OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR||t===E.TEAM_SPACE_ONLY_ON_TEAM_SHARING_ERROR?d=1===n.length?p.reactFormat(s._("If you need to move <strong>%(file_name)s</strong>, ask your admin to move it for you.").format({file_name:i.Emstring.em_snippet(a.filename(n[0].fq_path),f.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):c:t===E.NS_HAVE_MOUNTED_CHILDREN_NS_ERROR&&(d=1===n.length?p.reactFormat(s._("<strong>%(file_name)s</strong> has other shared folders inside it. Try moving each shared folder individually.").format({file_name:i.Emstring.em_snippet(a.filename(n[0].fq_path),f.SNIPPET_SIZES.FILENAME)}),{strong:o.default.createElement("strong",{style:{fontWeight:500}})}):c),d}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),a=r.__importStar(a),l=r.__importStar(l),c=r.__importStar(c),d=r.__importStar(d);var E={VIEW_ONLY_ACCESS_ERROR:"view_only_access_error",OFF_TEAM_OWNER_ERROR:"off_team_owner_error",OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR:"owner_only_manage_membership_error",TEAM_SPACE_OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR:"team_space_owner_only_manage_membership_error",TEAM_SPACE_ONLY_ON_TEAM_SHARING_ERROR:"team_space_only_on_team_sharing_error",NS_HAVE_MOUNTED_CHILDREN_NS_ERROR:"ns_have_mounted_children_ns_error"};t.copyFiles=function(e){var o=e.files,n=e.newPath,i=e.checkFSWs,a=e.onSuccess,u=e.onRequestNotSent,p=e.onUndo,h=e.user,f=e.dataApi;!(void 0===f?d:f).copyFiles({files:o,newPath:n,checkFSWs:i,userId:h.id,onSuccess:function(i){var d=i.newFiles,u=i.changesets,f=i.failureDetails;if(f){var _=function(){t.copyFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:f,onFinalAccept:_,confirmText:s._("Copy")})}else a&&a(d),c.notifyCopySuccess(o.length,h,u,n,function(){p&&p()})}})&&u&&u()},t.moveFiles=function(e){var o=e.path,i=e.files,a=e.newPath,u=e.checkFSWs,p=e.onSuccess,h=e.onRequestNotSent,f=e.onUndo,_=e.user,m=e.dataApi,g=void 0===m?d:m,v=function(o){var n=o.newFiles,d=o.changesets,u=o.failureDetails;if(u){var h=function(){t.moveFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:u,onFinalAccept:h,confirmText:s._("Move")})}else c.notifyMoveSuccess(i.length,_,d,a,function(){f&&f()}),p&&p(n)},E=function(e){"This will result in losing ownership of these folders."===e?(n.Notify.clear(),l.showConfirmOwnershipTransferModal(function(){g.moveFiles({path:o,files:i,newPath:a,userId:_.id,onSuccess:v,allowOwnershipTransfer:!0})})):S(_,e,i,a)};!g.moveFiles({path:o,files:i,newPath:a,checkFSWs:u,userId:_.id,onSuccess:v,onError:E,allowOwnershipTransfer:!1})&&h&&h()}}),define("modules/clean/react/files_view/column_header",["require","exports","tslib","react","external/classnames","spectrum/checkbox","spectrum/table","modules/clean/react/files_view/column_header_menu","modules/clean/react/files_view/fixed_table_head","modules/clean/react/files_view/sticky_table_head","modules/clean/react/files_view/view_type_column_header_menu","modules/clean/react/files_view/types","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importDefault(n);var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHovered:!1},t.handleChangeSelectAllCheckbox=function(e){"unchecked"===e?t.props.onDeselectAll():t.props.onSelectAll()},t.handleMouseEnter=function(){t.setState({isHovered:!0})},t.handleMouseLeave=function(){t.setState({isHovered:!1})},t}return r.__extends(t,e),t.prototype.getAriaSortValue=function(e){return e===u.SortDirection.ASCENDING?"ascending":e===u.SortDirection.DESCENDING?"descending":"none"},t.prototype.render=function(){var e=this,t=this.state.isHovered,u=this.props,h=u.columnFlex,f=u.isCompactMode,_=u.isSelectMode,m=u.isSticky,S=u.isTabbing,g=u.currentSort,v=u.onSelection,E=u.onSort,w=u.onSwitchViewType,T=u.selectAllCheckboxState,F=void 0===T?"unchecked":T,b=u.showSelectAllCheckbox,y=void 0===b||b,C=u.stickyOffsetHeight,I=u.stickyOffsetTop,R=u.columns,O=u.visibleColumns,P=u.viewType,D=u.viewTypes,A=u.viewTypeLabels,N=u.onTTI,L=u.isSearchMode,x=u.presentationOnly,M=!(S||_||t||f),k=[o.default.createElement(i.TableHeadCell,{className:"brws-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:x?"presentation":"columnheader",scope:"col"},o.default.createElement("div",{className:"brws-vertically-center"},y?o.default.createElement(s.Checkbox,{className:n.default("brws-checkbox",{"brws-checkbox-checked":"checked"===F}),checked:F,onChange:this.handleChangeSelectAllCheckbox,variant:M?"invisible":"default",ariaLabel:p._("Select all")}):null))].concat(O.map(function(t,r){var n=g&&g.sortField===t.sortField?g.sortDirection:void 0;return o.default.createElement(i.TableHeadCell,{key:r,role:x?"presentation":"columnheader",scope:"col","aria-sort":e.getAriaSortValue(n),className:"brws-column-header-table-cell"},o.default.createElement(a.ColumnHeaderMenu,{column:t,sortDirection:n,columns:R,visibleColumns:O,onSelection:v,onSort:E,viewType:P,isSearchMode:L}),r===O.length-1&&o.default.createElement(d.ViewTypeColumnHeaderMenu,{onTTI:N,viewType:P,viewTypes:D,viewTypeLabels:A,onSwitchViewType:w}))})),U={offsetHeight:C,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave};return m?o.default.createElement(c.StickyTableHead,r.__assign({columnFlex:h,offsetTop:I,className:"brws-column-header"},U),k):o.default.createElement(l.FixedTableHead,r.__assign({},U),k)},t})(o.default.PureComponent);t.ColumnHeader=h}),define("modules/clean/react/files_view/column_header_menu",["require","exports","tslib","external/classnames","spectrum/icon_form","spectrum/popover","react","modules/clean/react/files_view/constants","modules/clean/react/files_view/types","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),i=r.__importDefault(i);var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePopoverSelection=function(e){var r=t.props,o=r.onSort,n=r.onSelection,s=r.column;if(e===l.SortDirection.ASCENDING||e===l.SortDirection.DESCENDING)o(s.sortField,e);else{if(n(e,s),t.props.isSearchMode)return void o(e.sortField,l.SortDirection.DESCENDING);1===t.props.visibleColumns.length&&o(e.sortField,t.props.sortDirection||l.SortDirection.ASCENDING)}},t}return r.__extends(t,e),t.prototype._columnMenuTitle=function(){switch(this.props.viewType){case l.ViewType.Grid:case l.ViewType.LargeGrid:return c._("Group by");case l.ViewType.List:default:return this.props.isSearchMode?c._("Sort by"):c._("Show")}},t.prototype.render=function(){var e=this.props,t=e.column,r=e.columns,d=e.visibleColumns,u=e.sortDirection,p=e.isSearchMode,h=e.viewType;if(t.isSortDisabled)return i.default.createElement("div",{className:"normal brws-column-header-menu"},i.default.createElement("span",{className:"brws-column-header-menu-trigger-disabled"},t.label));var f,_=!(t.sortField!==l.SortField.RELEVANCE||!p),m=_&&h===l.ViewType.List?c._("Last modified"):t.label,S=u!==l.SortDirection.ASCENDING||_?u!==l.SortDirection.DESCENDING||_?"caret-down":"sort-arrow-down":"sort-arrow-up",g=_?null:i.default.createElement(s.PopoverItemGroupSeparator,{key:"show-separator"}),v=p?a.SEARCH_LIST_VIEW_SORT_ENABLED_COLUMNS:r;return!t.isLocked&&r&&r.length&&(f=[g,i.default.createElement(s.PopoverItemGroup,{key:"show-item-group"},i.default.createElement(s.PopoverItemGroupTitle,{className:"brws-column-header-menu-title",key:"show-title"},this._columnMenuTitle()),v.filter(function(e){return!e.isLocked}).map(function(e){return i.default.createElement(s.PopoverSelectableItem,{key:e.sortField,disabled:d.map(function(e){return e.sortField}).includes(e.sortField)&&e.sortField!==t.sortField,selected:e.sortField===t.sortField,value:e},e.label)}))]),i.default.createElement(s.Popover,{className:"brws-column-header-menu",onSelection:this.handlePopoverSelection},i.default.createElement(s.PopoverTrigger,{className:o.default("brws-column-header-menu-trigger",{"brws-column-header-menu-trigger-active":!!u&&!_}),title:t.popoverTriggerLabel,"aria-label":c._("Sort by")},i.default.createElement("span",null,m),i.default.createElement("span",{className:"brws-column-header-menu-label-icon-wrapper"},i.default.createElement(n.IconForm,{className:"brws-column-header-menu-label-icon",name:S}))),i.default.createElement(s.PopoverContent,null,!_&&i.default.createElement(s.PopoverItemGroup,null,i.default.createElement(s.PopoverItemGroupTitle,{className:"brws-column-header-menu-title"},c._("Order")),i.default.createElement(s.PopoverSelectableItem,{selected:u===l.SortDirection.ASCENDING,value:l.SortDirection.ASCENDING,disabled:t.isSortOrderOptionDisabled},c._("Ascending")),i.default.createElement(s.PopoverSelectableItem,{selected:u===l.SortDirection.DESCENDING,value:l.SortDirection.DESCENDING,disabled:t.isSortOrderOptionDisabled},c._("Descending"))),f))},t})(i.default.PureComponent);t.ColumnHeaderMenu=d}),define("modules/clean/react/files_view/column_helpers",["require","exports","modules/clean/immutability_helper"],function(e,t,r){"use strict";function o(e,t,o){var n=e.map(function(e){return e.sortField}).indexOf(t),s=e.map(function(e){return e.sortField}).indexOf(o);if(n===s||n===-1||s===-1)return e;var i=e[n],a=e[s];return r.splice(r.splice(e,n,1,a),s,1,i)}Object.defineProperty(t,"__esModule",{value:!0}),t.swapColumns=o}),define("modules/clean/react/files_view/column_manager",["require","exports","tslib","external/lodash","react","modules/clean/immutability_helper","modules/clean/react/files_view/column_helpers","modules/clean/react/files_view/types"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n);var l=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleSelection=function(e,t){var o=r.props,n=o.viewType,l=o.onColumnsChanged,c=o.viewTypeColumns,d=r.state.visibleColumns,u=c?c[a.ViewType.List]:void 0,p=c?c[a.ViewType.Grid]:void 0;if(u&&p){var h=d.indexOf(t);if(h===-1||d.includes(e))r.changeVisibleColumns(d);else{var f=s.splice(d,h,1,e);r.changeVisibleColumns(f);var _=r.isSizeColumnPresent(f);n===a.ViewType.List?l(i.swapColumns(u,t.sortField,e.sortField),a.ViewType.List,_):(l(i.swapColumns(p,t.sortField,e.sortField),n,_),e.sortField!==a.SortField.FILENAME&&l(i.swapColumns(u,u[1].sortField,e.sortField),a.ViewType.List,_))}}},r}return r.__extends(t,e),t.prototype.componentWillMount=function(){this.changeVisibleColumns(this.computeVisibleColumns(this.props),!0)},t.prototype.componentWillReceiveProps=function(e){var t=this.props.viewTypeColumns,r=this.state.visibleColumns,n=this.getNumVisibleColumns(this.props),s=this.getNumVisibleColumns(e);if(o.isEqual(this.props.columns,e.columns)&&this.props.viewType===e.viewType){if(s<n)this.changeVisibleColumns(r.slice(0,s),!0);else if(s>n){var l=this.props.columns,c=s-r.length,d=o.filter(l,function(e){return!o.find(r,function(t){return t.sortField===e.sortField})}).slice(0,c);this.changeVisibleColumns(r.concat(d),!0)}}else if(1===s&&e.columns.length&&e.currentSort){var l=e.columns,u=e.viewType,p=t?t[a.ViewType.Grid]:void 0;switch(u){case a.ViewType.List:this.changeVisibleColumns([l[0]],!0);break;case a.ViewType.Grid:case a.ViewType.LargeGrid:if(p){var h=e.currentSort,f=l.find(function(e){return e.sortField===h.sortField}),_=f||l[0];this.deferredOnColumnsChangedHandler([_],i.swapColumns(p,p[0].sortField,_.sortField),u)}}}else this.changeVisibleColumns(e.columns.slice(0,s),!0)},t.prototype.changeVisibleColumns=function(e,t){var r=this;void 0===t&&(t=!1),this.resetChangeVisibleColumnsTimeout();var o=this.isSizeColumnPresent(e);this.setState({visibleColumns:e,canDisplayFolderSizes:o}),t?this.changeVisibleColumnsTimeout=setTimeout(function(){r.resetChangeVisibleColumnsTimeout(),r.props.onCanDisplayFolderSizesChanged(o)
}):this.props.onCanDisplayFolderSizesChanged(o)},t.prototype.resetChangeVisibleColumnsTimeout=function(){this.changeVisibleColumnsTimeout&&(clearTimeout(this.changeVisibleColumnsTimeout),this.changeVisibleColumnsTimeout=void 0)},t.prototype.deferredOnColumnsChangedHandler=function(e,t,r){var o=this;this.resetDeferredOnColumnsChangedHandler();var n=this.isSizeColumnPresent(e);this.setState({visibleColumns:e,canDisplayFolderSizes:n}),this.onColumnsChangesTimeout=setTimeout(function(){o.resetDeferredOnColumnsChangedHandler(),o.props.onColumnsChanged(t,r,n)})},t.prototype.resetDeferredOnColumnsChangedHandler=function(){this.onColumnsChangesTimeout&&(clearTimeout(this.onColumnsChangesTimeout),this.onColumnsChangesTimeout=void 0)},t.prototype.computeVisibleColumns=function(e){return e.columns.slice(0,this.getNumVisibleColumns(e))},t.prototype.getNumVisibleColumns=function(e){var t=e.isMatchedLarge,r=e.isMatchedMedium;switch(e.viewType){case a.ViewType.Grid:case a.ViewType.LargeGrid:return 1;case a.ViewType.List:default:return t?3:r?2:1}},t.prototype.isSizeColumnPresent=function(e){return e.some(function(e){return e.sortField===a.SortField.SIZE})},t.prototype.render=function(){var e=this.props.children,t=this.state,r=t.visibleColumns,o=t.canDisplayFolderSizes;if(!e)return null;var n=e;return"function"==typeof e&&(n=e({visibleColumns:r,canDisplayFolderSizes:o,handleSelection:this.handleSelection})),n},t})(n.default.PureComponent);t.ColumnManager=l}),define("modules/clean/react/files_view/controller",["require","exports","tslib","external/classnames","external/immutable","spectrum/media_table_skeleton","spectrum/table","react","external/react-dom","external/lodash","modules/clean/react/files_view/types","modules/clean/react/files_view/drag_and_drop","modules/clean/react/files_view/file_grouper","modules/clean/react/files_view/file_list_empty_folder_table","modules/clean/react/files_view/column_header","modules/clean/react/files_view/column_manager","modules/clean/react/files_view/constants","modules/clean/react/files_view/list","modules/clean/react/files_view/pinned_team_folder_view","modules/clean/react/selectable_list","modules/clean/react/files_view/selectors","modules/clean/react/files_view/tile_grid","modules/clean/react/files_view/internal_drag_status","modules/clean/react/browse/models","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/i18n","modules/core/notify","modules/clean/sharing/access_level","modules/clean/photos/thumb_loading/buffered_thumb_store","modules/clean/photos/thumb_loading/generic_thumb_store"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C,I,R,O,P,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n),a=r.__importDefault(a),l=r.__importStar(l),c=r.__importStar(c),y=r.__importStar(y);var A=function(){},N=[O.NameSpaceAccess.ACCESS_NO_ACCESS,O.NameSpaceAccess.ACCESS_READER,O.NameSpaceAccess.ACCESS_READER_NO_COMMENT],L=(function(t){function O(){var e=null!==t&&t.apply(this,arguments)||this;return e.gridViewPrewarmedThumbnailRequestIds=[],e.state={thumbStore:new P.BufferedThumbStore,isTabbing:!1,keyboardShortcutModalHandler:function(){e.setState({shouldShowKeyboardShortcutModal:!0})},dropTarget:null,sections:{sectionLabels:[],sectionStartIndices:[]},tilesPerRow:1},e.handleMouseDownBody=function(){e.setState({isTabbing:!1})},e.handleKeyDownBody=function(t){9===t.keyCode&&e.setState({isTabbing:!0})},e.handleTabbingStart=function(){e.setState({isTabbing:!0})},e.handleCopyToClipboard=function(){var t=e.props,r=t.selectedFiles,o=t.onCopyToClipboard;r.size&&o(r.toArray())},e.handleNewFolderSubmit=function(t){""===t?(e.props.onNewFolderCancel(),e.handleNewFolderCancel({source:d.NameInputActionSource.SUBMIT})):e.props.onNewFolderSubmit(t)},e.handleNewFolderCancel=function(t){t.source!==d.NameInputActionSource.ESC&&R.Notify.error(I._("Please provide a name for the new folder.")),e.props.onNewFolderCancel()},e.handleSetFileUploaderPath=function(t){var r=t?t.path:e.props.path,o=e.props.context.isCurrentPathWriteable();t&&t.hasOwnProperty("hasPermissionToUploadToFolder")&&(o=!!t.hasPermissionToUploadToFolder),e.props.setFileUploaderPath({path:r,hasPermissionToUploadToFolder:o})},e.handleDragStart=function(t,o){void 0===o&&(o=[]);var n=e.props,s=n.path,i=n.selectedFiles,a=n.user,d=c.keyBy(o,"fq_path");d=r.__assign({},d,i.toJS());var u=c.values(d);if(u.some(function(e){return F.File.isTeamSharedFolder(e)}))return void R.Notify.error(I._("Team folders can’t be moved."));if(u.some(function(e){return F.File.isTeamMemberFolder(e)}))return void R.Notify.error(I._("Your member folder can’t be moved."));var p=t.dataTransfer;p&&(p.setDragImage&&e.internalDragStatusRef&&p.setDragImage(l.findDOMNode(e.internalDragStatusRef),-10,-10),p.setData(C.INTERNAL_FILE_DATA_TRANSFER_TYPE,JSON.stringify({userId:a.id,fromPath:s,filePaths:u.map(function(e){return e.fq_path})})),p.effectAllowed="copyMove")},e.handleDragEnter=function(t,r,o,n){u.onFileDragEnterItem(r,!!e.props.isDraggingExternalFiles,!!e.props.isDraggingInternalFiles,o,n,e.props.context,e.handleSetDropTarget,e.handleSetFileUploaderPath)},e.handleSetDropTarget=function(t){e.setState({dropTarget:t})},e.handleSelectionChange=function(t){b.UEClient.sendEvent("FileItemRow","CheckboxToggled"),e.props.onSelectionChange(t)},e.handleDeselectAll=function(){var t=e.props,r=t.selection;(0,t.onSelectionChange)(r.set("selected",n.OrderedSet()))},e.handleSelectAll=function(){var t=e.props,r=t.items,o=t.selection;(0,t.onSelectionChange)(o.set("selected",n.OrderedSet(r.filter(O.canSelectItem).map(function(e){return"fq_path"in e?e.fq_path:e.file_id}))))},e._handleGetOverflowMenuActions=function(t,r){var o=e.props;return(0,o.getOverflowMenuActions)(t,r,o.responsive)},e.handleTTI=function(){e.props.onComponentTTI("FilesViewController")},e.setFilesViewTileGridRef=function(t){e.filesViewTileGridRef=t},e.setInternalDragStatusRef=function(t){e.internalDragStatusRef=t},e.getIsCurrentPathWriteable=function(){return e.props.context.isCurrentPathWriteable()},e.onTilesPerRowChange=function(t){e.setState({tilesPerRow:t})},e}return r.__extends(O,t),O.prototype.componentWillMount=function(){this.setTileItemsSections(this.props)},O.prototype.componentDidMount=function(){var t=this;this.setupUnity(),document.addEventListener("keydown",this.handleKeyDownBody),document.addEventListener("mousedown",this.handleMouseDownBody),b.UEClient.registerForAllEducationSteps(function(e){var r=["FileItemRow","PinnedTeamFolder","PathBreadcrumbs"];e.step&&e.step.effect&&r.includes(e.step.effect.containerName)&&t.props.onSwitchViewType(d.ViewType.List)}),y.waitForTTI().then(function(){t.prewarmGridViewThumbStore();var o=function(e){var r=e.showKeyboardShortcutsModal;t.state.shouldShowKeyboardShortcutModal&&r(t.props.viewType===d.ViewType.List),t.setState({keyboardShortcutModalHandler:function(){r(t.props.viewType===d.ViewType.List)},shouldShowKeyboardShortcutModal:!1})};o.perfName="keyboard_shortcuts_modal",new Promise(function(t,r){e(["modules/clean/react/files_view/keyboard_shortcuts_modal"],t,r)}).then(r.__importStar).then(o)})},O.prototype.componentWillReceiveProps=function(e){if(e.context&&this.props.context&&e.context.currentFQPath!==this.props.context.currentFQPath){this.undoPrewarmGridViewThumbStore();var t=this.props.arePostTTIModulesLoaded?new D.GenericThumbStore:new P.BufferedThumbStore;this.setState({thumbStore:t})}(e.viewType!==this.props.viewType||!e.currentSort!=!this.props.currentSort||e.currentSort&&this.props.currentSort&&(e.currentSort.sortField!==this.props.currentSort.sortField||e.currentSort.sortDirection!==this.props.currentSort.sortDirection)||e.items!==this.props.items)&&this.setTileItemsSections(e)},O.prototype.componentDidUpdate=function(e){e.context&&this.props.context&&e.context.currentFQPath!==this.props.context.currentFQPath&&this.prewarmGridViewThumbStore(),this.props.enableUnity&&e.items!==this.props.items&&this.triggerUnityChangeCallback&&this.triggerUnityChangeCallback(),e.path!==this.props.path&&this.handleScrollToTop()},O.prototype.componentWillUnmount=function(){this.triggerUnityChangeCallback=void 0,document.removeEventListener("keydown",this.handleKeyDownBody),document.removeEventListener("mousedown",this.handleMouseDownBody)},O.prototype.setupUnity=function(){return r.__awaiter(this,void 0,void 0,function(){var t,o=this;return r.__generator(this,function(n){switch(n.label){case 0:return[4,y.waitForTTI()];case 1:return n.sent(),[4,new Promise(function(t,r){e(["modules/clean/unity_browse_interface"],t,r)}).then(r.__importStar)];case 2:return t=n.sent().default,this.triggerUnityChangeCallback=function(){t.browse_visible_change_callback(o.props.items.toArray(),o.props.user.id,0,o.props.items.size-1)},[2]}})})},O.prototype.setTileItemsSections=function(e){this.setState({sections:e.viewType!==d.ViewType.List&&e.currentSort?p.getSections(e.items,e.currentSort.sortField,e.currentSort.sortDirection,e.isSearchMode):O.emptySections})},O.prototype.prewarmGridViewThumbStore=function(){var e=this;if(this.props.viewType!==d.ViewType.Grid){var t=this.state.thumbStore;this.props.items.slice(0,100).forEach(function(r){if(r instanceof F.File||r instanceof F.FileSharedWithMe){var o=w.getThumbnailUrlForItem(r.thumbnail_url_tmpl,m.ViewTypeThumbnailSizes[d.ViewType.Grid]);if(o){var n=t.bind_url(o,{onSuccess:A});n&&e.gridViewPrewarmedThumbnailRequestIds.push(n)}}})}},O.prototype.undoPrewarmGridViewThumbStore=function(){var e=this;this.gridViewPrewarmedThumbnailRequestIds.length&&(this.gridViewPrewarmedThumbnailRequestIds.forEach(function(t){e.state.thumbStore.unbind_url(t)}),this.gridViewPrewarmedThumbnailRequestIds=[])},O.prototype.handleScrollToTop=function(){window.scrollTo(0,0)},O.prototype.getFilesViewTileGridRef=function(){return this.filesViewTileGridRef},O.prototype.renderEmptyFolderView=function(){var e=this.props,t=e.context,r=e.responsive,o=e.onFocusSearchBar,n=e.onPasteFromClipboard,s=e.onNavigateToParentFolder;if(this.props.customEmptyFolderView)return this.props.customEmptyFolderView(r);var i=t.isInsideSharedFolder,l=t.currentSharedFolderPermissionRole,c=i&&N.includes(l),d=c?void 0:I._("Drag and drop files onto this window to upload.");return a.default.createElement(h.EmptyFolderTable,{title:I._("This folder is empty"),subtitle:d,onTTI:this.handleTTI,onFocusSearchBar:o,onPasteFromClipboard:n,onNavigateToParentFolder:s,onOpenKeyboardShortcutModal:this.state.keyboardShortcutModalHandler})},O.prototype.renderPinnedTeamFolderView=function(e){var t=this.props,r=t.context,o=t.dropTargetHighlightMode,n=t.onShowShare,s=t.renderSharedWithController,i=t.teamFolders,l=t.user,c=t.onRenameSubmit,d=t.onRenameCancel,u=this.state,p=u.dropTarget,h=u.isTabbing,f=u.thumbStore;return a.default.createElement(g.PinnedTeamFolderView,{activeDropTarget:p,columnFlex:m.LIST_VIEW_COLUMN_FLEX[1],context:r,dropTargetHighlightMode:o,getOverflowMenuActions:this._handleGetOverflowMenuActions,isCompactMode:e,isTabbing:h,onDragEnter:this.handleDragEnter,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onRenameCancel:d,onRenameSubmit:c,teamFolders:i,user:l,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,thumbStore:f,onShowShare:n,renderSharedWithController:s})},O.prototype.getSelectAllCheckboxCheckedVariant=function(){var e=this.props,t=e.selectedFiles,r=e.items,o="unchecked";return t.size===r.filter(O.canSelectItem).size?o="checked":t.size&&(o="mixed"),o},O.prototype.getShouldShowSelectAllCheckbox=function(){return this.props.items.filter(O.canSelectItem).size>0},O.prototype.isCreateFolderUIActive=function(){var e=this.props.createNewFolderState;return e&&"CREATE_FOLDER_INACTIVE"!==e},O.prototype.shouldShowEmptyFolderView=function(){return this.props.loadingState===d.LoadingState.LOADED&&!this.props.items.size&&!this.isCreateFolderUIActive()},O.canSelectItem=function(e){return e instanceof F.File||e instanceof F.FileSharedWithMe},O.prototype.shouldComponentUpdate=function(e){return e.loadingState!==this.props.loadingState||e.loadingState!==d.LoadingState.LOADING_FIRST_PAGE},O.prototype.render=function(){var e=this,t=this.props,r=t.onDelete,n=t.onShowRename,l=t.onRenameSubmit,c=t.onRenameCancel,u=t.onSwitchViewType,p=t.onPasteFromClipboard,h=t.onColumnsChanged,g=t.onCanDisplayFolderSizesChanged,F=t.onFocusSearchBar,b=t.currentSort,y=t.createNewFolderState,C=t.context,I=t.columns,R=t.dropTargetHighlightMode,O=t.fileRename,P=t.getIsFileJumping,D=t.onAddFileJumpKeyCode,A=t.onResetFileJump,N=t.items,L=t.isSearchMode,x=t.isDraggingExternalFiles,M=t.isDraggingInternalFiles,k=t.isQueryingFolderSizes,U=t.isFileViewerShown,V=t.loadingState,B=t.onSortChange,q=t.path,H=t.responsive,W=t.selectedFiles,G=t.selection,z=t.shouldShowPinnedTeamFolders,j=t.renderSharedWithController,Q=t.onShowShare,Y=t.onPresentInZoom,K=t.teamFolders,J=t.totalNumFiles,X=t.user,Z=t.viewType,$=t.viewTypes,ee=t.viewTypeLabels,te=t.viewTypeColumns,re=t.onLocationLinkClick,oe=t.onNavigateToFileOrFolder,ne=t.onNavigateToParentFolder,se=t.onOpenFileSharedWithMe,ie=t.onOpenPaper,ae=t.arePostTTIModulesLoaded,le=t.onStarClick,ce=t.fileExtensionsConfigs,de=t.pageHeaderHeight,ue=t.disabledMultiselect,pe=t.isStickyColumnHeader,he=t.onRangeInView,fe=t.hasResponsiveOverflowMenu,_e=H.isMatchedLarge,me=H.isMatchedMedium,Se=this.state,ge=Se.dropTarget,ve=Se.thumbStore,Ee=Se.isTabbing,we=Se.keyboardShortcutModalHandler,Te=Se.sections,Fe=Se.tilesPerRow;if(V===d.LoadingState.LOADING_FIRST_PAGE)return ae?a.default.createElement(s.MediaTableSkeleton,{numRows:15}):null;var be=E.getItemIds(this.props),ye=!_e,Ce=!!W.size;if(this.shouldShowEmptyFolderView())return a.default.createElement("div",{className:"brws-files-view"},z&&this.renderPinnedTeamFolderView(ye),this.renderEmptyFolderView());var Ie=_e?m.DEFAULT_COLUMN_HEADER_HEIGHT:m.COMPACT_COLUMN_HEADER_HEIGHT,Re=Ie+de,Oe=this.props.scrollPositionOffset||0;return z&&(Oe+=Ie+Ie+m.PINNED_TEAM_FOLDER_SECONDARY_HEADER_PADDING_TOP+K.size*m.DEFAULT_ROW_HEIGHT),a.default.createElement("div",{className:o.default(["brws-files-view","brws-files-view--"+Z.toLowerCase()])},z&&this.renderPinnedTeamFolderView(ye),a.default.createElement(_.ColumnManager,{columns:I,viewTypeColumns:te,currentSort:b,onCanDisplayFolderSizesChanged:g,onColumnsChanged:h,isMatchedLarge:_e,isMatchedMedium:me,isSearchMode:L,viewType:Z},function(t){var s=t.visibleColumns,h=t.handleSelection,_=t.canDisplayFolderSizes,g=(L?m.LIST_VIEW_SEARCH_MODE_COLUMN_FLEX:m.LIST_VIEW_COLUMN_FLEX)[s.length],E=a.default.createElement(f.ColumnHeader,{columnFlex:g,currentSort:b,isCompactMode:ye,isSelectMode:Ce,isSticky:pe,isTabbing:Ee,onDeselectAll:e.handleDeselectAll,onSelectAll:e.handleSelectAll,onSelection:h,onSort:B,onSwitchViewType:u,selectAllCheckboxState:e.getSelectAllCheckboxCheckedVariant(),showSelectAllCheckbox:e.getShouldShowSelectAllCheckbox(),stickyOffsetHeight:Ie,stickyOffsetTop:de,columns:I,visibleColumns:s,viewType:Z,viewTypes:$,viewTypeLabels:ee,onTTI:e.handleTTI,isSearchMode:L,presentationOnly:Z!==d.ViewType.List});return Z===d.ViewType.List?a.default.createElement(v.SelectableList,{itemIds:be,keyScope:v.SELECTABLE_LIST_KEY_SCOPE,onSelectionChange:e.handleSelectionChange,onTabbingStart:e.handleTabbingStart,selection:G,tilesPerRow:Fe},function(t){var d=t.focusedFileId,u=t.handleDeselect,h=(t.handleDeselectAll,t.handleFocusFile),f=t.handleSelect,m=(t.handleSelectAll,t.isSelectableListEvent);return a.default.createElement(i.Table,{"aria-rowcount":J,className:o.default("brws-files-view-list",{"brws-files-view-list-compact":ye}),columnFlex:g},E,a.default.createElement(S.FilesViewList,{onDelete:r,onShowRename:n,activeDropTarget:ge,context:C,createNewFolderState:y,disabledMultiselect:ue||!1,dropTargetHighlightMode:R,items:N,fileExtensionsConfigs:ce,fileRename:O,focusedFileId:d,getOverflowMenuActions:e._handleGetOverflowMenuActions,getIsCurrentPathWriteable:e.getIsCurrentPathWriteable,getIsFileJumping:P,onAddFileJumpKeyCode:D,onResetFileJump:A,isCompactMode:ye,isDraggingExternalFiles:x,isDraggingInternalFiles:M,isFileViewerShown:U,isSearchMode:L,isSelectMode:Ce,isSelectableListEvent:m,arePostTTIModulesLoaded:ae,isTabbing:Ee,keyScope:v.SELECTABLE_LIST_KEY_SCOPE,onCopyToClipboard:e.handleCopyToClipboard,onDragStart:e.handleDragStart,onDragEnter:e.handleDragEnter,onDeselectFile:u,onFocusFile:h,onFocusSearchBar:F,onOpenKeyboardShortcutModal:we,onLocationLinkClick:re,onNavigateToFileOrFolder:oe,onNavigateToParentFolder:ne,onNewFolderCancel:e.handleNewFolderCancel,onNewFolderSubmit:e.handleNewFolderSubmit,onOpenFileSharedWithMe:se,onOpenPaper:ie,onPasteFromClipboard:p,onRenameCancel:c,onRenameSubmit:l,onSelectFile:f,onSetDropTarget:e.handleSetDropTarget,onSetFileUploaderPath:e.handleSetFileUploaderPath,onStarClick:le,responsive:H,scrollPositionOffset:Oe,scrollToRow:d?be.indexOf(d):0,selectedFiles:W,selection:G,renderSharedWithController:j,hrefForFile:e.props.hrefForFile,onShowShare:Q,onPresentInZoom:Y,user:X,viewportTopOffset:Re,visibleColumns:s,canDisplayFolderSizes:_,thumbStore:ve,shareButtonLabel:e.props.shareButtonLabel,showShareButton:e.props.showShareButton,starredState:e.props.starredState,useSearchSuccessBanner:e.props.useSearchSuccessBanner,showImageThumbnailOnly:e.props.showImageThumbnailOnly,expHighlightedTruncatedString:e.props.expHighlightedTruncatedString,onRangeInView:he,hasResponsiveOverflowMenu:fe,expSnippets:e.props.expSnippets}))}):a.default.createElement(v.SelectableList,{itemIds:be,keyScope:v.SELECTABLE_TILE_GRID_KEY_SCOPE,onSelectionChange:e.handleSelectionChange,onTabbingStart:e.handleTabbingStart,selection:G,tilesPerRow:Fe,sectionStartIndices:Te.sectionStartIndices},function(t){var o=t.handleDeselect,s=t.handleDeselectAll,d=t.handleFocusFile,u=t.handleSelect,h=t.handleSelectAll;return a.default.createElement("div",null,a.default.createElement(i.Table,{columnFlex:m.GRID_VIEW_COLUMN_FLEX,role:"presentation"},E),a.default.createElement(w.FilesViewTileGrid,{onDelete:r,disabledMultiselect:ue||!1,onShowRename:n,activeDropTarget:ge,arePostTTIModulesLoaded:ae,createNewFolderState:y,context:C,deselectAll:s,dropTargetHighlightMode:R,fileRename:O,getOverflowMenuActions:e._handleGetOverflowMenuActions,getIsCurrentPathWriteable:e.getIsCurrentPathWriteable,getIsFileJumping:P,onAddFileJumpKeyCode:D,onResetFileJump:A,onTTI:e.handleTTI,items:N,isCreateFolderUIActive:e.isCreateFolderUIActive(),isDraggingExternalFiles:x,isDraggingInternalFiles:M,isQueryingFolderSizes:k,isSearchMode:L,onCopyToClipboard:e.handleCopyToClipboard,onDeselectFile:o,onDragEnter:e.handleDragEnter,onDragStart:e.handleDragStart,onFocusFile:d,onFocusSearchBar:F,onNewFolderCancel:e.handleNewFolderCancel,onNewFolderSubmit:e.handleNewFolderSubmit,onNavigateToFileOrFolder:oe,onOpenFileSharedWithMe:se,onOpenPaper:ie,onOpenKeyboardShortcutModal:we,onPasteFromClipboard:p,onRangeInView:he,onRenameCancel:c,onRenameSubmit:l,onSelectFile:u,onSetDropTarget:e.handleSetDropTarget,onSortChange:B,onStarClick:le,onTilesPerRowChange:e.onTilesPerRowChange,path:q,ref:e.setFilesViewTileGridRef,sections:Te,selectAll:h,selectedFiles:W,selection:G,onSetFileUploaderPath:e.handleSetFileUploaderPath,thumbStore:ve,tilesPerRow:Fe,totalNumItems:J,user:X,viewType:Z,starredState:e.props.starredState,hrefForFile:e.props.hrefForFile}))})}),a.default.createElement(T.InternalDragStatus,{className:"offscreen-drag-icon",files:W.toArray(),ref:this.setInternalDragStatusRef}))},O.defaultProps={dropTargetHighlightMode:d.DropTargetHighlightMode.NONE,enableUnity:!0,fileRename:null,loadingState:d.LoadingState.LOADING_FIRST_PAGE,fileExtensionsConfigs:{}},O.emptySections={sectionLabels:[],sectionStartIndices:[]},O})(a.default.Component);t.FilesViewController=L}),define("modules/clean/react/files_view/culled_table_body",["require","exports","tslib","spectrum/table","react"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var s=(function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(s,e),s.prototype.componentWillMount=function(){this.updateOffsetCache()},s.prototype.componentDidMount=function(){this.updateScroll()},s.prototype.componentWillReceiveProps=function(e){e.listItemHeight!==this.props.listItemHeight&&this.updateOffsetCache(e),e.scrollToRow!==this.props.scrollToRow&&this.updateScroll(e)},s.prototype.updateOffsetCache=function(e){var r=(void 0===e?this.props:e).listItemHeight;this.offsetCache=Array.isArray(r)?t.computeOffsetCache(r):void 0},s.prototype.updateScroll=function(e){var r=void 0===e?this.props:e,o=r.scrollToRow,n=r.listItemHeight,s=r.viewportTopOffset,i=void 0===s?0:s,a=r.scrollPositionOffset,l=void 0===a?0:a;if(void 0!==o&&o>=0){var c=(Array.isArray(n)?this.offsetCache[o]:(o+1)*n)+l,d=Array.isArray(n)?n[o]:n,u=c-d;t.scrollTo([u,c],i)}},s.prototype.render=function(){var e=this.props,t=e.viewportTopOffset,s=(e.scrollToRow,r.__rest(e,["viewportTopOffset","scrollToRow"]));return n.default.createElement(o.CulledTableBody,r.__assign({viewportHeight:window.innerHeight-t},s))},s.defaultProps={viewportTopOffset:0},s})(n.default.PureComponent);t.CulledTableBodyWithScrollToRow=s;var i=function(){return"scrollingElement"in document&&document.scrollingElement?document.scrollingElement.scrollTop:document.documentElement.scrollTop};t.scrollTo=function(e,t){var r=e[0],o=e[1];void 0===t&&(t=0);var n=window.innerHeight-t,s=i(),a=s+n;r<s?window.scrollTo(0,r):o>a&&window.scrollTo(0,o-n)},t.computeOffsetCache=function(e){return e.reduce(function(e,t){return e.push(t+(e[e.length-1]||0)),e},[])}}),define("modules/clean/react/files_view/data/action_creators",["require","exports","tslib","modules/clean/react/files_view/constants","modules/clean/react/files_view/data/selectors","modules/clean/react/files_view/data/types","modules/clean/storage","modules/core/cookies"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.setViewType=function(e){var t=e.user,r=e.viewType;return function(e,a){e({type:s.ActionTypes.SET_VIEW_TYPE,payload:{viewType:r}}),i.UserLocalStorage.set(t.id,o.VIEW_TYPE_STORAGE_KEY,n.viewTypes(a()))}},t.loadViewTypes=function(e){var t=e.user;return function(e,r){var l,c=i.UserLocalStorage.get(t.id,o.VIEW_TYPE_STORAGE_KEY);if(c)e({type:s.ActionTypes.SET_VIEW_TYPES,payload:{viewTypes:c}});else{var d=a.Cookies.read(o.VIEW_TYPE_COOKIE_NAME);a.Cookies.delete(o.VIEW_TYPE_COOKIE_NAME),d&&(e({type:s.ActionTypes.SET_VIEW_TYPES,payload:{viewTypes:(l={},l[o.VIEW_TYPE_GLOBAL_SCOPE]=d,l)}}),i.UserLocalStorage.set(t.id,o.VIEW_TYPE_STORAGE_KEY,n.viewTypes(r())))}}},t.setViewTypeScope=function(e){var t=e.viewTypeScope;return{type:s.ActionTypes.SET_VIEW_TYPE_SCOPE,payload:{viewTypeScope:t}}},t.setViewTypeColumns=function(e){var t=e.columns,a=e.viewType,l=e.user;return function(e,c){var d;i.UserLocalStorage.set(l.id,o.COLUMNS_STORAGE_KEY+"_"+a,t);var u=r.__assign({},n.viewTypeColumns(c()),(d={},d[a]=t,d));e({type:s.ActionTypes.SET_VIEW_TYPE_COLUMNS,payload:{viewTypeColumns:u}})}},t.loadViewTypeColumns=function(e){var t=e.user;return function(e,a){var l=n.viewTypeColumns(a());o.AllViewTypes.forEach(function(e){var n,s=i.UserLocalStorage.get(t.id,o.COLUMNS_STORAGE_KEY+"_"+e);s&&(l=r.__assign({},l,(n={},n[e]=s,n)))}),e({type:s.ActionTypes.SET_VIEW_TYPE_COLUMNS,payload:{viewTypeColumns:l}})}},t.setFileRename=function(e){var t=e.file,r=e.renameState;return{type:s.ActionTypes.SET_FILE_RENAME,payload:{file:t,renameState:r}}}}),define("modules/clean/react/files_view/data/reducer",["require","exports","tslib","modules/clean/react/files_view/constants","modules/clean/react/files_view/data/types","modules/clean/react/files_view/types"],function(e,t,r,o,n,s){"use strict";function i(e,t){var o=t.payload,n=o.file,s=o.renameState;return s?r.__assign({},e,{fileRename:{file:n,state:s}}):r.__assign({},e,{fileRename:null})}function a(e,r){switch(void 0===e&&(e=t.defaultFilesViewState),r.type){case n.ActionTypes.SET_VIEW_TYPE:return u(e,r.payload);case n.ActionTypes.SET_VIEW_TYPES:return p(e,r.payload);case n.ActionTypes.SET_VIEW_TYPE_COLUMNS:return h(e,r.payload);case n.ActionTypes.SET_VIEW_TYPE_SCOPE:return d(e,r.payload);case n.ActionTypes.SET_FILE_RENAME:return i(e,r)}return e}Object.defineProperty(t,"__esModule",{value:!0});var l,c;t.defaultFilesViewState={viewTypes:(l={},l[o.VIEW_TYPE_GLOBAL_SCOPE]=s.ViewType.List,l),viewTypeScope:o.VIEW_TYPE_GLOBAL_SCOPE,viewTypeColumns:(c={},c[s.ViewType.List]=o.LIST_VIEW_COLUMNS,c[s.ViewType.Grid]=o.GRID_VIEW_COLUMNS,c[s.ViewType.LargeGrid]=o.GRID_VIEW_COLUMNS,c),fileRename:null};var d=function(e,t){var o=t.viewTypeScope;return r.__assign({},e,{viewTypeScope:o})},u=function(e,t){var o,n=t.viewType;return r.__assign({},e,{viewTypes:r.__assign({},e.viewTypes,(o={},o[e.viewTypeScope]=n,o))})},p=function(e,t){var o=t.viewTypes;return r.__assign({},e,{viewTypes:r.__assign({},e.viewTypes,o)})},h=function(e,t){var o=t.viewTypeColumns;return r.__assign({},e,{viewTypeColumns:o})};t.filesViewReducer=a}),define("modules/clean/react/files_view/data/selectors",["require","exports","external/reselect","modules/clean/react/files_view/constants","modules/clean/react/files_view/data/reducer","modules/clean/redux/selectors","modules/clean/redux/namespaces"],function(e,t,r,o,n,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return s.getStateAtNamespace(e,i.FILES_VIEW_NAMESPACE_KEY)||n.defaultFilesViewState};t.viewTypes=function(e){return a(e).viewTypes},t.viewTypeScope=function(e){return a(e).viewTypeScope},t.viewTypeColumns=function(e){return a(e).viewTypeColumns},t.viewType=r.createSelector(t.viewTypes,t.viewTypeScope,function(e,t){return t in e?e[t]:t in o.defaultViewTypes?o.defaultViewTypes[t]:e[o.VIEW_TYPE_GLOBAL_SCOPE]}),t.fileRename=function(e){return a(e).fileRename}}),define("modules/clean/react/files_view/data/store",["require","exports","modules/clean/react/files_view/data/reducer","modules/clean/redux/store","modules/clean/redux/namespaces","modules/clean/react/extensions/data/store"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i;t.getStoreForFilesView=function(){var e;return i||(i=o.getStoreAndRegisterReducers((e={},e[n.FILES_VIEW_NAMESPACE_KEY]=r.filesViewReducer,e)),s.getStore()),i}}),define("modules/clean/react/files_view/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.SET_VIEW_TYPE="FILES_VIEW/SET_VIEW_TYPE",e.SET_VIEW_TYPES="FILES_VIEW/SET_VIEW_TYPES",e.SET_VIEW_TYPE_COLUMNS="FILES_VIEW/SET_VIEW_TYPE_COLUMNS",e.SET_VIEW_TYPE_SCOPE="FILES_VIEW/SET_VIEW_TYPE_SCOPE",e.SET_FILE_RENAME="FILES_VIEW/SET_FILE_RENAME"})(t.ActionTypes||(t.ActionTypes={}))}),define("modules/clean/react/files_view/file_actions/api_v2",["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/filepath"],function(e,t,r,o,n){"use strict";function s(e,t,s,i){return r.__awaiter(this,void 0,Promise,function(){var a,l,c,d,u,p,h;return r.__generator(this,function(r){switch(r.label){case 0:a=n.parent_dir(e.fq_path),l=n.normalize(a)+"/"+t,c=new o.UserApiV2Client,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,c.ns("files").rpc("move_v2",{from_path:e.fq_path,to_path:l,allow_shared_folder:!0,autorename:!0,allow_ownership_transfer:!1,fsw_request:i?{".tag":"check"}:void 0},{subjectUserId:s.id})];case 2:return d=r.sent(),[2,{isError:!1,result:d}];case 3:return u=r.sent(),p=void 0,h=void 0,u&&u.error&&u.error[".tag"]?(p=u.error,h=u.summary):(p={".tag":"undefined_error"},h="undefined_error"),[2,{isError:!0,error:p,error_summary:h}];case 4:return[2]}})})}function i(e,t){return r.__awaiter(this,void 0,Promise,function(){var n,s,i,a,l;return r.__generator(this,function(r){switch(r.label){case 0:n=new o.UserApiV2Client,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.ns("files").rpc("undo_batch",{entries:e},{subjectUserId:t.id})];case 2:return s=r.sent(),[2,{isError:!1,result:s}];case 3:return i=r.sent(),a=void 0,l=void 0,i&&i.error&&i.error[".tag"]?(a=i.error,l=i.summary):(a={".tag":"undefined_error"},l="undefined_error"),[2,{isError:!0,error:a,error_summary:l}];case 4:return[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.renameFile=s,t.undo=i}),define("modules/clean/react/files_view/file_actions/file_from_metadata",["require","exports","tslib","modules/clean/react/browse/models"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fileFromMetadata=function(e,t){if("file"===t[".tag"]){var n=t,s=r.__assign({},e,{fq_path:n.path_display||e.fq_path,icon:n.icon+"_32",revision_id:n.rev,file_id:n.id});return new o.File(s)}return"folder"===t[".tag"]?new o.File(r.__assign({},e,{fq_path:t.path_display||e.fq_path})):e}}),define("modules/clean/react/files_view/file_actions/snackbars",["require","exports","modules/clean/react/snackbar","modules/core/i18n"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renameError=function(e,t){var n;n="to"===e[".tag"]&&"malformed_path"===e.to[".tag"]?o._("Name was invalid."):"from_write"===e[".tag"]&&"team_folder"===e.from_write[".tag"]?o._("Team folders can’t be renamed."):"from_lookup"===e[".tag"]&&"not_found"===e.from_lookup[".tag"]?o._("Couldn’t find the file."):o._("Rename failed."),r.Snackbar.fail(n,"browse-rename")}}),define("modules/clean/react/files_view/file_grouper",["require","exports","modules/core/i18n","modules/clean/datetime","modules/clean/react/browse/constants","modules/clean/react/files_view/types","modules/clean/react/browse/models"],function(e,t,r,o,n,s,i){"use strict";function a(e){return e instanceof i.File?i.File.getCategoryDescription(e,!0):n.ExtensionCategories.DOCUMENT}function l(e){return e instanceof i.File?e.is_dir?n.FileTypeCapitalizedCategoryTranslations.FOLDER:i.File.getExtension(e).toUpperCase():d}function c(e,t,n,c){void 0===c&&(c=!1);var h=[],f=[],_=null;if(t===s.SortField.CATEGORY)e.forEach(function(e,t){if(e){var r=a(e);r!==_&&(h.push(r),f.push(t),_=r)}});else if(t===s.SortField.EXTENSION)e.forEach(function(e,t){if(e){var r=l(e);if(r!==_){var o=r;""===r&&(o=d),h.push(o),f.push(t),_=r}}});else if(t===s.SortField.MODIFIED)if(n===s.SortDirection.DESCENDING){var m=o.getTimeBands(Date.now());e.forEach(function(e,t){if(e){var o;if(c&&e instanceof i.File&&e.isDeleted)o=p;else{var n=i.itemTimestampInMs(e);o=n>=m.today?r._("Today"):n>=m.yesterday?r._("Yesterday"):n>=m.thisWeek?r._("This week"):n>=m.lastWeek?r._("Last week"):n>=m.thisMonth?r._("This month"):n>=m.lastMonth?r._("Last month"):n>=m.lastThreeMonths?r._("Three months ago"):r._("Older")}o!==_&&(h.push(o),f.push(t),_=o)}})}else e.forEach(function(e,t){if(e){var r;if(c&&e instanceof i.File&&e.isDeleted)r=p;else if(i.itemTimestampInMs(e)){var n=new Date(i.itemTimestampInMs(e)),s=n.getMonth(),a=n.getFullYear();r=o.month_with_year(s,a)}else r=u;r!==_&&(h.push(r),f.push(t),_=r)}});return{sectionLabels:h,sectionStartIndices:f}}Object.defineProperty(t,"__esModule",{value:!0});var d=r._("Extensionless",{comment:"Label for files without extensions like .txt or .png"}),u=r._("Missing dates",{comment:"label for group of files without dates marking when they are created or modified"}),p=r._("Deleted content isn’t sorted by last modified");t.getSections=c}),
define("modules/clean/react/files_view/file_name_cell",["require","exports","tslib","external/classnames","react","retrieval-components/highlighted-truncated-string","spectrum/dimensions","spectrum/media_table","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filename_highlights","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/models","modules/clean/react/files_view/constants","modules/clean/react/files_view/file_snippets","modules/clean/react/files_view/file_thumbnail","modules/clean/react/files_view/name_input","modules/clean/react/files_view/star","modules/clean/react/files_view/types","modules/clean/react/files_view/util","modules/clean/react/title_bubble","modules/clean/user_education/react/user_education_effect","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importDefault(n),u=r.__importStar(u);var b=function(e){return e instanceof h.FileSharedWithMe},y=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleNameInputSubmit=function(e){r.props.onRenameSubmit&&E.isFile(r.props.file)&&r.props.onRenameSubmit(r.props.file,e)},r.handleNameInputCancel=function(){r.props.onRenameCancel&&E.isFile(r.props.file)&&r.props.onRenameCancel(r.props.file)},r.handleOnClickNameInput=function(e){e.stopPropagation()},r.handleOnClickName=function(e){if(!r.props.isTextSelectable&&!r.props.isSelectMode&&E.shouldHandleClick(e)){if(e.preventDefault(),e.stopPropagation(),b(r.props.file))return void(r.props.onOpenFileSharedWithMe&&r.props.onOpenFileSharedWithMe(r.props.file));r.props.onNavigateToFileOrFolder&&r.props.onNavigateToFileOrFolder(r.props.file)}},r.handleOnClickLocationLink=function(e){var t=r.props,o=t.file,n=t.onLocationLinkClick,s=!E.shouldHandleClick(e);s||(e.preventDefault(),e.stopPropagation()),n&&E.isFile(o)&&n(o,s)},r._setFilenameRef=function(e){return r._filenameDiv=e},r.onStarClick=function(e){var t=r.props,o=t.file,n=t.onStarClick;n&&E.isFile(o)&&n(o,e)},r.state={shouldShowTooltip:r.shouldShowTooltip(t)},r}return r.__extends(t,e),t.prototype.componentDidUpdate=function(e,t){var r=this.shouldShowTooltip(this.props);r!==t.shouldShowTooltip&&this.setState({shouldShowTooltip:r})},t.prototype.componentWillReceiveProps=function(e){var t=this.shouldShowTooltip(e);t!==this.state.shouldShowTooltip&&this.setState({shouldShowTooltip:t})},t.prototype.shouldShowTooltip=function(e){if(b(e.file))return!1;var t=this._filenameDiv,r=u.filename(e.file.fq_path);return!!(e.showTooltip&&t&&(t.offsetWidth<t.scrollWidth||t.textContent!==r))},t.prototype.renderScreenReaderExtraInfo=function(){var e=[],t=this.props,r=t.file,o=t.isSelected;if(E.isFile(r)&&r.isDeleted&&e.push(F._("Deleted")),o&&e.push(F._("Selected")),E.isFile(r)&&r.is_dir&&(r.type===p.FileTypes.SHARED_FOLDER?h.File.isReadOnlySharedFolder(r)?e.push(F._("Read-only shared folder")):e.push(F._("Shared folder")):r.type===p.FileTypes.TEAM_SHARED_FOLDER?h.File.isReadOnlySharedFolder(r)?e.push(F._("Read-only team shared folder")):e.push(F._("Team shared folder")):e.push(F._("Folder"))),e.length>0)return n.default.createElement("span",{className:"ax-visually-hidden"},""+e.join(" "))},t.prototype.splitTruncatedParts=function(e,t){for(var r=0;r<e.length&&e.charAt(r)===t.charAt(r);)++r;return r===e.length||"…"!==e.charAt(r)?[e]:[e.substring(0,r),e.substring(r+1)]},t.prototype.getHighlightedSpan=function(e,t){var r=E.getFilename(t),o=this.splitTruncatedParts(e,r);if(1===o.length)return E.isFile(t)&&!t.highlight_spans?d.highlightMatchReact(e,t.filename_highlights):d.highlightReactFromHighlightSpans(e,t.highlight_spans);var s,i;return E.isFile(t)&&!t.highlight_spans?(s=d.highlightMatchReact(r,t.filename_highlights,0,o[0].length),i=d.highlightMatchReact(r,t.filename_highlights,r.lastIndexOf(o[1]))):(s=d.highlightReactFromHighlightSpans(r,t.highlight_spans,0,o[0].length),i=d.highlightReactFromHighlightSpans(r,t.highlight_spans,r.lastIndexOf(o[1]))),n.default.createElement("span",null,s,"…",i)},t.prototype.getHighlightedSpansForHighlightedTruncatedString=function(e,t){if(E.isFile(t)||b(t)){if(t.highlight_spans)return t.highlight_spans.map(function(e){return{string:e.highlight_str,isHighlighted:e.is_highlighted}});if(t.filename_highlights){return d.highlightMatchSections(e,t.filename_highlights).map(function(e){return{string:e.text,isHighlighted:e.isHighlighted}})}}},t.prototype.renderTitle=function(e){var t=this.props,r=t.file,o=t.renameState,i=t.user,a=t.hrefForFile,l=t.expHighlightedTruncatedString;if(o===v.RenameState.SAVING_INPUT)return n.default.createElement("span",{role:"status"},F._("Renaming…"));var c,d=E.getFilename(r);if(l)c=n.default.createElement(s.HighlightedTruncatedString,{text:d,className:"brws-file-name-element",fontSize:14,availableWidth:e,highlightSpans:this.getHighlightedSpansForHighlightedTruncatedString(d,r),cellBuffer:3});else{var u=this.truncateTextInFilenameCell(d,14,3,e);if(c=this.props.showHighlights&&(r.highlight_spans||E.isFile(r)&&r.filename_highlights)?this.getHighlightedSpan(u,r):n.default.createElement("span",null,u),c=n.default.createElement("div",{className:"brws-file-name-element",ref:this._setFilenameRef},c),this.state.shouldShowTooltip){var p=d.length<=f.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?d:n.default.createElement("div",{className:"brws-file-name-cell-tooltip"},d);c=n.default.createElement(w.TitleBubble,{content:p,position:w.TitleBubble.POSITIONS.BOTTOM,className:"list-label__title-bubble"},c)}}if(E.isFile(r)&&a&&!(r.is_unmounted||r.isDeleted)||b(r)){var h=b(r)?r.href:a(i,r);c=n.default.createElement("a",{className:"brws-file-name-cell-filename",href:h,onClick:this.handleOnClickName},c)}return this.props.showUserEducationEffects?n.default.createElement(T.UserEducationEffect,{containerName:"FileItemRow",name:this.props.userEducationEffectName||"FileNameLabel",useSpan:!0},c):c},t.prototype.renderSubtitle=function(e){var t=this.props,r=t.file,o=t.isSelectMode,s=t.renameState,i=t.renderLocationAsLink,a=t.showLocation,c=t.user;if(!E.isFile(r))return F._("Shared with you",{comment:"A subtitle noting that a search result is a file that is shared with the user (Specifically it is unmounted, meaning it is not located in their Dropbox folder hierarchy)"});if(s||!a)return null;var d=u.parent_dir(r.fq_path),p="/"===d?l.get_browse_root_name(c):d.slice(1);if(r.is_unmounted)return F._("not added yet, in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:p});var h=F._("in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:p}),f=this.truncateTextInFilenameCell(h,12,6,e);if(!i||o||r.isDeleted)return f;var _=l.browse_uri_for_fq_path(c,d);return n.default.createElement("a",{className:"brws-file-name-cell-location",href:_.toString(),onClick:this.handleOnClickLocationLink},f)},t.prototype.truncateTextInFilenameCell=function(e,t,r,o){if(o&&o>32){var n=(o-32)/t,s=Math.max(r,n-r);return c.Emstring.em_snippet(e,Math.floor(s),.5)}return e},t.prototype.renderContent=function(e){var t,r=this.props,o=r.file,s=r.renameState,i=r.showSnippets;if(E.isFile(o)&&s===v.RenameState.PENDING_INPUT){var l=o.is_dir?F._("Rename directory…"):F._("Rename file…");t=n.default.createElement(S.NameInput,{defaultValue:u.filename(o.fq_path),label:l,onClick:this.handleOnClickNameInput,onSubmit:this.handleNameInputSubmit,onCancel:this.handleNameInputCancel,isDir:o.is_dir})}else t=[n.default.createElement(a.MediaCellText,{key:"title",highlight:this.props.isHovered},n.default.createElement("div",{className:"brws-file-name-cell-title-container"},this.renderTitle(e),this.renderScreenReaderExtraInfo(),this.renderStar())),n.default.createElement(a.MediaCellText,{highlight:this.props.isHovered,key:"subtitle",variant:"subtitle"},this.renderSubtitle(e))],i&&t.push(n.default.createElement(a.MediaCellText,{highlight:this.props.isHovered,key:"snippets",variant:"subtitle"},n.default.createElement(_.FileSnippets,{snippets:o.snippets})));return t},t.prototype.renderStar=function(){var e=this.props,t=e.file,r=e.renameState,o=e.user,s=e.showStar,i=e.isSelectMode,a=e.isTabbing,l=e.responsive,c=l&&!l.isMatchedMedium&&!l.isMatchedLarge;return s&&!r?n.default.createElement(g.StarContainer,{item:t,user:o,className:"brws-file-name-cell-star",onStarClick:this.onStarClick,isReadOnly:i||c,isTabbing:a}):null},t.prototype.render=function(){var e=this,t=this.props,s=t.mediaActions,l=t.file,c=t.thumbStore,d=t.showCDMUserEducationEffects,u=t.showImageThumbnailOnly,p=t.expHighlightedTruncatedString,h=t.fileNameCellWidth,f=t.height,_=o.default("brws-file-name-cell-text","brws-vertically-center",{"brws-file-name-cell-text-rename":!!this.props.renameState}),S=n.default.createElement(m.FileThumbnail,{file:l,thumbStore:c,showCDMUserEducationEffects:d,showImageThumbnailOnly:!!u}),g={icon:S,style:{minHeight:f-1}};return this.props.shouldTruncateMiddleFilename?b(l)&&p&&h?n.default.createElement(a.MediaCell,r.__assign({},g),n.default.createElement("div",{className:"brws-file-name-container"},n.default.createElement("div",{className:_},this.renderContent(h))),s):n.default.createElement(a.MediaCell,r.__assign({},g),n.default.createElement(i.Dimensions,{className:"brws-file-name-container"},function(t){var r=t.width;return n.default.createElement("div",{className:"brws-file-name-container"},n.default.createElement("div",{className:_},e.renderContent(r)))}),s):n.default.createElement(a.MediaCell,r.__assign({},g),n.default.createElement("div",{className:_},this.renderContent()),s)},t.defaultProps={renderLocationAsLink:!0},t})(n.default.Component);t.FileNameCell=y}),define("modules/clean/react/files_view/file_row",["require","exports","tslib","external/classnames","spectrum/button","spectrum/icon_table","spectrum/checkbox","spectrum/media_table","react","external/react-dom","modules/clean/react/files_view/file_name_cell","modules/clean/react/files_view/overflow_menu","modules/clean/react/files_view/types","modules/clean/react/files_view/share_button","modules/clean/react/files_view/util","modules/clean/react/browse/models","modules/clean/user_education/react/user_education_effect","modules/core/i18n","modules/clean/react/title_bubble","modules/core/browser","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/extensions/client","modules/core/exception","modules/clean/cloud_docs/constants","modules/clean/filepath","modules/clean/react/extensions/split_share_button","modules/clean/react/extensions/utils"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C){"use strict";function I(e){switch(b.split_filename(e.fq_path).ext){case F.PaperFileTypes.PAPER:case F.PaperFileTypes.PAPER_TEMPLATE:return!0;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),l=r.__importDefault(l),c=r.__importStar(c),v=r.__importStar(v),T=r.__importStar(T),b=r.__importStar(b);var R=function(){return l.default.createElement("span",{"aria-hidden":!0},"--")},O=function(e){var t=e.isVisible,r=e.onClick;return l.default.createElement(n.Button,{className:"brws-file-row-view-file-button","aria-label":S._("View File"),onClick:r,tabIndex:t?void 0:-1,variant:t?"secondary":"invisible"},l.default.createElement(s.IconTable,{name:"view"}))},P=function(){return l.default.createElement("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",version:"1.1"},l.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},l.default.createElement("g",{id:"Group",transform:"translate(2.000000, 2.000000)"},l.default.createElement("circle",{id:"Oval-65",cx:"8",cy:"8",r:"8"}),l.default.createElement("path",{d:"M8,13 L8,14.5 L5.5,12.5 L8,10.5 L8,12 C10.209139,12 12,10.209139 12,8 C12,6.93104698 11.5806921,5.96002857 10.8975817,5.24245012 L11.4674192,4.39763124 C12.4121861,5.30722218 13,6.58496544 13,8 C13,10.7614237 10.7614237,13 8,13 Z M8,3 L8,1.5 L10.5,3.5 L8,5.5 L8,4 C5.790861,4 4,5.790861 4,8 C4,8.96511539 4.34180174,9.8503987 4.91095749,10.5414022 L4.33270318,11.3986995 C3.5056268,10.5066799 3,9.3123877 3,8 C3,5.23857625 5.23857625,3 8,3 Z",id:"Oval-67",fill:"#637282"}))))},D=function(){return l.default.createElement("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",version:"1.1"},l.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},l.default.createElement("g",{id:"icon-warning",fill:"#637282"},l.default.createElement("path",{d:"M13.9298189,16.125 C16.4624689,16.125 17.5138484,14.3377448 16.2785476,12.1337797 L12.238298,4.92535765 C11.002815,2.72106753 8.99951926,2.72139251 7.76421846,4.92535765 L3.7239688,12.1337797 C2.48848585,14.3380698 3.54098311,16.125 6.07269759,16.125 L13.9298189,16.125 Z M11.002944,14.0995516 L8.99957244,14.0995516 L8.99957244,12.0741033 L11.002944,12.0741033 L11.002944,14.0995516 L11.002944,14.0995516 Z M11.002944,11.0613791 L8.99957244,11.0613791 L8.99957244,7.01048239 L11.002944,7.01048239 L11.002944,11.0613791 L11.002944,11.0613791 Z",id:"Shape"}))))},A=function(){return l.default.createElement("div",{className:"error-tooltip"},l.default.createElement("div",{className:"error-tooltip__title"},S._("This folder is too large")),S._("We can’t calculate the full size of this folder right now. This can happen when there are a large number of files inside of the folder or if the request takes too long."))};t.isCloudDocProviderStored=I;var N=function(e){var t=e.file;if(!t.is_dir)return t.is_cloud_doc&&I(t)?l.default.createElement(R,null):l.default.createElement("span",null,t.size);switch(t.fetchFolderSizesStatus){case p.FetchFolderSizeState.LOADING:return l.default.createElement("span",{className:"item-cell-title item-cell-title--loading"},l.default.createElement("span",{className:"ax-visually-hidden"},S._("Calculating folder sizes...")),l.default.createElement(P,null),S._("Calculating..."));case p.FetchFolderSizeState.ERROR:return l.default.createElement("span",{className:"item-cell-title"},l.default.createElement(g.TitleBubble,{content:l.default.createElement(A,null),position:g.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!1},l.default.createElement("span",{className:"item-cell-title item-cell-title--error"},l.default.createElement("span",{className:"ax-visually-hidden"},S._("Error in calculating folder sizes")),l.default.createElement(D,null))));case p.FetchFolderSizeState.COMPLETE:return l.default.createElement("span",{className:"item-cell-title"},t.size);default:return l.default.createElement(R,null)}},L=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isActionDropdownOpen:!1},t.checkboxRef=null,t.handleClick=function(e){if(e.defaultPrevented||t.isCheckboxNode(e.target))return void e.preventDefault();if(t.props.isSelectMode&&t.props.onDeselect&&t.props.onSelect){e.preventDefault();var r=t.props.file.fq_path;return void(t.props.isSelected?t.props.onDeselect(r,e.shiftKey):t.props.onSelect(r,e.shiftKey))}t.handleOpenNewTabOrNavigate(e)},t.isCheckboxNode=function(e){var r=t.getCheckboxNode();return!!r&&r.contains(e)},t.handleOpenNewTabOrNavigate=function(e){if(0===e.button){if(e.preventDefault(),e.stopPropagation(),f.hasModifierKey(e)){var r=t.props,o=r.file,n=r.user,s=r.hrefForFile;return void v.open_tab(s(n,o))}t.props.onNavigateToFileOrFolder(t.props.file)}},t.handleChangeCheckbox=function(e,r){if(t.props.onSelect&&t.props.onDeselect){var o=t.props.file.fq_path;"checked"===e?t.props.onSelect(o,r.shiftKey):t.props.onDeselect(o,r.shiftKey)}},t.handleCheckboxTouchTargetClick=function(e){if(t.isCheckboxNode(e.target))return void e.preventDefault();if(!t.props.isCheckboxDisabled&&t.props.onDeselect&&t.props.onSelect){e.preventDefault();var r=t.props.file.fq_path;t.props.isSelected?t.props.onDeselect(r,e.shiftKey):t.props.onSelect(r,e.shiftKey)}},t.handleDragEnter=function(e){var r=t.props,o=r.file,n=r.isSelected,s=r.isActiveDropTarget;t.props.onDragEnter(e,o,!!n,!!s)},t.handleDragStart=function(e){var r=t.props,o=r.file,n=r.isSelected,s=r.onDragStart,i=r.onSelect;s&&(n?s(e):(i&&i(o.fq_path),s(e,[o])))},t.setCheckboxRef=function(e){t.checkboxRef=e},t.getCheckboxNode=function(){return t.checkboxRef&&c.findDOMNode(t.checkboxRef)},t.onActionDropdownOpen=function(){t.setState({isActionDropdownOpen:!0})},t.onActionDropdownClose=function(){t.setState({isActionDropdownOpen:!1})},t.showShare=function(){t.props.onShowShare(t.props.file,"BROWSE_FILE_ROW")},t.presentInZoom=function(){t.props.onPresentInZoom&&t.props.onPresentInZoom(t.props.file)},t.rowChildFn=function(e){var r,n=e.isHovered,s=t.props,c=s.isCompactMode,d=s.isPinned,u=s.isSelectMode,p=s.isSelected,h=s.showUserEducationEffects,f=s.isTabbing,_=s.visibleColumns;if(!d){var g=!(f||n||p||u||c);r=l.default.createElement(i.Checkbox,{disabled:t.props.isCheckboxDisabled,checked:p?"checked":"unchecked",className:o.default("brws-checkbox",{"brws-checkbox-checked":p}),onChange:t.handleChangeCheckbox,ref:t.setCheckboxRef,variant:g?"invisible":"default",ariaLabel:S._("Select item")}),h&&(r=l.default.createElement(m.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox",useSpan:!0},r))}return[l.default.createElement(a.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},l.default.createElement("div",{className:"brws-vertically-center brws-file-row-checkbox-target",onClick:t.handleCheckboxTouchTargetClick},r))].concat(_.map(function(e,r){return t.renderCell({isHovered:n,isLastCell:r===_.length-1,sortField:e.sortField,renderCell:e.renderCell})}))},t}return r.__extends(t,e),t.prototype.componentDidUpdate=function(e){var t=this;(this.props.isFocused&&!e.isFocused||this.props.isFocused&&this.props.isSelected&&!e.isSelected)&&this.checkboxRef&&Promise.resolve().then(function(){var e=t.getCheckboxNode();e&&e.focus()})},t.prototype.renderMediaActions=function(e){var t=this.props,o=t.extensionsConfig,n=t.file,s=t.isCompactMode,i=t.isSelected,c=t.isSelectMode,d=t.isSearchMode,p=t.isSharingDisabled,f=t.isTabbing,_=t.getOverflowMenuActions,m=t.canDisplayFolderSizes,S=t.arePostTTIModulesLoaded,g=t.onShowShare,v=t.shareButtonLabel,T=t.showShareButton,F=t.thumbStore,b=t.user,I=t.hasResponsiveOverflowMenu,R={file:n,onShowShare:g,shareButtonLabel:v,showShareButton:T},P=d?"search":"browse";return c?l.default.createElement(a.MediaActions,null,!p&&!C.shouldShowSplitShare(o,n)&&l.default.createElement(h.ShareButton,r.__assign({},R,{isVisible:!s&&(i||e),isSearchMode:this.props.isSearchMode,useSearchSuccessBanner:this.props.useSearchSuccessBanner})),!p&&C.shouldShowSplitShare(o,n)&&l.default.createElement(y.SplitShareButton,r.__assign({},R,{user:b,file:n,onShowShare:this.showShare,isVisible:!s&&(i||e),onDropdownOpen:this.onActionDropdownOpen,onDropdownClose:this.onActionDropdownClose,onPresentInZoom:this.presentInZoom,context:{surface:P},variant:"secondary"})),s||!e&&!i||this.props.extensionsConfig.displayState!==w.DisplayState.ENABLED?null:l.default.createElement(E.ExtensionsMenu,{user:this.props.user,file:this.props.file,onDropdownOpen:this.onActionDropdownOpen,onDropdownClose:this.onActionDropdownClose,onPresentInZoom:this.presentInZoom,telemetryContext:{surface:P}}),l.default.createElement(O,{isVisible:i||s||e,onClick:this.handleOpenNewTabOrNavigate})):l.default.createElement(a.MediaActions,null,!p&&!C.shouldShowSplitShare(o,n)&&l.default.createElement(h.ShareButton,r.__assign({},R,{isVisible:f||e&&!s||this.state.isActionDropdownOpen,isSearchMode:this.props.isSearchMode,useSearchSuccessBanner:this.props.useSearchSuccessBanner})),!p&&C.shouldShowSplitShare(o,n)&&l.default.createElement(y.SplitShareButton,r.__assign({},R,{onShowShare:this.showShare,isVisible:f||e&&!s||this.state.isActionDropdownOpen,user:b,file:n,onDropdownOpen:this.onActionDropdownOpen,onDropdownClose:this.onActionDropdownClose,onPresentInZoom:this.presentInZoom,context:{surface:P},variant:"secondary"})),(f||e&&!s||this.state.isActionDropdownOpen)&&this.props.extensionsConfig.displayState===w.DisplayState.ENABLED?l.default.createElement(E.ExtensionsMenu,{user:this.props.user,file:this.props.file,onDropdownOpen:this.onActionDropdownOpen,onDropdownClose:this.onActionDropdownClose,onPresentInZoom:this.presentInZoom,telemetryContext:{surface:P}}):null,S&&l.default.createElement(u.FilesViewOverflowMenu,{file:n,thumbStore:F,getOverflowMenuActions:_,showBorders:f||e,canDisplayFolderSizes:m,viewportTopOffset:this.props.viewportTopOffset,isResponsive:!!I}))},t.prototype.renderModifiedCell=function(e,t){var r=e.is_dir&&!this.props.isSearchMode?void 0:e.ago,o=e.last_modified_name||void 0,n=o&&S._("by %(modified_by)s",{comment:"name of the person that modified the file"}).format({modified_by:o});return l.default.createElement(a.MediaCell,{className:"brws-file-modified-at-cell",key:"modifiedAt",subtitle:n,title:r||l.default.createElement(R,null)},t)},t.prototype.renderCell=function(e){var t=e.isHovered,r=e.isLastCell,o=e.sortField,n=e.renderCell,s=this.props,i=s.file,c=s.user,u=s.isCompactMode,h=s.isSearchMode,f=s.isSelectMode,m=s.isTabbing,S=s.arePostTTIModulesLoaded,g=s.renameState,v=s.showCDMUserEducationEffects,E=s.showUserEducationEffects,w=s.userEducationEffectName,F=s.onLocationLinkClick,b=s.onNavigateToFileOrFolder,y=s.onRenameCancel,C=s.onRenameSubmit,I=s.onStarClick,O=s.thumbStore,P=s.hrefForFile,D=s.responsive,A=s.showImageThumbnailOnly,L=s.expHighlightedTruncatedString,x=s.showSnippets,M=s.height,k=r&&!(u&&g),U=k?this.renderMediaActions(t):void 0;if(n)return n({file:i,mediaActions:U});switch(o){case p.SortField.FILENAME:return l.default.createElement(d.FileNameCell,{key:"fileName",user:c,file:i,isHovered:t,isSelectMode:f,isTabbing:m,mediaActions:U,onNavigateToFileOrFolder:b,onLocationLinkClick:F,onRenameCancel:y,onRenameSubmit:C,renameState:g,responsive:D,showCDMUserEducationEffects:v,showTooltip:S,showHighlights:h,showLocation:h,showUserEducationEffects:E,userEducationEffectName:w,showStar:S&&!_.File.isNoAccessSharedFolder(i),onStarClick:I,thumbStore:O,shouldTruncateMiddleFilename:S,hrefForFile:P,showImageThumbnailOnly:A,expHighlightedTruncatedString:L,showSnippets:x,height:M});case p.SortField.RELEVANCE:case p.SortField.MODIFIED:return this.renderModifiedCell(i,U);case p.SortField.SHARED_WITH:return l.default.createElement(a.MediaCell,{className:"brws-file-shared-with-cell",key:"sharedWith"},this.props.renderSharedWithController(i),U);case p.SortField.CATEGORY:return l.default.createElement(a.MediaCell,{className:"brws-file-category-cell",key:"category",title:_.File.getCategoryDescription(i)},U);case p.SortField.EXTENSION:return l.default.createElement(a.MediaCell,{className:"brws-file-extension-cell",key:"extension",title:_.File.getExtension(i)},U);case p.SortField.SIZE:return l.default.createElement(a.MediaCell,{className:"brws-file-size-cell",key:"size",title:l.default.createElement(N,{file:i})},U);default:return T.reportException({err:new Error("renderCell function for "+o+"is not implemented"),severity:T.SEVERITY.NONCRITICAL,tags:["js:browse"]}),l.default.createElement(R,null)}},t.prototype.render=function(){var e=this.props,t=e.file,n=e.isActiveDropTarget,s=e.isAvailableDropTarget,i=e.isPinned,c=e.isSearchMode,d=e.isSelected,u=e.renameState,p=e.rowIndex,h=e.tabIndex,f=e.topOffset,m=o.default("brws-file-row",{"brws-file-row-selected":d,"brws-file-row-deleted":t.isDeleted,"brws-file-row-droppable":s&&!n,"brws-file-row-dragover":n,"brws-file-row-no-access":_.File.isNoAccessSharedFolder(t),"brws-file-row-pinned":i}),S=n?"dragover":s&&!n?"droppable":d?"selected":"default",g=!(u||c||_.File.isTeamMemberFolder(t)||_.File.isReadOnlySharedFolder(t)||_.File.isNoAccessSharedFolder(t)),v={"aria-rowindex":void 0!==p?p+1:void 0,className:m,"data-filename":t.fq_path.split("/").slice(-1),"aria-label":b.filename(t.fq_path),onClick:this.handleClick,onDragEnter:this.handleDragEnter,tabIndex:h,variant:S};return i?l.default.createElement(a.MediaRow,r.__assign({},v),this.rowChildFn):l.default.createElement(a.CulledMediaRow,r.__assign({},v,{draggable:g,topOffset:f,onDragStart:this.handleDragStart}),this.rowChildFn)},t.defaultProps={isSelectionEmpty:!0,topOffset:0,extensionsConfig:w.emptyExtensionsConfig()},t})(l.default.PureComponent);t.FileRow=L}),define("modules/clean/react/files_view/file_shared_with_me_row",["require","exports","tslib","external/classnames","external/react-dom","react","spectrum/media_table","spectrum/util/raf_throttle","spectrum/checkbox","modules/clean/react/files_view/file_name_cell","modules/clean/react/files_view/types","modules/clean/user_education/react/user_education_effect","modules/core/exception","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n),s=r.__importDefault(s),p=r.__importStar(p);var f=function(){return s.default.createElement("span",{"aria-hidden":!0},"--")},_=(function(e){function t(t){var r=e.call(this,t)||this;return r.setRef=function(e){r.brwsFilenameContainerDiv=e},r.checkboxRef=null,r.handleWindowResize=function(){r.throttledWindowResize.request()},r.handleResize=function(){if(r.brwsFilenameContainerDiv){var e=r.state.brwsFilenameContainerDivWidth,t=r.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&r.setState({brwsFilenameContainerDivWidth:t})}},r.handleClick=function(e){if(e.defaultPrevented||r.isCheckboxNode(e.target))return void e.preventDefault();if(r.props.isSelectMode&&r.props.onDeselect&&r.props.onSelect){e.preventDefault();var t=r.props.file.file_id;return void(r.props.isSelected?r.props.onDeselect(t,e.shiftKey):r.props.onSelect(t,e.shiftKey))}r.handleOpenNewTabOrNavigate(e)},r.handleOpenNewTabOrNavigate=function(e){},r.getCheckboxNode=function(){return r.checkboxRef&&n.findDOMNode(r.checkboxRef)},r.isCheckboxNode=function(e){var t=r.getCheckboxNode();return!!t&&t.contains(e)},r.handleChangeCheckbox=function(e,t){if(r.props.onSelect&&r.props.onDeselect){var o=r.props.file.file_id;"checked"===e?r.props.onSelect(o,t.shiftKey):r.props.onDeselect(o,t.shiftKey)}},r.setCheckboxRef=function(e){r.checkboxRef=e},r.handleCheckboxTouchTargetClick=function(e){if(r.isCheckboxNode(e.target))return void e.preventDefault();if(!r.props.isCheckboxDisabled&&r.props.onDeselect&&r.props.onSelect){e.preventDefault();var t=r.props.file.file_id;r.props.isSelected?r.props.onDeselect(t,e.shiftKey):r.props.onSelect(t,e.shiftKey)}},r.rowChildFn=function(e){var t,n=e.isHovered,a=r.props,c=a.isCompactMode,d=a.isSelectMode,p=a.isSelected,f=a.showUserEducationEffects,_=a.isTabbing,m=a.visibleColumns,S=!(_||n||p||d||c);return t=s.default.createElement(l.Checkbox,{disabled:r.props.isCheckboxDisabled,checked:p?"checked":"unchecked",className:o.default("brws-checkbox",{"brws-checkbox-checked":p}),onChange:r.handleChangeCheckbox,ref:r.setCheckboxRef,variant:S?"invisible":"default",ariaLabel:h._("Select item")}),f&&(t=s.default.createElement(u.UserEducationEffect,{containerName:"FileSharedWithMeRow",name:"FirstFileSelectCheckbox",useSpan:!0},t)),[s.default.createElement(i.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},s.default.createElement("div",{className:"brws-vertically-center brws-file-row-checkbox-target",onClick:r.handleCheckboxTouchTargetClick},t))].concat(m.map(function(e){return r.renderCell({isHovered:n,sortField:e.sortField})}))},r.state={brwsFilenameContainerDivWidth:void 0},r.throttledWindowResize=new a.RafThrottle(function(){return r.handleResize()}),r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.handleResize(),window.addEventListener("resize",this.handleWindowResize)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.handleWindowResize)},t.prototype.componentDidUpdate=function(e){var t=this;(this.props.isFocused&&!e.isFocused||this.props.isFocused&&this.props.isSelected&&!e.isSelected)&&this.checkboxRef&&Promise.resolve().then(function(){var e=t.getCheckboxNode();e&&e.focus()})},t.prototype.renderCell=function(e){var t=e.isHovered,r=e.sortField,o=this.props,n=o.arePostTTIModulesLoaded,a=o.file,l=o.onOpenFileSharedWithMe,u=o.thumbStore,_=o.responsive,m=o.user,S=o.expHighlightedTruncatedString,g=o.showSnippets,v=o.height;switch(r){case d.SortField.FILENAME:if(S){var E=this.state.brwsFilenameContainerDivWidth;return s.default.createElement("div",{className:"brws-file-name-container",ref:this.setRef},s.default.createElement(c.FileNameCell,{key:"fileName",file:a,isHovered:t,onOpenFileSharedWithMe:l,responsive:_,shouldTruncateMiddleFilename:n,showHighlights:!0,showLocation:!0,showStar:!1,thumbStore:u,user:m,expHighlightedTruncatedString:S,fileNameCellWidth:E?E-64:void 0,showSnippets:g,height:v}))}return s.default.createElement(c.FileNameCell,{key:"fileName",file:a,isHovered:t,onOpenFileSharedWithMe:l,responsive:_,shouldTruncateMiddleFilename:n,showHighlights:!0,showLocation:!0,showStar:!1,thumbStore:u,user:m,showSnippets:g,height:v});case d.SortField.RELEVANCE:case d.SortField.MODIFIED:var w=a.ago,T=a.last_modified_name||void 0,F=T&&h._("by %(modified_by)s",{comment:"name of the person that modified the file"}).format({modified_by:T});return s.default.createElement(i.MediaCell,{className:"brws-file-modified-at-cell",key:"modifiedAt",subtitle:F,title:w||s.default.createElement(f,null)});case d.SortField.SIZE:return s.default.createElement(i.MediaCell,{className:"brws-file-size-cell",key:"size",title:a.size});default:case d.SortField.CATEGORY:case d.SortField.EXTENSION:case d.SortField.SHARED_WITH:return p.reportException({err:new Error("FileSharedWithMe.renderCell is not implemented for "+r),severity:p.SEVERITY.NONCRITICAL,tags:["js:search"]}),s.default.createElement(i.MediaCell,{key:r,title:s.default.createElement(f,null)})}},t.prototype.render=function(){var e=this.props,t=e.rowIndex,r=e.topOffset;return s.default.createElement(i.CulledMediaRow,{"aria-rowindex":void 0!==t?t+1:void 0,className:"brws-filesharedwithme-row",draggable:!1,onClick:this.handleClick,topOffset:r,variant:"default"},this.rowChildFn)},t})(s.default.PureComponent);t.FileSharedWithMeRow=_}),define("modules/clean/react/files_view/file_snippets",["require","exports","tslib","react","modules/clean/filename_highlights"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n);var s=(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(n,e),n.prototype.render=function(){var e=this.props.snippets;return o.default.createElement("span",{className:"brws-file-snippets"},e.map(function(e,r){return o.default.createElement(t.FileSnippet,{key:[r].concat(e.highlight_spans).join(),snippet:e})}))},n})(o.default.PureComponent);t.FileSnippets=s,t.FileSnippet=function(e){var t=e.snippet;return n.highlightReactFromAllHighlightSpans(t.highlight_spans)}}),define("modules/clean/react/files_view/fixed_table_head",["require","exports","tslib","spectrum/vertically_fixed","spectrum/table","react"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.FixedTableHead=function(e){var t=e.children,i=e.offsetHeight,a=e.style,l=void 0===a?{}:a,c=r.__rest(e,["children","offsetHeight","style"]),d=void 0===i?l:r.__assign({flexBasis:i},l);return s.default.createElement("thead",r.__assign({className:"mc-table-head mc-table-head-fixed brws-column-header",style:d},c),s.default.createElement(o.VerticallyFixed,{tag:function(e){var o=e.style;return s.default.createElement(n.TableRow,{className:"mc-table-head-row mc-table-head-row-fixed",style:r.__assign({height:i},o),role:"presentation"},t)}}))}}),define("modules/clean/react/files_view/internal_drag_status",["require","exports","tslib","external/classnames","react","modules/clean/react/icon/file_folder_icon"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importDefault(n);var i=(function(e){function t(){
return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,r=e.files,i=o.default("active",t);return n.default.createElement("div",{id:"drag-status",className:i},n.default.createElement("div",{id:"drag-selection-status"},r.slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?n.default.createElement("img",{key:t,src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):n.default.createElement(s.FileOrFolderIcon,{key:t,file:e,className:"icon icon"+t})}),n.default.createElement("span",{className:"badge"},r.length)))},t})(n.default.PureComponent);t.InternalDragStatus=i}),define("modules/clean/react/files_view/list",["require","exports","tslib","react","modules/clean/react/browse/models","modules/clean/react/extensions/client","modules/clean/react/files_view/culled_table_body","modules/clean/react/files_view/drag_and_drop","modules/clean/react/files_view/file_row","modules/clean/react/files_view/file_shared_with_me_row","modules/clean/react/files_view/keyboard_shortcuts","modules/clean/react/files_view/new_folder_row","modules/clean/react/files_view/paper_row","modules/clean/react/files_view/selectors","modules/clean/react/files_view/types","modules/clean/react/files_view/user_defined_item_row"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var m=function(){},S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrollToRow:0},t.handleFileViewerUnmount=function(){var e=t.props.selectedFiles.first();e&&t.props.onFocusFile(e.fq_path)},t.getIsListEvent=function(e){return t.props.isSelectableListEvent()&&(!(e.target instanceof Element)||"BUTTON"!==e.target.tagName)},t.getSelectedFiles=function(){return t.props.selectedFiles},t.handleNavigateToFileOrFolder=function(e){t.props.onNavigateToFileOrFolder(e,t.handleFileViewerUnmount)},t.getActiveDropTarget=function(){return t.props.activeDropTarget},t.getIsDraggingInternalFiles=function(){return!!t.props.isDraggingInternalFiles},t.getIsDraggingExternalFiles=function(){return!!t.props.isDraggingExternalFiles},t.renderRow=function(e,r,i){if("NewFolderRow"===e.type)return o.default.createElement(u.NewFolderRow,{createNewFolderState:e.props.createNewFolderState,isInsideMyTeamFolderTree:e.props.isInsideMyTeamFolderTree,onCancel:t.props.onNewFolderCancel,onSubmit:t.props.onNewFolderSubmit,rowIndex:r,topOffset:i});if("PaperRow"===e.type)return o.default.createElement(p.PaperRow,{paper:e.props.paper,rowIndex:r,topOffset:i,user:t.props.user,visibleColumns:e.props.visibleColumns,onOpenPaper:t.props.onOpenPaper,arePostTTIModulesLoaded:e.props.arePostTTIModulesLoaded,expHighlightedTruncatedString:t.props.expHighlightedTruncatedString,showSnippets:e.props.showSnippets,height:e.props.height});if("UserDefinedItemRow"===e.type)return o.default.createElement(_.UserDefinedItemRow,{userDefinedItem:e.props.userDefinedItem,rowIndex:r,topOffset:i});if("FileSharedWithMeRow"===e.type)return o.default.createElement(c.FileSharedWithMeRow,{arePostTTIModulesLoaded:t.props.arePostTTIModulesLoaded,file:e.props.file,visibleColumns:e.props.visibleColumns,onOpenFileSharedWithMe:t.props.onOpenFileSharedWithMe,rowIndex:r,topOffset:i,thumbStore:t.props.thumbStore,user:t.props.user,responsive:t.props.responsive,expHighlightedTruncatedString:t.props.expHighlightedTruncatedString,showSnippets:e.props.showSnippets,height:e.props.height,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,onSelect:t.props.onSelectFile,onDeselect:t.props.onDeselectFile,isFocused:e.props.isFocused});var a=t.props.selection,d=e.props.file,h=a.selected.last()===e.props.file.fq_path||!a.selected.size&&0===r?0:void 0,f=0===r||t.props.user.is_cdm_member&&(2===r||1===r),m=e.props.extensionsConfig;return m||(m=s.emptyExtensionsConfig()),o.default.createElement(l.FileRow,{extensionsConfig:m,context:t.props.context,file:d,getOverflowMenuActions:t.props.getOverflowMenuActions,isActiveDropTarget:e.props.isActiveDropTarget,isCheckboxDisabled:e.props.isCheckboxDisabled,isAvailableDropTarget:e.props.isAvailableDropTarget,isCompactMode:e.props.isCompactMode,isFocused:e.props.isFocused,isSearchMode:e.props.isSearchMode,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,arePostTTIModulesLoaded:e.props.arePostTTIModulesLoaded,isSharingDisabled:e.props.isSharingDisabled,isTabbing:e.props.isTabbing,key:d.fq_path,onDeselect:t.props.onDeselectFile,onDragStart:t.props.onDragStart,onDragEnter:t.props.onDragEnter,onLocationLinkClick:t.props.onLocationLinkClick,onNavigateToFileOrFolder:t.handleNavigateToFileOrFolder,onRenameCancel:t.props.onRenameCancel,onRenameSubmit:t.props.onRenameSubmit,onSelect:t.props.onSelectFile,onStarClick:t.props.onStarClick,renameState:e.props.renameState,responsive:t.props.responsive,rowIndex:r,showUserEducationEffects:f,userEducationEffectName:f?"FileNameLabel-"+r:void 0,showCDMUserEducationEffects:n.File.isTeamMemberFolder(d),tabIndex:h,topOffset:i,user:t.props.user,visibleColumns:t.props.visibleColumns,canDisplayFolderSizes:t.props.canDisplayFolderSizes,thumbStore:t.props.thumbStore,renderSharedWithController:t.props.renderSharedWithController,hrefForFile:t.props.hrefForFile,onShowShare:t.props.onShowShare,onPresentInZoom:t.props.onPresentInZoom,shareButtonLabel:t.props.shareButtonLabel,showShareButton:t.props.showShareButton,viewportTopOffset:t.props.viewportTopOffset,useSearchSuccessBanner:t.props.useSearchSuccessBanner,showImageThumbnailOnly:t.props.showImageThumbnailOnly,expHighlightedTruncatedString:t.props.expHighlightedTruncatedString,hasResponsiveOverflowMenu:t.props.hasResponsiveOverflowMenu,showSnippets:e.props.showSnippets,height:e.props.height})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.onTTI;e&&e(),this.setupKeyboardShortcuts(),this.setupExternalDragHandler(),this.props.selectedFiles.size&&!this.props.isFileViewerShown()&&this.setState({scrollToRow:this.getRowIndexForFile(this.props.selectedFiles.first())})},t.prototype.componentWillReceiveProps=function(e){this.props.scrollToRow!==e.scrollToRow&&this.setState({scrollToRow:e.scrollToRow})},t.prototype.componentDidUpdate=function(e){e.createNewFolderState===this.props.createNewFolderState||"PENDING_INPUT"!==this.props.createNewFolderState||this.props.isFileViewerShown()||this.setState(function(e){return 0===e.scrollToRow?(window.scrollTo(0,0),{scrollToRow:e.scrollToRow}):{scrollToRow:0}})},t.prototype.componentWillUnmount=function(){this.cleanupKeyboardShortcuts(),a.cleanupExternalDragHandler(this.props.keyScope)},t.prototype.getRowIndexForFile=function(e){return this.props.items.indexOf(e)},t.prototype.cleanupKeyboardShortcuts=function(){d.resetFilesViewKeyboardShortcuts(this.props.keyScope),d.resetFileJumpKeyboardShortcuts(this.props.keyScope)},t.prototype.setupKeyboardShortcuts=function(){var e=this,t=this.props,r=t.user,o=t.onDelete,n=t.onShowRename,s=t.getIsFileJumping,i=t.onAddFileJumpKeyCode,a=t.onResetFileJump,l=t.keyScope,c=t.onCopyToClipboard,u=t.onNavigateToParentFolder,p=t.onPasteFromClipboard;d.setupFileJumpKeyboardShortcuts({user:r,viewType:f.ViewType.List,scope:l,getIsFileJumping:s,onAddFileJumpKeyCode:i,onResetFileJump:a}),d.setupFilesViewKeyboardShortcuts({user:r,viewType:f.ViewType.List,getIsGlobalEvent:this.getIsGlobalEvent(),getIsItemEvent:this.getIsListEvent,getSelectedFiles:this.getSelectedFiles,isCurrentPathWriteable:this.props.getIsCurrentPathWriteable,selectAllAction:m,deselectAllAction:m,onCopyToClipboard:c,onDelete:o,onFocusSearchBar:this.props.onFocusSearchBar,onNavigateToFileOrFolder:this.handleNavigateToFileOrFolder,onNavigateToParentFolder:u,onPasteFromClipboard:p,onShowRename:n,scope:l,onShowHelpMenu:function(){return e.props.onOpenKeyboardShortcutModal()}})},t.prototype.setupExternalDragHandler=function(){a.setupExternalDragHandler(this.props.keyScope,this.getIsDraggingInternalFiles,this.getIsDraggingExternalFiles,this.props.onSetFileUploaderPath,".brws-file-row",this.getActiveDropTarget,this.props.onSetDropTarget)},t.prototype.getIsGlobalEvent=function(){return d.generateGetIsGlobalEvent(this)},t.prototype.render=function(){var e=this.props,t=e.scrollPositionOffset,r=e.viewportTopOffset,n=e.onRangeInView,s=h.getFilesViewListRowItemsAndHeights(this.props),a=s.rowItems,l=s.heights;return o.default.createElement(i.CulledTableBodyWithScrollToRow,{items:a,listItemHeight:l,renderRow:this.renderRow,scrollPositionOffset:t,scrollToRow:this.state.scrollToRow,shouldUseWindowAsScrollContainer:!0,viewportTopOffset:r,onRangeInView:n})},t.defaultProps={isFileViewerShown:function(){return!1}},t})(o.default.PureComponent);t.FilesViewList=S}),define("modules/clean/react/files_view/new_folder_row",["require","exports","tslib","spectrum/media_table","spectrum/table","react","spectrum/icon_content","modules/clean/react/files_view/name_input","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.NewFolderRow=function(e){var r,i=e.createNewFolderState,c=e.isInsideMyTeamFolderTree,d=void 0!==c&&c,u=e.onCancel,p=e.onSubmit,h=e.rowIndex,f=e.topOffset;r="SAVING_INPUT"===i?s.default.createElement("p",{className:"brws-new-folder-row-status",role:"status","aria-live":"polite"},l._("Creating new folder…")):s.default.createElement(a.NameInput,{defaultValue:"",label:l._("Folder name"),onSubmit:p,onCancel:u});var _=s.default.createElement(t.NewFolderIcon,{isInsideMyTeamFolderTree:d});return s.default.createElement(o.CulledMediaRow,{"aria-rowindex":void 0!==h?h+1:void 0,className:"brws-new-folder-row",topOffset:f},s.default.createElement(n.TableCell,{className:"brws-checkbox-cell"}),s.default.createElement(o.MediaCell,{icon:_},s.default.createElement("div",{className:"brws-new-folder-row-content brws-vertically-center"},r)),s.default.createElement(n.TableCell,null),s.default.createElement(n.TableCell,null))},t.NewFolderIcon=function(e){var t=e.isInsideMyTeamFolderTree,r=e.className||"";return s.default.createElement(i.IconContent,{className:r,name:t?"folder_team-small":"folder-small"})}}),define("modules/clean/react/files_view/paper_row",["require","exports","tslib","react","retrieval-components/highlighted-truncated-string","spectrum/media_table","spectrum/util/raf_throttle","modules/clean/emoji_utils","modules/clean/filename_highlights","modules/clean/paper_formatting_utils","modules/clean/react/files_view/file_snippets","modules/clean/react/files_view/star","modules/clean/react/files_view/types","modules/clean/react/files_view/util","modules/core/browser","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),a=r.__importStar(a),c=r.__importStar(c),f=r.__importStar(f);var m=(function(e){function t(t){var r=e.call(this,t)||this;return r.setRef=function(e){r.brwsFilenameContainerDiv=e},r.handleWindowResize=function(){r.throttledWindowResize.request()},r.handleResize=function(){if(r.brwsFilenameContainerDiv){var e=r.state.brwsFilenameContainerDivWidth,t=r.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&r.setState({brwsFilenameContainerDivWidth:t})}},r.handleClick=function(e){if(0===e.button){e.preventDefault(),e.stopPropagation();var t=r.props.paper;if(h.hasModifierKey(e))return void f.open_tab(t.url);r.props.onOpenPaper(t)}},r.throttledWindowResize=new i.RafThrottle(function(){return r.handleResize()}),r.state=r.calcState(t),r}return r.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){if(this.props.paper.title!==e.paper.title||this.props.paper.highlight_spans!==e.paper.highlight_spans){var t=this.calcState(e);this.setState(t)}},t.prototype.componentDidMount=function(){this.handleResize(),window.addEventListener("resize",this.handleWindowResize)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.handleWindowResize)},t.prototype.calcState=function(e){return{titleParts:c.getPaperDocTitleParts(e.paper,"brws-file-name-cell-icon","brws-file-name-cell-icon-emoji")}},t.prototype.getHighlightedSpansForHighlightedTruncatedString=function(e){var t=e.title,r=e.highlight_spans,o=e.title_highlights,n=r&&r.length>0,s=a.getFirstEmojiFromTitle(t);if(n){if(s){r=[{highlight_str:r[0].highlight_str.substr(s.length),is_highlighted:r[0].is_highlighted}].concat(r.slice(1))}return r.map(function(e){return{string:e.highlight_str,isHighlighted:e.is_highlighted}})}if(o){if(s){t=t.substr(s.length);var i=s.length/2;o=o.slice().map(function(e){return{pos:e.pos-i,len:e.string.length,string:e.string}})}return l.highlightMatchSections(t,o).map(function(e){return{string:e.text,isHighlighted:e.isHighlighted}})}},t.prototype.renderTitleElement=function(e){var t=this.props,r=t.paper,s=t.showHighlights,i=t.expHighlightedTruncatedString,a=this.state.titleParts,l=a.title,c=a.highlightedTitle;if(i){if(e){var d=o.default.createElement(n.HighlightedTruncatedString,{text:l,className:"brws-file-name-element",fontSize:14,highlightSpans:this.getHighlightedSpansForHighlightedTruncatedString(r),cellBuffer:3,availableWidth:e});return o.default.createElement("a",{className:"brws-paper-doc-name-cell-title",href:r.url,onClick:this.handleClick},s?d:o.default.createElement("span",null,l))}return null}return o.default.createElement("a",{className:"brws-paper-doc-name-cell-title",href:r.url,onClick:this.handleClick},s?c:o.default.createElement("span",null,l))},t.prototype.renderPaperCellContent=function(e,t){var r=this.props,n=r.paper,i=r.user,a=r.arePostTTIModulesLoaded,l=r.showSnippets,c=a?o.default.createElement(u.StarContainer,{item:n,user:i,key:"paperStar",className:"brws-file-name-cell-star"}):null;return o.default.createElement("div",{className:"brws-paper-doc-name-cell-content brws-vertically-center"},o.default.createElement("div",{className:"brws-paper-doc-name-cell-title-container"},o.default.createElement(s.MediaCellText,{highlight:e},this.renderTitleElement(t)),c),o.default.createElement(s.MediaCellText,{highlight:e,variant:"subtitle"},_._("in Paper",{comment:"The Dropbox Paper page"})),l&&o.default.createElement(s.MediaCellText,{highlight:e,key:"snippets",variant:"subtitle"},o.default.createElement(d.FileSnippets,{snippets:n.snippets})))},t.prototype.renderDocName=function(e){var t=this.props,n=t.expHighlightedTruncatedString,i=t.height,a=this.state.titleParts.icon,l={highlight:e,icon:a,style:{minHeight:i-1}};if(n){var c=this.state.brwsFilenameContainerDivWidth;return o.default.createElement(s.MediaCell,r.__assign({key:"docName"},l),o.default.createElement("div",{className:"brws-file-name-container",ref:this.setRef},this.renderPaperCellContent(e,c)))}return o.default.createElement(s.MediaCell,r.__assign({key:"docName"},l),this.renderPaperCellContent(e))},t.prototype.renderDocInfo=function(){var e=this.props.paper,t=e.last_modified_date||"",r=_._("by %(modified_by)s",{comment:"name of the person that modified the file"}).format({modified_by:e.last_editor_name||e.creator_name});return o.default.createElement(s.MediaCell,{key:"docInfo",subtitle:r,title:t})},t.prototype.renderCell=function(e){var t=e.isHovered,r=e.sortField;switch(r){case p.SortField.FILENAME:return this.renderDocName(t);case p.SortField.RELEVANCE:case p.SortField.MODIFIED:return this.renderDocInfo();default:return o.default.createElement(s.MediaCell,{key:r,title:o.default.createElement("span",{"aria-hidden":!0},"--")})}},t.prototype.render=function(){var e=this,t=this.props,r=t.rowIndex,n=t.topOffset,i=t.visibleColumns;return o.default.createElement(s.CulledMediaRow,{"aria-rowindex":void 0!==r?r+1:void 0,className:"brws-paper-row",draggable:!1,onClick:this.handleClick,topOffset:n,variant:"default"},function(t){var r=t.isHovered;return[o.default.createElement(s.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"})].concat(i.map(function(t){return e.renderCell({isHovered:r,sortField:t.sortField})}))})},t.defaultProps={showHighlights:!0},t})(o.default.PureComponent);t.PaperRow=m}),define("modules/clean/react/files_view/pinned_team_folder_view",["require","exports","tslib","external/classnames","spectrum/table","modules/clean/browse_uri_interface","modules/clean/react/browse/models","modules/clean/react/files_view/constants","modules/clean/react/files_view/file_list_utils","modules/clean/react/files_view/file_row","react","modules/clean/react/sprite","modules/constants/trademark","modules/core/i18n","modules/clean/react/tooltip","modules/clean/user_education/user_education_client","modules/clean/user_education/react/user_education_effect"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),d=r.__importDefault(d);var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName="PinnedTeamFolderView",t.renderTeamFolderRow=function(e,r){var o=t.props,n=o.activeDropTarget,u=o.context,p=o.dropTargetHighlightMode,h=o.getOverflowMenuActions,f=o.isTabbing,_=o.onDragEnter,S=o.onNavigateToFileOrFolder,g=o.onRenameCancel,v=o.onRenameSubmit,E=o.user,w=o.arePostTTIModulesLoaded,T=o.thumbStore,F=o.onShowShare,b=o.renderSharedWithController,y=l.shouldFileBeHighlightedDropTarget({dropTargetHighlightMode:p,file:e,isSelected:!1}),C=d.default.createElement(c.FileRow,{context:u,file:e,getOverflowMenuActions:h,key:encodeURI(e.fq_path),isAvailableDropTarget:y,isActiveDropTarget:e===n,isPinned:!0,arePostTTIModulesLoaded:w,isTabbing:f,onDragEnter:_,onNavigateToFileOrFolder:S,onRenameCancel:g,onRenameSubmit:v,showUserEducationEffects:0===r,showCDMUserEducationEffects:i.File.isTeamMemberFolder(e),user:E,visibleColumns:a.LIST_VIEW_COLUMNS.slice(0,1),canDisplayFolderSizes:!1,thumbStore:T,onShowShare:F,renderSharedWithController:b,hrefForFile:s.href_for_file});return r>0?C:d.default.createElement(m.UserEducationEffect,{containerName:"PinnedTeamFolder",name:"TeamFolder",key:encodeURI(e.fq_path)+"-UserEducationEffect"},C)},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){_.UEClient.sendEvent(this.displayName,"componentDidMount",JSON.stringify(this.props.context))},t.prototype.renderHeaderTitle=function(e,t){var r=t?d.default.createElement("div",{className:"brws-pinned-team-folder-info-button"},d.default.createElement(f.Tooltip,{position:f.TooltipPosition.RIGHT,tooltip_contents:d.default.createElement("div",null,t),tooltip_classname:"brws-pinned-team-folder-tooltip"},d.default.createElement(u.Sprite,{group:"web",name:"info",alt:h._("File section information")}))):null;return d.default.createElement("div",{className:"brws-pinned-team-folder-header-title-button-group"},d.default.createElement("h2",{className:"brws-pinned-team-folder-header-title"},e),r)},t.prototype.render=function(){var e=this.props,t=e.columnFlex,r=e.isCompactMode,s=e.teamFolders,i=h.ungettext("Team folder","Team folders",s.size);return d.default.createElement("div",{className:"brws-pinned-team-folder-view"},d.default.createElement(n.Table,{columnFlex:t},d.default.createElement(n.TableHead,{className:o.default("brws-column-header","brws-pinned-team-folder-header",{"brws-column-header-compact brws-pinned-team-folder-header-compact ":r})},d.default.createElement(n.TableHeadCell,{className:"brws-checkbox-cell"}),d.default.createElement(n.TableHeadCell,{className:"brws-vertically-center"},this.renderHeaderTitle(i,h._("Team folders are the hub of content for a team and contents are                 automatically shared with team folder members. %(trademark_business)s                 team admins own and manage team folders.").format({trademark_business:p.TRADEMARK_BUSINESS})))),d.default.createElement(n.TableBody,null,s.map(this.renderTeamFolderRow))),d.default.createElement(n.Table,{columnFlex:t},d.default.createElement(n.TableHead,{className:o.default("brws-column-header","brws-pinned-team-folder-header","brws-pinned-team-folder-header-secondary",{"brws-column-header-compact brws-pinned-team-folder-header-compact ":r})},d.default.createElement(n.TableHeadCell,{className:"brws-checkbox-cell"}),d.default.createElement(n.TableHeadCell,{className:"brws-vertically-center"},this.renderHeaderTitle(h._("Everything else"))))))},t})(d.default.Component);t.PinnedTeamFolderView=S}),define("modules/clean/react/files_view/selectors",["require","exports","tslib","external/reselect","modules/clean/react/browse/models","modules/clean/react/files_view/constants","modules/clean/react/files_view/file_list_utils"],function(e,t,r,o,n,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return{activeDropTarget:e.activeDropTarget,arePostTTIModulesLoaded:e.arePostTTIModulesLoaded,canDisplayFolderSizes:e.canDisplayFolderSizes,context:e.context,createNewFolderState:e.createNewFolderState,dropTargetHighlightMode:e.dropTargetHighlightMode,fileExtensionsConfigs:e.fileExtensionsConfigs,fileRename:e.fileRename,focusedFileId:e.focusedFileId,isCheckboxDisabled:e.disabledMultiselect,isCompactMode:e.isCompactMode,isSearchMode:e.isSearchMode,isSelectMode:e.isSelectMode,isTabbing:e.isTabbing,items:e.items,selection:e.selection,starredState:e.starredState,user:e.user,visibleColumns:e.visibleColumns,responsive:e.responsive,expSnippets:e.expSnippets}},l=function(e,t){return Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(function(r){return t.hasOwnProperty(r)&&e[r]===t[r]})},c=o.createSelectorCreator(o.defaultMemoize,l);t.getFilesViewListRowItems=c(a,function(e){var o=e.activeDropTarget,a=e.context,l=e.createNewFolderState,c=e.dropTargetHighlightMode,d=e.items,u=e.fileRename,p=e.focusedFileId,h=e.selection,f=e.user,_=e.visibleColumns,m=e.fileExtensionsConfigs,S=e.responsive,g=e.expSnippets,v=r.__rest(e,["activeDropTarget","context","createNewFolderState","dropTargetHighlightMode","items","fileRename","focusedFileId","selection","user","visibleColumns","fileExtensionsConfigs","responsive","expSnippets"]),E=d.toArray().map(function(e){if(e instanceof n.UserDefinedItem)return{type:"UserDefinedItemRow",props:{userDefinedItem:e},height:s.DEFAULT_ROW_HEIGHT};var l=t.getFileRowHeight({file:e,expSnippets:g,responsive:S}),d=t.shouldShowSnippets({file:e,expSnippets:g,responsive:S});if(e instanceof n.Paper)return{type:"PaperRow",props:{isSearchMode:v.isSearchMode,paper:e,visibleColumns:_,arePostTTIModulesLoaded:v.arePostTTIModulesLoaded,showSnippets:d,height:l},height:l};var E="fq_path"in e?e.fq_path:e.file_id,w=h.selected.has(E);if(e instanceof n.FileSharedWithMe)return{type:"FileSharedWithMeRow",props:{file:e,visibleColumns:_,showSnippets:d,height:l,isSelected:w},height:l};var T=i.shouldFileBeHighlightedDropTarget({file:e,isSelected:w,dropTargetHighlightMode:c});return{type:"FileRow",props:r.__assign({},v,{file:e,isActiveDropTarget:T&&o===e,isAvailableDropTarget:T,isFocused:e.fq_path===p,isSelected:w,isSharingDisabled:i.isSharingDisabledForFile({context:a,file:e,user:f}),renameState:u&&u.file.fq_path===e.fq_path?u.state:void 0,visibleColumns:_,extensionsConfig:m?m[e.file_id]:void 0,showSnippets:d,height:l}),height:l}});return l&&"CREATE_FOLDER_INACTIVE"!==l&&E.unshift({type:"NewFolderRow",props:{createNewFolderState:l,isInsideMyTeamFolderTree:a.isInsideTeamFolderTree},height:s.DEFAULT_ROW_HEIGHT}),E}),t.getFilesViewListRowItemsAndHeights=o.createSelector(t.getFilesViewListRowItems,function(e){return{rowItems:e,heights:e.map(function(e){return e.height})}}),t.getItemIds=o.createSelector(function(e){return e.items},function(e){return e.toArray().map(function(e){return e.fq_path||e.file_id})}),t.shouldShowSnippets=function(e){var t=e.file.snippets,r=e.expSnippets,o=void 0!==r&&r,n=e.responsive;return!!o&&!!t&&t.length>0&&(n.isMatchedLarge||n.isMatchedMedium)},t.getFileRowHeight=o.createSelector(t.shouldShowSnippets,function(e){return e?s.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS:s.DEFAULT_ROW_HEIGHT})}),define("modules/clean/react/files_view/share_button",["require","exports","tslib","spectrum/button","react","modules/clean/react/retrieval_success_banner/util","modules/core/i18n","modules/clean/react/extensions/data/types"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var l=(function(t){function l(){var o=null!==t&&t.apply(this,arguments)||this;return o.handleClick=function(t){return r.__awaiter(o,void 0,void 0,function(){var o,n,i,l,c,d;return r.__generator(this,function(u){switch(u.label){case 0:return this.props.useSearchSuccessBanner&&this.props.isSearchMode&&s.doSearchResultActionClickBroadcast(!0),t.preventDefault(),o=this.props,n=o.file,i=o.onShowShare,i(n,"BROWSE_FILE_ROW"),t.stopPropagation(),[4,new Promise(function(t,r){e(["modules/clean/react/app_actions/telemetry_client"],t,r)}).then(r.__importStar)];case 1:return l=u.sent(),c=l.createTelemetryClient,d=l.getPiiSafeExtension,c({component:"share-btn"}).session({surface:this.props.isSearchMode?"search":"browse",ext:d(this.props.file.ext)}).event("click_share",{trigger_type:a.TriggerType.PrimaryButton}),[2]}})})},o}return r.__extends(l,t),l.prototype.render=function(){var e=this.props,t=e.isVisible,r=e.shareButtonLabel,s=e.showShareButton;return n.default.createElement(o.Button,{"aria-label":r,className:"inline-share-button",onClick:this.handleClick,tabIndex:t&&s?void 0:-1,variant:t&&s?"secondary":"invisible"},r)},l.defaultProps={isVisible:!0,shareButtonLabel:i._("Share"),showShareButton:!0},l})(n.default.PureComponent);t.ShareButton=l}),define("modules/clean/react/files_view/sticky_table_head",["require","exports","tslib","spectrum/dimensions","spectrum/table","react","modules/clean/react/sticky/sticky","modules/clean/react/sticky/container"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.StickyTableHead=function(e){var t=e.children,l=e.columnFlex,c=e.offsetHeight,d=e.offsetTop,u=r.__rest(e,["children","columnFlex","offsetHeight","offsetTop"]);return s.default.createElement("thead",{className:"brws-sticky-table-head"},s.default.createElement(o.Dimensions,{tagName:"tr"},function(e){var o=e.width;return s.default.createElement("td",{className:"brws-sticky-table-cell"},s.default.createElement(a.StickyContainer,{offsetTop:d,useNativeSticky:!0,useWindowToDetermineBottom:!0},s.default.createElement(i.Sticky,{offsetHeight:c},s.default.createElement(n.Table,{columnFlex:l,style:{width:o}},s.default.createElement(n.TableHead,r.__assign({},u),t)))))}))}}),define("modules/clean/react/files_view/user_defined_item_row",["require","exports","tslib","react"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var n=(function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.rowIndex,r=e.topOffset;return e.userDefinedItem.renderUserDefinedItemRow({rowIndex:t,topOffset:r})},t})(o.default.PureComponent);t.UserDefinedItemRow=n}),define("modules/clean/react/files_view/view_type_column_header_menu",["require","exports","tslib","react","spectrum/icon_form","spectrum/icon_mode","spectrum/popover","modules/clean/react/files_view/types","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelection=function(e){e!==t.props.viewType&&t.props.onSwitchViewType(e)},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.onTTI()},t.prototype.viewTypeIcon=function(e){switch(e){case a.ViewType.List:return"list";case a.ViewType.Grid:return"grid";case a.ViewType.LargeGrid:return"tiles"}return"list"},t.prototype.viewTypeLabel=function(e){switch(e){case a.ViewType.List:return l._("Layout: List");case a.ViewType.Grid:return l._("Layout: Grid");case a.ViewType.LargeGrid:return l._("Layout: Large Grid")}return l._("Layout: List")},t.prototype.render=function(){var e=this,t=this.props,r=t.viewType,a=t.viewTypes,c=t.viewTypeLabels;return 1===a.length?null:o.default.createElement(i.Popover,{className:"brws-view-type-column-header-menu",onSelection:this.handleSelection,closeOnSelection:!1},o.default.createElement(i.PopoverTrigger,{className:"brws-view-type-column-header-menu-trigger","aria-label":l._("Select view type")},o.default.createElement(s.IconMode,{name:this.viewTypeIcon(r)}),o.default.createElement(n.IconForm,{name:"caret-down"})),o.default.createElement(i.PopoverContent,{attachment:"right",className:"brws-view-type-column-header-menu-content"},o.default.createElement(i.PopoverItemGroup,null,o.default.createElement(i.PopoverItemGroupTitle,null,l._("View As")),a.map(function(t){return o.default.createElement(i.PopoverSelectableItem,{"data-viewtype":t,key:t,icon:o.default.createElement(s.IconMode,{name:e.viewTypeIcon(t)}),selected:r===t,value:t,"aria-label":e.viewTypeLabel(t)},c[t])}))))},t})(o.default.PureComponent);t.ViewTypeColumnHeaderMenu=c});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/folder_dialog/async",["require","exports","modules/clean/css"],function(e,t,r){"use strict";function o(t){new Promise(function(t,r){e(["modules/clean/react/folder_dialog/folder_dialog"],t,r)}).then(__importStar).then(function(e){return e.FolderDialog.show(t)})}function n(){new Promise(function(t,r){e(["modules/clean/react/folder_dialog/folder_dialog"],t,r)}).then(__importStar).then(function(){r.require_css("/static/css/react/folder_picker-vflIBh6K8.css")})}Object.defineProperty(t,"__esModule",{value:!0}),t.showFolderDialog=o,t.prewarmFolderDialog=n}),define("modules/clean/react/folder_overview/api",["require","exports","tslib","modules/clean/api_v2/user_client"],function(e,t,r,o){"use strict";var n=this;Object.defineProperty(t,"__esModule",{value:!0});var s=new o.UserApiV2Client;t.getDescription=function(e,t){return r.__awaiter(n,void 0,Promise,function(){return r.__generator(this,function(r){switch(r.label){case 0:return[4,s.ns("files").rpc("get_description_batch",{file_ids:[t]},{subjectUserId:e}).then(function(e){if(!e||!e.items||1!==e.items.length)throw new Error("Unexpected response from get_description_batch");return e.items[0]})];case 1:return[2,r.sent()]}})})},t.setDescription=function(e,t,o,i,a){return r.__awaiter(n,void 0,Promise,function(){return r.__generator(this,function(r){switch(r.label){case 0:return[4,s.ns("files").rpc("set_description",{file_id:t,current_revision_id:o,text:i,format_version:a},{subjectUserId:e})];case 1:return[2,r.sent()]}})})},t.getContentReferences=function(e,t){return r.__awaiter(n,void 0,Promise,function(){return r.__generator(this,function(r){switch(r.label){case 0:return[4,s.ns("files").rpc("get_content_references_info",{file_id:t},{subjectUserId:e})];case 1:return[2,r.sent()]}})})},t.removeContentReferences=function(e,t,o){return r.__awaiter(n,void 0,Promise,function(){return r.__generator(this,function(r){switch(r.label){case 0:return[4,s.ns("files").rpc("remove_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e})];case 1:return[2,r.sent()]}})})},t.addContentReferences=function(e,t,o){return r.__awaiter(n,void 0,Promise,function(){return r.__generator(this,function(r){switch(r.label){case 0:return[4,s.ns("files").rpc("add_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e})];case 1:return[2,r.sent()]}})})},t.addContentReferencesToPath=function(e,t,o){return r.__awaiter(n,void 0,Promise,function(){return r.__generator(this,function(r){switch(r.label){case 0:return[4,s.ns("files").rpc("add_content_references_to_path",{path:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e})];case 1:return[2,r.sent()]}})})},t.getFolderAccess=function(e){var t=e.userId,o=e.sharedFolderId,i=e.accountId,a=e.accountEmail
;return r.__awaiter(n,void 0,void 0,function(){return r.__generator(this,function(e){return[2,s.ns("folder_overview").rpc("has_folder_access",{shared_folder_id:o,account_id:i,account_email:a},{subjectUserId:t})]})})},t.getSharedFolderPath=function(e){var t=e.userId,r=e.sharedFolderId;return s.ns("files").rpc("get_metadata",{path:"ns:"+r},{subjectUserId:t}).then(function(e){return e.is_shareable?e.path_display:void 0})},t.getLoggingFileId=function(e){var t=e.userId,r=e.path;return s.ns("files").rpc("get_metadata",{path:r},{subjectUserId:t}).then(function(e){return e.id})},t.isNotFoundError=function(e){try{return"NOT_FOUND"===JSON.parse(e.raw.responseBody).user_message}catch(e){return!1}},t.isConflictError=function(e){return e.error&&e.error.status&&"conflict"===e.error.status[".tag"]},t.isFormatVersionError=function(e){return e.error&&e.error.status&&"bad_format_version"===e.error.status[".tag"]},t.getUserAccount=function(e){var t=e.userId,r=e.accountId;return s.ns("users").rpc("get_account",{account_id:r},{subjectUserId:t})}}),define("modules/clean/react/folder_overview/connected",["require","exports","tslib","react","external/react-redux","modules/clean/react/browse/data/selectors","modules/clean/react/css","modules/clean/react/folder_overview/controller","modules/clean/react/folder_overview/data/action_creators","modules/clean/react/folder_overview/data/selectors","modules/clean/react/folder_overview/data/store"],function(e,t,r,o,n,s,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),s=r.__importStar(s),l=r.__importStar(l),c=r.__importStar(c);var u=d.getStoreForFolderOverview(),p=function(e){return{path:s.path(e),folderFileId:c.folderFileId(e),folderNsId:c.folderNsId(e),sharedFolderId:c.sharedFolderId(e),isOpen:!c.isCollapsed(e),descriptionContent:c.descriptionContent(e),pinnedItems:c.pinnedItems(e),hasUnsavedDescriptionDraft:c.hasUnsavedDescriptionDraft(e),user:s.user(e),descriptionAuthor:c.descriptionAuthor(e),haveAllComponentsLoaded:c.haveAllComponentsLoaded(e),descriptionBaseRevision:c.descriptionBaseRevision(e),lastModifiedTime:c.lastModifiedTime(e),lastModifiedUser:c.lastModifiedUser(e),lastModifiedUserId:c.lastModifiedUserId(e),descriptionSaveState:c.descriptionSaveState(e),hasFailedToLoad:c.hasFailedToLoad(e),browseContext:s.context(e),sharedFolderName:c.sharedFolderName(e),sharedFolderPath:c.sharedFolderPath(e),descriptionFormatValid:c.descriptionFormatValid(e),isFolderOverviewEmpty:c.isFolderOverviewEmpty(e),loadedComponents:c.loadedComponents(e),doesFolderOverviewExist:c.doesFolderOverviewExist(e)}},h={updateFolderData:l.updateFolderDataCache,removeContentReferences:l.removeContentReferences,saveFolderData:l.saveFolderPreferences,addLoadedComponent:l.addLoadedComponent,removeLoadedComponent:l.removeLoadedComponent,saveDescriptionDraft:l.saveDescriptionDraft,setFailedToLoad:l.setFailedToLoad,fetchDataForFolder:l.fetchDataForFolder,reloadDescription:l.reloadDescriptionForCurrentFolder,reloadContentReferences:l.reloadContentReferencesForCurrentFolder},f=n.connect(p,h)(a.FolderOverviewController),_=function(e){return o.default.createElement(n.Provider,{store:u},o.default.createElement(f,r.__assign({},e)))};t.FolderOverview=i.requireCssWithComponent(_,["/static/css/browse/folder_overview-vfl4Sg-UM.css","/static/js/spectrum_comments/index.web-vflkuBAHI.css","/static/js/retrieval-components/index.web-vfl4qjaZj.css"])}),define("modules/clean/react/folder_overview/constants",["require","exports","tslib","modules/clean/react/comments2/components/comments_translations","modules/core/i18n"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DESCRIPTION_PLACEHOLDER=n._("Type notes, lists, to-dos, and links here. <link>Show examples</link>"),t.FOLDER_EXAMPLES_LINK_LABEL=n._("Show examples"),t.FOLDER_EXAMPLES_LINK_URI="https://www.dropbox.com/help/desktop-web/folder-overviews",t.NUM_COMPONENTS=3,t.ERROR_DESCRIPTION_CONFLICT=n._("Can’t save changes. Paste text elsewhere to save, then click Refresh."),t.ERROR_DESCRIPTION_FORMAT_VERSION=n._("Can’t save changes. Reload the page and try again."),t.ERROR_DESCRIPTION_SAVE=n._("Can’t save changes."),t.ERROR_SHARE_PERSONAL_FOLDER=n._("Can’t @mention someone in your Personal Dropbox."),t.ERROR_SHARE_MEMBER_FOLDER=n._("Can’t @mention someone in your member folder."),t.ERROR_SHARE_NO_PERMISSION=n._("You don’t have permission to share this folder."),t.DESCRIPTION_SAVE_DELAY_MS=3e3,t.DESCRIPTION_SAVE_ERROR_DELAY_MS=10*t.DESCRIPTION_SAVE_DELAY_MS,t.FOLDER_OVERVIEW_EDITOR_STRINGS=r.__assign({},o.commentsMasterLocalization,{searchingMsg:n._("@mention someone to share this folder"),folderOverviewToolbar:{boldMsg:n._("Bold"),italicMsg:n._("Italic"),strikeThroughMsg:n._("Strikethrough"),mentionMsg:n._("Mention someone"),orderedListMsg:n._("Start numbered list"),unorderedListMsg:n._("Start bulleted list"),linkMsg:n._("Create link"),taskMsg:n._("Create to-do"),onboardingMsg:n._("Folder examples"),mentionShortcutMsg:n._("someone",{comment:"used in a tooltip to tell the user that they can mention someone by typing the '@'     character followed by the name of a user. In english, the tooltip will display just '@someone'"}),spaceKey:n._("space",{comment:"'space' refers to the spacebar key on the keyboard. This string is used to create labels for     shortcuts e.g. '@ + space' to insert a mention"})},folderOverviewSharePopover:{cancelLabel:n._("Cancel"),continueLabel:n._("Continue"),shareTitle:function(e){return e?n._("Share folder with %(user_name)s?").format({user_name:e}):""},shareMessage:function(e,t){return e&&t?n._("Before you can @mention %(user_name)s, share the %(folder_name)s folder with them first.").format({folder_name:t,user_name:e}):""}},folderOverviewTaskPlaceholder:n._("Set a task and assign @someone")}),t.SHARING_MODAL_MESSAGE_SAME_FOLDER=n._("Hi %(user_name)s, I @mentioned you in this folder. Take a look."),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=n._("Hi %(user_name)s, I @mentioned you in the %(folder_name)s folder. Take a look."),t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=n._("I @mentioned you in this folder. Take a look."),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=n._("I @mentioned you in the %(folder_name)s folder. Take a look."),t.DESCRIPTION_VERSION=[1,0,0],t.PIN_TO_SUCCESS_SINGLE=n._("Pinned %(file)s to %(path)s"),t.PIN_TO_SUCCESS_MULTIPLE=n._("Pinned %(num)d files to %(path)s"),t.PIN_TO_MODAL_TITLE_SINGLE=n._("Pin “%(name)s” to..."),t.PIN_TO_MODAL_TITLE_MULTIPLE=n._("Pin %(num)d files to..."),t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=n._("Deleted %(time_ago)s by you"),t.DESCRIPTION_LAST_EDIT_EMPTY=n._("Deleted %(time_ago)s by %(name)s"),t.DESCRIPTION_LAST_EDIT_YOU=n._("Updated %(time_ago)s by you"),t.DESCRIPTION_LAST_EDIT=n._("Updated %(time_ago)s by %(name)s"),t.CONFLICT_POPUP_TITLE=n._("Your changes weren’t saved because you and %(user)s are editing at the same time."),t.CONFLICT_POPUP_TITLE_YOU=n._("Your changes weren’t saved because you are editing this description elsewhere."),t.CONFLICT_POPUP_CONTENT=n._("Please wait until they’re done before making changes.",{comment:'"they\'re" here refers to another user who is also currently making changes to the folder overview'}),t.CONFLICT_POPUP_CONTENT_YOU=n._("Please save your other changes before making them here."),t.CONFLICT_POPUP_BUTTON=n._("OK")}),define("modules/clean/react/folder_overview/content_references",["require","exports","tslib","react","retrieval-components/pinned-item","modules/clean/browse_uri_interface","modules/clean/react/browse/models","modules/clean/react/files_view/tile_grid","modules/clean/react/icon/folder_icon","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),t.FolderOverviewContentReferences=function(e){var t=e.user,d=e.pinnedItems,u=e.isReadOnly,p=(e.isMobile,e.onPinnedItemClick),h=e.onPinnedItemUnpin;return d&&d.length?o.default.createElement("div",{className:"folder-overview__content-references"},d.map(function(e){if(e.isDeleted||!e.fq_path)return null;var d={className:"folder-overview__content-reference",filename:i.File.getFilename(e),fqPath:e.fq_path,onClick:function(){return p(e)},url:s.href_for_file(t,e),subtitle:i.File.getCategoryDescription(e)};if(u||(d=r.__assign({},d,{menuOptions:u?void 0:[{key:"unpin",label:c._("Unpin")}],onMenuOptionClick:function(t){switch(t){case"unpin":h(e)}},menuLabel:""})),e.is_dir)return o.default.createElement(n.PinnedItem,r.__assign({},d,{key:e.file_id,isFolder:!0,folderIcon:l.convertLegacyFolderIconToSpectrum(e.icon,"large")}));var f=r.__assign({},d,{thumbnailUrl:a.getThumbnailUrlForItem(e.thumbnail_url_tmpl,256)});return o.default.createElement(n.PinnedItem,r.__assign({key:e.file_id},f))})):null}}),define("modules/clean/react/folder_overview/controller",["require","exports","tslib","external/classnames","external/lodash","react","retrieval-components/collapsable-section","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/react/async/loadable","modules/clean/react/browse/uri_helper","modules/clean/react/files_view/types","modules/clean/react/folder_overview/api","modules/clean/react/folder_overview/constants","modules/clean/react/folder_overview/content_references","modules/clean/react/folder_overview/live_update","modules/clean/react/folder_overview/logging","modules/clean/react/folder_overview/placeholder","modules/clean/react/folder_overview/utils","modules/clean/react/snackbar","modules/clean/sharing/browse_exports","modules/clean/web_user_action_events","modules/core/browser","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n),s=r.__importDefault(s),l=r.__importStar(l),p=r.__importStar(p),T=r.__importStar(T),t.AsyncFolderOverviewDescription=c.Loadable({loader:function(){return new Promise(function(t,r){e(["modules/clean/react/folder_overview/description"],t,r)}).then(r.__importStar).then(function(e){return e.FolderOverviewDescription})},loading:function(){return s.default.createElement("div",{className:"folder-overview__description"},s.default.createElement(S.FolderOverviewPlaceholder,{folderExamplesLink:h.FOLDER_EXAMPLES_LINK_URI}))}}),t.AsyncFolderOverviewLastEdit=c.Loadable({loader:function(){return new Promise(function(t,r){e(["modules/clean/react/folder_overview/last_edit"],t,r)}).then(r.__importStar).then(function(e){return e.FolderOverviewLastEdit})}});var b=(function(e){function c(t){var r=e.call(this,t)||this;return r.handleHeaderClick=function(){var e=r.props,t=e.folderFileId,o=e.isOpen;t&&(r.props.updateFolderData({fileId:t,folderData:{isCollapsed:o}}),r.props.saveFolderData({folderFileId:t}),m.logFolderOverviewAction(w.WebUserActionLogEvent.FOLDER_OVERVIEW_TOGGLED,r.props.user.id,null,{opened:o?"0":"1"}))},r.handleLiveUpdate=function(e){switch(e.type){case"description":r.props.reloadDescription();break;case"content_references":r.props.reloadContentReferences()}},r.handleBeforeUnload=function(e){r.immediatelySaveDescriptionDraft(),r.props.hasUnsavedDescriptionDraft&&(e.preventDefault(),e.returnValue="")},r.immediatelySaveDescriptionDraft=function(){r.delayedSaveDescriptionDraft.cancel(),r.saveDescriptionDraft()},r.saveDescriptionDraft=function(){r.props.folderFileId&&r.props.hasUnsavedDescriptionDraft&&(r.props.saveDescriptionDraft({folderFileId:r.props.folderFileId}),m.logFolderOverviewAction(w.WebUserActionLogEvent.FOLDER_OVERVIEW_DESCRIPTION_SAVE,r.props.user.id))},r.handlePinnedItemUnpin=function(e){var t=r.props.folderFileId;t&&r.props.removeContentReferences({folderFileId:t,fileIds:[e.file_id]}),m.logFolderOverviewAction(w.WebUserActionLogEvent.FOLDER_OVERVIEW_UNPIN,r.props.user.id,e)},r.handleDescriptionUpdated=function(e){r.props.folderFileId&&(r.props.updateFolderData({fileId:r.props.folderFileId,folderData:{descriptionDraft:e?JSON.stringify(e):void 0}}),r.delayedSaveDescriptionDraft())},r.handleDescriptionMount=function(){r.props.addLoadedComponent({component:"draftjs"})},r.handlePinnedItemClick=function(e){m.logFolderOverviewAction(w.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN_CLICK,r.props.user.id,e),void 0!==e.ns_id?r.props.onNavigateToFileOrFolder(e):T.redirect(a.href_for_file(r.props.user,e))},r.handleDescriptionMention=function(e){return"email"===e.type&&e.identifier===r.props.user.email||"id"===e.type&&e.identifier===r.props.user.id.toString()?Promise.resolve({userInFolder:!0,shouldShowSharePopup:!1}):r.props.user.cdm_tmf_path&&l.paths_are_equal(r.props.user.cdm_tmf_path,r.props.path)?(v.Snackbar.fail(h.ERROR_SHARE_MEMBER_FOLDER,"folder-overview-mention"),Promise.resolve({userInFolder:!1,shouldShowSharePopup:!1})):p.getFolderAccess({userId:r.props.user.id,sharedFolderId:r.props.sharedFolderId,accountEmail:"email"===e.type?e.identifier:void 0,accountId:"id"===e.type?e.identifier:void 0}).then(function(e){return{userInFolder:e.has_access,shouldShowSharePopup:!e.has_access}}).catch(function(e){var t=!r.props.browseContext.isCurrentlyInRoot&&r.props.browseContext.canViewContainingNSMembers;return t||v.Snackbar.fail(h.ERROR_SHARE_NO_PERMISSION,"folder-overview-mention"),{userInFolder:!1,shouldShowSharePopup:t}})},r.generateShareMessage=function(e){return r.props.sharedFolderPath&&!l.paths_are_equal(r.props.sharedFolderPath,r.props.path)?e&&e.length?h.SHARING_MODAL_MESSAGE_PARENT_FOLDER.format({user_name:e,folder_name:g.pathFromSharingFolder(r.props.sharedFolderPath,r.props.path)}):h.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME.format({folder_name:g.pathFromSharingFolder(r.props.sharedFolderPath,r.props.path)}):e&&e.length?h.SHARING_MODAL_MESSAGE_SAME_FOLDER.format({user_name:e}):h.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME},r.handleDescriptionShare=function(e,t,o,n){E.asyncShowPrefilledShareModal({user:r.props.user,sharePrefillEmail:e.identifier,content:{fqPath:r.props.sharedFolderPath,isFolder:!0},extras:{onSuccessSharing:function(){r.handleDescriptionMention(e).then(function(e){return e.userInFolder&&n()})},recipientMessage:r.generateShareMessage(t)}})},r.handleLastEditDismiss=function(){r.props.reloadDescription()},r.shouldRenderFolderOverview=function(e){return!("OFF"===e.expFolderOverview&&"V2"===e.expFolderOverviewGeminiRollout&&e.loadedComponents.includes("description")&&e.loadedComponents.includes("content_references")&&!e.doesFolderOverviewExist)},r.setContainerRef=function(e){return r.container=e},r.delayedSaveDescriptionDraft=n.debounce(r.saveDescriptionDraft,h.DESCRIPTION_SAVE_DELAY_MS),r}return r.__extends(c,e),c.prototype.componentDidMount=function(){var e=this.props.path;(this.props.folderFileId||this.props.folderNsId)&&this.props.fetchDataForFolder({path:e,expFolderOverview:this.props.expFolderOverview}),window.addEventListener("beforeunload",this.handleBeforeUnload),"V2"===this.experimentVariant&&_.folderOverviewLiveUpdateManager.addListener("update",this.handleLiveUpdate),this.shouldRenderFolderOverview(this.props)||this.props.addLoadedComponent({component:"draftjs"})},c.prototype.componentWillReceiveProps=function(e){var t=e.path;(!l.paths_are_equal(t,this.props.path)&&(e.folderFileId||e.folderNsId)||!this.props.folderNsId&&!this.props.folderFileId&&e.folderNsId)&&(this.props.fetchDataForFolder({path:t,expFolderOverview:e.expFolderOverview}),this.immediatelySaveDescriptionDraft()),!this.props.folderFileId&&e.folderFileId&&d.getQueryArgs().folder_overview&&(this.props.updateFolderData({fileId:e.folderFileId,folderData:{isCollapsed:!1}}),this.props.saveFolderData({folderFileId:e.folderFileId}))},c.prototype.componentDidUpdate=function(e){this.container&&this.props.onChangeHeight(this.container.getBoundingClientRect().height),!this.shouldRenderFolderOverview(this.props)&&this.shouldRenderFolderOverview(e)&&this.props.addLoadedComponent({component:"draftjs"}),this.shouldRenderFolderOverview(this.props)&&!this.shouldRenderFolderOverview(e)&&this.props.removeLoadedComponent({component:"draftjs"})},c.prototype.componentWillUnmount=function(){this.props.folderFileId&&this.props.hasUnsavedDescriptionDraft&&this.immediatelySaveDescriptionDraft(),window.removeEventListener("beforeunload",this.handleBeforeUnload),"V2"===this.experimentVariant&&(_.folderOverviewLiveUpdateManager.removeListener("update",this.handleLiveUpdate),_.folderOverviewLiveUpdateManager.stop())},Object.defineProperty(c.prototype,"experimentVariant",{get:function(){return"V2"===this.props.expFolderOverviewGeminiRollout?this.props.expFolderOverviewGeminiRollout:this.props.expFolderOverview},enumerable:!0,configurable:!0}),c.prototype.render=function(){if(!this.shouldRenderFolderOverview(this.props))return null;var e=this.props.isReadOnly||!this.props.descriptionFormatValid;return s.default.createElement("div",{className:o.default({"folder-overview":!0,"folder-overview--expanded":this.props.isOpen,"folder-overview--loading":!this.props.haveAllComponentsLoaded||this.props.hasFailedToLoad||this.props.browseLoadingState===u.LoadingState.LOADING_FIRST_PAGE}),ref:this.setContainerRef},s.default.createElement(i.CollapsableSection,{title:F._("Overview"),isOpen:this.props.isOpen,onHeaderClick:this.handleHeaderClick,strings:{buttonClose:F._("Hide"),buttonOpen:F._("Show")}},s.default.createElement(t.AsyncFolderOverviewDescription,{user:this.props.user,expFolderOverview:this.experimentVariant,author:this.props.descriptionAuthor,content:this.props.descriptionContent,isReadOnly:e,showReadOnlyIcon:!0,hasUnsavedDraft:this.props.hasUnsavedDescriptionDraft,onDescriptionUpdated:this.handleDescriptionUpdated,onMount:this.handleDescriptionMount,descriptionKey:[this.props.folderFileId,this.props.descriptionBaseRevision].join("-"),onMention:this.handleDescriptionMention,onShare:this.handleDescriptionShare,rootSharedFolderName:this.props.sharedFolderName}),s.default.createElement(f.FolderOverviewContentReferences,{user:this.props.user,pinnedItems:this.props.pinnedItems,isReadOnly:this.props.isReadOnly,onPinnedItemClick:this.handlePinnedItemClick,onPinnedItemUnpin:this.handlePinnedItemUnpin}),s.default.createElement(t.AsyncFolderOverviewLastEdit,{onDismiss:this.handleLastEditDismiss,user:this.props.user,lastModifiedTime:this.props.lastModifiedTime,lastModifiedUser:this.props.lastModifiedUser,lastModifiedUserId:this.props.lastModifiedUserId,isFolderOverviewEmpty:this.props.isFolderOverviewEmpty,descriptionSaveState:this.props.descriptionSaveState})))},c})(s.default.PureComponent);t.FolderOverviewController=b}),define("modules/clean/react/folder_overview/data/action_creators",["require","exports","tslib","modules/clean/filepath","modules/clean/react/browse/data/selectors","modules/clean/react/folder_overview/api","modules/clean/react/folder_overview/constants","modules/clean/react/folder_overview/data/selectors","modules/clean/react/folder_overview/data/types","modules/clean/react/folder_overview/errors","modules/clean/react/folder_overview/live_update","modules/clean/react/folder_overview/logging","modules/clean/react/folder_overview/utils","modules/clean/react/snackbar","modules/clean/storage","modules/clean/viewer","modules/core/exception"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m){"use strict";var S=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),s=r.__importStar(s),a=r.__importStar(a),p=r.__importStar(p),m=r.__importStar(m),t.fetchDataForFolder=function(e){var o=e.path,i=e.expFolderOverview;return function(e,c){return r.__awaiter(S,void 0,void 0,function(){var d,u,h,f,_,S,g,v,E,w;return r.__generator(this,function(r){switch(r.label){case 0:e(t.removeLoadedComponent({component:"description"})),e(t.removeLoadedComponent({component:"content_references"})),e(t.setFailedToLoad({hasFailedToLoad:!1})),u=n.user(c()).id,r.label=1;case 1:if(r.trys.push([1,3,,4]),h=a.fileIdCache(c())[p.normalizePath(o)]||a.nsIdCache(c())[p.normalizePath(o)],!h)throw new Error("Unable to get file ID or NS ID for current folder");return[4,Promise.all([s.getDescription(u,h),s.getContentReferences(u,h)])];case 2:if(f=r.sent(),_=f[0],S=f[1],g=_.file_obj_id,!g)throw new Error("Did not get a file ID from the Sprinkle description payload");return e({type:l.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:(d={},d[p.normalizePath(o)]=g,d)}}),v=!!_.latest_revision_id,E=!!S.latest_revision_id,v?t.setDescriptionData(_,e):e(t.addLoadedComponent({component:"description"})),E?t.setContentReferencesData(g,S,e):(("V1"===i||"V2"===i||v)&&e(t.updateFolderDataCache({fileId:g,folderData:{contentReferences:[]}})),e(t.addLoadedComponent({component:"content_references"}))),"V1"===i||"V2"===i||E||v||e(t.addLoadedComponent({component:"draftjs"})),a.folderDataCache(c())[g]&&a.folderDataCache(c())[g].sharedFolderPath||e(t.fetchSharedFolderName({path:o})),a.folderDataCache(c())[g]&&a.folderDataCache(c())[g].loggingFileId||e(t.fetchLoggingFileId({path:o})),e(t.loadFolderPreferences({folderFileId:g})),[3,4];case 3:return w=r.sent(),m.reportException({err:w,severity:"non-critical",exc_extra:{path:o,expFolderOverview:i}}),e(t.setFailedToLoad({hasFailedToLoad:!0})),[3,4];case 4:return[2]}})})}},t.loadFolderPreferences=function(e){var o=e.folderFileId;return function(e,s){return r.__awaiter(S,void 0,void 0,function(){var i,a;return r.__generator(this,function(r){return i=n.user(s()).id,f.UserLocalStorage.clearOtherUsers([i]),(a=f.UserLocalStorage.get(i,"folder-overview-"+o))?(e(t.updateFolderDataCache({fileId:o,folderData:a})),[2]):[2]})})}},t.saveFolderPreferences=function(e){var t=e.folderFileId;return function(e,o){return r.__awaiter(S,void 0,void 0,function(){var e,s;return r.__generator(this,function(r){return e=n.user(o()).id,f.UserLocalStorage.clearOtherUsers([e]),(s=a.folderDataCache(o())[t])?(f.UserLocalStorage.set(e,"folder-overview-"+t,{isCollapsed:s.isCollapsed}),[2]):[2]})})}},t.addLoadedComponent=function(e){var t=e.component;return{type:l.ActionTypes.ADD_LOADED_COMPONENT,payload:{component:t}}},t.removeLoadedComponent=function(e){var t=e.component;return{type:l.ActionTypes.REMOVE_LOADED_COMPONENT,payload:{component:t}}},t.setFailedToLoad=function(e){var t=e.hasFailedToLoad;return{type:l.ActionTypes.SET_FAILED_TO_LOAD,payload:{hasFailedToLoad:t}}},t.setDescriptionData=function(e,r){var o=e.text,n=e.latest_revision_id,s=e.file_obj_id,i=e.bolt_channel_state,a=e.format_version,c=e.last_modified_time,d=e.last_modified_user;if(!s)throw new Error("Unexpected response from Sprinkle");var u=n||"";r(t.updateFolderDataCache({fileId:s,folderData:{description:o,descriptionBaseRevision:u,descriptionLatestRevision:u,descriptionDraft:void 0,descriptionSaveState:l.DescriptionSaveState.IDLE,descriptionFormatVersion:a}})),r(t.addLoadedComponent({component:"description"})),r(v({folderFileId:s,time:c,userId:d})),E("description",i)},t.reloadDescriptionForCurrentFolder=function(){return function(e,o){return r.__awaiter(S,void 0,void 0,function(){var n;return r.__generator(this,function(r){return n=a.folderFileId(o()),e(t.reloadDescription({folderFileId:n})),[2]})})}},t.reloadDescription=function(e){var o=e.folderFileId;return function(e,i){return r.__awaiter(S,void 0,void 0,function(){var a,l,c;return r.__generator(this,function(r){switch(r.label){case 0:a=n.user(i()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.getDescription(a.id,o)];case 2:return l=r.sent(),t.setDescriptionData(l,e),[3,4];case 3:return c=r.sent(),m.reportException({err:c,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:o,isReload:!0}}),[3,4];case 4:return[2]}})})}},t.saveDescriptionDraft=function(e){var o=e.folderFileId;return function(e,d){return r.__awaiter(S,void 0,void 0,function(){function p(r){e(t.updateFolderDataCache({fileId:o,folderData:r}))}var h,f,_,m,S,v,E,T,F;return r.__generator(this,function(t){switch(t.label){case 0:h=n.user(d()).id,t.label=1;case 1:return t.trys.push([1,3,,4]),f=a.folderDataCache(d()),_=f[o],g(_)?(p({descriptionSaveState:l.DescriptionSaveState.SAVING}),[4,s.setDescription(h,o,_.descriptionLatestRevision,_.descriptionDraft,i.DESCRIPTION_VERSION.join("."))]):[2];case 2:return m=t.sent(),S=m.text,v=m.latest_revision_id,E=m.last_modified_time,T=m.last_modified_user,p({description:S,descriptionLatestRevision:v,descriptionSaveState:l.DescriptionSaveState.IDLE,lastModifiedTime:E,lastModifiedUserId:T}),u.logOverviewEdited(o,d()),[3,4];case 3:return F=t.sent(),s.isConflictError(F)?(p({descriptionSaveState:l.DescriptionSaveState.CONFLICT,lastModifiedUserId:void 0}),e(w({folderFileId:o}))):s.isFormatVersionError(F)?(c.showDescriptionFormatError(),p({descriptionSaveState:l.DescriptionSaveState.ERROR})):(c.showDescriptionSaveError(),p({descriptionSaveState:l.DescriptionSaveState.ERROR})),[3,4];case 4:return[2]}})})}},t.setContentReferencesData=function(e,r,o){var n=r.content_references||[],s=r.latest_revision_id,i=r.last_modified_time,a=r.last_modified_user;o(t.updateFolderDataCache({fileId:e,folderData:{contentReferences:n,contentReferencesRevision:s}})),o(v({folderFileId:e,time:i,userId:a})),o(t.addLoadedComponent({component:"content_references"})),E("content_references",r.bolt_channel_state)},t.reloadContentReferencesForCurrentFolder=function(){return function(e,o){return r.__awaiter(S,void 0,void 0,function(){var n;return r.__generator(this,function(r){return n=a.folderFileId(o()),e(t.reloadContentReferences({folderFileId:n})),[2]})})}},t.reloadContentReferences=function(e){var o=e.folderFileId;return function(e,i){return r.__awaiter(S,void 0,void 0,function(){var a,l,c;return r.__generator(this,function(r){switch(r.label){case 0:a=n.user(i()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.getContentReferences(a.id,o)];case 2:return l=r.sent(),t.setContentReferencesData(o,l,e),[3,4];case 3:return c=r.sent(),m.reportException({err:c,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:o,isReload:!0}}),[3,4];case 4:return[2]}})})}},t.addContentReferencesForCurrentFolder=function(e){var o=e.fileIds;return function(e,n){return r.__awaiter(S,void 0,void 0,function(){var s;return r.__generator(this,function(r){return s=a.folderFileId(n()),s&&e(t.addContentReferences({folderFileId:s,fileIds:o})),[2]})})}},t.addContentReferences=function(e){var o=e.folderFileId,i=e.fileIds;return function(e,a){return r.__awaiter(S,void 0,void 0,function(){var l,c;return r.__generator(this,function(r){switch(r.label){case 0:l=n.user(a()).id,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.addContentReferences(l,o,i)];case 2:return r.sent(),e(t.reloadContentReferences({folderFileId:o})),u.logOverviewEdited(o,a()),[3,4];case 3:return c=r.sent(),m.reportException({err:c,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]}),[3,4];case 4:return[2]}})})}},t.addContentReferencesForPath=function(e){var t=e.path,a=e.files;return function(e,l){return r.__awaiter(S,void 0,void 0,function(){var e,c;return r.__generator(this,function(r){switch(r.label){case 0:e=n.user(l()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.addContentReferencesToPath(e.id,t,a.map(p.fileToContentReferenceId))];case 2:return r.sent(),1===a.length?h.Snackbar.complete(i.PIN_TO_SUCCESS_SINGLE.format({file:o.filename(a[0].fq_path),path:o.filename(t,_.Viewer.get_root_name(e))}),"folder-overview-pin"):h.Snackbar.complete(i.PIN_TO_SUCCESS_MULTIPLE.format({num:a.length,path:o.filename(t,_.Viewer.get_root_name(e))}),"folder-overview-pin"),[3,4];case 3:return c=r.sent(),m.reportException({err:c,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]}),[3,4];case 4:return[2]}})})}},t.removeContentReferencesForCurrentFolder=function(e){var o=e.fileIds;return function(e,n){return r.__awaiter(S,void 0,void 0,function(){var s;return r.__generator(this,function(r){return s=a.folderFileId(n()),s&&e(t.removeContentReferences({folderFileId:s,fileIds:o})),[2]})})}},t.removeContentReferences=function(e){var o=e.folderFileId,i=e.fileIds;return function(e,a){return r.__awaiter(S,void 0,void 0,function(){var l,c;return r.__generator(this,function(r){switch(r.label){case 0:l=n.user(a()).id,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.removeContentReferences(l,o,i)];case 2:return r.sent(),e(t.reloadContentReferences({folderFileId:o})),u.logOverviewEdited(o,a()),[3,4];case 3:return c=r.sent(),m.reportException({err:c,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]}),[3,4];case 4:return[2]}})})}},t.updateFolderDataCache=function(e){var t=e.fileId,r=e.folderData;return{type:l.ActionTypes.UPDATE_FOLDER_DATA_CACHE,payload:{fileId:t,folderData:r}}};var g=function(e){return!!e&&(e.descriptionSaveState!==l.DescriptionSaveState.CONFLICT&&(e.descriptionSaveState!==l.DescriptionSaveState.SAVING&&p.hasUnsavedDescriptionDraft(e)))};t.fetchSharedFolderName=function(e){var i=e.path;return function(e,l){return r.__awaiter(S,void 0,void 0,function(){var c,d,u,h,f,_,S;return r.__generator(this,function(r){switch(r.label){case 0:if(o.paths_are_equal(i,"/"))return[2];if(c=p.normalizePath(i),d=a.nsIdCache(l())[c],!d)return[2];if(u=a.fileIdCache(l())[c],h=n.user(l()).id,f=p.extractSharedFolderId(d),!f)return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.getSharedFolderPath({userId:h,sharedFolderId:f})];case 2:return _=r.sent(),e(t.updateFolderDataCache({fileId:u,folderData:{sharedFolderPath:_}})),[3,4];case 3:return S=r.sent(),m.reportException({err:S,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]}),[3,4];case 4:return[2]}})})}},t.fetchAccountForUserId=function(e){var t=e.accountId;return function(e,o){return r.__awaiter(S,void 0,void 0,function(){var i,c,d;return r.__generator(this,function(r){switch(r.label){case 0:return c=n.user(o()),t?t in a.accountCache(o())?[2]:t===c.account_id?[2]:[4,s.getUserAccount({userId:c.id,accountId:t})]:[2];case 1:return d=r.sent(),e({type:l.ActionTypes.UPDATE_ACCOUNT_CACHE,payload:{accountCache:(i={},i[t]=d,i)}}),[2]}})})}},t.fetchLoggingFileId=function(e){var i=e.path;return function(e,l){return r.__awaiter(S,void 0,void 0,function(){var c,d,u,h,f;return r.__generator(this,function(r){switch(r.label){case 0:if(o.paths_are_equal(i,"/"))return[2];if(o.paths_are_equal(n.context(l()).currentFQPath,i)&&!n.context(l()).currentNSPath)return[2];c=p.normalizePath(i),d=a.fileIdCache(l())[c],u=n.user(l()).id,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.getLoggingFileId({userId:u,path:c})];case 2:return h=r.sent(),e(t.updateFolderDataCache({fileId:d,folderData:{loggingFileId:h}})),[3,4];case 3:return f=r.sent(),m.reportException({err:f,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]}),[3,4];case 4:return[2]}})})}};var v=function(e){var r=e.folderFileId,o=e.time,n=e.userId;return function(e,s){if(o&&n){var i=a.folderDataCache(s())[r];i&&(i.lastModifiedTime&&o<i.lastModifiedTime||(e(t.updateFolderDataCache({fileId:r,folderData:{lastModifiedTime:o,lastModifiedUserId:n}})),e(t.fetchAccountForUserId({accountId:n}))))}}},E=function(e,t){if(void 0!==t)try{var r=t.channel_id,o=t.revision,n=t.token;if(void 0===r||void 0===o||void 0===n)return;var s=r.unique_id,i=r.app_id;if(void 0===s||void 0===i)return;d.folderOverviewLiveUpdateManager.setUpdateChannelForType(e,{uniqueId:s,appId:i,token:n,revision:""+o})}catch(e){m.reportException({err:e,severity:m.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}},w=function(e){var t=e.folderFileId;return function(e,o){return r.__awaiter(S,void 0,void 0,function(){var i,a,l,c;return r.__generator(this,function(r){switch(r.label){case 0:return i=n.user(o()),[4,s.getDescription(i.id,t)];case 1:return a=r.sent(),l=a.last_modified_time,c=a.last_modified_user,e(v({folderFileId:t,time:l,userId:c})),[2]}})})}}}),define("modules/clean/react/folder_overview/data/reducer",["require","exports","tslib","modules/clean/react/browse/data/types","modules/clean/react/folder_overview/data/types","modules/clean/react/folder_overview/utils"],function(e,t,r,o,n,s){"use strict";function i(e,r){switch(void 0===e&&(e=t.defaultFolderOverviewState),r.type){
case n.ActionTypes.UPDATE_FOLDER_DATA_CACHE:return d(e,r.payload);case n.ActionTypes.UPDATE_FILE_ID_CACHE:return l(e,r.payload);case n.ActionTypes.UPDATE_ACCOUNT_CACHE:return c(e,r.payload);case o.ActionTypes.SET_CONTEXT:return a(e,r.payload);case n.ActionTypes.REMOVE_LOADED_COMPONENT:return u(e,r.payload);case n.ActionTypes.ADD_LOADED_COMPONENT:return p(e,r.payload);case n.ActionTypes.SET_FAILED_TO_LOAD:return h(e,r.payload);case o.ActionTypes.SET_UNSORTED_FILES:return f(e,r.payload)}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.defaultFolderOverviewState={folderDataCache:{},fileIdCache:{},accountCache:{},hasFailedToLoad:!1,nsIdCache:{},loadedComponents:[]};var a=function(e,t){var o,n=t.context;return r.__assign({},e,{nsIdCache:r.__assign({},e.nsIdCache,(o={},o[s.normalizePath(n.currentFQPath)]="ns:"+n.currentNSID+"/"+n.currentNSPath,o))})},l=function(e,t){var o=t.fileIdCache;return r.__assign({},e,{fileIdCache:r.__assign({},e.fileIdCache,o)})},c=function(e,t){var o=t.accountCache;return r.__assign({},e,{accountCache:r.__assign({},e.accountCache,o)})},d=function(e,t){var o,n=t.fileId,s=t.folderData;return r.__assign({},e,{folderDataCache:r.__assign({},e.folderDataCache,(o={},o[n]=r.__assign({},e.folderDataCache[n],s),o))})},u=function(e,t){var o=t.component;return r.__assign({},e,{loadedComponents:e.loadedComponents.filter(function(e){return e!==o})})},p=function(e,t){var o=t.component;return r.__assign({},e,{loadedComponents:e.loadedComponents.includes(o)?e.loadedComponents:e.loadedComponents.concat([o])})},h=function(e,t){var o=t.hasFailedToLoad;return r.__assign({},e,{hasFailedToLoad:o})},f=function(e,t){var o=t.unsortedFiles,n={};return o.filter(function(e){return e.is_dir}).forEach(function(e){n[s.normalizePath(e.fq_path)]=e.target_ns?"ns:"+e.target_ns+"/":"ns:"+e.ns_id+"/"+e.ns_path}),r.__assign({},e,{nsIdCache:r.__assign({},e.nsIdCache,n)})};t.folderOverviewReducer=i}),define("modules/clean/react/folder_overview/data/selectors",["require","exports","tslib","external/reselect","modules/clean/filepath","modules/clean/react/browse/data/reducer","modules/clean/react/folder_overview/constants","modules/clean/react/folder_overview/data/reducer","modules/clean/react/folder_overview/utils","modules/clean/redux/selectors","modules/clean/redux/namespaces"],function(e,t,r,o,n,s,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),l=r.__importStar(l);var u=function(e){return c.getStateAtNamespace(e,d.BROWSE_NAMESPACE_KEY)||s.defaultBrowseState},p=function(e){return u(e).path},h=function(e){return c.getStateAtNamespace(e,d.FOLDER_OVERVIEW_NAMESPACE_KEY)||a.defaultFolderOverviewState};t.folderDataCache=function(e){return h(e).folderDataCache},t.fileIdCache=function(e){return h(e).fileIdCache},t.nsIdCache=function(e){return h(e).nsIdCache},t.accountCache=function(e){return h(e).accountCache};var f=function(e){return e.BROWSE.user};t.loadedComponents=function(e){return h(e).loadedComponents},t.haveAllComponentsLoaded=function(e){return t.loadedComponents(e).length===i.NUM_COMPONENTS},t.hasFailedToLoad=function(e){return h(e).hasFailedToLoad},t.folderFileId=o.createSelector(t.fileIdCache,p,function(e,t){return e[l.normalizePath(t)]}),t.folderNsId=o.createSelector(t.nsIdCache,p,function(e,t){return e[l.normalizePath(t)]}),t.sharedFolderId=o.createSelector(t.nsIdCache,p,function(e,t){var r=e[l.normalizePath(t)];if(r)return l.extractSharedFolderId(r)}),t.descriptionAuthor=o.createSelector(f,l.convertDbxUserToIUser);var _=o.createSelector(t.folderDataCache,t.folderFileId,function(e,t){return e[t]});t.isCollapsed=o.createSelector(_,function(e){return!!e&&!!e.isCollapsed}),t.descriptionBaseRevision=o.createSelector(_,function(e){return e?e.descriptionBaseRevision:void 0}),t.lastModifiedTime=o.createSelector(_,function(e){return e?e.lastModifiedTime:void 0}),t.lastModifiedUserId=o.createSelector(_,function(e){return e?e.lastModifiedUserId:void 0}),t.lastModifiedUser=o.createSelector(t.lastModifiedUserId,t.accountCache,function(e,t){return e?t[e]:void 0}),t.descriptionSaveState=o.createSelector(_,function(e){return e?e.descriptionSaveState:void 0}),t.descriptionContent=o.createSelector(_,function(e){if(e&&e.description)try{return JSON.parse(e.description)}catch(e){return}}),t.descriptionFormatVersion=o.createSelector(_,function(e){return e?e.descriptionFormatVersion:void 0}),t.descriptionFormatValid=o.createSelector(t.descriptionFormatVersion,function(e){if(!e)return!0;var t=e.split(".").map(function(e){return parseInt(e,10)});return!(t[0]>i.DESCRIPTION_VERSION[0])&&!(t[0]===i.DESCRIPTION_VERSION[0]&&t[1]>i.DESCRIPTION_VERSION[1])}),t.descriptionContentIsEmpty=o.createSelector(t.descriptionContent,function(e){return!e||!(e.blocks.length>1)&&(0===e.blocks.length||""===e.blocks[0].text)}),t.hasUnsavedDescriptionDraft=o.createSelector(_,l.hasUnsavedDescriptionDraft),t.sharedFolderPath=o.createSelector(_,p,function(e,t){return e?e.sharedFolderPath||t:void 0}),t.sharedFolderName=o.createSelector(_,p,function(e,t){return e?n.filename(e.sharedFolderPath||t):void 0}),t.loggingFileId=o.createSelector(_,function(e){return e?e.loggingFileId:void 0}),t.pinnedItems=o.createSelector(_,function(e){if(void 0!==e&&void 0!==e.contentReferences)return l.convertContentReferencesToSortedFiles(e.contentReferences)}),t.isFolderOverviewEmpty=o.createSelector(t.descriptionContentIsEmpty,t.pinnedItems,function(e,t){return e&&!(t&&t.length)}),t.doesFolderOverviewExist=o.createSelector(_,function(e){return e&&(!!e.descriptionBaseRevision||!!e.contentReferencesRevision)})}),define("modules/clean/react/folder_overview/data/store",["require","exports","modules/clean/react/folder_overview/data/reducer","modules/clean/redux/store","modules/clean/redux/namespaces"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s;t.getStoreForFolderOverview=function(){var e;return s||(s=o.getStoreAndRegisterReducers((e={},e[n.FOLDER_OVERVIEW_NAMESPACE_KEY]=r.folderOverviewReducer,e))),s}}),define("modules/clean/react/folder_overview/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.UPDATE_FOLDER_DATA_CACHE="FOLDER_OVERVIEW/UPDATE_FOLDER_DATA_CACHE",e.UPDATE_FILE_ID_CACHE="FOLDER_OVERVIEW/UPDATE_FILE_ID_CACHE",e.REMOVE_LOADED_COMPONENT="FOLDER_OVERVIEW/REMOVE_LOADED_COMPONENT",e.ADD_LOADED_COMPONENT="FOLDER_OVERVIEW/ADD_LOADED_COMPONENT",e.SET_FAILED_TO_LOAD="FOLDER_OVERVIEW/SET_FAILED_TO_LOAD",e.UPDATE_ACCOUNT_CACHE="FOLDER_OVERVIEW/UPDATE_ACCOUNT_CACHE"})(t.ActionTypes||(t.ActionTypes={}));(function(e){e.IDLE="IDLE",e.SAVING="SAVING",e.CONFLICT="CONFLICT",e.ERROR="ERROR"})(t.DescriptionSaveState||(t.DescriptionSaveState={}))}),define("modules/clean/react/folder_overview/errors",["require","exports","modules/clean/react/folder_overview/constants","modules/clean/react/snackbar"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showDescriptionFormatError=function(){o.Snackbar.fail(r.ERROR_DESCRIPTION_FORMAT_VERSION)},t.showDescriptionSaveError=function(){o.Snackbar.fail(r.ERROR_DESCRIPTION_SAVE)}}),define("modules/clean/react/folder_overview/live_update",["require","exports","tslib","external/lodash","external/eventemitter3","modules/clean/bolt"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var i=(function(e){function t(){var t=e.call(this)||this;return t.setUpdateChannelForType=function(e,r){t.signedChannelStates[e]=new s.SignedChannelState(r.appId,r.uniqueId,r.revision,r.token),t.boltClient.update_states(o.values(t.signedChannelStates)),t.boltClient.start()},t.handleUpdate=function(e){var r=[];e.forEach(function(e){var n=o.findKey(t.signedChannelStates,{app_id:e.app_id,unique_id:e.unique_id});n&&!r.includes(n)&&(t.emit("update",{type:n}),r.push(n))})},t.handleRefresh=function(){t.boltClient.update_states(o.values(t.signedChannelStates))},t.boltClient=new s.BoltClient([],t.handleUpdate,t.handleRefresh),t.signedChannelStates={},t}return r.__extends(t,e),t.prototype.stop=function(){this.boltClient.unsubscribe()},t})(n.EventEmitter);t.FolderOverviewLiveUpdateManager=i,t.folderOverviewLiveUpdateManager=new i}),define("modules/clean/react/folder_overview/logging",["require","exports","tslib","external/sjcl","immutable","modules/clean/filepath","modules/clean/logging/hive/schemas/web-user-action","modules/clean/logging/telemetry","modules/clean/react/browse/data/selectors","modules/clean/react/folder_overview/data/selectors","modules/clean/react/folder_overview/utils","modules/clean/web_user_action_events"],function(e,t,r,o,n,s,i,a,l,c,d,u){"use strict";function p(e){return{length:e?h(e):0,features:e?f(e):[]}}function h(e){return e.blocks.map(function(e){return e.text.length}).reduce(function(e,t){return e+t},0)}function f(e){var t=n.OrderedSet();return t=t.merge(e.blocks.map(function(e){return e.type}).filter(function(e){return"unstyled"!==e})),e.blocks.forEach(function(e){return e.inlineStyleRanges.forEach(function(e){t=t.add(e.style)})}),e.blocks.forEach(function(r){return r.entityRanges.forEach(function(r){t=t.add(e.entityMap[r.key].type)})}),t.toArray().sort()}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),l=r.__importStar(l),c=r.__importStar(c),t.hiveLogger=new a.HiveLogger;var _=function(e,t){var r=c.folderDataCache(t)[e];if(r&&r.descriptionDraft)try{return JSON.parse(r.descriptionDraft)}catch(e){return}},m=function(e,t){var r=c.folderDataCache(t)[e];return r?r.contentReferences||[]:[]},S=function(e){if(!e)return"";var t=o.hash.sha256.hash(e.toLowerCase());return o.codec.hex.fromBits(t)},g=function(e){return(e||"/").split("/").map(S).join("/")},v=function(e){return S(s.normalize(e).split("/").pop())},E=function(e,t){var r=c.fileIdCache(t);for(var o in r)if(r[o]===e)return o},w=function(e){return e?{nsId:d.extractSharedFolderId(e),nsPath:d.extractSharedFolderPath(e)}:{}};t.makeEditedData=function(e,t){var r=E(e,t);if(r){var o=w(c.nsIdCache(t)[r]),n=o.nsId,s=o.nsPath;if(n){var i=p(_(e,t));return{resource_title:v(r),resource_type:"SFJ_FOLDER",ns_id:n,resource_path:g(r),resource_namespace_path:g(s),file_id:(s?c.loggingFileId(t):n)||null,file_obj_id:e,length:""+i.length,formatting:JSON.stringify(i.features),pins:JSON.stringify(m(e,t).map(function(e){return{file_id:e.ns_path?e.file_id:e.ns_id,file_obj_id:e.file_id,resource:{resource_title:v(e.fq_path),resource_type:e.is_dir?"SFJ_FOLDER":"SFJ_FILE",ns_id:""+e.ns_id,resource_path:g(e.fq_path),resource_namespace_path:g(e.ns_path)}}})),is_offline:"false"}}}},t.logOverviewEdited=function(e,r){t.logFolderOverviewAction(u.WebUserActionLogEvent.FOLDER_OVERVIEW_EDITED,l.user(r).id,null,t.makeEditedData(e,r))},t.logFolderOverviewAction=function(e,o,n,a){void 0===a&&(a={});var l={user_id:o,event_name:e,source:"browse"};n&&(l=r.__assign({},l,{file_nsid:n.ns_id,file_sjid:n.sjid,file_id:n.file_id,file_name:s.filename(n.fq_path),file_path:n.fq_path,file_extension:n.ext})),t.hiveLogger.log(new i.WebUserActionRow(r.__assign({},l,{extra:r.__assign({},a)})))}}),define("modules/clean/react/folder_overview/placeholder",["require","exports","tslib","react","modules/clean/react/folder_overview/constants","modules/clean/react_format"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var i=(function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype.render=function(){return o.default.createElement("div",{className:"folder-overview__description--placeholder"},s.reactFormat(n.DESCRIPTION_PLACEHOLDER,{link:o.default.createElement("a",{"aria-label":n.FOLDER_EXAMPLES_LINK_LABEL,href:this.props.folderExamplesLink,target:"_blank",rel:"noreferrer"})}))},t})(o.default.PureComponent);t.FolderOverviewPlaceholder=i}),define("modules/clean/react/folder_overview/utils",["require","exports","tslib","modules/clean/filepath","modules/clean/react/browse/models","modules/core/i18n"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.convertDbxUserToIUser=function(e){return{id:e.id.toString(),name:{display:e.display_name,initials:[e.fname.substr(0,1),e.lname.substr(0,1)].join(""),public:e.familiar_name},photoUrl:e.initials_url}},t.normalizePath=function(e){return o.normalize(e).toLowerCase()},t.hasUnsavedDescriptionDraft=function(e){return!!e&&(!!e.descriptionDraft&&e.description!==e.descriptionDraft)},t.convertContentReferencesToSortedFiles=function(e){var r=[];e.forEach(function(e){var o={file_id:e.file_id,fq_path:e.fq_path,href:e.href,icon:e.icon,is_cloud_doc:e.is_cloud_doc,is_dir:e.is_dir,thumbnail_url_tmpl:e.thumbnail_url_tmpl,ns_id:e.ns_id,ns_path:e.ns_path,sjid:e.sjid,isDeleted:e.is_deleted,ext:t.getFileExtension(e.fq_path)},s=new n.File(o);r.push(s)});var o=s.case_insensitive_comparator(!0);return r.sort(function(e,t){return o(n.File.getFilename(e),n.File.getFilename(t))})},t.getFileExtension=function(e){if(!e)return"";var t=o.file_extension(e);return t?"."+t:""},t.extractSharedFolderId=function(e){var t=/^ns:([0-9]+)\/?/.exec(e);return t?t[1]:void 0},t.extractSharedFolderPath=function(e){var t=/^ns:[0-9]+\/?(.*)/.exec(e);return t?t[1]:void 0},t.pathFromSharingFolder=function(e,t){return e.length>=t.length?o.filename(t):[o.filename(e)].concat(t.substr(e.length).split("/").filter(function(e){return!!e})).join(" › ")},t.fileToContentReferenceId=function(e){return e.is_dir&&e.target_ns?"ns:"+e.target_ns:e.file_id};var i=function(e){return"fname"in e};t.userInitials=function(e){return i(e)?e.fname.substr(0,1)+e.lname.substr(0,1):e.name.given_name.substr(0,1)+e.name.surname.substr(0,1)}}),define("modules/clean/react/growth/connected_checklist_banner",["require","exports","tslib","react","modules/core/browser","external/lodash","modules/core/i18n","premium-growth/checklist-banner","premium-growth/checklist-banner-item","modules/clean/react/css","modules/constants/trademark","modules/clean/analytics","modules/clean/api_v2/user_client"],function(e,t,r,o,n,s,i,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n),s=r.__importStar(s);t.fetchModules=function(e){return(new p.UserApiV2Client).ns("onboarding_tracker").rpc("get_checklist_modules_for_user",{},{subjectUserId:e.id})};var h=function(e,t){return(new p.UserApiV2Client).ns("growth").rpc("mark_onboarding_modules_as_completed",{modules:[t]},{subjectUserId:e.id})},f=(function(e){function c(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={tracker:void 0,modules:null,dimmed:!1,isOpen:!0},t.handleDismiss=function(){u.TeamsWebActionsLogger.log("onboarding_checklist_dismiss",{checklist_version:t.state.tracker,url:n.get_uri().path}),h(t.props.user,"dismissed_checklist_banner"),t.setState({isOpen:!1})},t}return r.__extends(c,e),c.prototype.componentDidMount=function(){var e=this;t.fetchModules(this.props.user).then(function(t){return e.postFetchActions(t)})},c.prototype.postFetchActions=function(e){this.setState({modules:e.modules,tracker:e.tracker}),this.isUserEduEnabled()?this.setState({dimmed:!0}):this.logOnboardingChecklistImpression(e.modules)},c.prototype.isDirectPurchase=function(e){return!!e&&["direct_purchase_team_creator_checklist_banner","direct_purchase_team_joiner_checklist_banner"].includes(e)},c.prototype.isUserEduEnabled=function(){var e=n.get_uri().getQuery();return this.props.isUserEduEnabled||e&&!!e.uem_wop},c.prototype.logOnboardingChecklistImpression=function(e){var t={checklist_version:this.state.tracker,url:n.get_uri().path};e.forEach(function(e){t[e.name+"_status"]=e.completed?"complete":"incomplete"}),u.TeamsWebActionsLogger.log("onboarding_checklist_impression",t)},c.prototype.redirectToUrl=function(e){e&&n.redirect(e)},c.prototype.mapModulesToChecklistItems=function(e){var t=this;return null===e?s.range(3).map(function(e){return o.default.createElement(l.ChecklistBannerItem,{loaded:!1,key:e})}):e.map(function(e){return o.default.createElement(l.ChecklistBannerItem,{key:e.name,status:e.completed?"complete":"incomplete",title:e.label,onClick:function(){t.redirectToUrl(e.url)}})})},c.prototype.mapModulesToCopy=function(e,t){return null===e?{title:"",subtitle:""}:t.is_team_admin&&!s.some(e,"completed")?{title:i._("First things first"),subtitle:i._("We picked the most important tasks to get you started with %(trademark_business)s.").format({trademark_business:d.TRADEMARK_BUSINESS})}:{title:i._("Finish setting up"),subtitle:i._("You’re almost done getting up and running with %(trademark_business)s.").format({trademark_business:d.TRADEMARK_BUSINESS})}},c.prototype.render=function(){var e=this.state,t=e.modules,n=e.dimmed,s=e.isOpen,i=e.tracker,l=this.isDirectPurchase(i),c=this.props.user;return s&&o.default.createElement(a.ChecklistBanner,r.__assign({loaded:!!t},this.props,this.mapModulesToCopy(t,c),{dimmed:n,onDismiss:l?this.handleDismiss:void 0}),this.mapModulesToChecklistItems(t))},c})(o.default.PureComponent);t.OnboardingChecklistBanner=c.requireCssWithComponent(f,["/static/js/premium-growth/index.web-vflN446C9.css","/static/css/font_sharp_grotesk-vfle4tE4q.css"])}),define("modules/clean/react/growth/education_module_event_bridge",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){this.requestSectionHandler=null,this.requestSharingCalloutHandler=null}return e.prototype.registerRequestSectionHandler=function(e){this.requestSectionHandler=e},e.prototype.requestSection=function(e){this.requestSectionHandler&&this.requestSectionHandler(e)},e.prototype.registerRequestSharingCalloutHandler=function(e){this.requestSharingCalloutHandler=e},e.prototype.requestSharingCallout=function(){this.requestSharingCalloutHandler&&this.requestSharingCalloutHandler()},e})();t.educationEventBridge=new r});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/growth/education_module_experiment",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger","modules/clean/react/css"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r.Loadable({loader:function(){return o.waitForTTI().then(function(){return new Promise(function(t,r){e(["modules/clean/react/growth/education_module_experiment_sync"],t,r)}).then(__importStar)}).then(function(e){return e.UnstyledEducationModuleExperiment})}});t.EducationModuleExperiment=n.requireCssWithComponent(s,["/static/js/premium-growth/index.web-vflN446C9.css","/static/css/growth/experiments/education_module_experiment-vflFlYQXJ.css","/static/css/font_sharp_grotesk-vfle4tE4q.css"])}),define("modules/clean/react/path_breadcrumbs",["require","exports","tslib","external/classnames","react","spectrum/icon_arrow","spectrum/icon_content","spectrum/popover","modules/clean/em_string","modules/clean/filepath","modules/core/i18n","modules/clean/user_education/react/user_education_effect","modules/clean/user_education/user_education_client","modules/clean/react/icon/icon_helper","modules/clean/react/title_bubble","modules/clean/react/retrieval_success_banner/util"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_){"use strict";function m(e,t,r){void 0===r&&(r=20);var o=t?2.625:new l.Emstring(e).length;return Math.max(r,20)-o}function S(e){return e>769?(e-417)/20:e/20}function g(e,t,r,o,n){void 0===n&&(n=20);for(var s=e.split("/").filter(Boolean),i=[{path:"",icon:"folder_dropbox-small",folderName:t,alt:r}],a=h.spectrumFolderIcon({size:h.SpectrumIconSize.Small}),u=0;u<s.length;u++)e="/"+s.slice(0,u+1).join("/"),i.push({path:e,folderName:c.filename(e),icon:a,alt:d._("Folder")});if(i.length<3)return{dropdownCrumbs:[],inlineCrumbs:i,root:i[0]};for(var p=i[0]&&i[0].folderName||"",f=m(p,!1,n),_=i.map(function(e){return new l.Emstring(e.folderName||"").length}),S=1,g=_[i.length-1],u=i.length-2;u>=1&&(g+=1.64,g+=_[u],!(g>f));u--)S+=1;i.length===S+1&&(S+=1),1===S&&o===E.SMALL&&S++;var v=i.length-S;return{dropdownCrumbs:i.slice(0,v),inlineCrumbs:i.slice(v),root:i[0]}}function v(e){switch(e){case E.LARGE:return"right";case E.SMALL:return"right-small"}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importDefault(n),c=r.__importStar(c);t.generateBreadcrumbData=g;var E;(function(e){e.LARGE="LARGE",e.SMALL="SMALL"})(E=t.PathBreadcrumbsSize||(t.PathBreadcrumbsSize={}));var w=(function(e){function t(t){var r=e.call(this,t)||this;return r.breadcrumbsContainerSpan=document.getElementById("page-content"),r.resizeListener=function(){if(r.breadcrumbsContainerSpan){var e=S(r.breadcrumbsContainerSpan.getBoundingClientRect().width);e!==r.state.maxWidthInEm&&r.setState({maxWidthInEm:e})}},r.state={maxWidthInEm:r.breadcrumbsContainerSpan?S(r.breadcrumbsContainerSpan.getBoundingClientRect().width):20},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){window.addEventListener("resize",this.resizeListener)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.resizeListener)},t.prototype.render=function(){var e=this.props.path,t=this.props,s=t.firstBreadcrumbName,i=t.firstBreadcrumbAlt,a=t.isDraggingInternalFiles,l=t.shouldHighlightDropTargets,p=t.setFileUploaderPath,h=t.getUrlForPath,f=t.setUrl,_=t.size,S=t.disableDragging,v=this.state.maxWidthInEm?this.state.maxWidthInEm:20,w=g(e,s,i,_,v),F=w.dropdownCrumbs,y=w.inlineCrumbs,C=w.root,I=m(C&&C.folderName||"",F.length>0,v),R=o.default({"brws-path-breadrumbs":!0,"brws-path-breadrumbs--small":this.props.size===E.SMALL}),O="page-header-text u-l-fl";return y.length>1||F.length>0?n.default.createElement("span",{className:R},n.default.createElement("h1",{className:"ax-visually-hidden"},c.filename(e)),n.default.createElement("nav",{className:O,id:"path-breadcrumbs","aria-label":d._("Folder hierarchy"),role:"navigation"},F.length>0&&n.default.createElement(b,{crumbs:F,currentPath:e,isDraggingInternalFiles:a,shouldHighlightDropTargets:l,setFileUploaderPath:p,setUrl:f,size:_,disableDragging:S}),y.map(function(t,o){return n.default.createElement(T,r.__assign({},t,{key:encodeURI(t.path),isOnlyCrumb:0===o&&1===y.length&&0===F.length,index:o,isLastCrumb:o===y.length-1,maxWidth:I,currentPath:e,isDraggingInternalFiles:a,isHighlightedDropTarget:l,setFileUploaderPath:p,getUrlForPath:h,setUrl:f,size:_,disableDragging:S}))}))):n.default.createElement("span",{className:R},n.default.createElement("h1",{className:O},n.default.createElement(u.UserEducationEffect,{containerName:"PathBreadcrumbs",name:"HomeTitle",useSpan:!0},s)))},t.defaultProps={path:"/",isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1,setFileUploaderPath:function(){},size:E.LARGE,disableDragging:!1},t})(n.default.PureComponent);t.PathBreadcrumbs=w;var T=(function(e){function t(t){var r=e.call(this,t)||this;return r.onDragEnterBreadcrumb=function(e){e.preventDefault(),e.target!==r.lastEnteredElement&&(r.props.disableDragging||(r.lastEnteredElement=e.target,r.dragEnterCount+=1,r.setState({isDraggedOver:!0}),r.props.isLastCrumb||r.props.setFileUploaderPath({path:r.props.path})))},r.onDragLeaveBreadcrumb=function(e){e.preventDefault(),r.props.disableDragging||(r.lastEnteredElement=null,r.dragEnterCount-=1,r.dragEnterCount<1&&(r.dragEnterCount=0,r.state.isDraggedOver&&(r.props.setFileUploaderPath({path:r.props.currentPath}),r.setState({isDraggedOver:!1}))))},r.onDropBreadcrumb=function(){r.setState({isDraggedOver:!1})},r.onDragOverBreadcrumb=function(e){e.preventDefault(),e.stopPropagation()},r.handleMouseEnter=function(){r.props.isDraggingInternalFiles&&r.setState({isDraggedOver:!0})},r.handleMouseLeave=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1})},r.handleMouseUp=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1})},r.navigateToFolder=function(e){_.resetSearchSuccessBannerSettings();var t=r.props.path;p.UEClient.sendEvent("BreadCrumbSegment","linkClicked",{path:t}),e.preventDefault(),r.props.setUrl({path:t})},r.eventHandlers={onDragEnter:r.onDragEnterBreadcrumb,onDragLeave:r.onDragLeaveBreadcrumb,onDrop:r.onDropBreadcrumb,onDragOver:r.onDragOverBreadcrumb,onMouseEnter:r.handleMouseEnter,onMouseLeave:r.handleMouseLeave,onMouseUp:r.handleMouseUp},r.state={isDraggedOver:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0,this.lastEnteredElement=null},t.prototype.render=function(){var e,t=this.props,i=t.getUrlForPath,a=t.path,c=t.index,d=t.isOnlyCrumb,p=t.maxWidth,h=t.isLastCrumb,_=t.isHighlightedDropTarget,m=t.size,S=d?this.props.folderName:l.Emstring.em_snippet(this.props.folderName,p),g={"breadcrumb-segment":!0,"breadcrumb-segment--is-drop-target":!h&&_,"breadcrumb-segment--file-dragged-over":!h&&this.state.isDraggedOver},E=v(m);return e=h?n.default.createElement("span",r.__assign({},this.eventHandlers),S):n.default.createElement("span",r.__assign({className:"breadcrumb-segment__wrapper"},this.eventHandlers),n.default.createElement(u.UserEducationEffect,{containerName:"BreadCrumbSegment",name:"link-"+c,useSpan:!0},n.default.createElement("a",{href:i(a).toString(),onClick:this.navigateToFolder,className:o.default(g)},S)),n.default.createElement(s.IconArrow,{name:E})),this.props.folderName!==S?n.default.createElement(f.TitleBubble,{content:this.props.folderName,position:f.TitleBubble.POSITIONS.BOTTOM,className:"list-label__title-bubble"},e):e},t.defaultProps={isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,disableDragging:!1},t})(n.default.Component),F=(function(e){function t(t){var r=e.call(this,t)||this;return r.onDragEnter=function(e){e.preventDefault(),e.target!==r.lastEnteredElement&&(r.props.disableDragging||(r.lastEnteredElement=e.target,r.dragEnterCount+=1,r.setState({isDraggedOver:!0}),r.props.setFileUploaderPath({path:r.props.path})))},r.onDragLeave=function(e){e.preventDefault(),r.props.disableDragging||(r.lastEnteredElement=null,r.dragEnterCount-=1,r.dragEnterCount<1&&(r.dragEnterCount=0,r.state.isDraggedOver&&(r.props.setFileUploaderPath({path:r.props.currentPath}),r.setState({isDraggedOver:!1}))))},r.onDrop=function(e){r.setState({isDraggedOver:!1}),r.dragEnterCount=0,r.props.closeFunc()},r.onDragOver=function(e){e.preventDefault(),e.stopPropagation()},r.handleMouseEnter=function(){r.props.isDraggingInternalFiles&&r.setState({isDraggedOver:!0})},r.handleMouseLeave=function(){r.state.isDraggedOver&&(r.setState({isDraggedOver:!1}),r.props.closeFunc())},r.handleMouseUp=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1}),r.props.isDraggingInternalFiles&&!r.props.isLastCrumb&&r.props.closeFunc()},r.state={isDraggedOver:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0,this.lastEnteredElement=null},t.prototype.render=function(){var e=this.props,t=e.icon,s=e.alt,l=e.folderName,c={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},d=n.default.createElement("span",{title:l,className:"breadcrumb-menu-item-wrapper"},n.default.createElement("span",{className:"breadcrumb-menu-item-icon"},n.default.createElement(i.IconContent,{name:t,"aria-label":s,role:"img"})),n.default.createElement("span",{className:"breadcrumb-menu-item-text"},l));return n.default.createElement(a.PopoverContentItem,r.__assign({value:this.props.path,className:o.default(c)},{onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop,onDragOver:this.onDragOver,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp}),d)},t.defaultProps={isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,disableDragging:!1},t})(n.default.Component),b=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={menuVisible:!1},t.onDragEnter=function(e){t.props.disableDragging||(e.preventDefault(),t.setState({menuVisible:!0}))},t.onInnerDragEnter=function(e){e.preventDefault(),t.dragEnterCount++},t.onDragLeave=function(e){e.preventDefault(),t.dragEnterCount--,t.dragEnterCount<1&&(t.dragEnterCount=0,t.state.menuVisible&&t.setState({menuVisible:!1}))},t.onMouseEnter=function(e){t.props.disableDragging||t.props.isDraggingInternalFiles&&!t.props.disableDragging&&(e.preventDefault(),t.setState({menuVisible:!0}))},t.onCrumbSelected=function(e){t.props.setUrl({path:e})},t.onPopoverToggle=function(e){var r=e.isOpen;t.setState({menuVisible:r})},t.onClose=function(){t.dragEnterCount=0,t.onPopoverToggle({isOpen:!1})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0},t.prototype.render=function(){var e=this,t=this.props.crumbs.slice().reverse(),r=this.props,o=r.currentPath,l=r.shouldHighlightDropTargets,c=r.isDraggingInternalFiles,u=r.setFileUploaderPath,p=r.size,h=r.disableDragging,f=d._("Show parent folders (descending)"),_=n.default.createElement(i.IconContent,{name:"folder_dropdown-small","aria-label":f,role:"img",className:"breadcrumb-menu-icon"}),m=v(p);return n.default.createElement(a.Popover,{onSelection:this.onCrumbSelected,onMenuToggle:this.onPopoverToggle,className:"breadcrumb-dropdown-container"},n.default.createElement(a.PopoverTrigger,{onDragOver:this.onDragEnter,onMouseEnter:this.onMouseEnter,tag:"button"},n.default.createElement("span",{className:"u-unbutton breadcrumb-overflow-button u-l-fl"},_)),n.default.createElement(a.PopoverContent,{isRevealed:this.state.menuVisible,onDragEnter:this.onInnerDragEnter,onDragLeave:this.onDragLeave},t.map(function(t){return n.default.createElement(F,{key:encodeURI(t.path),path:t.path,icon:t.icon,alt:t.alt,folderName:t.folderName,currentPath:o,isHighlightedDropTarget:l,isDraggingInternalFiles:c,setFileUploaderPath:u,closeFunc:e.onClose,disableDragging:h})})),n.default.createElement(s.IconArrow,{name:m,className:"breadcrumb__spacer"}))},t.defaultProps={shouldHighlightDropTargets:!1,isDraggingInternalFiles:!1,disableDragging:!1},t})(n.default.Component)}),define("modules/clean/react/retrieval_success_banner/data/selectors",["require","exports","modules/clean/react/retrieval_success_banner/data/reducer","modules/clean/redux/selectors","modules/clean/redux/namespaces"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){return o.getStateAtNamespace(e,n.RETRIEVAL_SUCCESS_BANNER_NAMESPACE_KEY)||r.defaultSuccessBannerState};t.isBrowseSuccessBannerCounterComplete=function(e){return s(e).browseSuccessBannerCounterComplete},t.isBrowseSuccessBannerVisible=function(e){return s(e).browseSuccessBannerShouldShow},t.isRetrievalSuccessBannerVisible=function(e){return s(e).retrievalSuccessBannerShouldShow},t.isSearchSuccessBannerVisible=function(e){return s(e).searchSuccessBannerShouldShow},t.isSearchBarAbandoned=function(e){return s(e).searchBarAbandoned},t.isSearchResultActionClicked=function(e){return s(e).searchResultActionClicked},t.isSearchSuccessBannerDismissed=function(e){return s(e).searchSuccessBannerDismissed}}),define("modules/clean/react/snackbar_manager",["require","exports","tslib","react","external/lodash","modules/clean/react/portal","modules/clean/react/snackbar","modules/core/accessible_announce","modules/core/exception","modules/clean/analytics"],function(e,t,r,o,n,s,i,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n),l=r.__importStar(l);var d=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleActionClick=function(){var e=r.state,t=e.displayedSnackbar,o=e.queue;if(t){var n=o[0].onActionClick;n&&n()}},r.handleCloseClick=function(){var e=r.dequeue();e&&(e.richSnackBarProps&&c.TeamsWebActionsLogger.log("edu_rich_confirmation_clk_close",e.richSnackBarProps.extraLogInfo),e.onCloseClick&&e.onCloseClick())},r.handleTimeout=function(){
var e=r.dequeue();e&&e.onTimeout&&e.onTimeout()},r.getAccessibleAnnouncement=function(e){return e.accessibleAnnouncement?e.accessibleAnnouncement:"string"==typeof e.title?e.title:null},r.state={queue:[],displayedSnackbar:null,isVisible:!0},r}return r.__extends(t,e),t.prototype.showContainer=function(){this.setState({isVisible:!0})},t.prototype.hideContainer=function(){this.setState({isVisible:!1})},t.prototype.show=function(e){e.id||l.reportStack("Missing `id` in Snackbar.show",{severity:l.SEVERITY.NONCRITICAL}),this.update(e)},t.prototype.update=function(e){e.id||l.reportStack("Missing `id` in Snackbar.update",{severity:l.SEVERITY.NONCRITICAL});var t=this.state.queue,r=n.findIndex(t,function(t){return t.id===e.id});if(r===-1)return void this.enqueue(e);0===r&&this.displayNewSnackbar(e);var o=t.slice();o[r]=e,this.setState({queue:o})},t.prototype.close=function(e){e||l.reportStack("Missing `id` in Snackbar.close",{severity:l.SEVERITY.NONCRITICAL}),this.dequeue(e)},t.prototype.displayNewSnackbar=function(e){var t=o.default.createElement(i.ControlledSnackbar,r.__assign({},e,{onActionClick:this.handleActionClick,onCloseClick:this.handleCloseClick,onTimeout:this.handleTimeout,key:e.id})),n=this.getAccessibleAnnouncement(e);if(n)if(this.state.displayedSnackbar){var s=this.getAccessibleAnnouncement(this.state.displayedSnackbar.props);n!==s&&a.AccessibleAnnounce.polite(n)}else a.AccessibleAnnounce.polite(n);this.setState({displayedSnackbar:t})},t.prototype.enqueue=function(e){var t=this.state.queue,o=r.__assign({id:Date.now().toString()},e);if(t.length||this.displayNewSnackbar(o),o.isLowPriority)return void this.setState({queue:t.concat([o])});var s=n.findIndex(t,function(e){return e.isLowPriority});s===-1?this.setState({queue:t.concat([o])}):0===s?(this.setState({queue:[o].concat(t)}),this.displayNewSnackbar(o)):this.setState({queue:t.slice(0,s).concat([o],t.slice(s))})},t.prototype.dequeue=function(e){var t=this.state.queue,r=e?n.findIndex(t,function(t){return t.id===e}):0,o=t[r];if(o)return t.length>1?(this.setState({queue:t.slice(0,r).concat(t.slice(r+1))}),0===r&&this.displayNewSnackbar(t[1])):this.setState({queue:[],displayedSnackbar:null}),o},t.prototype.render=function(){var e=this.state,t=e.displayedSnackbar,r=e.isVisible;return t&&r?o.default.createElement(s.Portal,{className:"snackbar-container"},t):null},t})(o.default.PureComponent);t.SnackbarManager=d}),define("modules/clean/redux/tests/store",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockExtraArguments=function(){return{}}}),define("modules/clean/search/api",["require","exports","tslib","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/api_helpers","modules/clean/search/constants","modules/clean/search/models","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store","modules/clean/search/search_helpers","modules/clean/search/types"],function(e,t,r,o,n,s,i,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),a=r.__importStar(a),u=r.__importStar(u);var h=(function(){function e(){this._activeRequest=null,this._activeSuggestionRequest=null}return e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype.loadResults=function(e){var t=e.user,r=e.path,o=e.query,n=e.start,s=e.maxResults,l=e.searchSessionId,c=e.nsId,d=e.fileNameOnly,p=e.loadDeleted,h=e.showPaperResults,f=e.isDropdown,_=e.isAdminConsole,m=e.webTimer,S=e.onSuccess,g=e.onError,v=e.overrideUrl,E=e.searchResultsExperiments,w=i.getCurrentTimezoneOffset(),T={query:o,search_token:u.getSearchCsrfToken(),fq_path:r,ns_id:c,filename_only:!!d,max_results:s,deleted:!!p,start:n,show_paper_results:!!h,is_dropdown:!!f,is_admin_console:!!_,show_unmounted_results:!0,timezone_offset:w,show_symlink_icon:!!E.expShowSymlinkIcon,include_browse_context:!0,calculate_folder_size:!!E.expFolderCalcSize,include_shared_docs:!0,include_snippets:!!E.expSnippets},F=v?v:a.SEARCH_FRONTEND_SERVICE_ENDPOINT;this._fetchResults({requestData:T,user:t,searchSessionId:l,url:F,onSuccess:S,onError:g,webTimer:m})},e.prototype._extractSearchResultsList=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var n=o[r];switch(n.search_result_type){case p.SearchResultTypes.FILE:t.push(s.File.fromServerObject(n));break;case p.SearchResultTypes.FILE_SHARED_WITH_ME:t.push(s.FileSharedWithMe.fromServerObject(n));break;case p.SearchResultTypes.PAPER:t.push(s.Paper.fromServerObject(n));break;case p.SearchResultTypes.PAPER_FOLDER:t.push(s.PaperFolder.fromServerObject(n))}}return t},e.prototype._getSearchType=function(e){return e.is_image_content_search?"image_search":e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"},e.prototype.loadPartialResults=function(e){var t=e.user,o=e.maxResults,n=e.start,s=e.path,i=e.query,l=e.fileCategories,c=e.isPaperEnabled,d=void 0===c||c,p=e.searchSessionId,h=e.includeBrowseContext,f=e.webTimer,_=e.sortOrder,m=e.searchType,S=e.getSuggestion,g=e.onSuccess,v=e.onError,E=e.searchResultsExperiments,w=e.skipLogging,T=e.deleted;m===a.SearchType.IMAGE&&(l=void 0);var F=l&&!u.allCategoriesChecked(l,d)?u.fileCategoriesToString(l):"",b=_?u.sortFieldToOrderBy(_.sortField):"",y=_?u.sortDirectionToReverseOrder(_.sortDirection):"",C=r.__assign({query:i,search_token:u.getSearchCsrfToken(),fq_path:s,start:n,max_results:o,deleted:T,show_paper_results:m!==a.SearchType.IMAGE,show_symlink_icon:!!E.expShowSymlinkIcon,include_browse_context:h,search_session_id:p,calculate_folder_size:!!E.expFolderCalcSize},F&&{file_categories:F},{is_image_content_search:m===a.SearchType.IMAGE,is_prompt_request:S,order_by:b,reverse_order:y,include_shared_docs:!0,include_snippets:!!E.expSnippets&&m===a.SearchType.ALL});this._fetchResults({requestData:C,user:t,searchSessionId:p,url:a.SEARCH_FRONTEND_SERVICE_ENDPOINT,onSuccess:g,onError:v,webTimer:f,skipLogging:w,getSuggestion:S})},e.prototype._fetchResults=function(e){var t=this,s=e.requestData,i=e.user,a=e.searchSessionId,p=e.url,h=e.onSuccess,f=e.onError,_=e.webTimer,m=e.skipLogging,S=e.getSuggestion;if(S?null!==this._activeSuggestionRequest&&this._activeSuggestionRequest.abort():null!=this._activeRequest&&this._activeRequest.abort(),""!==s.query){var g=u.fileCategoryStringToLogValue(s.file_categories),v=c.experiments(d.getStoreForSearchBar().getState()),E=r.__assign({path_scoped:"/"!==s.fq_path,search_type:this._getSearchType(s),query_string:s.query,start:s.start,search_session_id:a,timezone_offset:s.timezone_offset},u.isInFileTypeFilterExperiment(v)&&{file_type_filters:g});m||n.SearchClientActivityLogger.log("query_started",i.id,E);var w=(new Date).getTime(),T=o.WebRequest({url:p,data:s,dataType:"json",subject_user:i,success:function(e,r,o){var c;s.include_browse_context&&(c=l.extractBrowseContext(e));var d=e.search_results,u=o.getResponseHeader("x-dropbox-request-id");d.forEach(function(e){return e.request_id=u});var p={results:t._extractSearchResultsList(d),hasMore:!!e.more,nextPageOffset:+e.next_offset||0};if(h({context:c,searchResults:p,deleted:!!s.deleted,requestId:u}),!m){var f=n.SearchClientActivityLogger.create_search_log_dict(E,u,w,s.query,p.results.length,null,a);n.SearchClientActivityLogger.log("query_completed",i.id,f)}_&&_.end(u?u:void 0)},error:function(e,t,r){var o=e.getResponseHeader("x-dropbox-request-id");if("abort"!==t&&"function"==typeof f&&f(r,o),!m){var l=n.SearchClientActivityLogger.create_search_log_dict(E,o,w,s.query,null,t,a);n.SearchClientActivityLogger.log("query_failed",i.id,l)}_&&_.abort()},complete:function(){S?this._activeSuggestionRequest=null:this._activeRequest=null}});S?this._activeSuggestionRequest=T:this._activeRequest=T}},e.prototype.fetchAdditionalFileMetadata=function(e){var t=e.searchResults,r=e.user,n=e.onSuccess,i=e.onError,l=t.filter(function(e){return e instanceof s.File}),c=l.map(function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]});c.length>0&&o.WebRequest({url:a.FILE_INFO_ENDPOINT,data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(c)},dataType:"json",subject_user:r,success:function(e,t,r){for(var o=e.file_results,s=[],i=0,a=o;i<a.length;i++){var l=a[i];s.push(l)}n(s)},error:function(e,t,r){"abort"!==t&&"function"==typeof i&&i(r,e.getResponseHeader("x-dropbox-request-id"))}})},e})();t.SearchApiClient=h,t.searchApiClient=new h}),define("modules/clean/search/search_results/actions",["require","exports","tslib","modules/clean/search/constants","modules/clean/search/constants","modules/core/i18n","modules/clean/search/search_results/dispatcher","modules/clean/search/api","modules/clean/search/search_results/store","modules/clean/search/store_helpers","modules/clean/search/search_helpers"],function(e,t,r,o,n,s,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),c=r.__importStar(c);var u=(function(){function e(e,t){void 0===e&&(e=a.searchApiClient),void 0===t&&(t=l.getSearchResultsStore()),this._searchApi=e,this._searchResultsStore=t}return e.prototype.runSearch=function(e){var t=this,s=e.user,a=e.path,l=e.query,d=e.searchSessionId,u=e.webTimer,p=e.deletedFiles,h=e.expSinglePageSearch,f=e.fileCategories,_=e.isPaperEnabled,m=void 0===_||_,S=e.sortOrder,g=e.searchResultsExperiments,v=e.searchType,E=c.generateRandomId();h&&!this._searchResultsStore.searchResults().isEmpty()||i.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION}),i.SearchResultsDispatcher.dispatch({type:o.START_SEARCH_ACTION,data:{query:l,searchSessionId:d,queryId:E,fileCategories:f,sortOrder:S,searchType:v||n.SearchType.ALL}}),v===n.SearchType.IMAGE&&void 0===p&&(p=!1);var w=n.MaxResults.MAX_SEARCH_RESULTS;if(p!==!0){var T={user:s,path:a,query:l,start:0,searchSessionId:d,includeBrowseContext:!0,webTimer:u,maxResults:w,fileCategories:f,isPaperEnabled:m,sortOrder:S,searchResultsExperiments:g,searchType:v||n.SearchType.ALL};this._searchApi.loadPartialResults(r.__assign({},T,{onSuccess:function(e){var r=e.searchResults,o=e.context;E===t._searchResultsStore.queryId()&&u.fetchedDataRequiredForTTI(),t._setSearchResults({searchResults:r,context:o,deletedFiles:!!p,queryId:E}),window.scrollTo(0,0),g.expFolderCalcSize&&t.setFolderSize(),void 0===p&&t._loadDeletedResults({path:a,user:s,isPaperEnabled:m}),t._searchApi.fetchAdditionalFileMetadata({searchResults:r.results,user:s,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:E})}})}})),this._shouldGetImageSuggestion(T)&&this._searchApi.loadPartialResults(r.__assign({},T,{includeBrowseContext:!1,skipLogging:!0,getSuggestion:!0,searchType:n.SearchType.IMAGE,onSuccess:function(e){var r=e.searchResults,o=e.requestId;t._setImageSearchSuggestions({imageSuggestions:r,queryId:E,query:T.query,requestId:o})}}))}else this._searchApi.loadResults({user:s,path:a,query:l,start:0,maxResults:w,showPaperResults:!0,searchSessionId:d,webTimer:u,loadDeleted:p,searchResultsExperiments:g,onSuccess:function(e){var r=e.searchResults,o=e.context;E===t._searchResultsStore.queryId()&&u.fetchedDataRequiredForTTI(),t._setSearchResults({searchResults:r,context:o,deletedFiles:!!p,queryId:E}),g.expFolderCalcSize&&t.setFolderSize(),void 0===p&&t._loadDeletedResults({path:a,user:s,isPaperEnabled:m})}})},e.prototype.fetchCompleteSearchResultSRP=function(e){var t=this,r=e.searchResult,o=e.user,n=e.onSuccess,i=e.onError;if(r.isDeleted)return n(r);var a=l.getSearchResultsStore().fullSearchResults().get(r.fq_path,null);if(a){n(this._mergePartialAndCompleteResult({partialResult:r,completeResult:a}))}else this._searchApi.fetchAdditionalFileMetadata({searchResults:[r],user:o,onSuccess:function(e){if(e.length>0){n(t._mergePartialAndCompleteResult({partialResult:r,completeResult:e[0]}))}else if(i){var o=s._("There was a problem completing this request.");i(o)}},onError:i})},e.prototype._mergePartialAndCompleteResult=function(e){var t=e.partialResult,o=e.completeResult;return r.__assign({},t,o)},e.prototype.loadMoreResults=function(e){var t=this,r=e.path,s=e.user,a=e.deletedFiles,l=e.isPaperEnabled,c=void 0===l||l,u=e.searchResultsExperiments,p=!1,h=this._searchResultsStore.latestFileCategories(),f=!d.allCategoriesUnchecked(h,c)&&!d.allCategoriesChecked(h,c);if(this._searchResultsStore.loadingState()===o.SearchLoadingState.LOADED){if(void 0===a)if(this._searchResultsStore.hasMoreResults())p=!1;else{if(!this._searchResultsStore.hasMoreResults(!f))return;p=!0}else{if(!this._searchResultsStore.hasMoreResults(a&&!f))return;p=a&&!f}i.SearchResultsDispatcher.dispatch({type:o.CONTINUE_SEARCH_ACTION,data:{didLoadDeletedResults:p}});var _=p?this._searchResultsStore.moreDeletedSearchResultsOffset():this._searchResultsStore.moreLiveSearchResultsOffset(),m=this._searchResultsStore.queryId();if(p)this._searchApi.loadResults({user:s,path:r,query:this._searchResultsStore.latestQuery(),fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:p,start:_,maxResults:n.MaxResults.MAX_SEARCH_RESULTS,searchSessionId:this._searchResultsStore.searchSessionId(),searchResultsExperiments:u,onSuccess:function(e){var o=e.searchResults,n=(e.context,e.deleted);t._appendSearchResults({searchResults:o,deleted:n}),void 0===a&&t._loadDeletedResults({path:r,user:s,isPaperEnabled:c})}});else{var S=this._searchResultsStore.latestQuery();this._searchApi.loadPartialResults({user:s,path:r,query:S,start:_,includeBrowseContext:!1,searchSessionId:this._searchResultsStore.searchSessionId(),maxResults:n.MaxResults.MAX_SEARCH_RESULTS,fileCategories:h,isPaperEnabled:c,sortOrder:this._searchResultsStore.sortOrder(),searchResultsExperiments:u,searchType:this._searchResultsStore.searchType(),onSuccess:function(e){var o=e.searchResults;e.context;t._appendSearchResults({searchResults:o,deleted:!1}),u.expFolderCalcSize&&t.setFolderSize(),t._searchApi.fetchAdditionalFileMetadata({searchResults:o.results,user:s,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:m})}}),void 0===a&&t._loadDeletedResults({path:r,user:s,isPaperEnabled:c})}})}}},e.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,n=e.deletedFiles,s=e.queryId;i.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:r,deletedFiles:n,queryId:s}})},e.prototype._shouldGetImageSuggestion=function(e){var t=e.searchResultsExperiments,r=e.searchType;return!!t.expImageContentSearch&&r!==o.SearchType.IMAGE},e.prototype._setImageSearchSuggestions=function(e){var t=e.imageSuggestions,r=e.queryId,n=e.query,s=e.requestId;i.SearchResultsDispatcher.dispatch({type:o.SET_IMAGE_SEARCH_SUGGESTION_ACTION,data:{imageSuggestions:t,queryId:r,query:n,requestId:s}})},e.prototype._setFullSearchResults=function(e){var t=e.searchResults,r=e.queryId;i.SearchResultsDispatcher.dispatch({type:o.SET_FULL_SEARCH_RESULTS_ACTION,data:{searchResults:t,queryId:r}})},e.prototype._appendSearchResults=function(e){var t=e.searchResults,r=e.deleted;i.SearchResultsDispatcher.dispatch({type:o.APPEND_SEARCH_RESULTS_ACTION,data:{searchResults:t,deleted:r}})},e.prototype._loadDeletedResults=function(e){var t=e.path,r=e.user,o=e.isPaperEnabled;this._searchResultsStore.hasMoreResults()||this._searchResultsStore.didLoadDeletedResults()||this.loadMoreResults({path:t,user:r,isPaperEnabled:o,searchResultsExperiments:{}})},e.prototype.setSearchSelection=function(e){var t=e.selection;i.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_SELECTION_ACTION,data:{selection:t}})},e.prototype.clearSearch=function(){i.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION})},e.prototype.setFileTypeFilter=function(e){var t=e.fileCategories;i.SearchResultsDispatcher.dispatch({type:o.SET_FILE_TYPE_FILTER_ACTION,data:{fileCategories:t}})},e.prototype.selectFirstFile=function(){i.SearchResultsDispatcher.dispatch({type:o.SELECT_FIRST_FILE_ACTION,data:{}})},e.prototype.setFolderSize=function(){i.SearchResultsDispatcher.dispatch({type:o.SET_FOLDER_SIZE_ACTION,data:{}})},e.prototype.sortSearchResults=function(e){i.SearchResultsDispatcher.dispatch({type:o.SORT_SEARCH_RESULTS_ACTION,data:{sortOrder:e}}),window.scrollTo(0,0)},e})();t.SearchResultsActions=u,t.searchResultsActions=new u}),define("modules/clean/search/search_results/controller",["require","exports","tslib","external/lodash","react","external/react-dom","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/search/constants","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/search/search_results/view","modules/clean/web_user_action_events","modules/clean/react/extensions/client"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),s=r.__importStar(s),i=r.__importStar(i),c=r.__importStar(c);var m=(function(t){function l(){var e=null!==t&&t.apply(this,arguments)||this;return e._onSearchResultsStoreChanged=function(){e.setState(e._getStateFromSearchResultsStore()),e.deferredCheckForMissingStarredData&&e.deferredCheckForMissingStarredData()},e._handleScroll=function(){try{if(s.findDOMNode(e).getBoundingClientRect().bottom<=window.innerHeight){var t=e.props,r=t.path,o=t.user,n=t.shouldShowDeletedFiles,i=t.searchResultsExperiments,a=t.isPaperEnabled,l=n;void 0===l&&e.state.searchType===c.SearchType.IMAGE&&(l=!1),d.searchResultsActions.loadMoreResults({path:r,user:o,deletedFiles:l,isPaperEnabled:a,searchResultsExperiments:i})}}catch(e){}},e._handleSelectionChange=function(e){d.searchResultsActions.setSearchSelection({selection:e})},e._handleLocationLinkClick=function(t,r){var o=e.props,n=o.user,s=o.viewType;if(u.recordSearchResultsAction({result:t,user:n,action_type:f.WebUserActionLogEvent.CLICK_PATH_LINK,view_type:s,search_type:e.state.searchType}),!r){var a=i.parent_dir(t.fq_path);e.props.onNavigateToPath(a)}},e._handleFilesViewShowShare=function(t,r){var o=e.props,n=o.user,s=o.filesViewActionHandlers,i=o.viewType;u.recordSearchResultsAction({result:t,user:n,action_type:f.WebUserActionLogEvent.SHARE,view_type:i,search_type:e.state.searchType}),s.onShowShare(t,r)},e}return r.__extends(l,t),l.prototype.componentWillMount=function(){this.state=this._getStateFromSearchResultsStore()},l.prototype.componentWillReceiveProps=function(e){e.arePostTTIModulesLoaded&&!this.props.arePostTTIModulesLoaded&&this.enableStarring()},l.prototype.componentDidMount=function(){p.getSearchResultsStore().add_change_listener(this._onSearchResultsStoreChanged),this.props.arePostTTIModulesLoaded&&this.enableStarring(),this.setState(this._getStateFromSearchResultsStore()),window.scrollTo(0,0)},l.prototype.componentWillUnmount=function(){p.getSearchResultsStore().remove_change_listener(this._onSearchResultsStoreChanged)},l.prototype.componentDidUpdate=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var e;return r.__generator(this,function(r){switch(r.label){case 0:return this.state.searchResults===t.searchResults?[3,2]:[4,this.getAppActions(this.state.searchResults)];case 1:e=r.sent(),this.setState({fileExtensionsConfigs:e}),r.label=2;case 2:return[2]}})})},l.prototype.enableStarring=function(){return r.__awaiter(this,void 0,void 0,function(){var t,n=this;return r.__generator(this,function(s){switch(s.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar)];case 1:return t=s.sent().checkForMissingStarredData,this.deferredCheckForMissingStarredData=function(){o.defer(function(){var e=[];p.getSearchResultsStore().searchResults().forEach(function(t){t instanceof a.File&&e.push(t),(t instanceof a.Paper||t instanceof a.PaperFolder)&&e.push(t)}),t({items:e,user:n.props.user})})},this.deferredCheckForMissingStarredData(),[2]}})})},l.prototype._getStateFromSearchResultsStore=function(){var e=p.getSearchResultsStore(),t=e.latestQuery(),r=e.loadingState(),o=this.state?this.state.loadingState!==r&&this.state.loadingState===c.SearchLoadingState.LOADING_FIRST_PAGE?t:this.state.queryForResultsTitle:"";return this.state&&this.state.queryForResultsTitle&&this.state.queryForResultsTitle!==t&&o===t&&this.props.handleComponentTTI("SearchResultsTitle"),{context:e.browseContext(),hasMoreResults:e.hasMoreResults(),loadingState:r,latestQuery:t,queryForResultsTitle:o,searchSessionId:e.searchSessionId(),fullSearchResults:e.fullSearchResults(),searchResults:e.searchResults(),selection:e.selection(),selectedFiles:e.selectedFiles(),searchType:e.searchType(),numImageSuggestions:e.numImageSuggestions(),imageSuggestionQuery:e.imageSuggestionQuery(),imageSuggestionRequestId:e.imageSuggestionRequestId()}},l.prototype.getAppActions=function(e){return r.__awaiter(this,void 0,void 0,function(){var t,o;return r.__generator(this,function(r){switch(r.label){case 0:return t=e.toArray().filter(function(e){return e instanceof a.File&&!e.isDeleted}),o=_.getExtensionsClient(),[4,o.getActionsForFileBatch(t,this.props.user.id)];case 1:return[2,r.sent()]}})})},l.prototype.render=function(){var e=this.props,t=e.searchResultsExperiments,s=e.searchBarExperiments,i=e.maestroSearchBarProps,a=e.onFocusSearchBar,l=e.onSearch,c=e.onNavigateToFileOrFolder,d=e.setFileUploaderPath,u=e.path,p=e.user,f=e.handleComponentTTI,_=e.ensureFileViewerClosedIfNotPreviewing,m=e.getIsFileJumping,S=e.isFileViewerShown,g=e.fileRename,v=e.arePostTTIModulesLoaded,E=e.getOverflowMenuActions,w=e.filesViewActionHandlers,T=e.onNavigateToParentFolder,F=e.shouldShowDeletedFiles,b=e.browseExperiments,y=e.onOpenFileSharedWithMe,C=e.onOpenPaper,I=e.renderSharedWithController,R=e.hrefForFile,O=e.responsive,P=e.onSearchFiltersChanged,D=e.starredState,A=e.fileCategories,N=e.viewType,L=e.pageHeaderHeight,x=e.currentSort,M=e.onSortChange,k=this.state,U=k.context,V=k.hasMoreResults,B=k.loadingState,q=k.latestQuery,H=k.queryForResultsTitle,W=k.searchSessionId,G=k.searchResults,z=k.selection,j=k.selectedFiles,Q=k.fileExtensionsConfigs,Y=r.__assign({},w,{onShowShare:this._handleFilesViewShowShare});return n.default.createElement(h.SearchResultsView,{filesViewActionHandlers:Y,searchResultsExperiments:t,searchBarExperiments:s,browseExperiments:b,maestroSearchBarProps:i,onFocusSearchBar:a,onSearch:l,onScroll:o.throttle(this._handleScroll,200),setFileUploaderPath:d,onSelectionChange:this._handleSelectionChange,path:u,user:p,handleComponentTTI:f,ensureFileViewerClosedIfNotPreviewing:_,getIsFileJumping:m,isFileViewerShown:S,fileRename:g,arePostTTIModulesLoaded:v,getOverflowMenuActions:E,onLocationLinkClick:this._handleLocationLinkClick,onNavigateToFileOrFolder:c,onNavigateToParentFolder:T,onOpenFileSharedWithMe:y,onOpenPaper:C,context:U,hasMoreResults:V,loadingState:B,latestQuery:q,queryForResultsTitle:H,searchSessionId:W,searchResults:G,selection:z,selectedFiles:j,viewType:N,shouldShowDeletedFiles:F,renderSharedWithController:I,hrefForFile:R,responsive:O,onSearchFiltersChanged:P,starredState:D,fileCategories:A,pageHeaderHeight:L,onStarClick:this.props.onStarClick,fileExtensionsConfigs:Q,currentSort:x,onSortChange:M,searchType:this.state.searchType,numImageSuggestions:this.state.numImageSuggestions,imageSuggestionQuery:this.state.imageSuggestionQuery,imageSuggestionRequestId:this.state.imageSuggestionRequestId,showImageSuggestionSnackbar:!0})},l})(n.default.Component);t.SearchResultsController=l.requireCssWithComponent(m,["/static/css/browse/browse-vfl8WNZDd.css","/static/css/search/search_results-vfl5T-x3r.css","/static/css/scooter/scooter-scoped-vflWuydQl.css","/static/js/retrieval-components/index.web-vfl4qjaZj.css"])}),define("modules/clean/search/search_results/dispatcher",["require","exports","tslib","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/search/search_results/store"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.SearchResultsDispatcher={dispatch:function(e){o.assert(s.searchResultsStoreInstantiated(),"Must call getSearchResultsStore() before a dispatch"),n.Dispatcher.dispatch(e)}}}),define("modules/clean/search/search_results/log_helper",["require","exports","tslib","modules/clean/search/logger","modules/clean/search/search_results/store","modules/clean/web_user_action_events","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/action_creators","modules/clean/search/constants"],function(e,t,r,o,n,s,i,a,l){"use strict";function c(e){var t=e.result,r=e.user,s=e.action_type,l=e.view_type,c=e.search_type,d=e.action_surface,p=n.getSearchResultsStore().searchSessionId(),h=n.getSearchResultsStore().latestQuery(),f={rawQuery:h,normalizedQuery:h};i.getStoreForSearchBar().dispatch(a.addQueryToHistory({user:r,query:f,searchSessionId:p,requestId:t.request_id||""})),o.logSearchAction({searchSessionId:p,result:t,user:r,action_type:s,search_type:u(c),viewport:"full-view",view_type:l,action_surface:d})}function d(e){var t=e.user,r=e.view_type,i=e.sort_order,a=e.search_type,l=n.getSearchResultsStore().searchSessionId();o.logSearchResultsSortOrderChange({searchSessionId:l,user:t,action_type:s.WebUserActionLogEvent.SORT_RECORDS,search_type:u(a),sort_order:i,viewport:"full-view",view_type:r})}function u(e){return e===l.SearchType.IMAGE?"image_search":"full_page"}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.recordSearchResultsAction=c,t.recordSearchResultsSortOrderChange=d}),define("modules/clean/search/search_results/search_filters",["require","exports","tslib","react","modules/core/i18n","spectrum/tertiary_link","spectrum/label","spectrum/radio_button","spectrum/checkbox","modules/clean/filepath","modules/clean/react/folder_dialog/async","modules/clean/react/path_filter_button","modules/clean/search/types","modules/clean/search/search_helpers","modules/clean/search/search_bar/experiments","spectrum/icon_arrow","modules/clean/search/constants","external/classnames","spectrum/icon_content","spectrum/tooltip","modules/clean/logging/hive/schemas/web-modal-activity"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),c=r.__importStar(c),S=r.__importDefault(S);var w=(function(e){function t(w){var T,F=e.call(this,w)||this;F.showFolderFilterModal=function(){var e=F.props,t=e.user,r=e.path,o=e.onFiltersChanged;d.showFolderDialog({ariaLabel:n._("Folder selector"),canSelectReadonly:!0,initialPath:r,modalName:E.ModalName.SEARCH_FILTER,primaryActionLabel:n._("Select"),title:n._("Select a folder"),user:t,onSuccess:function(e){o({path:e})}})},F.resetFilters=function(){var e=F.props,t=e.searchBarExperiments,o=e.onFiltersChanged,n={};f.isInDeletedFilterRightRailExperiment(t)&&(n.deletedFiles=!1),n.path="/",h.isInFileTypeFilterExperiment(t)&&(n.fileCategories=r.__assign({},m.FILE_CATEGORIES_UNCHECKED)),o(n)},F.shouldRenderResetButton=function(){var e=F.props,t=e.path,r=e.deletedFiles,o=e.fileCategories,n=e.searchBarExperiments,s=h.fileCategoriesSet(o,n,F.props.isPaperEnabled);return!c.paths_are_equal(t,"/")||!!r||s},F.renderResetButton=function(){return o.default.createElement(s.TertiaryLink,{onClick:F.resetFilters,className:"search-filters__reset"},n._("Reset filters"))},F.renderPathFilter=function(){var e=F.props.path;return o.default.createElement("div",{className:"filter-item__row"},o.default.createElement("div",{className:"filter-item__column"},o.default.createElement("div",{className:"filter-item__desc"},n._("By folder")),o.default.createElement(u.PathFilterButton,{path:e,defaultText:n._("Any folder"),dropdownClasses:"filter-item__filter",onClick:F.showFolderFilterModal})))},F.handleDeletedFilesAll=function(){F.props.onFiltersChanged({deletedFiles:!1})},F.handleDeletedFilesDeleted=function(){F.props.onFiltersChanged({deletedFiles:!0})},F.handleFileTypeChanged=function(e,t,o){var n,s=o.target.name;F.props.onFiltersChanged({fileCategories:r.__assign({},F.props.fileCategories,(n={},n[s]=e,n))})},F.handleChangeFileTypeFiltersView=function(){F.setState({showAllFilters:!F.state.showAllFilters})},F.handleClearOrSelectAll=function(){var e;h.allCategoriesChecked(F.props.fileCategories,F.props.isPaperEnabled)?F.props.onFiltersChanged({fileCategories:r.__assign({},m.FILE_CATEGORIES_UNCHECKED)}):(F.props.onFiltersChanged({fileCategories:r.__assign({},m.FILE_CATEGORIES_CHECKED,(e={},e[p.FileCategory.PAPER]=F.props.isPaperEnabled?"checked":"unchecked",e))}),F.setState({showAllFilters:!0}))},F.renderDeletedFilter=function(){var e=F.props.deletedFiles;return o.default.createElement("div",{className:"filter-item__row"},o.default.createElement("div",{className:"filter-item__column"},o.default.createElement("div",{className:"filter-item__desc"},n._("By status")),o.default.createElement("div",null,o.default.createElement(i.Label,{htmlFor:"filter-type-all"},o.default.createElement(a.RadioButton,{"aria-checked":!0,checked:!e,id:"filter-type-all",value:"all",onChange:F.handleDeletedFilesAll}),n._("Available"))),o.default.createElement("div",null,o.default.createElement(i.Label,{htmlFor:"filter-type-deleted"},o.default.createElement(a.RadioButton,{"aria-checked":!0,checked:e,id:"filter-type-deleted",value:"deleted",onChange:F.handleDeletedFilesDeleted}),n._("Deleted")))))},F.renderFileTypeFilter=function(){var e=F.renderFileTypeFilterCheckboxes(),t=F.state.showAllFilters?"up":"down",r=F.state.showAllFilters?n._("Show Less"):n._("Show More"),i=h.allCategoriesChecked(F.props.fileCategories,F.props.isPaperEnabled),a=i?n._("Clear all"):n._("Select all");return o.default.createElement("div",{className:"filter-item__row"},o.default.createElement("div",{className:"filter-item__column"},o.default.createElement("div",{className:"filter-item__desc"},n._("By type"),o.default.createElement(s.TertiaryLink,{onClick:F.handleClearOrSelectAll,className:"filter-type-file-select-or-clear-all-button"},a)),e,o.default.createElement("button",{className:"show-more-filters",onClick:F.handleChangeFileTypeFiltersView},o.default.createElement("div",{className:"show-more-filters__arrow show-more-filters__arrow-"+t},o.default.createElement(_.IconArrow,{name:"right"})),r)))},F.renderFileTypeFilterCheckboxes=function(){var e=[],r=0;return Object.keys(t.FileCategoryData).forEach(function(t){(F.props.isPaperEnabled||t!==p.FileCategory.PAPER)&&(e.push(F.createCheckBox(t,r>=m.NUMBER_FILE_TYPE_CHECKBOXES_ALWAYS_SHOWN)),r++)}),e},F.createCheckBox=function(e,r){var n=t.FileCategoryData[e].label,s=t.FileCategoryData[e].icon,a=t.FileCategoryData[e].tooltip,c="filter-type-file-"+e,d=F.state.showAllFilters?"":S.default({"filter-type-file-checkbox__hidden":r}),u=o.default.createElement("div",{className:"filter-type-file-icon-wrapper"},o.default.createElement(v.Tooltip,{tooltipContent:a,positioning:"left"},o.default.createElement(g.IconContent,{className:"filter-type-file-icon",name:s})));return o.default.createElement("div",{key:c,className:"filter-type-file-checkbox-wrapper "+d},o.default.createElement(i.Label,{htmlFor:c,className:"filter-type-file-label filter-type-file-label__full-width"},o.default.createElement(l.Checkbox,{name:e,"aria-checked":!0,checked:F.props.fileCategories[e],id:c,onChange:F.handleFileTypeChanged,className:"filter-type-file-checkbox"}),n,u))},F.handleClick=function(e){e.stopPropagation()};var b=F.props.searchBarExperiments,y=h.fileCategoriesToString(F.props.fileCategories);return f.isInDeletedFilterRightRailExperiment(b)?F.state={showAllFilters:!!y}:F.state={showAllFilters:!0},F.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(b)&&void 0===t.FileCategoryData&&(t.FileCategoryData=(T={},T[p.FileCategory.IMAGE]={label:n._("Images"),tooltip:n._("JPG, PNG, GIF, and more",{comment:"Intended to represent 3 of the most common file formats for images."}),icon:"image-small"},T[p.FileCategory.DOCUMENT]={label:n._("Documents"),tooltip:n._("DOC, DOCX, TXT, and more",{comment:"Intended to represent 3 of the most common file formats for documents."}),icon:"txt-small"},T[p.FileCategory.PDF]={
label:n._("PDFs"),tooltip:n._("PDF"),icon:"pdf-small"},T[p.FileCategory.SPREADSHEET]={label:n._("Spreadsheets"),tooltip:n._("XLSX, XLS, CSV, and more",{comment:"Intended to represent 3 of the most common file formats for spreadsheets."}),icon:"numbers-small"},T[p.FileCategory.PRESENTATION]={label:n._("Presentations"),tooltip:n._("PPT, PPTX, KEY, and more",{comment:"Intended to represent 3 of the most common file formats for presentations."}),icon:"keynote-small"},T[p.FileCategory.AUDIO]={label:n._("Audio"),tooltip:n._("MP3, WAV, MID, and more",{comment:"Intended to represent 3 of the most common file formats for audio."}),icon:"audio-small"},T[p.FileCategory.VIDEO]={label:n._("Video"),tooltip:n._("MOV, WMV, MP4, and more",{comment:"Intended to represent 3 of the most common file formats for videos."}),icon:"video-small"},T[p.FileCategory.FOLDER]={label:n._("Folders"),tooltip:n._("Dropbox folders"),icon:"folder-small"},T[p.FileCategory.PAPER]={label:n._("Paper docs"),tooltip:n._("Dropbox Paper docs"),icon:"paper-small"},T[p.FileCategory.OTHER]={label:n._("Other"),tooltip:n._("Other file types"),icon:"unknown-small"},T)),F}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.fileCategories;e.fileTypeFilterEnabled||h.allCategoriesUnchecked(t)||this.props.onFiltersChanged({fileCategories:r.__assign({},m.FILE_CATEGORIES_UNCHECKED)}),d.prewarmFolderDialog()},t.prototype.render=function(){var e=this.props.searchBarExperiments;return o.default.createElement("div",{onClick:this.handleClick},o.default.createElement("div",{className:"filter-header"},o.default.createElement("h3",null,n._("Filter")),this.shouldRenderResetButton()&&this.renderResetButton()),o.default.createElement("div",{className:"filter-item"},this.renderPathFilter()),o.default.createElement("div",{className:"filter-item"},this.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(e)&&this.props.searchType!==m.SearchType.IMAGE&&this.renderFileTypeFilter()),o.default.createElement("div",{className:"filter-item"},f.isInDeletedFilterRightRailExperiment(e)&&this.renderDeletedFilter()))},t})(o.default.Component);t.SearchFilters=w}),define("modules/clean/search/search_results/sidebar_view",["require","exports","tslib","react","modules/clean/react/app_actions_view","modules/clean/react/browse/selection_preview_pane","modules/clean/react/browse/util","modules/clean/search/search_results/search_filters","modules/clean/search/types","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n"],function(e,t,r,o,n,s,i,a,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o);var p=(function(t){function p(e){var r=t.call(this,e)||this;return r.state={},r}return r.__extends(p,t),p.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,c.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar)];case 2:return t=o.sent(),this.setState({fileActionsModule:t}),[2]}})})},p.prototype.render=function(){var e=this.props,t=e.context,r=e.selectedFiles,c=e.user,p=e.path,h=e.actionHandlers,f=e.searchBarExperiments,_=e.shouldShowDeletedFiles,m=e.viewType,S=e.responsive,g=e.onSearchFiltersChanged,v=e.fileCategories,E=e.isNautilusEnabled,w=e.isPaperEnabled,T=e.fileExtensionsConfigs,F=e.searchType,b=e.renderFilters,y=f.expSearchDetailsPaneVariants,C=y===l.DetailsPaneVariants.PREVIEW_ONLY,I=C?o.default.createElement(s.SelectionPreviewPane,{selectedFiles:this.props.selectedFiles,responsive:this.props.responsive}):null;if(r.size){var R=[],O=this.state.fileActionsModule;if(O){var P=f.expSearchSuccessBanner;R=O.getActionsForFileCollection({files:r,context:t,user:c,viewType:m,fileExtensionsConfigs:T,actionHandlers:h,isSearchMode:!0,responsive:S,useSearchSuccessBanner:!!P,isSidebar:!0})}if(R.length){d.assert("function"!=typeof R[0],"The primary menu item for AppActionsView must be a BrowseAppActionLink");var D=R[0],A={displayName:D.label,handleClick:D.performAction,iconName:D.iconName,className:D.className,disabled:D.disabled},N=R.slice(1).map(function(e){return"function"==typeof e?e:{displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled}}),L=i.getSelectedFilesText(r,t);return o.default.createElement(o.default.Fragment,null,I,o.default.createElement(n.AppActionsView,{headerText:L,popoverTriggerLabel:u._("Actions"),primaryMenuItems:[A],secondaryMenuItems:N,responsive:S,hideHeaderText:!!C}))}}return b?o.default.createElement(o.default.Fragment,null,I,o.default.createElement(a.SearchFilters,{user:c,searchBarExperiments:f,path:p,onFiltersChanged:g,deletedFiles:_,fileCategories:v,fileTypeFilterEnabled:E,isPaperEnabled:w,searchType:F})):I},p})(o.default.PureComponent);t.SearchResultsSidebarView=p}),define("modules/clean/search/search_results/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/selection","modules/clean/search/constants","modules/clean/react/browse/models","modules/clean/search/store_helpers","modules/clean/react/files_view/types","modules/core/exception"],function(e,t,r,o,n,s,i,a,l,c,d,u){"use strict";function p(){return null===_&&(_=new f),_}function h(){return null!==_}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),a=r.__importStar(a),c=r.__importStar(c);var f=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchResults(!0),r}return r.__extends(t,e),t.prototype._resetSearchResults=function(e){this._browseContext=void 0,this._rawQuery="",this._latestQuery="",this._loadingState=a.SearchLoadingState.LOADING_FIRST_PAGE,this._fullSearchResults=o.OrderedMap(),this._searchResults=o.OrderedMap(),this._selection=void 0,this._hasMoreLiveResults=!0,this._moreLiveSearchResultsOffset=0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._moreDeletedSearchResultsOffset=0,this._didLoadDeletedResults=!1,this._latestFileCategories=a.FILE_CATEGORIES_UNCHECKED,e&&(this._searchType=a.SearchType.ALL),this._numImageSuggestions=0,this._imageSuggestionQuery="",this._imageSuggestionRequestId="",this._sortOrder={sortField:d.SortField.RELEVANCE,sortDirection:d.SortDirection.DESCENDING},this._cachedFullSearchResults=void 0,this._cachedFullSearchResultsSortField=void 0},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.searchSessionId=function(){return this._searchSessionId},t.prototype.queryId=function(){return this._queryId},t.prototype.browseContext=function(){return this._browseContext||(this._browseContext=new l.BrowseContext)},t.prototype.latestQuery=function(){return this._latestQuery},t.prototype.loadingState=function(){return this._loadingState},t.prototype.searchResults=function(){return this._searchResults.toList().filter(function(e){return!!e})},t.prototype.fullSearchResults=function(){return this._fullSearchResults},t.prototype.hasMoreResults=function(e){return void 0===e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},t.prototype.moreLiveSearchResultsOffset=function(){return this._moreLiveSearchResultsOffset},t.prototype.moreDeletedSearchResultsOffset=function(){return this._moreDeletedSearchResultsOffset},t.prototype.numDeletedResults=function(){return this._numDeletedResults},t.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},t.prototype.selection=function(){return this._selection||(this._selection=i.createSelection())},t.prototype.selectedFiles=function(){var e=this;return this._searchResults.filter(function(t){return t&&e.selection().selected.some(function(e){return"fq_path"in t?t.fq_path===e:t.file_id===e})})},t.prototype.latestFileCategories=function(){return this._latestFileCategories},t.prototype.searchType=function(){return this._searchType},t.prototype.numImageSuggestions=function(){return this._numImageSuggestions},t.prototype.imageSuggestionQuery=function(){return this._imageSuggestionQuery},t.prototype.imageSuggestionRequestId=function(){return this._imageSuggestionRequestId},t.prototype.sortOrder=function(){return this._sortOrder},t.prototype.hasCachedFullSearchResults=function(){return!!this._cachedFullSearchResults},t.prototype.cachedFullSearchResultsSortField=function(){return this._cachedFullSearchResultsSortField},t.prototype._setRawQuery=function(e,t){t?this._searchSessionId=t:c.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionId=c.generateRandomId()),this._rawQuery=e},t.prototype._setSearchQuery=function(e){var t=e.query;this._setRawQuery(t),this.emit_change()},t.prototype._startSearch=function(e){var t=e.query,r=e.searchSessionId,o=e.queryId,n=e.fileCategories,s=e.searchType,i=e.sortOrder;this._setRawQuery(t,r),this._latestQuery=c.normalize(t),this._loadingState=a.SearchLoadingState.LOADING_FIRST_PAGE,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._queryId=o,this._latestFileCategories=n?n:a.FILE_CATEGORIES_UNCHECKED,this._searchType=s,this._sortOrder=i?i:{sortField:d.SortField.RELEVANCE,sortDirection:d.SortDirection.DESCENDING},this._cachedFullSearchResults=void 0,this._cachedFullSearchResultsSortField=void 0,this.emit_change()},t.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,o=e.deletedFiles;e.queryId===this.queryId()&&(this._setSearchResultsInternal(t.results,o),this._loadingState=a.SearchLoadingState.LOADED,r&&(this._browseContext=r),this._updateMoreResults(t,o),this.emit_change())},t.prototype._setImageSearchSuggestion=function(e){var t=e.imageSuggestions,r=e.queryId,o=e.query,n=e.requestId;r===this.queryId()&&(this._numImageSuggestions=t.results.length,this._imageSuggestionQuery=o,this._imageSuggestionRequestId=n,t.hasMore&&(this._numImageSuggestions+=1),this.emit_change())},t.prototype._setFullSearchResults=function(e){var t=e.searchResults;if(e.queryId===this._queryId){for(var r=0,o=t;r<o.length;r++){var n=o[r];this._fullSearchResults=this._fullSearchResults.set(n.fq_path,n)}this._loadingState=a.SearchLoadingState.LOADED,this.emit_change()}},t.prototype._setSearchResultsInternal=function(e,t){this._searchResults=o.OrderedMap(e.map(function(e){return[l.itemId(e),e]})),t&&(this._numDeletedResults=e.length)},t.prototype._continueSearch=function(e){e.didLoadDeletedResults&&(this._didLoadDeletedResults=!0),this._loadingState=a.SearchLoadingState.LOADING_ADDITIONAL_PAGE,this.emit_change()},t.prototype._appendSearchResults=function(e){var t=e.deleted,r=e.searchResults;t&&(this._numDeletedResults+=r.results.length),this._searchResults=this._searchResults.concat(r.results.map(function(e){return[l.itemId(e),e]})),this._loadingState=a.SearchLoadingState.LOADED,this._updateMoreResults(r,t),this.emit_change()},t.prototype._setFolderSize=function(){var e=this;this._searchResults.toList().toArray().forEach(function(t){t instanceof l.File&&t.is_dir&&(e._searchResults=e._searchResults.set(l.itemId(t),t.updateSize(t.bytes,d.FetchFolderSizeState.COMPLETE)))})},t.prototype._clearSearch=function(){this._resetSearchResults(!1),this.emit_change()},t.prototype._updateMoreResults=function(e,t){t?(this._hasMoreDeletedResults=e.hasMore,this._moreDeletedSearchResultsOffset=e.nextPageOffset||0):(this._hasMoreLiveResults=e.hasMore,this._moreLiveSearchResultsOffset=e.nextPageOffset||0),this.hasMoreResults(!0)||(this._cachedFullSearchResults=this._searchResults,this._cachedFullSearchResultsSortField=this._sortOrder.sortField)},t.prototype._setSearchSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype._selectFirstFile=function(){var e=this._searchResults.find(function(e){return e instanceof l.File});e&&this._setSearchSelection({selection:i.createSelection([e.fq_path])})},t.prototype._applyFileDeltas=function(e){var t=e.fileDeltas;if(t){for(var r=function(e,t){var r=void 0;!e&&t?o._searchResults=o._searchResults.set(t.fq_path,t):e&&!t?(r=o._searchResults.findKey(function(t){return t instanceof l.File&&n.paths_are_equal(t.fq_path,e)}),o._searchResults=o._searchResults.delete(r)):e&&t&&(r=o._searchResults.findKey(function(t){return t instanceof l.File&&n.paths_are_equal(t.fq_path,e)}),o._searchResults=r?o._searchResults.set(r,t):o._searchResults.set(t.fq_path,t))},o=this,s=0,i=t;s<i.length;s++){var a=i[s];r(a.before,a.after)}this.emit_change()}},t.prototype._hasValidTimestamp=function(e){return(e instanceof l.File&&!e.isDeleted||e instanceof l.Paper||e instanceof l.FileSharedWithMe)&&null!==e.ts&&void 0!==e.ts},t.prototype._sortByLastModifiedTimeComparator=function(e,t,r){var o=l.itemTimestampInMs(e),n=l.itemTimestampInMs(t);return r===d.SortDirection.DESCENDING?n-o:o-n},t.prototype._sortSearchResults=function(e){var t=e.sortOrder;if(!this._cachedFullSearchResults)return void u.reportException({err:new Error("Cannot sort when search results are not fully loaded."),severity:u.SEVERITY.NONCRITICAL,tags:["search"]});if(this._cachedFullSearchResults.size>1){var r=this._sortCachedFullSearchResults(this._cachedFullSearchResults,t);r&&(this._searchResults=r)}this._sortOrder=t,this.emit_change()},t.prototype._sortCachedFullSearchResults=function(e,t){var r=this,n=t.sortField,s=t.sortDirection,i=o.List();switch(n){case d.SortField.MODIFIED:var a=e.filter(function(e){return r._hasValidTimestamp(e)}).toList(),c=e.filter(function(e){return!r._hasValidTimestamp(e)});i=a.sort(function(e,t){return r._sortByLastModifiedTimeComparator(e,t,s)}).concat(c);break;case d.SortField.RELEVANCE:if(s===d.SortDirection.ASCENDING)return u.reportException({err:new Error("Cannot sort by relevance in ascending order."),severity:u.SEVERITY.NONCRITICAL,tags:["search"]}),null;if(this._cachedFullSearchResultsSortField!==d.SortField.RELEVANCE)return u.reportException({err:new Error("Cannot sort by relevance when cached search results are not sorted by relevance."),severity:u.SEVERITY.NONCRITICAL,tags:["search"]}),null;i=e.toList();break;default:return u.reportException({err:new Error("Sort by "+n+" is not supported."),severity:u.SEVERITY.NONCRITICAL,tags:["search"]}),null}return o.OrderedMap(i.filter(function(e){return!!e}).map(function(e){return[l.itemId(e),e]}))},t.prototype._new_payload=function(e){switch(e.action.type){case a.START_SEARCH_ACTION:this._startSearch(e.action.data);break;case a.SET_SEARCH_RESULTS_ACTION:this._setSearchResults(e.action.data);break;case a.CONTINUE_SEARCH_ACTION:this._continueSearch(e.action.data);break;case a.APPEND_SEARCH_RESULTS_ACTION:this._appendSearchResults(e.action.data);break;case a.SET_FULL_SEARCH_RESULTS_ACTION:this._setFullSearchResults(e.action.data);break;case a.SET_SEARCH_SELECTION_ACTION:this._setSearchSelection(e.action.data);break;case a.CHANGE_FILES_ACTION:this._applyFileDeltas(e.action.data);break;case a.CLEAR_SEARCH_ACTION:this._clearSearch();break;case a.SELECT_FIRST_FILE_ACTION:this._selectFirstFile();break;case a.SET_FOLDER_SIZE_ACTION:this._setFolderSize();break;case a.SORT_SEARCH_RESULTS_ACTION:this._sortSearchResults(e.action.data);break;case a.SET_IMAGE_SEARCH_SUGGESTION_ACTION:this._setImageSearchSuggestion(e.action.data)}},t})(s.Store);t.SearchResultsStore=f;var _=null;t.getSearchResultsStore=p,t.searchResultsStoreInstantiated=h}),define("modules/clean/search/search_results/view",["require","exports","tslib","classnames","external/immutable","external/lodash","react","spectrum/dimensions","spectrum/media_table","spectrum/snackbar","spectrum/tabbed_header","spectrum/table","spectrum/tip_card","modules/clean/analytics","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/react/async/loadable","modules/clean/react/badge","modules/clean/react/browse/models","modules/clean/react/files_view/column_helpers","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/file_list_empty_folder_table","modules/clean/react/files_view/types","modules/clean/react/image","modules/clean/react/retrieval_success_banner/util","modules/clean/react/snackbar","modules/clean/react/sticky/container","modules/clean/react/sticky/sticky","modules/clean/react_format","modules/clean/search/api_helpers","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/clean/search/types","modules/clean/static_urls","modules/core/i18n","modules/core/uri"],function(e,t,r,o,n,s,i,a,l,c,d,u,p,h,f,_,m,S,g,v,E,w,T,F,b,y,C,I,R,O,P,D,A,N,L,x,M,k,U){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n),s=r.__importStar(s),i=r.__importDefault(i),_=r.__importStar(_),m=r.__importDefault(m),A=r.__importStar(A),L=r.__importStar(L);var V=S.Loadable({loader:function(){return new Promise(function(t,r){e(["modules/clean/react/retrieval_success_banner/search_feedback_banner"],t,r)}).then(r.__importStar).then(function(e){return e.SearchFeedbackBanner})}}),B="imageSuggestionSnackBar",q=(function(e){function t(t){var n=e.call(this,t)||this;return n._handleScroll=function(){n.props.onScroll()},n._ensureFileViewerClosedIfNotPreviewing=function(){var e=m.default.deconstruct_url().qargs;n.props.ensureFileViewerClosedIfNotPreviewing(e)},n._handleFullSearchOnClick=function(e){e.preventDefault(),n.props.onSearch(n.props.latestQuery,"/")},n._handleEmptyFolderViewTTI=function(){n.props.handleComponentTTI("FilesViewController")},n._logHelpSearchClick=function(){var e=n.props,t=e.searchSessionId,r=e.user,o=e.viewType,s={search_type:"full_page",viewport:"full-view",search_session_id:t,view_type:o,timezone_offset:D.getCurrentTimezoneOffset()};h.SearchClientActivityLogger.log("help_center_link_clicked",r.id,s)},n._handleSearchAllFiles=function(e){e.preventDefault();var t=n.props.path;n.props.onSearchFiltersChanged({path:t,deletedFiles:!1})},n._handleSearchDeletedFiles=function(e){e.preventDefault();var t=n.props.path;n.props.onSearchFiltersChanged({path:t,deletedFiles:!0})},n._handleRemoveAllFilters=function(e){e.preventDefault();var t=n.props.shouldShowDeletedFiles;n.props.onSearchFiltersChanged({path:"/",deletedFiles:t,fileCategories:r.__assign({},A.FILE_CATEGORIES_UNCHECKED)})},n._getEmptyFolderViewUrl=function(e,t){var r=n.props,o=r.user,s=r.latestQuery,i=r.searchSessionId;return L.buildSearchURL({user:o,searchPath:e,normalizedQuery:s,searchSessionId:i,searchToken:L.getSearchCsrfToken(),qargs:{d:t?"1":void 0}}).toString()},n._getRemoveAllFiltersViewUrl=function(e){var t=n.props,r=t.user,o=t.latestQuery,s=t.searchSessionId;return L.buildSearchURL({user:r,searchPath:"/",normalizedQuery:o,searchSessionId:s,searchToken:L.getSearchCsrfToken(),qargs:{d:e?"1":void 0,file_categories:void 0}}).toString()},n._renderEmptyFolderSubtitle=function(){var e=n.props,t=e.path,r=e.shouldShowDeletedFiles,o=e.searchBarExperiments,s=e.fileCategories;return _.paths_are_equal(t,"/")&&!L.fileCategoriesSet(s,o)?r?P.reactFormat(k._("Try different keywords or <Link>search files that aren’t deleted</Link>"),{Link:i.default.createElement("a",{href:n._getEmptyFolderViewUrl(t,!1),onClick:n._handleSearchAllFiles})}):N.isInDeletedFilterRightRailExperiment(o)?P.reactFormat(k._("Try different keywords or <Link>search deleted files</Link>"),{Link:i.default.createElement("a",{href:n._getEmptyFolderViewUrl(t,!0),onClick:n._handleSearchDeletedFiles})}):N.isInShowHelpLinkHelpCenterLinkExperiment(o)?i.default.createElement("ul",{className:"search-results__no-results-links"},i.default.createElement("li",null,k._("To try again, enter different search words")),i.default.createElement("li",null,P.reactFormat(k._("To get help, head to the <Link>Dropbox help center</Link>"),{Link:i.default.createElement("a",{href:"https://help.dropbox.com?utm_source=InProductSearch&utm_medium=Search",target:"_blank",rel:"noopener",onClick:n._logHelpSearchClick})}))):k._("Try different keywords"):r?P.reactFormat(k._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>files that aren’t deleted</LinkDeleted>"),{LinkScope:i.default.createElement("a",{href:n._getEmptyFolderViewUrl("/",r),onClick:n._handleRemoveAllFilters}),LinkDeleted:i.default.createElement("a",{href:n._getEmptyFolderViewUrl(t,!1),onClick:n._handleSearchAllFiles})}):N.isInDeletedFilterRightRailExperiment(o)?P.reactFormat(k._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>deleted files</LinkDeleted>"),{LinkScope:i.default.createElement("a",{href:n._getEmptyFolderViewUrl("/",r),onClick:n._handleRemoveAllFilters}),LinkDeleted:i.default.createElement("a",{href:n._getEmptyFolderViewUrl(t,!0),onClick:n._handleSearchDeletedFiles})}):N.isInShowHelpLinkHelpCenterLinkExperiment(o)?i.default.createElement("ul",{className:"search-results__no-results-links"},i.default.createElement("li",null,P.reactFormat(k._("To try again, enter different search words or <LinkScope>clear all filters</LinkScope>"),{LinkScope:i.default.createElement("a",{href:n._getRemoveAllFiltersViewUrl(),onClick:n._handleRemoveAllFilters})})),i.default.createElement("li",null,P.reactFormat(k._("To get help, head to the <Link>Dropbox help center</Link>"),{Link:i.default.createElement("a",{href:"https://help.dropbox.com?utm_source=InProductSearch&utm_medium=Search",target:"_blank",rel:"noopener",onClick:n._logHelpSearchClick})}))):P.reactFormat(k._("Try <LinkScope>resetting all filters</LinkScope>"),{LinkScope:i.default.createElement("a",{href:n._getRemoveAllFiltersViewUrl(),onClick:n._handleRemoveAllFilters})})},n._renderEmptyFolderView=function(e){var t=n.props.path,r=_.paths_are_equal(t,"/"),o=k._("No results found");if(n.shouldRenderNewEmptyState())return i.default.createElement("div",null,i.default.createElement("div",{className:"u-font-center u-pad-top-xl"},i.default.createElement(y.Image,{src:M.static_url("/static/images/empty_states/search-vflHMNVT9.png"),srcHiRes:M.static_url("/static/images/empty_states/search@2x-vfly2B3kk.png"),alt:""}),i.default.createElement("h2",{className:"u-font-strong empty-folder-table-title"},o),i.default.createElement("span",null,n._renderEmptyFolderSubtitle())));var s=r?k._("Please update your search and try again"):k._("Search all of my Dropbox instead"),a=r?void 0:n._getFullSearchLink(),l=r?void 0:n._handleFullSearchOnClick;return i.default.createElement(F.EmptyFolderTable,{title:o,subtitle:s,subtitleLink:a,subtitleOnClick:l,onTTI:n._handleEmptyFolderViewTTI})},n._renderDeletedFilesTipcard=function(){return N.isInDeletedFilterRightRailExperiment(n.props.searchBarExperiments)&&n.props.shouldShowDeletedFiles&&n.props.loadingState===A.SearchLoadingState.LOADED&&n.props.searchResults.count()>0?i.default.createElement(p.TipCard,{className:"mc-tip-card--deleted-files"},P.reactFormat(k._("Can’t find what you’re looking for? <a>View all deleted files</a>"),{a:i.default.createElement("a",{href:"/deleted_files"})})):null},n._renderFixedHeader=function(e){var t=n.props,r=t.hasMoreResults,o=t.searchResults,s=r||o.size>0,a=k._("Search results");if(n._shouldShowTabs()){a=n.props.searchType===A.SearchType.ALL?k._("Text search results"):k._("Image search results")}return s?i.default.createElement("div",{className:"search-results-header"},i.default.createElement("h1",{className:"search-results-title"},a),i.default.createElement("div",{className:"search-results-subtitle"},n._searchResultsTitle(e))):null},n._shouldShowTabs=function(){return n.props.searchResultsExperiments.expImageContentSearch&&!n.props.dontRenderHeader},n._shouldShowSearchFeedbackBanner=function(){return n.props.searchType===A.SearchType.IMAGE},n._getTabNavHeight=function(){return n._shouldShowTabs()?40:0},n._renderTabNav=function(){var e=null;if(n._shouldShowTabs()){var t="search-type-tab-"+n.props.searchType,r=[{id:"search-type-tab-"+A.SearchType.ALL,label:k._("Text")},{id:"search-type-tab-"+A.SearchType.IMAGE,label:k._("Images")}].map(function(e){var r=e.id==="search-type-tab-"+A.SearchType.IMAGE,s=function(){n._toggleTab(e.id,"tab")};return i.default.createElement(d.Tab,{id:e.id,key:e.id,active:t===e.id,className:o.default(e.id,{"has-new-badge":r}),onClick:s},e.label,r?i.default.createElement(g.Badge,{variant:g.BadgeVariant.ALPHA}):null)});e=i.default.createElement(a.Dimensions,{tagName:"div",className:"search-results-tab-container"},function(e){var o=e.width;return i.default.createElement(R.StickyContainer,{offsetTop:n.props.pageHeaderHeight,useNativeSticky:!0,useWindowToDetermineBottom:!0},i.default.createElement(O.Sticky,{offsetHeight:n._getTabNavHeight(),allowStickyOnLoad:!0},i.default.createElement(d.TabbedHeader,{activeTabId:t,onSelection:n._toggleTab,style:{width:o}},r)))})}return e},n._manageImageSuggestionSnackBar=function(){var e=n.props,t=e.imageSuggestionQuery,r=e.numImageSuggestions,o=e.searchType,s=e.showImageSuggestionSnackbar,a=n.state,l=a.imageSuggestionsNumberInSnackbar,d=a.closedImageSuggestionsSnackbar,u=a.queryInSnackbar;if(n.props.searchResultsExperiments.expImageContentSearch&&s)if(o===A.SearchType.IMAGE)l>0&&I.Snackbar.close(B);else if(r>0){var p=l!==r,f=t!==u,_=n.props,m=_.searchSessionId,S=_.user,g=_.viewType,v=_.imageSuggestionRequestId,E={search_type:"full_page",viewport:"full-view",request_id:v,search_session_id:m,view_type:g,timezone_offset:D.getCurrentTimezoneOffset()};if(d||!p&&!f)return;var w=function(){n.setState({imageSuggestionsNumberInSnackbar:0,queryInSnackbar:void 0})},T=function(){n.setState({closedImageSuggestionsSnackbar:!0}),E.timezone_offset=D.getCurrentTimezoneOffset(),h.SearchClientActivityLogger.log("image_search_snackbar_closed",S.id,E)},F=function(){n._toggleTab("search-type-tab-"+A.SearchType.IMAGE,"snackbar")},b=i.default.createElement(I.Snackbar,{variant:"generic",title:n._getSnackbarText(t,r),closeButtonText:k._("Close"),onClosed:w,onCloseClick:T,id:B,isLowPriority:!0,accessibleAnnouncement:n._getRawSnackbarText(t,r)},i.default.createElement(c.SnackbarAction,{onClick:F},k._("View")));l>0?I.Snackbar.update(b):I.Snackbar.show(b),h.SearchClientActivityLogger.log("image_search_snackbar_shown",S.id,E),n.setState({imageSuggestionsNumberInSnackbar:r,queryInSnackbar:t})}else l>0&&I.Snackbar.close(B)},n._getSnackbarText=function(e,t){var r=f.Emstring.em_snippet(e,15,.6);return t>100?P.reactFormat(k._("100+ results for <strong>%(query)s</strong> in image search"),{query:r,strong:i.default.createElement("strong",null)}):P.reactFormat(k.ungettext("%(size)d result for <strong>%(query)s</strong> in image search","%(size)d results for <strong>%(query)s</strong> in image search",t).format({size:t,query:r}),{strong:i.default.createElement("strong",null)})},n._getRawSnackbarText=function(e,t){var r=f.Emstring.em_snippet(e,15,.6);return t>100?k._("100+ results for %(query)s in image search").format({query:r}).toString():k.ungettext("%(size)d result for %(query)s in image search","%(size)d results for %(query)s in image search",t).format({size:t,query:r}).toString()},n._renderSearchFeedbackBanner=function(){return n._shouldShowSearchFeedbackBanner()?i.default.createElement(V,null):null},n._toggleTab=function(e,t){var r=n.props,o=r.onSearchFiltersChanged,s=r.imageSuggestionRequestId,i=e.substr("search-type-tab-".length);if(i!==n.props.searchType){var a=n.props,l=a.searchSessionId,c=a.user,d=a.viewType,u={search_type:"full_page",viewport:"full-view",request_id:s,search_session_id:l,view_type:d,timezone_offset:D.getCurrentTimezoneOffset(),extra:{search_type:i,ref:t||"tab"}};h.SearchClientActivityLogger.log("switch_search_type",c.id,u),o({searchType:i}),i===A.SearchType.IMAGE?C.doSearchResultBannerDismissBroadcast(!0):C.doSearchResultBannerDismissBroadcast(!1)}},n.state={viewTypeColumns:n._generateViewTypeColumns(),searchResultsWithUserDefinedItem:n._generateSearchResultsWithUserDefinedItem(t.searchResults),imageSuggestionsNumberInSnackbar:0,closedImageSuggestionsSnackbar:!1},n}return r.__extends(t,e),t.prototype.componentWillMount=function(){this.props.browseExperiments.expUniversalSinglePageSearch||m.default.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype.componentDidUpdate=function(){this._manageImageSuggestionSnackBar()},t.prototype.componentDidMount=function(){window.addEventListener("scroll",this._handleScroll)},t.prototype.componentWillReceiveProps=function(e){var t=this.props,r=t.currentSort,o=t.searchResults,n=e.viewType,s=e.currentSort,i=e.searchResults,a=this.state.viewTypeColumns;r&&s&&a&&!L.areSortOrdersEqual(r,s)&&this.setState({viewTypeColumns:this._updateViewTypeColumns(a,n,s)}),o!==i&&this.setState({searchResultsWithUserDefinedItem:this._generateSearchResultsWithUserDefinedItem(i)})},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this._handleScroll),m.default.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing),this.state.imageSuggestionsNumberInSnackbar>0&&I.Snackbar.close(B)},t.prototype._getFullSearchLink=function(){var e=this.props,t=e.latestQuery,r=e.searchSessionId,o=e.user;return U.URI.parse("/search/"+o.role).setQuery({path:"/",query:t,search_session_id:r}).toString()},t.prototype.shouldRenderNewEmptyState=function(){var e=this.props,t=e.searchBarExperiments;return e.browseExperiments.expUniversalSinglePageSearch||L.isInFileTypeFilterExperiment(t)||N.isInDeletedFilterRightRailExperiment(t)||N.isInSinglePageSearchExperiment(t)||N.isInShowHelpLinkHelpCenterLinkExperiment(t)},t.prototype._searchResultsTitle=function(e){var t=N.isInSinglePageSearchExperiment(this.props.searchBarExperiments)&&this.props.loadingState===A.SearchLoadingState.LOADING_FIRST_PAGE?this.props.queryForResultsTitle:this.props.latestQuery,r=this.props,o=r.searchResults,n=r.path,s=r.viewType,a=r.shouldShowDeletedFiles,l=o.size,c=_.paths_are_equal(n,"/"),d=this.props,u=d.loadingState,p=d.hasMoreResults;if(0===l||u===A.SearchLoadingState.LOADING_FIRST_PAGE)return"";if(!this.shouldRenderNewEmptyState()&&0===l)return"";var h,m=e.isMatchedMedium?e.isMatchedLarge?30:20:10;s===b.ViewType.List&&(m/=2);if(c){var S=f.Emstring.em_snippet(t,m,.6);h=a?P.reactFormat(k.ungettext("%(size)d deleted result for <strong>%(query)s</strong>","%(size)d deleted results for <strong>%(query)s</strong>",l).format({size:l,query:S}),{strong:i.default.createElement("strong",null)}):p?P.reactFormat(k._("%(size)s+ results for <strong>%(query)s</strong>"),{size:l,query:S,strong:i.default.createElement("strong",null)}):P.reactFormat(k.ungettext("%(size)d result for <strong>%(query)s</strong>","%(size)d results for <strong>%(query)s</strong>",l).format({size:l,query:S}),{strong:i.default.createElement("strong",null)})}else{var g=f.Emstring.em_snippet(_.filename(n),m/2,.6),S=f.Emstring.em_snippet(t,m/2,.6);h=a?P.reactFormat(k.ungettext("%(size)d deleted result for <strong>%(query)s</strong> in %(path)s","%(size)d deleted results for <strong>%(query)s</strong> in %(path)s",l).format({size:l,query:S,path:g}),{strong:i.default.createElement("strong",null)}):p?P.reactFormat(k._("%(size)s+ results for <strong>%(query)s</strong> in %(path)s"),{size:l,query:S,path:g,strong:i.default.createElement("strong",null)}):P.reactFormat(k.ungettext("%(size)d result for <strong>%(query)s</strong> in %(path)s","%(size)d results for <strong>%(query)s</strong> in %(path)s",l).format({size:l,query:S,path:g}),{strong:i.default.createElement("strong",null)})}return h},t.prototype._getLoadingState=function(){var e=this.props,t=e.searchResults,r=e.searchBarExperiments,o=e.loadingState;return N.isInSinglePageSearchExperiment(r)&&!t.isEmpty()?b.LoadingState.LOADED:o===A.SearchLoadingState.LOADING_FIRST_PAGE?b.LoadingState.LOADING_FIRST_PAGE:o===A.SearchLoadingState.LOADING_ADDITIONAL_PAGE?b.LoadingState.LOADING_REMAINING_PAGES:b.LoadingState.LOADED},t.prototype._renderSearchResultItems=function(e){
var t=this.props,o=t.getOverflowMenuActions,n=t.onFocusSearchBar,a=t.onLocationLinkClick,l=t.onNavigateToFileOrFolder,c=t.onNavigateToParentFolder,d=t.onOpenFileSharedWithMe,u=t.onOpenPaper,p=t.context,h=t.fileRename,f=t.searchResults,_=t.getIsFileJumping,m=t.isFileViewerShown,S=t.arePostTTIModulesLoaded,g=t.handleComponentTTI,v=t.onSelectionChange,E=t.selectedFiles,F=t.selection,y=t.setFileUploaderPath,C=t.viewType,I=t.user,R=t.path,O=t.filesViewActionHandlers,P=t.renderSharedWithController,D=t.hrefForFile,A=t.starredState,N=t.pageHeaderHeight,L=t.onStarClick,M=t.fileExtensionsConfigs,k=t.searchResultsExperiments,U=t.currentSort,V=t.onSortChange,B=t.onRangeInView,q=this.props.searchBarExperiments.expSearchSuccessBanner,H=this.state.viewTypeColumns,W=k.expDropdownImagesThumbnail===x.DropdownImagesThumbnailVariants.IMAGE_TN_ONLY,G=this.props.searchResultsExperiments.expHighlightedTruncatedString,z=this.props.searchResultsExperiments.expSnippets;return i.default.createElement(T.FilesViewController,r.__assign({},O,{getOverflowMenuActions:o,onLocationLinkClick:a,onNavigateToFileOrFolder:l,onNavigateToParentFolder:c,onOpenFileSharedWithMe:d,onOpenPaper:u,context:p,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:b.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:h,getIsFileJumping:_,isFileViewerShown:m,isSearchMode:!0,arePostTTIModulesLoaded:S,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:g,onSelectionChange:v,onFocusSearchBar:n,path:R,selectedFiles:E,selection:F,setFileUploaderPath:y,showFileUploaderModal:s.noop,user:I,viewType:C,totalNumFiles:f.size,responsive:e,columns:this._generateColumns(e),renderSharedWithController:P,hrefForFile:D,viewTypes:w.AllViewTypes,viewTypeLabels:w.ViewTypeLabels,starredState:A,pageHeaderHeight:N+this._getTabNavHeight(),fileExtensionsConfigs:M,onStarClick:L,useSearchSuccessBanner:!!q,items:this._generateFilesViewItems(),isStickyColumnHeader:!0,viewTypeColumns:H,onColumnsChanged:s.noop,currentSort:U,onSortChange:V,showImageThumbnailOnly:W,expHighlightedTruncatedString:G,expSnippets:z,onRangeInView:B}))},t.prototype._generateColumns=function(e){var t=this.props,r=t.shouldShowDeletedFiles,o=t.viewType,n=this.state.viewTypeColumns;return r?w.SEARCH_LIST_VIEW_COLUMNS_DELETED:n?n[o]:w.SEARCH_LIST_VIEW_COLUMNS},t.prototype._generateViewTypeColumns=function(){var e,t=this.props,r=t.viewType,o=t.currentSort,n=(e={},e[b.ViewType.List]=w.SEARCH_LIST_VIEW_SORT_ENABLED_COLUMNS,e[b.ViewType.Grid]=w.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS,e[b.ViewType.LargeGrid]=w.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS,e);return o?this._updateViewTypeColumns(n,r,o):n},t.prototype._isDeletedFile=function(e){return e instanceof v.File&&e.isDeleted},t.prototype._generateSearchResultsWithUserDefinedItem=function(e){var t=this,r=e.filter(function(e){return t._isDeletedFile(e)});if(r.size>0){var o=e.filter(function(e){return!t._isDeletedFile(e)}),s=function(e){var t=e.rowIndex,r=e.topOffset;return i.default.createElement(l.CulledMediaRow,{"aria-rowindex":void 0!==t?t+1:void 0,className:"brws-user-defined-item-row",topOffset:r},i.default.createElement(u.TableCell,{key:"checkboxCell",className:"brws-checkbox-cell"}),i.default.createElement(u.TableCell,{className:"mc-media-cell"},i.default.createElement(p.TipCard,{className:"search-results__deleted-files-notice","non-dismissible":!0},k._("Deleted content isn’t sorted by last modified"))))},a=new v.UserDefinedItem({renderUserDefinedItemRow:s});return o.concat([a]).concat(r)}return n.List()},t.prototype._generateFilesViewItems=function(){var e=this,t=this.props,r=t.searchResults,o=t.viewType,n=t.currentSort,s=r.filter(function(t){return e._isDeletedFile(t)});return o===b.ViewType.List&&n&&n.sortField!==b.SortField.RELEVANCE&&s.size>0?this.state.searchResultsWithUserDefinedItem:r},t.prototype._updateViewTypeColumns=function(e,t,o){var n,s,i=e[t];if(t===b.ViewType.List)return r.__assign({},e,(n={},n[t]=E.swapColumns(i,i[1].sortField,o.sortField),n));var a=e[b.ViewType.List];return r.__assign({},e,(s={},s[t]=E.swapColumns(i,i[0].sortField,o.sortField),s[b.ViewType.List]=E.swapColumns(a,a[1].sortField,o.sortField),s))},t.prototype.render=function(){var e=this.props.responsive;return i.default.createElement("div",{className:"search-results"},this.props.dontRenderHeader?null:this._renderTabNav(),this.props.dontRenderHeader?null:this._renderFixedHeader(e),this._renderSearchFeedbackBanner(),this._renderSearchResultItems(e),this._renderDeletedFilesTipcard())},t})(i.default.Component);t.SearchResultsView=q}),define("modules/clean/sharing/shared_folder_invite/shared_folder_invite_async",["require","exports","tslib","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,r,o,n){"use strict";var s=this;Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncSharedFolderInvite=o.Loadable({loader:function(){return r.__awaiter(s,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,n.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/sharing/shared_folder_invite/shared_folder_invite"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().SharedFolderInvite,[2,t]}})})}})}),define("modules/clean/web_upload_action_logger",["require","exports","tslib","modules/clean/ajax"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.MAX_ERRORS=3;var n=(function(){function e(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}return e.prototype.log=function(e,r,n){var s=this;return this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise(function(i,a){o.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:r,extra_params:JSON.stringify(n)},error:function(e){429===e.status?s.errorCount=t.MAX_ERRORS:s.errorCount++,s.lastError=Date.now(),a(e)},success:function(e){try{var t=JSON.parse(e);t&&!t.continue_sending&&(s.shouldReport=!1),s.errorCount=0,i(e)}catch(e){throw s.errorCount++,s.lastError=Date.now(),a(e),e}}})}):Promise.resolve({})},e})();t.WebUploadActionLog=new n,t.WebUploadActionLogClass=n}),define("premium-growth/checklist-banner-item",["require","exports","tslib","react","spectrum/button","premium-growth/classnames","premium-growth/user-education-icons","premium-growth/loading-placeholder"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importDefault(s),t.ChecklistBannerItem=function(e){var t=e.onClick,r=e.status,l=e.title,c=e.loaded,d=void 0===c?!!r||!!l:c,u="complete"===r?i.CheckInCircleSvg:i.ArrowInCircleSvg;return o.createElement("div",{className:"checklist-banner-item"},d?o.createElement(n.Button,{className:s.default("checklist-banner-item__button","checklist-banner-item__button--"+r),onClick:t,variant:"styleless"},o.createElement("div",{className:"checklist-banner-item__body"},o.createElement("div",{className:s.default("checklist-banner-item__text ","checklist-banner-item__text--"+r)},l),o.createElement("div",{className:"checklist-banner-item__spacer"}),o.createElement(u,{className:"checklist-banner-item__icon"}))):o.createElement(a.LoadingPlaceholder,null))}}),define("premium-growth/checklist-banner",["require","exports","tslib","react","premium-growth/classnames","premium-growth/loading-placeholder","spectrum/button","spectrum/icon_form"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),t.ChecklistBanner=function(e){var t=e.children,r=e.subtitle,l=e.title,c=e.loaded,d=void 0===c?!!l||!!r:c,u=e.dimmed,p=e.onDismiss,h=n.default("checklist-banner",{"is-dimmed":u});return o.createElement("div",{className:h},o.createElement("div",{className:"checklist-banner__copy"},d?o.createElement("div",{className:"checklist-banner__title"},l):o.createElement(s.LoadingPlaceholder,{className:"checklist-banner__title-loading"}),d?o.createElement("div",{className:"checklist-banner__subtitle"},r):o.createElement(s.LoadingPlaceholder,{className:"checklist-banner__subtitle-loading"})),o.createElement("div",{className:"checklist-banner__items"},t),p&&o.createElement(i.Button,{className:"checklist-banner__close-icon",onClick:p,variant:"styleless"},o.createElement(a.IconForm,{name:"cancel"})))}}),define("premium-growth/classnames",["require","exports"],function(e,t){"use strict";function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],s=0;s<e.length;s++){var i=e[s];if(i)if("string"==typeof i||"number"==typeof i)n.push(i);else if(Array.isArray(i)&&i.length){var a=r.apply(null,i);a&&n.push(a)}else if("object"==typeof i)for(var l in i)o.call(i,l)&&i[l]&&n.push(l)}return n.join(" ")}Object.defineProperty(t,"__esModule",{value:!0});var o={}.hasOwnProperty;t.default=r}),define("premium-growth/loading-placeholder",["require","exports","tslib","react","premium-growth/classnames"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),t.LoadingPlaceholder=function(e){var t=e.className;return o.createElement("div",{className:n.default("loading-placeholder",t)})}}),define("premium-growth/user-education-icons",["require","exports","tslib","react","premium-growth/classnames"],function(e,t,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),t.ArrowInCircleSvg=function(e){var t=e.className;return o.createElement("svg",{className:n.default("icon","icon__arrow",t),viewBox:"0 0 35 35"},o.createElement("path",{d:"M21.6270544,16.4260476 L9.125,16.4260476 C8.50367966,16.4260476 8,16.9658974\n                8,17.6318359 C8,18.2977745 8.50367966,18.8376243 9.125,18.8376243\n                L21.6270544,18.8376243 L18.0498997,22.2052624 C17.5497138,22.676152\n                17.5497138,23.439615 18.0498997,23.9105046 C18.5500856,24.3813943\n                19.3610472,24.3813943 19.8612331,23.9105046 L25.3936666,18.7021098\n                C25.753622,18.5013092 25.9995453,18.0980226 25.9999994,17.6331258\n                C26.0000002,17.6322659 26.0000002,17.631406 25.9999993,17.630546\n                C25.9995453,17.1656493 25.753622,16.7623627 25.3936666,16.561562\n                L19.8612331,11.3531672 C19.3610472,10.8822776 18.5500856,10.8822776\n                18.0498997,11.3531672 C17.5497138,11.8240569 17.5497138,12.5875198\n                18.0498997,13.0584095 L21.6270544,16.4260476 Z M17.5,35 C7.83501688,35\n                0,27.1649831 0,17.5 C0,7.83501688 7.83501688,0 17.5,0 C27.1649831,0\n                35,7.83501688 35,17.5 C35,27.1649831 27.1649831,35 17.5,35 Z"}))},t.CheckInCircleSvg=function(e){var t=e.className;return o.createElement("svg",{className:n.default("icon","icon__check-circle",t),viewBox:"0 0 35 35"},o.createElement("path",{d:"M15.75,20.1286797 L13.2928932,17.6715729 C12.7071068,17.0857864\n                11.7573593,17.0857864 11.1715729,17.6715729 C10.5857864,18.2573593\n                10.5857864,19.2071068 11.1715729,19.7928932 L14.7071068,23.3284271\n                C15.2928932,23.9142136 16.2426407,23.9142136 16.8284271,23.3284271\n                C16.9289209,23.2279334 17.0121746,23.116728 17.0781882,22.9984862\n                C17.1630264,22.9429118 17.2434703,22.87785 17.3180195,22.8033009\n                L25.8033009,14.3180195 C26.3890873,13.732233 26.3890873,12.7824856\n                25.8033009,12.1966991 C25.2175144,11.6109127 24.267767,11.6109127\n                23.6819805,12.1966991 L15.75,20.1286797 Z M17.5,35 C7.83501688,35\n                0,27.1649831 0,17.5 C0,7.83501688 7.83501688,0 17.5,0 C27.1649831,0\n                35,7.83501688 35,17.5 C35,27.1649831 27.1649831,35 17.5,35 Z"}))}}),define("retrieval-components/collapsable-section",["require","exports","tslib","react","classnames","spectrum/button"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importDefault(n),t.CollapsableSection=function(e){var t=e.title,r=e.isOpen,i=e.onHeaderClick,a=e.children,l=e.top,c=e.strings;return o.default.createElement("div",{className:n.default({"rc-collapsable-section":!0,"rc-collapsable-section--closed":!r}),style:{top:l}},o.default.createElement("h2",{className:"rc-collapsable-section__header"},o.default.createElement("span",null,t),o.default.createElement(s.Button,{onClick:i,className:"rc-collapsable-section__toggle",variant:"styleless"},r?c.buttonClose:c.buttonOpen)),o.default.createElement("div",{style:{display:r?void 0:"none"}},a))}}),define("retrieval-components/highlighted-truncated-string/em-string",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(t){if(!(this instanceof e))return new e(t);this.s=t,this.info=this.widthInfo(),this.length=t.length?this.info[this.s.length-1]:0}return e.initClass=function(){this.ACCURACY=2,this.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1e3:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,2026:67,19977:108,65403:58},this._ELLIPSIS_LENGTH=new e("…").length,this._DOT_LENGTH=new e(".").length},e.em_snippet=function(t,r,o,n){void 0===n&&(n="HIGHLIGHTED_TRUNCATED_STRING_MIDDLE"),null==r&&(r=50),null==o&&(o=.75);var s=new e(t.toString());switch(n){case"HIGHLIGHTED_TRUNCATED_STRING_END":return s.snippet_end(r).toString();case"HIGHLIGHTED_TRUNCATED_STRING_START":return s.snippet_start(r).toString();case"HIGHLIGHTED_TRUNCATED_STRING_LAST_WORD":return s.snippet_last_word(r).toString();case"HIGHLIGHTED_TRUNCATED_STRING_FILE_EXTENSION":return s.snippet_file_extension(r).toString();case"HIGHLIGHTED_TRUNCATED_STRING_MIDDLE":default:return s.snippet(r,o).toString()}},e.prototype.widthInfo=function(){var e={};e[-1]=0;for(var t=0,r=this.s.length,o=0<=r;o?t<r:t>r;o?t++:t--)e[t]=e[t-1]+this.ems(this.s.charAt(t));return e},e.prototype.findSpot=function(e){var t;if(!e)return 0;for(var r=0,o=this.s.length;r<=o;){t=Math.floor(r/2+o/2);var n=this.info[t-1];if(n>e)o=t-1;else{if(!(n<e))return t;r=t+1}}return r>t?r:t},e.prototype.ems=function(t){var r=t.charCodeAt(0),o=e.CODEPOINT_TO_WIDTH[r];return o?o/Math.pow(10,e.ACCURACY):768<=r&&r<=879?0:65377<=r&&r<=65500?.58:11904<=r&&r<=40911||44032<=r&&r<=55215||4352<=r&&r<=4607||63744<=r&&r<=64255||65280<=r&&r<=65535||131072<=r&&r<=196607?1.08:.65},e.prototype.substr=function(t,r){var o=this.findSpot(t);if(null!=r){var n=this.findSpot(t+r);if(n-o<this.s.length){var s=this.s.charCodeAt(n-o);65024<=s&&s<=65039&&n--}return new e(this.s.substr(o,n-o))}return new e(this.s.substr(o))},e.prototype.toString=function(){return this.s},e.prototype.snippet=function(t,r){if(void 0===t&&(t=50),void 0===r&&(r=.75),this.length<=t)return this;t-=e._ELLIPSIS_LENGTH;var o=t*r,n=t-o,s=this.length-n,i=this.substr(0,o),a=this.substr(s);return new e(i.toString()+"…"+a.toString())},e.prototype.snippet_end=function(t){return void 0===t&&(t=50),this.length<=t?this:(t-=e._ELLIPSIS_LENGTH,new e(this.substr(0,t).toString()+"…"))},e.prototype.snippet_start=function(t){return void 0===t&&(t=50),this.length<=t?this:(t-=e._ELLIPSIS_LENGTH,new e("…"+this.substr(this.length-t,t).toString()))},e.prototype.snippet_last_word=function(t){if(void 0===t&&(t=50),this.length<=t)return this;var r=this.toString().trim().split(" "),o=r.pop(),n=new e(o).length;if(n>=t)return this.snippet(t);t-=e._ELLIPSIS_LENGTH;var s=t-n;return new e(this.substr(0,s).toString()+"…"+o)},e.prototype.snippet_file_extension=function(t){if(void 0===t&&(t=50),this.length<=t)return this;var r=this.toString().trim().split("."),o=r.pop(),n=new e(o).length;if(n>=t)return this.snippet(t);t-=e._ELLIPSIS_LENGTH;var s=t-n-e._DOT_LENGTH;return new e(this.substr(0,s).toString()+"…."+o)},e})();t.Emstring=r,r.initClass()}),define("retrieval-components/highlighted-truncated-string",["require","exports","tslib","tslib","classnames","react","spectrum/tooltip","retrieval-components/highlighted-truncated-string/em-string","retrieval-components/highlighted-truncated-string/text-highlights"],function(e,t,r,o,n,s,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),s=r.__importStar(s);var c=(function(e){function t(t){var r=e.call(this,t)||this;return r.setRef=function(e){r.textContainerSpan=e},r.updateDisplayTextIfNecessary=function(e){if(r.textContainerSpan){var t=e.fontSize,o=e.text,n=e.availableWidth,s=e.cellBuffer,i=e.variant,l=r.textContainerSpan,c=n?n:l.getBoundingClientRect().width;if(r.props.text!==o||r.state.cellWidth!==c||r.props.fontSize!==t||r.props.variant!==i){r.setState({cellWidth:c});var d=c/t-s,u=a.Emstring.em_snippet(o,d,.5,i);u!==r.state.truncatedText&&r.setState({truncatedText:u}),r.updateTooltip(u,o)}}},r.updateTooltip=function(e,t){e&&t&&r.setState({showTooltip:e!==t})},r.state={truncatedText:t.text,showTooltip:!1},r}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.updateDisplayTextIfNecessary(this.props)},t.prototype.componentWillReceiveProps=function(e){this.updateDisplayTextIfNecessary(e)},t.prototype.render=function(){var e=this.props,t=e.className,r=e.ariaLabel,o=e.highlightSpans,a=e.text,c=e.tooltipPosition,d=e.tooltipId,u=this.state,p=u.truncatedText,h=u.showTooltip;return s.createElement(i.Tooltip,{id:d,positioning:c,tooltipContent:o?l.generateHighlightedTooltipSpans(o):a,showOnMouseMove:h,wrapperClassName:"rc-truncated-string__tooltip"},s.createElement("span",{className:n.default(t,"rc-hl-truncated-string__container"),"aria-label":r,ref:this.setRef,style:{display:"block"}},o?this.getHighlightedSpan(p,a,o):p))},t.prototype.splitTruncatedParts=function(e,t){for(var r=0;r<e.length&&e.charAt(r)===t.charAt(r);)++r;return r===e.length||"…"!==e.charAt(r)?[e]:[e.substring(0,r),e.substring(r+1)]},t.prototype.getHighlightedSpan=function(e,t,r){var o=this.splitTruncatedParts(e,t);if(1===o.length)return l.highlightReactFromHighlightSpans(e,r);var n=l.highlightReactFromHighlightSpans(t,r,0,o[0].length),i=l.highlightReactFromHighlightSpans(t,r,t.lastIndexOf(o[1])),a=l.highlightEllipsisFromHighlightSpans(o[0].length+1,t.lastIndexOf(o[1])-1,r);return s.createElement("span",null,n,a,i)},t.defaultProps={tooltipPosition:"above",cellBuffer:1,variant:"HIGHLIGHTED_TRUNCATED_STRING_MIDDLE"},t})(s.PureComponent);t.HighlightedTruncatedString=c}),define("retrieval-components/highlighted-truncated-string/text-highlights",["require","exports","tslib","classnames","react"],function(e,t,r,o,n){"use strict";function s(e,t,r,o){if(r||(r=0),void 0===o&&(o=e.length),!t||!c(e,t))return[{isHighlighted:!1,text:e.substring(r,o)}];for(var n=[],s=0,i=0,a=t;i<a.length;i++){var l=a[i],d=e.indexOf(l.string,s),u=d+l.string.length;if(s=u,!(d<r&&u<=r||d>=o)){var p=l.string;d<r&&(p=p.slice(r-d)),o<u&&(p=p.slice(0,-(u-o))),n.push({text:p,isHighlighted:l.isHighlighted})}}return n}function i(e,t,r,o){return d(s(e,t,r,o))}function a(e,t,r){return n.createElement("span",{className:o.default({"rc-hl-truncated-string__highlight":l(e,t,r)})},"…")}function l(e,t,r){if(!r)return!1;for(var o=0,n=0,s=r;n<s.length;n++){var i=s[n],a=o+i.string.length-1;if(i.isHighlighted&&a>=e&&o<=t)return!0;o=a+1}return!1}function c(e,t){return e===t.map(function(e){return e.string}).join("")}function d(e){return n.createElement("span",null,e.map(function(e,t){return n.createElement("span",{className:o.default({"rc-hl-truncated-string__highlight":e.isHighlighted}),key:t},e.text)}))}function u(e){return n.createElement("span",null,e.map(function(e,t){return n.createElement("span",{className:o.default({"rc-hl-truncated-string__tooltip-highlight":e.isHighlighted}),key:t},e.string)}))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importStar(n);t.highlightSectionsFromHighlightSpans=s,t.highlightReactFromHighlightSpans=i,t.highlightEllipsisFromHighlightSpans=a,t.generateHighlightedTooltipSpans=u}),define("retrieval-components/pinned-item",["require","exports","tslib","react","classnames","retrieval-components/thumbnail-icon","retrieval-components/truncated-string","spectrum/icon_content","spectrum/overflow_button","spectrum/popover"],function(e,t,r,o,n,s,i,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),n=r.__importDefault(n);var d=function(e){return"menuOptions"in e},u=function(e){return!!e.isFolder};t.PinnedItem=function(e){var t=function(t){t.preventDefault(),e.onClick()};return o.default.createElement("div",{className:n.default(["rc-pinned-item__wrapper",e.className])},o.default.createElement("a",{className:"rc-pinned-item",href:e.url,onClick:t,"data-fqpath":e.fqPath,"data-isdir":u(e)},o.default.createElement("div",{className:"rc-pinned-item__file-icon"},u(e)?o.default.createElement("span",null,o.default.createElement(a.IconContent,{name:e.folderIcon})):o.default.createElement(s.ThumbnailIcon,{path:e.filename,variant:"large",thumbnailUrl:e.thumbnailUrl})),o.default.createElement("div",{className:"rc-pinned-item__info"},o.default.createElement(i.TruncatedString,{text:e.filename,className:"rc-pinned-item__name",variant:u(e)?i.TruncatedStringVariant.TRUNCATED_STRING_LAST_WORD:i.TruncatedStringVariant.TRUNCATED_STRING_FILE_EXTENSION}),o.default.createElement("span",{className:"rc-pinned-item__subtitle"},e.subtitle))),d(e)?o.default.createElement(c.Popover,{className:"rc-pinned-item__menu-button",onSelection:e.onMenuOptionClick},o.default.createElement(c.PopoverTrigger,null,o.default.createElement(l.OverflowButton,{tagName:"span","aria-label":e.menuLabel,size:"small"})),o.default.createElement(c.PopoverContent,{attachment:"left"},e.menuOptions.map(function(e){var t=e.key,r=e.label,n=e.isDisabled;return o.default.createElement(c.PopoverContentItem,{key:t,value:t,disabled:n},r)}))):null)}}),define("retrieval-components/thumbnail-icon",["require","exports","tslib","tslib","react","spectrum/file_icon"],function(e,t,r,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n);var i=(function(e){function t(t){var r=e.call(this,t)||this;return r.addEventListeners=function(){r.thumbnail&&(r.removeEventListeners(),r.thumbnail.addEventListener("load",r.handleImageLoaded),r.thumbnail.addEventListener("error",r.handleImageError))},r.removeEventListeners=function(){r.thumbnail&&(r.thumbnail.removeEventListener("load",r.handleImageLoaded),r.thumbnail.removeEventListener("error",r.handleImageError))},r.handleImageLoaded=function(){r.setState({thumbnailLoadingState:"loaded"}),r.removeEventListeners()},r.handleImageError=function(){r.setState({thumbnailLoadingState:"error"})},r.setThumnailRef=function(e){r.thumbnail=e,r.addEventListeners()},r.className=function(){return["rc-thumbnail-icon","rc-thumbnail-icon--"+(r.props.variant||"small"),r.props.className].join(" ")},r.state={thumbnailLoadingState:r.props.thumbnailUrl?"loading":"loaded"},r}return o.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){this.props.thumbnailUrl!==e.thumbnailUrl&&(this.removeEventListeners(),this.setState({thumbnailLoadingState:e.thumbnailUrl?"loading":"loaded"}),e.thumbnailUrl&&this.addEventListeners())},t.prototype.componentWillUnmount=function(){this.removeEventListeners()},t.prototype.render=function(){return n.default.createElement("div",{className:this.className()},"loading"===this.state.thumbnailLoadingState?n.default.createElement("img",{key:"loader",src:this.props.thumbnailUrl,ref:this.setThumnailRef,className:"rc-thumbnail-icon__loader","aria-hidden":!0}):null,this.props.thumbnailUrl&&"loaded"===this.state.thumbnailLoadingState?n.default.createElement("img",{src:this.props.thumbnailUrl}):null,this.props.thumbnailUrl&&"loaded"===this.state.thumbnailLoadingState?null:n.default.createElement(s.FileIcon,{key:"thumbnail",path:this.props.path,variant:this.props.variant,className:"rc-thumbnail-icon__file-icon"}))},t})(n.default.PureComponent);t.ThumbnailIcon=i}),define("retrieval-components/truncated-string",["require","exports","tslib","tslib","react","classnames","spectrum/tooltip","spectrum/dimensions"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importDefault(n),s=r.__importDefault(s);var l;(function(e){e.TRUNCATED_STRING_END="TRUNCATED_STRING_END",e.TRUNCATED_STRING_START="TRUNCATED_STRING_START",e.TRUNCATED_STRING_MIDDLE="TRUNCATED_STRING_MIDDLE",e.TRUNCATED_STRING_LAST_WORD="TRUNCATED_STRING_LAST_WORD",e.TRUNCATED_STRING_FILE_EXTENSION="TRUNCATED_STRING_FILE_EXTENSION"})(t.TruncatedStringVariant||(t.TruncatedStringVariant={})),t.TruncatedStringVariantClass=(l={},l[t.TruncatedStringVariant.TRUNCATED_STRING_END]="rc-truncated-string--end",l[t.TruncatedStringVariant.TRUNCATED_STRING_START]="rc-truncated-string--start",l[t.TruncatedStringVariant.TRUNCATED_STRING_MIDDLE]="rc-truncated-string--middle",l[t.TruncatedStringVariant.TRUNCATED_STRING_LAST_WORD]="rc-truncated-string--last-word",l[t.TruncatedStringVariant.TRUNCATED_STRING_FILE_EXTENSION]="rc-truncated-string--file-extension",l);var c=(function(e){function r(r){var o=e.call(this,r)||this;return o.setCalculator=function(e){o.calculator=e},o.setWrapper=function(e){o.wrapper=e},o.updateTooltip=function(){if(o.calculator&&o.wrapper){
var e=o.calculator.getBoundingClientRect().width,t=o.wrapper.getBoundingClientRect().width;o.setState({showTooltip:e>t})}},o.debouncedUpdateTooltip=function(){"clearTimeout"in window&&"setTimeout"in window&&(clearTimeout(o.updateTooltipTimeout),o.updateTooltipTimeout=setTimeout(function(){return o.updateTooltip()},50))},o.calculatePiecesFromProps=function(e){void 0===e&&(e=o.props);var r=e.text;switch(e.variant){case t.TruncatedStringVariant.TRUNCATED_STRING_END:case t.TruncatedStringVariant.TRUNCATED_STRING_START:default:return[r];case t.TruncatedStringVariant.TRUNCATED_STRING_MIDDLE:var n=Math.floor(2*r.length/3),s=r.indexOf(" ",n);return[r.substr(0,s),r.substr(s)];case t.TruncatedStringVariant.TRUNCATED_STRING_LAST_WORD:var i=r.trim().split(" "),a=i.pop();return[i.join(" "),a].filter(function(e){return!!e});case t.TruncatedStringVariant.TRUNCATED_STRING_FILE_EXTENSION:var i=r.trim().split(".");if(i.length<=1)return[r];var a=i.pop();return[i.join("."),"."+a]}},o.state={pieces:o.calculatePiecesFromProps(r),showTooltip:!1},o}return o.__extends(r,e),r.prototype.componentDidMount=function(){this.updateTooltip()},r.prototype.componentWillReceiveProps=function(e){this.setState({pieces:this.calculatePiecesFromProps(e),showTooltip:!1})},r.prototype.componentDidUpdate=function(){},r.prototype.render=function(){var e=this,r=this.props,o=r.className,l=r.variant,c=r.text,d=this.state,u=d.pieces,p=d.showTooltip;return n.default.createElement(i.Tooltip,{positioning:"below",tooltipContent:c,showOnMouseMove:p,wrapperClassName:"rc-truncated-string__tooltip"},n.default.createElement(a.Dimensions,null,function(r){r.width;return e.debouncedUpdateTooltip(),n.default.createElement("span",{className:s.default(["rc-truncated-string",o,t.TruncatedStringVariantClass[l]]),ref:e.setWrapper},n.default.createElement("span",{className:"rc-truncated-string__calculator","aria-hidden":!0,ref:e.setCalculator},c),u.map(function(e,t){return n.default.createElement("span",{key:t,className:s.default({"rc-truncated-string__piece":!0,"rc-truncated-string__piece--last-piece":0!==t&&t===u.length-1})},e)}))}))},r})(n.default.PureComponent);t.TruncatedString=c}),define("spectrum/icon_mode/bundle",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS={grid:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},dangerouslySetInnerIconHtml:'<g fill="#637282" fill-rule="evenodd"><path d="M7 7h2v2H7zM11 7h2v2h-2zM15 7h2v2h-2zM7 11h2v2H7zM11 11h2v2h-2zM15 11h2v2h-2zM7 15h2v2H7zM11 15h2v2h-2zM15 15h2v2h-2z"></path></g>'},list:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},dangerouslySetInnerIconHtml:'<g fill="#637282" fill-rule="evenodd"><path d="M6 15h2v2H6zM10 15h8v2h-8zM6 11h2v2H6zM10 11h8v2h-8zM6 7h2v2H6zM10 7h8v2h-8z"></path></g>'},tiles:{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"},dangerouslySetInnerIconHtml:'<g fill="#637282" fill-rule="evenodd"><path d="M7 7h4v4H7zM13 7h4v4h-4zM13 13h4v4h-4zM7 13h4v4H7z"></path></g>'}}}),define("spectrum/icon_mode",["require","exports","tslib","tslib","react","spectrum/icon_templates/stateless","spectrum/svg_icon_bundle","spectrum/icon_mode/bundle"],function(e,t,r,o,n,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),t.ICONS=a.ICONS,t.IconMode=function(e){var t=e.name,r=n.createElement(i.SvgIconBundle,{focusable:"false",icon:a.ICONS[t]});return n.createElement(s.Component,o.__assign({icon:r},e))},t.IconMode.displayName="IconMode"});
//# sourceMappingURL=pkg-browse.min.js-vflIKlTDG.map